"use strict";

paAcl.$inject = ["$http", "$q", "paCache", "config"];
angular.module('paApp').factory('paAcl', paAcl);

function paAcl($http, $q, paCache, config) {
  var permissions = {};
  return {
    loadPermissions: function(){
      $http.get(config.apiUrl + '/ws/allowedPermissions').then(function (resp) {
        permissions = resp.data;
      });
    },
    isAllowed: function isAllowed(resource, permission) {
      var deferred = $q.defer();
      $http.get(config.apiUrl + '/ws/isAllowed/' + resource + '/' + permission).then(function (resp) {
        return deferred.resolve(resp.data);
      });
      return deferred.promise;
    },
    hasPermission: function(resource, permission){
      return permissions[resource] && permissions[resource].includes(permission);
    },
    loadSystemResources: function(){
      var conf = paCache.getConf();
      $http.get(config.apiUrl + '/ws/systemResources').then(function (resp) {
        conf.systemResources = _.sortBy(resp.data, 'order');
      });
    }
  };
}
'use strict';

authService.$inject = ["$q", "$http", "$window", "config"];
angular.module('paApp').factory('authService', authService);

function authService($q, $http, $window, config) {
  return {
    login: function(username, password, callback) {
      //var deferred = $q.defer();
      $http.post(config.apiUrl + '/login', {
        username: username,
        password: password
      }).then(
      function (response) {
        if (response && response.data && response.data.token) {
          $window.localStorage.setItem('pa.token', response.data.token);
          callback({
            success: true,
            data: response.data
          });
        } else {
          callback({
            success: false,
            error: 'Invalid credentials'
          });
        }
      },
      function (error) {
        callback({
          success: false,
          error: error
        });
      });
    },
    mirgovoritLogin: function(data, callback) {
      //var deferred = $q.defer();
      $http.post(config.apiUrl + '/ws/mirgovorit/login', {
        data: data
      }).then(
      function (response) {
        if (response && response.data && response.data.token) {
          $window.localStorage.setItem('pa.token', response.data.token);
          callback({
            success: true,
            data: response.data.profile
          });
        } else {
          callback({
            success: false,
            error: 'Invalid credentials'
          });
        }
      },
      function (error) {
        callback({
          success: false,
          error: error
        });
      });
    },
    logout: function logout() {
      var deferred = $q.defer();
      $http.get(config.apiUrl + '/ws/logout').then(function (response) {
        deferred.resolve();
      });
      return deferred;
    },
    getStrategies: function(){
      var deferred = $q.defer();
      $http.get(config.apiUrl + '/ws/auth/strategies').then(function (response) {
        deferred.resolve(response.data);
      });
      return deferred.promise;
    }
  };
}
"use strict";

paCache.$inject = ["$log", 'config'];
angular.module('paApp').factory('paCache', paCache);

function paCache($log, config) {
  var data = {
    initialized: false
  };
  var conf = {};
  var feed = {};
  var pageScope = {};
  var alerts = [];
  var events = {};
  var counters= null;
  var localization={
    locales: [
      {code:'it',desc:'italiano'},
      {code:'en',desc:'english'},
      {code:'ru',desc:'русский'},
      {code:'fr',desc:'francais'},
      {code:'de',desc:'deutsche'}
    ]
  }
  return {
    setOnlineUsers: function(users) {
      conf.onlineUsers = _.indexBy(users, 'student');
    },
    setCurrentPage: function(page) {
      conf.currentPage = page;
    },
    setCurrentFolder: function(folder) {
      conf.currentFolder = folder;
    },
    setCurrentContent: function(content) {
      conf.currentContent = content;
    },
    setCurrentHomework: function(homework) {
      conf.currentHomework = homework;
    },
    setCurrentMode: function(mode) {
      conf.currentMode = mode;
    },
    setSelected: function(i, sel) {
      if(!data.selected){
        data.selected={};
      }
      data.selected[i] = sel;
    },
    getSelected: function(i) {
      return data.selected[i];
    },
    setSelectedImage: function(msg) {
      data.selectedImage = msg._id;
    },
    setTab: function(i) {
      data.tab = i;
    },
    setSize: function(s) {
      data.size = s;
    },
    setSize2: function(s) {
      data.size2 = s;
    },
    set: function(name, value) {
      data[name] = value;
    },
    stopRec: function() {
      data.rec = false;
    },
    setChannel: function(channel) {
      conf.channel = channel;
    },
    setSidebarTab: function(tab) {
      if (!conf.sidebar) {
        conf.sidebar={};
      }
      conf.sidebar.tab=tab;
    },
    init: function() {
      var jq = (angular.element === window.jQuery);
      if (!jq) {
        $log.error('using jqLite');
      }
      data = {
        initialized: true,
        selected: {},
        ratio: 1,
        size: 3,
        size2: 7,
        opacity: .4,
        selectedImage: -1,
        selectedDiv: -1,
        tab: 1,
        counter: 0,
        counters: {},
        temp: {},
        notifications: [],
        unit: angular.element('#panel').width() / 12,
        unitW: angular.element('#panel').width() / 100,
        unitH: angular.element('#panel').height() / 100,
        selCollections: {},
        audio: {},
        tooltips: {},
        player: {}
      };
      return data;
    },
    initCounters: function(obj){
      counters = obj;
    },
    getCounters: function(){
      return counters;
    },
    initPageScope: function(){
      pageScope={};
      return pageScope;
    },
    getPageScope: function(){
      return pageScope;
    },
    getData: function() {
      return data;
    },
    getConf: function() {
      return conf;
    },
    getFeed: function() {
      return feed;
    },
    getAlerts: function(){
      return alerts;
    },
    getEvents: function(){
      return events;
    },
    getDrops: function(){
      if (!data.drops){
        data.drops={};
      }
      return data.drops;
    },
    getLocalization: function(){
      return localization;
    },
    initLocale: function() {
      var storedLocale = window.localStorage.getItem('pa.locale');
      if (!storedLocale) {
        this.setUserLocale(config.defaultLocale);
      } else {
        this.setUserLocale(storedLocale);
      }
    },
    setUserLocale: function(locale){
      var userLocale = localization.locales.find((l)=>l.code==locale);
      if (userLocale) {
        localization.userLocale = userLocale;
        window.localStorage.setItem('pa.locale', userLocale.code);
      }
    },
    getUserLocale: function() {
      return localization.userLocale;
    }
  };
}
"use strict";

paChannel.$inject = ["$q", "$rootScope", "$http", "paCache", "config"];
angular.module('paApp').factory('paChannel', paChannel);

function paChannel($q, $rootScope, $http, paCache, config) {
  return {
    loadValidStudents: function(){
      $http.get(config.apiUrl + '/ws/findUserSubscriptions/' + $rootScope.user.channel).then(function (resp) {
        var pageScope = paCache.getPageScope();
        pageScope.validStudents = _.indexBy(resp.data,'student');
      })
    },
    saveLesson: function(subscription){
      var conf = paCache.getConf();
      $http.post(config.apiUrl + '/ws/newLesson/' + subscription.student._id + '/' + $rootScope.user.teacher + '/' + conf.channel._id);
    },
    loadRoom: function() {
        var self = this;
        var conf = paCache.getConf();
  
        $http.get(config.apiUrl + '/ws/findChannelSubscriptions/' + conf.channel._id).then(function (resp) {
          conf.room.subscriptions=resp.data;

          var promises=[];
          _.each(resp.data,function(subscr){
            var promise = $http.get(config.apiUrl + '/ws/studentData/'+subscr.student._id).then(function(resp){
              return resp.data;
            })
            promises.push(promise);
          });
          var promise = $http.get(config.apiUrl + '/ws/teacherData/'+$rootScope.user.channel).then(function(resp){
            return resp.data;
          })
          promises.push(promise);
  
          $q.all(promises).then(function(result){
              // sort
              conf.room.users=result;
              conf.user=_.find(result, function(user){
                return user.id==$rootScope.user.id;
              })
              console.log('conf.room.users:'+result.length);
          })
        })
      },
      joinChannel: function(id){
        var deferred = $q.defer();
        $http.get('/ws/channels/'+id+'/join').then(function(resp){
          return deferred.resolve(resp.data);
        })
        return deferred.promise;
      },
      findOrCreateChannel: function(id){
        var deferred = $q.defer();
        $http.get('/ws/findOrCreateChannel/teachers/'+id).then(function(resp){
          return deferred.resolve(resp.data);
        })
        return deferred.promise;
      },
      subscribeChannel: function(subscr) {
        var deferred = $q.defer();
        $http.post('/ws/students/'+subscr.student+'/subscribeChannel',subscr).then(function(resp){
          return deferred.resolve(resp.data);
        })
        return deferred.promise;
      },
      unsubscribeChannel: function(subscr) {
        var deferred = $q.defer();
        $http.post('/ws/students/'+subscr.student+'/unsubscribeChannel').then(function(resp){
          return deferred.resolve(resp.data);
        })
        return deferred.promise;
      },
      saveSubscriptions: function(subscriptions) {
        var conf = paCache.getConf();

        var deferred = $q.defer();
        $http.post('/ws/channels/'+conf.channel._id+'/subscriptions', subscriptions).then(function(resp){
          return deferred.resolve(resp.data);
        })
        return deferred.promise;
      },
      openChannel: function(id){
        var deferred = $q.defer();
        $http.post(config.apiUrl + '/ws/openChannel/' + id).then(function (resp) {
          return deferred.resolve(resp.data);
        });
        return deferred.promise;
      }
    }
}
"use strict";

exceptionHandler.$inject = ['$log', 'LogglyLogger', '$injector'];
angular.module('paApp').factory('$exceptionHandler', exceptionHandler);

function exceptionHandler($log, LogglyLogger, $injector) {
    return function(exception, cause) {
		var rootScope = $injector.get('$rootScope');
		if (rootScope){
			LogglyLogger.fields( { username: rootScope.user.username } );
		}
		$log.error(exception, cause);
    };
}
"use strict";

paFeed.$inject = ["$rootScope", "$http", "$q", "paCache", "config"];
angular.module('paApp').factory('paFeed', paFeed);

function paFeed($rootScope, $http, $q, paCache, config) {
    return {
        loadFeeds: function(){
            $http.get('/ws/feeds').then(function(resp){
                var pageScope = paCache.getPageScope();
                pageScope.feeds=resp.data;
            })
        },
        addFeed: function(feed) {
            var deferred = $q.defer();
            $http.post('/ws/feeds', feed).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        updateFeed: function(feed) {
            var deferred = $q.defer();
            $http.put('/ws/feeds/'+feed._id, feed).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        removeFeed: function(feed) {
            var deferred = $q.defer();
            $http.delete('/ws/feeds/'+feed._id).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        }
   }
}
"use strict";

paHomework.$inject = ["$rootScope", "$http", "$q", "paCache", "config"];
angular.module('paApp').factory('paHomework', paHomework);

function paHomework($rootScope, $http, $q, paCache, config) {
    return {
        loadHomeworks: function(student){
            $http.get('/ws/homeworks/students/'+student).then(function(resp){
                var pageScope = paCache.getPageScope();
                pageScope.homeworks=resp.data;
                pageScope.homeworksOpen=_.filter(pageScope.homeworks, h=>!h.done).length;
            })
        },
        addHomework: function(homework) {
            var deferred = $q.defer();
            $http.post('/ws/homeworks', homework).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        editHomework: function(homework) {
            var deferred = $q.defer();
            $http.put('/ws/homeworks/'+homework._id, homework).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        removeHomework: function(homework) {
            var deferred = $q.defer();
            $http.delete('/ws/homeworks/'+homework._id).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        patchHomework: function(student, content, patch){
            var deferred = $q.defer();
            $http.put('/ws/homeworks/students/'+student+'/contents/'+content, patch).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        saveComment: function(homework, comment) {
            var deferred = $q.defer();
            $http.post('/ws/homeworks/'+homework._id+'/comments', {comment: comment}).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        updateComment: function(homework, i, comment) {
            var deferred = $q.defer();
            $http.put('/ws/homeworks/'+homework._id+'/comments/'+i, {comment: comment}).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        removeComment: function(homework, i) {
            var deferred = $q.defer();
            $http.delete('/ws/homeworks/'+homework._id+'/comments/'+i).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        }
    }
}
"use strict";

authInterceptor.$inject = ["$window", "$q", "toaster"];
angular.module('paApp').factory('authInterceptor', authInterceptor);

function authInterceptor($window, $q, toaster) {
  return {
    request: function request(config) {
      if(!config.url.startsWith('https://a34alefeliza.github.io') 
      && !config.url.startsWith('https://customsearch.googleapis.com') 
      && !config.url.startsWith('https://www.googleapis.com/youtube')){
        config.headers['Authorization'] = 'Bearer ' + $window.localStorage.getItem('pa.token');
      }
      return config;
    },
    responseError: function responseError(response) {
      if (response.status === 401) {
        //toaster.pop('error', "Access denied", "not authenticated"); //$window.location.href = '/login';
      } else if (response.status === 403) {
        toaster.pop('error', "Access denied", "not authorized");
      } else if (response.status === 500) {
        toaster.pop('error', "Error", response.data);
      } else if (response.status === 404 || response.status === 409) {
        return $q.reject(response);
      }
    }
  };
}
"use strict";

paIntro.$inject = ["$rootScope", "$state", "$http", "$q", "$timeout", "paCache", "config", "ngIntroService", "toaster"];
angular.module('paApp').factory('paIntro', paIntro);

function paIntro($rootScope, $state, $http, $q, $timeout, paCache, config, ngIntroService, toaster) {
    return {
        resetIntro: function() {
            var deferred = $q.defer();
            $http.post('/ws/intro/reset/'+$rootScope.user.id).then(function(resp){
                return deferred.resolve(resp.data);
            });
            return deferred.promise;
        },
        pageTour: function(page) {
            var self=this;
            if (config.intro && $rootScope.user.role=='T'){
                $http.get(config.apiUrl+'/ws/intro/'+page).then(function(resp){
                    var pageSteps = resp.data;
                    if (pageSteps && pageSteps.length){

                        var showUserProfile = _.find(pageSteps, function(step){
                            return step.showUserProfile;
                        });
                        if (showUserProfile){
                            var conf = paCache.getConf();
                            conf.sidebar={
                                show:true,
                                tab:1
                            }
                            //$rootScope.$apply();
                        }
                        $timeout(function(){

                            var introOptions = {
                                showStepNumbers:false,
                                showBullets:false,
                                showProgress:false,
                                tooltipClass:'pa-tooltip',
                                //exitOnEsc: false,
                                exitOnOverlayClick: false,
                                hidePrev: true,
                                hideNext: true,
                                nextToDone: true,
                                steps: pageSteps
                            };
                            ngIntroService.clear();
                            ngIntroService.setOptions(introOptions);
                            ngIntroService.onComplete(function(){
                                var map = {};
                                map[page] = new Date();
                                $http.post('/ws/intro/lastSeen/'+$rootScope.user.id, map);
                            })
                            ngIntroService.onExit(function(){
                                var map = {};
                                map[page] = new Date();
                                $http.post('/ws/intro/lastSeen/'+$rootScope.user.id, map);
                            })
                            ngIntroService.start();
    
                        }, 0, false);
                    }
                })
            }    
        },
        getSteps: function() {
            var deferred = $q.defer();
            $http.get('/ws/steps').then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        saveSteps: function(steps){
            $http.put('/ws/steps', steps).then(function(resp){
                toaster.pop('success', 'Steps', 'Steps saved succesfully');
            })
        },
        saveStep: function(step){
            $http.post('/ws/steps', step).then(function(resp){
                toaster.pop('success', 'Step', 'Step saved succesfully');
                $state.transitionTo('intro-steps');
            })
        },
        removeStep: function(step){
            $http.delete('/ws/steps/'+step._id).then(function(resp){
                toaster.pop('success', 'Step', 'Step removed succesfully');
                $state.transitionTo('intro-steps');
            })
        }

    }
}
"use strict";

paMenu.$inject = ["$http", "$q", "paCache", "config"];
angular.module('paApp').factory('paMenu', paMenu);

function paMenu($http, $q, paCache, config) {
  return {
    pages:{},
    contents:{},
    loadFolders: function(){
      var conf=paCache.getConf();
      if(!conf.allFolders){
        $http.get(config.apiUrl + '/ws/menu/findAllFolders').then(function (resp) {
          conf.allFolders = _.sortBy(resp.data, 'order');
        });
      }
    },
    loadMyFolders: function(teacher){
      var conf = paCache.getConf();
      $http.get(config.apiUrl + '/ws/menu/findFolders/' + teacher).then(function (resp) {
        conf.myFolders = resp.data;
      });
      $http.get(config.apiUrl + '/ws/menu/folderSubscriptions/' + teacher).then(function (resp) {
        conf.myFolderSubscriptions = resp.data;
      });
    },
    loadPages: function(folder, forceReload){
      var self=this;
      var conf=paCache.getConf();
      if (!self.pages[folder._id] || forceReload){
        $http.get(config.apiUrl + '/ws/menu/findPages/' + folder._id).then(function (result) {
          _.each(result.data, function(page){
            page.template=conf.templates[page.template];
          })
          self.pages[folder._id] = _.sortBy(result.data, 'pos');
          folder.pages = self.pages[folder._id];
        });
      } else {
        folder.pages = self.pages[folder._id];
      }
    },
    loadContents: function(folder, forceReload){
      var self=this;
      var conf=paCache.getConf();
      if (!self.contents[folder._id] || !self.pages[folder._id] || forceReload){
        $http.get(config.apiUrl + '/ws/findContentsByFolder/' + folder._id).then(function (result) {

          _.each(result.data.pages, function(page){
            page.template=conf.templates[page.template];
          })
          self.pages[folder._id] = _.sortBy(result.data.pages, 'pos');
          folder.pages = self.pages[folder._id];

          var pMap = _.indexBy(result.data.pages,'_id');
          _.each(result.data.contents, function(content){
            content.page=pMap[content.page];
          })
          self.contents[folder._id] = _.sortBy(result.data.contents, 'name');
          folder.contents = self.contents[folder._id];
        });
      } else {
        folder.contents = self.contents[folder._id];
        folder.pages = self.pages[folder._id];
      }
    },
    seachCollectionsByName: function(name){
      var deferred = $q.defer();
      $http.post('/ws/collections/search', {name:name}).then(function(result){
        return deferred.resolve(result.data);
      });
      return deferred.promise;
    }
  };
}
"use strict";

paService.$inject = ["$q", "$rootScope", "$state", "$stateParams", "$http", "runtimeStates", "paCache", "paSocket", "paMenu", "ngAudio", "config", "toaster"];
angular.module('paApp').factory('paService', paService);

function paService($q, $rootScope, $state, $stateParams, $http, runtimeStates, paCache, paSocket, paMenu, ngAudio, config, toaster) {
  return {
    init: function init() {
      var conf = paCache.getConf();
      var data = paCache.init();
      var self = this;

      /*if (conf.channel && conf.channel.open) {
        paCache.setSidebarTab(2);
      } else {
        paCache.setSidebarTab(1);
      }*/
  
      if ($state.current.name) {
        if ($stateParams.content.type == 'C') {
          // by content
          data.selCollections.readonly = true;
          this.loadPageContent(conf.currentContent);
        } else if ($stateParams.content.type == 'W') {
          // by workplan
          data.selCollections.readonly = true;
          this.loadPageContent(conf.currentContent);
        } else if ($stateParams.content.type == 'P') {
          // by page
          data.selCollections.readonly = false;
          $http.get(config.apiUrl + '/ws/pageConf/' + $rootScope.user.channel + '/' + conf.currentPage._id).then(function (resp) {
            if (resp.data){
              self.loadPageContent(resp.data);
            }
          });
        }

        // initial size
        data.size = 15;
        data.size2 = 10;
        data.textsize = 2;
        data.textsize2 = 2;

        var params = _.extend(conf.currentPage.template.params, conf.currentPage.params);
        if (params) {
          data.pageParams = params;

          if (params.onClickAudio) {
            data.onClickAudio = ngAudio.load(params.onClickAudio);
            if (data.onClickAudio.error){
              throw new Error('error loading audio');
            }
          }

          if (params.size) {
            data.size = parseInt(params.size);
          }

          if (params.size2) {
            data.size2 = parseInt(params.size2);
          }

          if (params.opacity) {
            data.opacity = parseFloat(params.opacity);
          }

          if (params.textsize) {
            data.textsize = parseFloat(params.textsize);
          }

          if (params.textsize2) {
            data.textsize2 = parseFloat(params.textsize2);
          }

          if (params.ratio) {
            data.ratio = parseFloat(params.ratio);
          }
        }

        self.findParams().then(function (params) {
          if (params) {
            if (params.size) {
              data.size = parseInt(params.size);
            }

            if (params.size2) {
              data.size2 = parseInt(params.size2);
            }

            if (params.opacity) {
              data.opacity = parseFloat(params.opacity);
            }

            if (params.textsize) {
              data.textsize = parseFloat(params.textsize);
            }

            if (params.textsize2) {
              data.textsize2 = parseFloat(params.textsize2);
            }

            if (params.ratio) {
              data.ratio = parseFloat(params.ratio);
            }
          }
        });

      }

      return data;
    },
    findText: function findText() {
      var deferred = $q.defer();

      var data = paCache.getData();
      var conf = paCache.getConf();
      if ($stateParams.content.type == 'C') {
        // by content
        data.selCollections.readonly = true;
        $http.get(config.apiUrl + '/ws/findTextByCode/' + $rootScope.user.channel + '/' + conf.currentContent.text).then(function (resp) {
          if (resp.data) {
            data.selCollections.text = resp.data._id;
          }

          return deferred.resolve(resp.data);
        });
      } else if ($stateParams.content.type == 'W') {
        // by workplan
        data.selCollections.readonly = true;
        $http.get(config.apiUrl + '/ws/findTextByCode/' + $rootScope.user.channel + '/' + conf.currentContent.text).then(function (resp) {
          if (resp.data) {
            data.selCollections.text = resp.data._id;
          }

          return deferred.resolve(resp.data);
        });
      } else if ($stateParams.content.type == 'P') {
        // by page
        data.selCollections.readonly = false;
        $http.get(config.apiUrl + '/ws/findActiveText/' + conf.currentPage._id + '/' + $rootScope.user.channel).then(function (resp) {
          if (resp.data) {
            data.selCollections.text = resp.data._id;
          }

          return deferred.resolve(resp.data);
        });
      }

      return deferred.promise;
    },
    split: function split(chars, sep) {
      var chunks = [];
      var i=0;
      var chunk = {
        i: i,
        chars: [],
        textValue: '',
        type: 'chunk'
      };
      chunks.push(chunk);

      _.each(chars, function (c) {
        if (c.val == sep) {
          chunk = {
            i: ++i,
            chars: [],
            textValue: '',
            type: 'chunk'
          };
          chunks.push(chunk);
        } else {
          chunk.chars.push(c);
          chunk.textValue+=c.val;
        }
      });

      return chunks;
    },
    destroy: function destroy() {
      var data = paCache.getData();

      _.each(data.audioCollection, function (item) {
        item.audio.pause();
      });
    },
    loadPageContent: function loadPageContent(content) {
      paCache.setCurrentContent(content);
      var data = paCache.getData();
      var conf = paCache.getConf();
      var self=this;

      if (content.page && content.page.collections && content.page.collections.img && content.img) {
        data.selCollections.img = content.img;
        this.findCollectionByCode(content.img).then(function (collection) {
          if (collection) {
            if (conf.currentPage.params && conf.currentPage.params.shuffleImages) {
              if ($rootScope.admin) {
                paSocket.emit('images', _.shuffle(collection.resources));
              }
            } else {
              data.images = collection.resources;
            }
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.img2 && content.img2) {
        data.selCollections.img2 = content.img2;
        this.findCollectionByCode(content.img2).then(function (collection) {
          if (collection) {
            if (conf.currentPage.params && conf.currentPage.params.shuffleImages2) {
              if ($rootScope.admin) {
                paSocket.emit('images2', _.shuffle(collection.resources));
              }
            } else {
              data.images2 = collection.resources;
            }
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.text && content.text) {
        data.selCollections.text = content.text;
        this.findTextByCode(content.text).then(function (collection) {
          if (collection) {
            data.text = collection.chars;
            data.textResources = collection.resources;

            _.each(collection.chars, function (c, i) {
              c.index = i;
            });
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.text2 && content.text2) {
        data.selCollections.text2 = content.text2;
        this.findTextByCode(content.text2).then(function (collection) {
          if (collection) {
            data.text2 = collection.chars;

            _.each(collection.chars, function (c, i) {
              c.index = i;
            });
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.audio && content.audio) {
        data.selCollections.audio = content.audio;
        this.findCollectionByCode(content.audio).then(function (collection) {
          if (collection) {
            var audioCollection = [];

            _.each(collection.resources, function (res, i) {
              var audio=ngAudio.load(res.src);
              if(audio.error){
                throw new Error('error loading audio');
              }
              audioCollection.push({
                audio: audio,
                title: res.title,
                i: i
              });
            });

            data.audioCollection = audioCollection;
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.card && content.card) {
        data.selCollections.card = content.card;
        this.findCollectionByCode(content.card).then(function (collection) {
          if (collection) {
            data.cards = collection.resources;
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.url && content.url) {
        data.selCollections.url = content.url;
        this.findCollectionByCode(content.url).then(function (collection) {
          if (collection) {
            data.url = collection.resources;
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.mixed && content.mixed) {
        data.selCollections.mixed = content.mixed;
        this.findCollectionByCode(content.mixed).then(function (collection) {
          if (collection) {
            data.mixed = collection.resources;
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.mixed2 && content.mixed2) {
        data.selCollections.mixed2 = content.mixed2;
        this.findCollectionByCode(content.mixed2).then(function (collection) {
          if (collection) {
            data.mixed2 = collection.resources;
          }
        });
      }

      if (content.page && content.page.collections && content.page.collections.grid && content.grid) {
        data.selCollections.grid = content.grid;
        this.findCollectionByCode(content.grid).then(function (collection) {
          if (collection) {
            data.grid = collection.resources;
          }
        });
      }

      if ($rootScope.admin && content.page && content.page.collections){
        var sel=0;
        _.each(_.keys(content.page.collections), function(coll){
          if (content[coll]){
            sel++;
          }
        })
        if (sel==0 && _.keys(content.page.collections).length>1){
          toaster.pop('warning','Warning', "No collection selected. Please select at least one collection.")
        }
      }
    },
    processResources: function(resources){
      var count = paCache.getCounters();
      var self=this;
      _.each(resources,function(res){
        res.id=count.i++;
        if (res.type=='card'){
          self.processResource(res.front);
          self.processResource(res.back);
        } else {
          self.processResource(res);
        }
      })
    },
    processResource: function(res) {
      if (res) {        
        var count = paCache.getCounters();
        var self=this;
        if (res.type=='text'){
          res.words=self.split(res.chars,' ');
          _.each(res.words,function(word){
            word.id=count.w++;
          })
        }
        _.each(res.chars,function(char){
          char.id=count.c++;
        })
      }
    },
    findCollectionByCode: function findCollectionByCode(code) {
      var deferred = $q.defer(); // conf.currentFolder is not defined on student side
      //var conf = paCache.getConf();

      var self=this;
      $http.get(config.apiUrl + '/ws/findCollectionByCode/' + $rootScope.user.channel + '/' + code).then(
        function (resp) {
          var collection = resp.data;
          paCache.initCounters({i:0,w:0,c:0});
          if(collection.type=='grid'){
            _.each(collection.resources,function(line){
              self.processResources(line.resources);
            })
          } else {
            self.processResources(collection.resources);
          }
          return deferred.resolve(collection);
        }
      );
      return deferred.promise;
    },
    findTextByCode: function findTextByCode(code) {
      var deferred = $q.defer(); // conf.currentFolder is not defined on student side
      //var conf = paCache.getConf();

      $http.get(config.apiUrl + '/ws/findTextByCode/' + $rootScope.user.channel + '/' + code).then(function (resp) {
        return deferred.resolve(resp.data);
      });
      return deferred.promise;
    },
    findParams: function findParams() {
      var deferred = $q.defer();
      var conf = paCache.getConf();
      $http.get(config.apiUrl + '/ws/pageParams/' + conf.currentPage._id + '/' + $rootScope.user.channel).then(function (resp) {
        // defaults
        var params = {odd:1,even:3};
        for (let param of resp.data) {
          params[param.name] = param.value;
        }
        if (conf.currentMode!='P' && conf.currentContent) {
          $http.get(config.apiUrl + '/ws/contentParams/' + conf.currentContent._id + '/' + $rootScope.user.channel).then(function (resp) {
              for (let param of resp.data) {
                params[param.name] = param.value;
              }
              return deferred.resolve(params);
          })
        } else {
          return deferred.resolve(params);
        }

      });
      return deferred.promise;
    },
    saveParam: function saveParam(name, value, system) {
      var conf = paCache.getConf();
      if (conf.currentMode!='P' && conf.currentContent) {
        $http.put(config.apiUrl + '/ws/contentParam', {content:conf.currentContent._id, teacher:$rootScope.user.channel, name:name, value:value, systemParam: system});
      } else {
        $http.put(config.apiUrl + '/ws/pageParam', {page:conf.currentPage._id, teacher:$rootScope.user.channel, name:name, value:value, systemParam: system});
      }
    },
    listBlobs: function listBlobs(prefix) {
      var deferred = $q.defer();
      var conf = paCache.getConf();
      $http.post(config.apiUrl + '/ws/browse', {
        folder: conf.currentFolder.code,
        prefix: prefix
      }).then(function (resp) {
        return deferred.resolve(resp.data);
      });
      return deferred.promise;
    },
    getBlob: function getBlob(name) {
      var deferred = $q.defer();
      var conf = paCache.getConf();
      $http.post(config.apiUrl + '/ws/getBlob/' + conf.currentFolder.code, {
        name: name
      }).then(function (resp) {
        return deferred.resolve(resp.data);
      });
      return deferred.promise;
    },
    saveBlob: function saveBlob(name, data) {
      var deferred = $q.defer();
      var conf = paCache.getConf();
      $http.post(config.apiUrl + '/ws/saveBlob/' + conf.currentFolder.code, {
        name: name,
        data: data
      }).then(function (resp) {
        return deferred.resolve(resp.data);
      });
      return deferred.promise;
    },
    loadContents: function loadContents(folder) {
      paMenu.loadContents(folder);
    },
    loadWorkplans: function loadWorkplans() {
      $http.get(config.apiUrl + '/ws/workplans/teachers/' + $rootScope.user.channel).then(function (resp) {
        var conf = paCache.getConf();
        conf.workplans = resp.data;
      });
    },
    loadWorkplan: function loadWorkplan(workplan) {
      var conf=paCache.getConf();
      $http.get(config.apiUrl + '/ws/workplans/' + workplan._id + '/contents').then(function (result) {
        workplan.contents = _.filter(result.data,'page');
        _.each(workplan.contents,function(content){
          content.page.template=conf.templates[content.page.template];
          content.subsrc = _.find(conf.myFolderSubscriptions, function(subscr){
            return subscr.folder._id==content.page.folder;
          });
        })
      });
    },
    loadPages: function loadPages(folder) {
      paMenu.loadPages(folder);
    },
    loadAlerts: function() {
      $http.get(config.apiUrl + '/ws/alerts').then(function (result) {
        var conf = paCache.getConf();
        conf.alerts=result.data;
      })
    },
    loadStates: function loadStates() {
      $http.get(config.apiUrl + '/ws/templates').then(function (result) {
        _.each(result.data, function (template) {
          runtimeStates.addState({
            name: template.name,
            controller: template.controller,
            templateUrl: template.templateUrl,
            params: template.params
          });
        });
        
        var conf = paCache.getConf();
        conf.templates=_.indexBy(result.data,'_id');
      });
    },
    loadFreeStickers: function loadFreeStickers() {
      var data = paCache.init();
      var self = this;
      $http.get(config.apiUrl + '/ws/freeContent/stickers').then(function (result) {
        self.loadPageContent(result.data);
      });
      return data;
    },
    loadStudentComments: function loadStudentComments(id) {
      $http.get(config.apiUrl + '/ws/comments/students/' + id).then(function (res) {
        var data = paCache.getData();
        data.comments = res.data;
      });
    },
    logContent: function logContent(content) {
      var conf = paCache.getConf();

      if (conf.channel.open) {
        $http.post(config.apiUrl + '/ws/channel/log', {
          channel: conf.channel,
          folder: conf.currentFolder,
          teacher: $rootScope.user.channel,
          content: content
        });
      }
    },
    loadAudioCollections: function(folder) {
      if (folder && folder._id){
        var conf = paCache.getConf();
        $http.post(config.apiUrl + '/ws/menu/findPages',{type:'A',folder:folder._id}).then(function(resp){
          if (resp.data && resp.data.length){
            var page =resp.data[0];
            $http.post(config.apiUrl + '/ws/findCollections', {type:'audio',folder:folder._id,page:page._id}).then(
              function (resp) {
                conf.currentFolder.audioCollections=resp.data;
              }
            );
          }
        })
      }
    }
  };
}
"use strict";

angular.module('paApp').config(['$urlRouterProvider', '$stateProvider', function ($urlRouterProvider, $stateProvider) {
  //$urlRouterProvider.otherwise('/home');
  $stateProvider.state('login', {
    //url: '/login',
    controller: 'loginCtrl',
    templateUrl: '/pa/pa.login.html?795b87625b9d3199'
  });
  $stateProvider.state('auth', {
    url: '/auth/:token',
    controller: 'authCtrl'
  });
  $stateProvider.state('join', {
    url: '/join/:channel',
    controller: 'channelCtrl',
    templateUrl: '/pa/pa.subscription.html?af79fbf92532d6cb'
  });
  $stateProvider.state('mirgovorit-link', {
    url: '/mirgovorit/link',
    controller: 'mirgovoritCtrl',
    templateUrl: '/pa/mirgovorit-link.html?094aa374a6ae29d6',
    params:{
      mirgovoritProfile:null
    }
  });
  $stateProvider.state('mirgovorit-login', {
    url: '/mirgovorit/login',
    controller: 'mirgovoritCtrl'
  });
  $stateProvider.state('pa', {
    url: '/pa/:to',
    controller: 'homeCtrl'
  });
  $stateProvider.state('dashboard',{
    //url: '/',
    controller: 'dashboardController',
    templateUrl: '/pa/pa.dashboard.html?8530b07352a2118a',
    params:{
      tab:null
    }
  });
  $stateProvider.state('dashboard-o',{
    //url: '/',
    controller: 'dashboardController',
    templateUrl: '/pa/pa.dashboard-o.html?39df4a2df4a99c5d'
  });
  $stateProvider.state('dashboard-e',{
    //url: '/',
    controller: 'dashboardController',
    templateUrl: '/pa/pa.dashboard-e.html?55a08b362e7ed219'
  });
  $stateProvider.state('edit-folder',{
    //url: '/',
    controller: 'paFolderCtrl',
    templateUrl: '/pa/pa.edit-folder.html?e6f64967e6432506',
    params: {
      folder:null,
      forceReload:null
    }
  });
  $stateProvider.state('copy-page',{
    //url: '/',
    controller: 'paCopyPageCtrl',
    templateUrl: '/pa/pa.copy-page.html?ddff14c695e1de0f'
  });
  $stateProvider.state('add-page',{
    //url: '/',
    controller: 'paEditPageCtrl',
    templateUrl: '/pa/pa.edit-page.html?3b4599d9a9476992'
  });
  $stateProvider.state('edit-page',{
    //url: '/',
    controller: 'paEditPageCtrl',
    templateUrl: '/pa/pa.edit-page.html?3b4599d9a9476992',
    params: {
      page:null
    }
  });
  $stateProvider.state('edit-content',{
    //url: '/',
    controller: 'paEditContentCtrl',
    templateUrl: '/pa/pa.edit-content.html?919cdf1a6002560a',
    params: {
      content:null
    }
  });
  $stateProvider.state('profile',{
    //url: '/profile',
    controller: 'paProfileCtrl',
    templateUrl: '/pa/pa.profile.html?674cec8e4a417cdd'
  });
  $stateProvider.state('edit-profile',{
    //url: '/edit-profile',
    controller: 'paProfileCtrl',
    templateUrl: '/pa/pa.edit-profile.html?2d02ad744576bf69'
  });
  $stateProvider.state('opentok',{
    //url: '/opentok',
    controller: 'paProfileCtrl',
    templateUrl: '/pa/pa.edit-opentok.html?53d47b97e806282e'
  });
$stateProvider.state('students',{
    //url: '/students',
    controller: 'paStudentsCtrl',
    templateUrl: '/pa/pa.students.html?450a17a268b69fbb'
  });
  $stateProvider.state('add-student',{
    //url: '/add-student',
    controller: 'paStudentCtrl',
    templateUrl: '/pa/popup.add-student.html?03dc217959f9d295'
  });
  $stateProvider.state('edit-student',{
    //url: '/edit-student/:id',
    controller: 'paStudentCtrl',
    templateUrl: '/pa/popup.edit-student.html?518c6a80d8da9094',
    params: {
      id: null
    }
  });
  $stateProvider.state('select-student',{
    //url: '/select-student/:id',
    controller: 'dashboardController',
    templateUrl: '/pa/pa.dashboard.html?8530b07352a2118a',
    params: {
      id: null,
      tab: null
    }
  });
  $stateProvider.state('add-group',{
    //url: '/add-student',
    controller: 'paGroupCtrl',
    templateUrl: '/pa/popup.group.html?513ee77a6f459d9c'
  });
  $stateProvider.state('edit-group',{
    //url: '/add-student',
    controller: 'paGroupCtrl',
    templateUrl: '/pa/popup.group.html?513ee77a6f459d9c',
    params:{
      group: null
    }
  });
  $stateProvider.state('lessons',{
    //url: '/lessons',
    controller: 'lessonsCtrl',
    templateUrl: '/pa/pa.lessons.html?3c7d70811177f69a'
  });
  $stateProvider.state('levels',{
    //url: '/levels',
    controller: 'levelsCtrl',
    templateUrl: '/pa/pa.levels.html?659ef536913e0a0a'
  });
  $stateProvider.state('payments',{
    //url: '/payments',
    controller: 'paPaymentsCtrl',
    templateUrl: '/pa/pa.payments.html?ee59a8e28abe7206'
  });
  $stateProvider.state('webinar',{
    //url: '/unlock',
    controller: 'paWebinarCtrl',
    templateUrl: '/pa/pa.webinar.html?7af455cf2a297b24'
  });
  $stateProvider.state('unlock',{
    //url: '/unlock',
    controller: 'paUnlockCtrl',
    templateUrl: '/pa/popup.unlock.html?bb5363a881306e2b'
  });
  $stateProvider.state('change-password',{
    //url: '/change-password',
    controller: 'paChangePasswordCtrl',
    templateUrl: '/pa/pa.change-password.html?d82f1c7771688f6b'
  });
$stateProvider.state('subscriptions',{
    //url: '/subscriptions',
    controller: 'subscriptionsController',
    templateUrl: '/pa/pa/pa.subscriptions.html'
  });
  $stateProvider.state('wall',{
    //url: '/wall',
    controller: 'likesController',
    templateUrl: '/pa/pa.likes.html?7d1629d1e330ae99'
  });
  $stateProvider.state('posts',{
    //url: '/posts',
    params: {
      tab: 5
    },
    controller: 'dashboardController',
    templateUrl: '/pa/pa.dashboard.html?8530b07352a2118a'
  });
  $stateProvider.state('admin',{
    //url: '/admin',
    controller: 'adminController',
    templateUrl: '/pa/pa.admin.html?769028d1fb1b39ae',
    params: {
      options: null
    }
  });
  $stateProvider.state('canvas',{
    //url: '/canvas',
    controller: 'canvasController',
    templateUrl: '/pa/pa.canvas.html?b44612280c542847',
    params: {
      content: null
    }
  });
  $stateProvider.state('add-collection',{
    controller: 'CollectionCtrl',
    templateUrl: '/pa/pa.popup.html?72e4460249056cb8',
    params: {
      collection: {},
      options: null
    }
  });
  $stateProvider.state('collection-mixed',{
    controller: 'CollectionCtrl',
    templateUrl: '/pa/pa.collection-mixed.html?ca980bd891ff5c9d',
    params: {
      collection: {},
      options: null,
      tab: 0
    }
  });
  $stateProvider.state('collection-mixed2',{
    controller: 'CollectionCtrl',
    templateUrl: '/pa/pa.collection-mixed.html?ca980bd891ff5c9d',
    params: {
      collection: {},
      options: null,
      tab: 0
    }
  });
  $stateProvider.state('collection-grid',{
    controller: 'CollectionCtrl',
    templateUrl: '/pa/pa.collection-grid.html?1067d128f89b5629',
    params: {
      collection: {},
      options: null,
      tab: 0
    }
  });
  $stateProvider.state('edit-card',{
    controller: 'cardEditorController',
    templateUrl: '/pa/pa.card.editor.html?6de285e7d71fb699',
    params: {
      collection: {},
      card: {},
      options: null
    }
  });
  $stateProvider.state('edit-collection',{
    controller: 'CollectionCtrl',
    templateUrl: '/pa/pa.popup.html?72e4460249056cb8',
    params: {
      collection: {},
      options: null,
      tab: null,
      back: null
    }
  });
  $stateProvider.state('copy-collection',{
    controller: 'CollectionCtrl',
    templateUrl: '/pa/pa.popup.html?72e4460249056cb8',
    params: {
      collection: {},
      copyFrom: null,
      options: null
    }
  });
  $stateProvider.state('copy-collection-mixed',{
    controller: 'CollectionCtrl',
    templateUrl: '/pa/pa.collection-mixed.html?ca980bd891ff5c9d',
    params: {
      collection: {},
      copyFrom: null,
      options: null
    }
  });
  $stateProvider.state('copy-collection-grid',{
    controller: 'CollectionCtrl',
    templateUrl: '/pa/pa.collection-grid.html?1067d128f89b5629',
    params: {
      collection: {},
      copyFrom: null,
      options: null
    }
  });
  $stateProvider.state('edit-pictogram',{
    //url: '/edit-pictogram',
    controller: 'pictogramCtrl',
    templateUrl: '/pa/pa.pictogram.editor.html?1cb44c0b4bf7b9fd',
    params: {
      collection: {},
      type: null
    }
  });
  $stateProvider.state('size-factor',{
    //url: '/size-factor',
    controller: 'sizeFactorCtrl',
    templateUrl: '/pa/pa.size-factor.editor.html?ed8409765e1c79e7',
    params: {
      collection: {}
    }
  });
  $stateProvider.state('lesson',{
    //url: '/lesson/:lessonId',
    controller: 'dashboardController',
    templateUrl: '/pa/pa.dashboard.html?8530b07352a2118a'
  });
  $stateProvider.state('org-teachers',{
    //url: '/lesson/:lessonId',
    controller: 'paOrganizationCtrl',
    templateUrl: '/pa/pa.org-teachers.html?94b8d2b7c4cf8a37'
  });
  $stateProvider.state('org-teacher',{
    //url: '/lesson/:lessonId',
    controller: 'paOrganizationCtrl',
    templateUrl: '/pa/pa.org-teacher.html?3ca0350407d1fa44',
    params:{
      teacher:null
    }
  });
  $stateProvider.state('org-students',{
    //url: '/lesson/:lessonId',
    controller: 'paOrganizationCtrl',
    templateUrl: '/pa/pa.org-students.html?487df4ad8fc8b36d'
  });
  $stateProvider.state('org-groups',{
    //url: '/lesson/:lessonId',
    controller: 'paOrganizationCtrl',
    templateUrl: '/pa/pa.org-groups.html?b32cda71831d09b0'
  });
  $stateProvider.state('org-student',{
    //url: '/lesson/:lessonId',
    controller: 'paOrganizationCtrl',
    templateUrl: '/pa/pa.org-student.html',
    params:{
      student:null
    }
  });
  $stateProvider.state('org-unlock',{
    //url: '/unlock',
    controller: 'paUnlockCtrl',
    templateUrl: '/pa/popup.org-unlock.html?29c515b9d2e752c6'
  });
  $stateProvider.state('org-workplans',{
    //url: '/lesson/:lessonId',
    controller: 'paOrganizationCtrl',
    templateUrl: '/pa/pa.org-workplans.html'
  });
  $stateProvider.state('org-payments',{
    //url: '/lesson/:lessonId',
    controller: 'paOrganizationCtrl',
    templateUrl: '/pa/pa.org-payments.html?31c942b10e5bce66'
  });
  $stateProvider.state('marketplace',{
    //url: '/lesson/:lessonId',
    controller: 'paMarketplaceCtrl',
    templateUrl: '/pa/pa.marketplace.html?4332b59100c46859',
    params:{
      teacher:null
    }
  });
  $stateProvider.state('org-subscriptions',{
    //url: '/lesson/:lessonId',
    controller: 'paOrganizationCtrl',
    templateUrl: '/pa/pa.org-subscriptions.html?eccb58de3f974edf'
  });
  $stateProvider.state('styles',{
    //url: '/lesson/:lessonId',
    controller: 'paStyleController',
    templateUrl: '/pa/pa.globalStyle.html?81c38eae33abd68a',
    params: {
      global:true
    }
  });
  $stateProvider.state('intro-steps',{
    //url: '/lesson/:lessonId',
    controller: 'paIntroController',
    templateUrl: '/pa/pa.introSteps.html?3d83c58066977a77',
    params: {
      global:true
    }
  });
  $stateProvider.state('intro-step',{
    //url: '/lesson/:lessonId',
    controller: 'paIntroController',
    templateUrl: '/pa/pa.introStep.html?a6ccb028eebd3fc3',
    params: {
      step: null
    }
  });
  $stateProvider.state('feeds',{
    //url: '/lesson/:lessonId',
    controller: 'paFeedsController',
    templateUrl: '/pa/pa.feeds.html?89469a8dab215e30'
  });
  $stateProvider.state('feed',{
    //url: '/lesson/:lessonId',
    controller: 'paFeedController',
    templateUrl: '/pa/pa.feed.html?0e2976628368b036',
    params: {
      feed:null
    }
  });
  $stateProvider.state('search-collections',{
    //url: '/lesson/:lessonId',
    controller: 'paCollectionsController',
    templateUrl: '/pa/pa.search-collections.html?c237cbb6185933c4',
    params: {
      feed:null
    }
  });
  $stateProvider.state('axerve', {
    //url: '/pa/axerve',
    controller: 'axerveCtrl',
    templateUrl: '/pa/axerve.html?14e69ecd7d627148',
  });
}]);
"use strict";

paPayment .$inject = ["$q", "$rootScope", "$state", "$http", "paCache", "config"];
angular.module('paApp').factory('paPayment', paPayment );

function paPayment ($q, $rootScope, $state, $http, paCache, config) {
    return {
        getOrganizationPayments: function(org){
            $http.get('/ws/organizations/'+org+'/payments')
                .then(function(resp){
                    var pageScope=paCache.getPageScope();
                    pageScope.payments = resp.data;
                })
        }
   }
}
"use strict";

paSocket.$inject = ["$rootScope", "$state", "$log", "$location", "$document", "$window", "$timeout", "$uibModal", "$http", "paCache", "paChannel", "ngAudio", "config"];
angular.module('paApp').factory('paSocket', paSocket);

function paSocket($rootScope, $state, $log, $location, $document, $window, $timeout, $uibModal, $http, paCache, paChannel, ngAudio, config) {
  var socket;
  return {
    on: function on(eventName, callback) {
      /*LogglyLogger.sendMessage({
      username: $rootScope.user.username,
      message: 'on ' + eventName
      });*/
      function wrapper() {
        var args = arguments;

        var data = paCache.getData();
        if(!data.initialized){
          data = paCache.init();
        }

        var msg = args[0];
        if (msg && msg._id && msg._user && msg._user.role=='S'){
          var name = msg._user.data.name+' '+msg._user.data.surname;
          data.tooltips[msg._id] = {
            text: name,
            open: true
          };
          $timeout(function () {
            data.tooltips[msg._id] = undefined;
          }, 3000);
            
        }
  
        $rootScope.$apply(function () {
          callback.apply(socket, args);
        });
      }

      socket.on(eventName, wrapper);
      return function () {
        socket.removeListener(eventName, wrapper);
      };
    },
    emit: function emit(eventName, data, callback) {

      var conf = paCache.getConf();
      var isLocked = conf.user && conf.user.params && conf.user.params.locked=='true';
      if (!isLocked || $rootScope.admin) {
        /*LogglyLogger.sendMessage({ 
        	username: $rootScope.user.username,
        	message: 'emit ' + eventName
        });*/
        if (paCache.getData().rec) {
          var event = {
            name: eventName,
            data: data,
            rec: paCache.getData().rec._id
          };
          $http.post(config.apiUrl + '/ws/event/save', event, function (error, event) {});
        }

        if (_.isObject(data)){
          data._user = conf.user;
        }

        socket.emit(eventName, data, function () {
          var args = arguments;
          $rootScope.$apply(function () {
            if (callback) {
              callback.apply(socket, args);
            }
          });
        });
      }
    },
    removeAllListeners: function removeAllListeners(eventName, callback) {
      //socket.removeAllListeners();
    },
    init: function init() {
      var ns = $location.protocol() + '://' + $location.host() + ':' + $location.port() + '/whiteboard';
      var paToken = $window.localStorage.getItem('pa.token');
      socket = io.connect(ns, {
        query: {token: paToken}
      });
      $log.info("socket created: " + ns);
      socket.on('connect', function () {
        socket.emit('register', $rootScope.user);
      });
      socket.on('disconnect message', function (student) {
        $log.info("disconnect student " + student);

        if (student == $rootScope.user.student) {
          socket.disconnect();
        }
      });
      socket.on('reload', function (teacher) {
        $window.location.reload();
      });
      socket.on("page message", function (msg) {
        paCache.stopRec();
        var params=null;
        if (msg.page){
          paCache.setCurrentContent(null);
          paCache.setCurrentPage(msg.page);
          params = _.extend(msg.page.params?msg.page.params:{},{content: {type: 'P'}});
        }
        $state.transitionTo(msg.code, params, {"reload": true});
      });
      socket.on("content message", function (msg) {
        paCache.stopRec();
        var params=msg.content.page.params||{};
        if (msg.content){
          paCache.setCurrentContent(msg.content);
          paCache.setCurrentPage(msg.content.page);
          params = _.extend(params,{content: msg.content});
        }
        $state.transitionTo(msg.code, params, {"reload": true});
      });
      socket.on("pos message", function (elem) {
        var element = angular.element("#" + elem.id);
        var w = $("#panel").width();
        var h = $("#panel").height();
        element.css({
          top: elem.y * h + 'px',
          left: elem.x * w + 'px'
        });
      });
      socket.on("drag", function (evt) {
        var element = angular.element("#" + evt.source);
        var w = element.width();
        var h = element.height();
        var target = angular.element("#" + evt.target);
        element.detach().appendTo(target);
        element.css({
          top: evt.y + '%',
          left: evt.x + '%',
          position: 'absolute',
          width: w,
          height: h
        });
        var drops = paCache.getDrops();
        drops[evt.source] = true;
      });
      socket.on("undo-drag", function (evt) {
        var element = angular.element("#" + evt.source);
        var target = angular.element("#" + evt.target); //target.empty();

        element.detach().appendTo(target);
        element.css({
          top: 0,
          left: 0,
          position: 'relative'
        });
        var drops = paCache.getDrops();
        drops[evt.source] = false;
      });
      socket.on("fit", function (evt) {
        var element = angular.element("#" + evt.source);
        var w = element.width();
        var h = element.height();
        var target = angular.element("#" + evt.target);
        element.detach().appendTo(target);
        element.css({
          position: 'absolute',
          left: '0',
          top: '0'
        });
        target.css({
          width: w,
          height: h
        })
        var drops = paCache.getDrops();
        drops[evt.source] = true;
      });
      socket.on("append", function (evt) {
        var element = angular.element("#" + evt.source);
        var w = element.width();
        var h = element.height();
        var target = angular.element("#" + evt.target);
        element.detach().appendTo(target);
        element.css({
          position: evt.position ? evt.position : '',
          left: '',
          top: '',
          width: w,
          height: h
        });
        var drops = paCache.getDrops();
        drops[evt.source] = true;
      });
      socket.on('click-msg', function (msg) {
        var target = angular.element("#" + msg.id);
        var x = msg.x * target.width();
        var y = msg.y * target.height();
        var element;

        if (msg.single) {
          element = angular.element(".click-msg");

          if (!element.length) {
            element = angular.element('<i class="fa ' + msg.icon + ' fa-2x click-msg"></i>');
            element.appendTo(target);
          }
        } else {
          element = angular.element('<i class="fa ' + msg.icon + ' fa-2x click-msg"></i>');
          element.appendTo(target);
        }

        element.css({
          top: y - element.height() / 2,
          left: x - element.width() / 2,
          position: 'absolute'
        });
      });
      socket.on('clear-click-msg', function (msg) {
        var l = angular.element(".click-msg");

        _.each(l, function (e) {
          e.remove();
        });
      });
      socket.on("play-track", function (a) {
        var data = paCache.getData();
        if (!data.audioCollection){
          data.audioCollection={};
        }

        if (a.play !== undefined) {
          data.track = a.play;
          if (!data.audioCollection[a.play]) {
            var audio=ngAudio.load(a.play);
            if (audio.error){
              throw new Error('error loading audio');
            }
            data.audioCollection[a.play]={audio:audio};
          }
          data.audioCollection[a.play].audio.play();

        } else if (a.pause !== undefined && data.audioCollection[a.pause]) {
          data.track = -1;
          data.audioCollection[a.pause].audio.pause();

        } else if (a.stop !== undefined && data.audioCollection[a.stop]) {
          data.track = -1;
          data.audioCollection[a.stop].audio.pause();

        } else if (a.track !== undefined && a.progress !== undefined && data.audioCollection[a.track]) {
          data.audioCollection[a.track].audio.progress = a.progress;
        }
      });
      socket.on("audio message", function (msg) {
        var data = paCache.getData();

        var res = _.find(data.audioCollection, function (audio) {
          return audio.title == msg.title;
        });

        if (msg.action == 'play') {
          res.audio.play();
        } else if (msg.action == 'pause') {
          res.audio.pause();
        } else if (msg.action == 'stop') {
          res.audio.pause();
        }
      });
      socket.on("smile message", function (i) {
        var data = paCache.getData();
        data.selectedSmiles[i] = true;
        data.counter = data.counter + 1;
      });
      this.on('count', function (msg) {
        var data = paCache.getData();
        data.counters[msg.user] = msg.counter;
      });
      this.on('text', function (obj) {
        if (window.getSelection) {
          if (window.getSelection().empty) {  // Chrome
            window.getSelection().empty();
          } else if (window.getSelection().removeAllRanges) {  // Firefox
            window.getSelection().removeAllRanges();
          }
        }         
        var data = paCache.getData();
        data.start = Number(obj.start);
        data.end = Number(obj.end);
      });
      this.on('user-selection', function (msg) {
        var data = paCache.getData();
        var word = data.grid[msg.i].resources[msg.j];

        if (word.selected !== undefined) {
          word.selected = undefined;
        } else {
          if (!data.players) {
            data.players = [];
          }

          if (!_.contains(data.players, msg.user)) {
            data.players.push(msg.user);
          }

          var sel = _.indexOf(data.players, msg.user);

          word.selected = sel;
        }
      });
      this.on('binocular', function (e) {
        var relX = e.offsetX - 140;
        var relY = e.offsetY - 80;
        $('mask g').attr('transform', 'translate(' + relX + ',' + relY + ')');
      });
      this.on("img message", function (msg) {
        paCache.setSelectedImage(msg);
      });
      this.on("img2 message", function (obj) {
        var i = obj[0];
        var sel = obj[1];
        paCache.setSelected(i, sel);
      });
      this.on("flip", function (obj) {
        var i = obj[0];
        var sel = obj[1];
        paCache.setSelected(i, sel);
      });
      this.on("book message", function (msg) {
        $('#bb-bookblock').bookblock(msg);
        return false;
      });
      this.on("tab", function (i) {
        paCache.setTab(i);
      });
      this.on("show message", function (obj) {
        var i = obj[0];
        var val = obj[1];
        var data = paCache.getData();
        data.images[i].show = val;
      });
      this.on("hide message", function (obj) {
        var i = obj[0];
        var val = obj[1];
        var data = paCache.getData();
        data.images[i].hide = val;
      });
      this.on("var", function (obj) {
        var data = paCache.getData();
        data[obj["var"]] = obj.val;

        if (obj["var"] == 'enableJcrop' && !obj.val && data.jcrop_api) {
          data.jcrop_api.destroy();
        }
      });
      this.on("json", function(json){
        var data = paCache.getData();
        _.mapObject(json,function(val,key){
          data[key]=val;
        })
      });
      this.on("conf", function (obj) {
        var conf = paCache.getConf();
        _.extend(conf[obj["var"]], obj.val);
      });
      this.on("images", function (images) {
        var data = paCache.getData();
        data.images = images;
      });
      this.on("images2", function (images2) {
        var data = paCache.getData();
        data.images2 = images2;
      });
      this.on("words", function (words) {
        var data = paCache.getData();
        data.words = words;
      });
      this.on("line", function (msg) {
        var data = paCache.getData();
        data.lines[msg.i].words.sort(function(a,b){
          var posA=msg.order.indexOf(a.i);
          var posB=msg.order.indexOf(b.i);
          return (posA>posB)?1:-1;
        })
      });
      this.on("pop message", function (msg) {
        var data = paCache.getData();

        if (data.images.length > 0) {
          data.images.pop();
        }
      });
      this.on("img params", function (obj) {
        var data = paCache.getData();
        var i = obj[0];
        var val = obj[1];
        angular.extend(data.images[i], val);
      });
      this.on("clear", function (b) {
        var data = paCache.getData();

        if (data.jcrop_api) {
          data.jcrop_api.destroy();
        }

        data.selectedImage = -1;
        window.getSelection().removeAllRanges();
        data.start = -1;
        data.end = -1;
      });
      this.on("textsize", function (size) {
        var data = paCache.getData();
        data.textsize = size;
      });
      this.on("ratio", function (ratio) {
        var data = paCache.getData();
        data.ratio = ratio;
      });
      this.on("size", function (size) {
        var data = paCache.getData();
        data.size = size;
      });
      this.on("size2", function (size) {
        var data = paCache.getData();
        data.size2 = size;
      });
      this.on("hide", function (bool) {
        var data = paCache.getData();
        data.hide = bool;
      });
      this.on("feed", function (data) {
        var feed = paCache.getFeed();
        feed.show = true;
        feed.data = data;

        if (data.audio) {
          var sound = ngAudio.load(data.audio);
          if (sound.error){
            throw new Error('error loading audio');
          }
          sound.volume = 0.2;
          sound.play();
        }

        $timeout(function () {
          feed.data = null;
          feed.show = false;
        }, data.timeout || 3000);
      });
      this.on("toggle", function (msg) {
        var feed = paCache.getFeed();
        feed.toggle = !feed.toggle;
        feed.toggleData = msg;
      });
      this.on("replace-text", function (msg) {
        var data = paCache.getData();
        data.temp[msg.i] = msg.val;
      });
      this.on("filterBy", function (msg) {
        var data = paCache.getData();
        data.filterBy = msg;
      });
      this.on("scroll", function (id) {
        var data = paCache.getData();
        data.selectedImage = id;
        var el = angular.element(document.getElementById(id));
        $document.scrollToElementAnimated(el);
      });
      this.on("css", function (msg) {
        var element = angular.element("#" + msg.id);
        element.css(msg.css);
      });
      this.on("list", function (msg) {
        var data = paCache.getData();
        data.list = msg;
      });
      this.on("exec", function (msg) {
        var data = paCache.getData();

        if (msg == 'countdown') {
          var audio = ngAudio.load(config.storageBaseUrl+'/img/controlpanel/Countdown%20(mp3cut.ru).mp3');
          if (audio.error){
            throw new Error('error loading audio');
          }
          data.countdownSel = 5;

          var exec = function exec() {
            if (data.countdownSel > 0) {
              data.countdownSel -= 1;

              $timeout(exec, 1000);
            }
          };

          audio.play(); //data.audio.bip.play();

          $timeout(exec, 1000);
        } else if (msg.method && msg.method == "pickUpNumber") {
          data.pickUpSel = undefined;
          data.dice = msg.arg;
          var i = 0;

          var _next2 = function next() {
            if (i < msg.arg.length) {
              data.pickUpSel = i;
              i += 1;
              $timeout(_next2, 300);
            } else {
              data.running = false;
            }
          };

          data.running = true;
          $timeout(_next2, 300);
        } else if (msg.method && msg.method == "oneOrTwo") {
          data.oneOrTwo = undefined;
          data.oneOrTwoLen = _.range(msg.arg);
          var i = 0;

          var _next2 = function next() {
            if (i < msg.arg) {
              data.oneOrTwo = i;
              i += 1;
              $timeout(_next2, 500);
            } else {
              data.running = false;
            }
          };

          data.running = true;
          $timeout(_next2, 500);
        } else if (msg.method && msg.method == "diceForSentence") {
          data.pickUpSel = undefined;
          data.diceForSentence = msg.arg;
          var i = 0;

          var _next2 = function _next() {
            if (i < msg.arg.length) {
              data.pickUpSel = i;
              i += 1;
              $timeout(_next2, 300);
            } else {
              data.running = false;
            }
          };

          data.running = true;
          $timeout(_next2, 300);
        } else if (msg.method && msg.method == "paperStoneScissors") {
          data.pickUpSel = undefined;
          data.paperStoneScissors = msg.arg;
          var i = 0;

          var _next2 = function _next() {
            if (i < msg.arg.length) {
              data.pickUpSel = i;
              i += 1;
              $timeout(_next2, 300);
            } else {
              data.running = false;
            }
          };

          data.running = true;
          $timeout(_next2, 300);
        } else if (msg == 'distributeFromDeck') {
          var data = paCache.getData();

          for (var i = 0; i < data.mixed.length; i++) {
            var source = $('#s' + i);
            var target = $('#t' + i);
            var left = target.offset().left - source.offset().left;
            var top = target.offset().top - source.offset().top;
            data.mixed2[i].transition = {
              transform: 'translate(' + left + 'px,' + top + 'px)'
            };
          }
        }
      });
      this.on("capture-screen", function (msg) {
        var self = this;

        if ($rootScope.user.student == msg) {
          var options = {
            useCORS: true
          };
          html2canvas(document.body, options).then(function (canvas) {
            self.emit("png", canvas.toDataURL('image/png'));
          });
        }
      });
      this.on("png", function (base64) {
        var data = paCache.getData();
        data.base64 = base64;
      });
      this.on('lessonStarted', function (channel) {
        var conf = paCache.getConf();
        conf.channel = channel;
      });
      this.on('lessonEnded', function (msg) {
        var conf = paCache.getConf();
        conf.channel.open = false;
        var modalInstance = $uibModal.open({
          animation: true,
          templateUrl: '/pa/popup.feedback.html?f2cdd1a489342de8',
          controller: 'paFeedbackCtrl',
          channel: function(){
            return msg;
          }
        });
        modalInstance.result.then(function () {});
      });
      this.on('userParam', function (msg) {
        var conf = paCache.getConf();
        var user = _.find(conf.room.users, function (user) {
          return user.id == msg.user;
        });
        if (user){
          user.params[msg.name] = msg.value;
        }
      });
      this.on("battery", function (msg) {
        var conf = paCache.getConf();

        var user = _.find(conf.room.users, function (user) {
          return user.id == msg.user;
        });

        user.params['battery'] = msg.value;

        if (msg.value == 0) {
          var audio = ngAudio.load(config.storageBaseUrl+'/img/battery/Sound_04675.mp3');
          if (audio.error){
            throw new Error('error loading audio');
          }
          audio.play();
        }
      });
      this.on("users", function (users) {
        paCache.setOnlineUsers(users);
      });
      this.on("toggle message", function (v) {
        var data = paCache.getData();
        data[v] = !data[v];
      });
      this.on('student-id', function (student) {
        if ($rootScope.user.teacher || $rootScope.user.student == student._id) {
          $http.post('/ws/menu/findPages',{type:'S',code:'stickers'}).then(function(resp){
            var page=resp.data[0];
            paCache.setCurrentMode('S');
            paCache.setCurrentFolder(page.folder);
            paCache.setCurrentPage(page);
            $state.go('stickers', {
              student: student,
              content: {
                type: 'P'
              }
            });
          })
        }
      });
      this.on('video', function (msg) {
        var conf = paCache.getConf();
        conf.video = msg;
      });
      this.on('youtube', function (msg) {
        var data = paCache.getData();

        if (msg.play) {
          data.player[msg.videoId].playVideo();
        } else {
          data.player[msg.videoId].pauseVideo();
        }
      });
      this.on('reloadChannel', function(msg){
        // reload channel due to room changed, before or after lesson start
        paChannel.loadRoom();
      });
      this.on("chat.open", function (msg) {
        var conf = paCache.getConf();
        conf.chat.open=msg.value;
      });
      this.on("chat.message", function (msg) {
        var conf = paCache.getConf();
        if (msg.action=='add') {
          conf.chat.messages.push(msg);

        } else if (msg.action=='update') {
          var m = _.find(conf.chat.messages, function(m){
            return msg.id==m.id;
          })
          if (m) {
            m.text=msg.text;
          }

        } else if (msg.action=='remove'){
          var i = _.findIndex(conf.chat.messages, function(m){
            return msg.id==m.id;
          });
          if (i!=-1){
            conf.chat.messages.splice(i,1);
          }
        }
      });

      var sendCoords = function(c){
        var data = paCache.getData();
        socket.emit("coords message", {
          x: c.x / data.imgWidth,
          y: c.y / data.imgHeight,
          x2: c.x2 / data.imgWidth,
          y2: c.y2 / data.imgHeight
        })
      };
  
      var initJcrop = function(i){
        var data = paCache.getData();
        var options = {
          onSelect: sendCoords,
          bgColor: 'lightgrey',
          bgOpacity: parseInt(data.opacity) / 10
        };
        var img = angular.element('#' + i);
        data.imgWidth = img.width();
        data.imgHeight = img.height();
        img.Jcrop(options, function () {
          data.jcrop_api = this;
        });
      };
  
      this.on("jcrop message", function (i) {
        var data = paCache.getData();
        if (data.jcrop_api) {
          data.jcrop_api.destroy();
        }
        data.selectedImage = i;
        if (data.enableJcrop){
          initJcrop(i);
        }
      });
    
      this.on("coords message", function (c) {
        var data = paCache.getData();
        if (data.jcrop_api) {
          data.jcrop_api.setOptions({
            onSelect: null
          });
          data.jcrop_api.setSelect([c.x * data.imgWidth, c.y * data.imgHeight, c.x2 * data.imgWidth, c.y2 * data.imgHeight]);
          data.jcrop_api.setOptions({
            onSelect: sendCoords
          });
        }
      });

      this.on("opacity", function (opacity) {
        var data = paCache.getData();
        if (data.jcrop_api) {
          data.jcrop_api.setOptions({
            bgOpacity: parseInt(opacity) / 10
          });
          var options = data.jcrop_api.getOptions();
          console.log(options);
        }
        data.opacity = opacity;
      });
      
    }

  };
}
"use strict";

paStorage.$inject = ["$q", "$rootScope", "$state", "$http", "paCache", "config"];
angular.module('paApp').factory('paStorage', paStorage);

function paStorage($q, $rootScope, $state, $http, paCache, config) {
    return {
        mapBlob: function (blob, collection) {
          var active = false;
          if (collection && collection.resources){
            active = _.some(collection.resources, function (res) {
              return res.name == blob.Name;
            });
          }
        
            var conf = paCache.getConf();
            return {
              name: blob.Name,
              folder: blob.Name.indexOf('/') != blob.Name.lastIndexOf('/') ? blob.Name.substring(blob.Name.indexOf('/') + 1, blob.Name.lastIndexOf('/')) : '',
              title: blob.Name.substring(blob.Name.lastIndexOf('/') + 1, blob.Name.lastIndexOf('.')),
              src: config.storageBaseUrl+"/" + conf.currentFolder.code + "/" + blob.Name,
              active: active,
              contentType: blob.Properties['Content-Type']
            };
        },
        getLevels: function getLevels(prefix) {
            var levels = [];
        
            if (prefix) {
              var prev = '';
        
              _.each(prefix.split('/'), function (l) {
                if (l) {
                  prev = prev + l + '/';
                  levels.push({
                    name: l,
                    prefix: prev
                  });
                }
              });
            }
        
            return levels;
        },
        loadBlobs: function (prefix, contentType, collection) {
            var conf = paCache.getConf();
            var self = this;
            if (conf.currentFolder.code){
              conf.storage={
                blobs: [],
                directories: [],
                levels: self.getLevels(prefix)
              }
              $http.post(config.apiUrl + '/ws/browse', {
                folder: conf.currentFolder.code,
                prefix: prefix
              }).then(function (resp) {
                if (resp.data.Blob) {
                  var filt = _.filter([].concat(resp.data.Blob), function(blob){
                    return contentType.indexOf(blob.Properties["Content-Type"]) != -1;
                  });
                  conf.storage.blobs = _.map(filt, function(blob){
                    return self.mapBlob(blob, collection);
                  });
                }
          
                if (resp.data.BlobPrefix) {
                  conf.storage.directories = _.map([].concat(resp.data.BlobPrefix), function (d) {
                    return {
                      prefix: d.Name,
                      name: d.Name.substring(prefix ? prefix.length : 0, d.Name.length - 1)
                    };
                  });
                }
              });
            }
        }        
    }   
}
"use strict";

paStudent.$inject = ["$q", "$rootScope", "$state", "$http", "paCache", "config"];
angular.module('paApp').factory('paStudent', paStudent);

function paStudent($q, $rootScope, $state, $http, paCache, config) {
    return {
        getSubscriptions: function() {
            var pageScope=paCache.getPageScope();
            $http.get(config.apiUrl + '/ws/menu/findAllFolders').then(function (resp) {
              var allFolders = _.indexBy(resp.data,'code');
              $http.get(config.apiUrl + '/ws/findSubscriptions/' + $rootScope.user.teacher).then(function (resp) {
                pageScope.subscriptions = resp.data;
                _.each(pageScope.subscriptions, function(subscr){
                  subscr.student.folder = allFolders[subscr.student.course];
                })
              });
              $http.get(config.apiUrl + '/ws/findUserSubscriptions/' + $rootScope.user.teacher).then(function (resp) {
                pageScope.validStudents = _.indexBy(resp.data,'student');
              })
            });
        },
        removeSubscription: function (subscription) {
            var self = this;
            $http.get(config.apiUrl + '/ws/removeSubscription/' + subscription._id).then(function (resp) {
                self.getSubscriptions();
            });
        },        
        getGroups: function(){
            var pageScope=paCache.getPageScope();
            $http.get(config.apiUrl + '/ws/teachers/' + $rootScope.user.teacher + '/groups').then(function (resp) {
                pageScope.groups = resp.data;
            });
        },
        saveGroup : function(group){
            var pageScope=paCache.getPageScope();
            var conf=paCache.getConf();
            var to=(conf.organization)?'org-groups':'students';
            group.subscriptions = _.filter(pageScope.subscriptions, 'active');
            if(group._id){
                $http.put('/ws/groups/'+group._id, group).then(function(resp){
                    $state.go(to);
                })
            }else{
                $http.post('/ws/groups', group).then(function(resp){
                    $state.go(to);
                })
            }
        },
        removeGroup: function(group){
            $http.delete('/ws/groups/'+group._id).then(function(resp){
              var conf=paCache.getConf();
              if(conf.organization){
                $state.go('org-groups');
              } else {
                $state.go('students');
              }
            })
        },
        loadFolders: function loadFolders() {
            var pageScope=paCache.getPageScope();
            $http.get(config.apiUrl + '/ws/menu/findAllFolders').then(function (result) {
              pageScope.allFolders = result.data;
            });
        },
        editStudent: function() {
            var pageScope=paCache.getPageScope();
            $http.get(config.apiUrl + '/ws/findUser/student/' + $state.params.id).then(function (resp) {
              if (resp.data){
                pageScope.user = resp.data;
              } else {
                pageScope.user = {local:{}};
              }
            });
            $http.get(config.apiUrl + '/ws/findStudent/' + $state.params.id).then(function (resp) {
              pageScope.student = resp.data;
            });
            $http.get(config.apiUrl + '/ws/students/'+ $state.params.id + '/groups').then(function(resp){
                var groupIndex = _.indexBy(resp.data, 'group');
                _.each(pageScope.groups, function(group){
                    group.active=_.has(groupIndex, group._id);
                })
            })
        },
        
        addStudent: function() {
            var pageScope=paCache.getPageScope();
            var conf=paCache.getConf();
            pageScope.student = {organization:conf.organization};
            pageScope.user = {};
        },
        
        saveStudent: function() {
            var pageScope=paCache.getPageScope();
            var conf=paCache.getConf();
            if(conf.organization){

              $http.post(config.apiUrl + '/ws/addStudent', pageScope.student).then(function (resp) {
                pageScope.user.role = 'S';
                pageScope.user.student = resp.data._id;
                $http.post(config.apiUrl + '/ws/addUser', pageScope.user).then(function (resp3) {
                  $state.transitionTo('org-students');
                });
              });
  
            } else {

              $http.post(config.apiUrl + '/ws/addStudent', pageScope.student).then(function (resp) {
                $http.post(config.apiUrl + '/ws/addSubscription/' + $rootScope.user.teacher + "/" + resp.data._id).then(function (resp2) {
                  pageScope.user.role = 'S';
                  pageScope.user.student = resp.data._id;
                  $http.post(config.apiUrl + '/ws/addUser', pageScope.user).then(function (resp3) {
                    $state.transitionTo('students');
                  });
                });
              });
  
            }
        },
        
        updateStudent: function() {
            var pageScope=paCache.getPageScope();
            var conf=paCache.getConf();
            var to = (conf.organization)?'org-students':'students';

            $http.post(config.apiUrl + '/ws/saveStudent/' + pageScope.student._id, pageScope.student).then(function (resp) {
              pageScope.user.role = 'S';
              pageScope.user.student = resp.data._id;
              if (pageScope.user._id) {
                $http.post(config.apiUrl + '/ws/saveUser/' + pageScope.user._id, pageScope.user).then(function (resp) {
                  $state.transitionTo(to);
                });
              } else {
                $http.post(config.apiUrl + '/ws/addUser', pageScope.user).then(function (resp3) {
                  $state.transitionTo(to);
                });
              }
            });
        },
        
        saveOrUpdate: function () {
            var self = this;
            var pageScope=paCache.getPageScope();
            pageScope.errors = {};
            pageScope.student.groups = _.filter(pageScope.groups,'active');

            $http.get(config.apiUrl + '/ws/findUser/' + pageScope.user.local.username).then(function (resp) {
              if (!resp.data || resp.data._id == pageScope.user._id) {
                if (pageScope.student._id) {
                    self.updateStudent();
                } else {
                    self.saveStudent();
                }
              } else {
                pageScope.errors.username = pageScope.user.local.username + ' already exists. Please choose a different username.';
              }
            });
        },

        findStudent(id) {
          var deferred = $q.defer();
          $http.get('/ws/findStudent/'+id).then(function(resp){
            return deferred.resolve(resp.data);
          })
          return deferred.promise;
        },

        updateSubscription: function(subscr) {
          var deferred = $q.defer();
          $http.post('/ws/addSubscription/'+subscr.teacher+'/'+subscr.student).then(function(resp){
            return deferred.resolve(resp.data);
          })
          return deferred.promise;
        },

        getOrganizationStudents: function(org){
          $http.get('/ws/organizations/'+org+'/students').then(function(resp){
            var pageScope = paCache.getPageScope();
            pageScope.students = resp.data;
          })
        },

        getOrganizationStudentSubscriptions: function(org){
          $http.get('/ws/organizations/'+org+'/students').then(function(resp){
            var pageScope = paCache.getPageScope();
            pageScope.subscriptions = _.map(resp.data,function(student){
              return {student:student};
            });
          })
        },

        unlinkStudentFromOrganization: function(student) {
          var deferred = $q.defer();
          $http.delete('/ws/students/'+student._id+'/unlink').then(function(resp){
            return deferred.resolve(resp.data);
          })
          return deferred.promise;
        },

        getOrganizationGroups: function(org){
          $http.get('/ws/organizations/'+org+'/groups').then(function(resp){
            var pageScope = paCache.getPageScope();
            pageScope.groups = resp.data;
          })
        },

        subscribeStudent: function(teacher,student){
          var deferred = $q.defer();
          $http.post('/ws/addSubscription/'+teacher+'/'+student).then(function(resp){
            return deferred.resolve(resp.data);
          });
          return deferred.promise;
        },

        subscribeGroup: function(teacher,group){
          var deferred = $q.defer();
          $http.post('/ws/addGroupSubscription/'+teacher+'/'+group).then(function(resp){
            return deferred.resolve(resp.data);
          });
          return deferred.promise;
        }

    }
}

"use strict";

paStyle.$inject = ["$q", "$rootScope", "$state", "$http", "paCache", "config", "toaster"];
angular.module('paApp').factory('paStyle', paStyle);

function paStyle($q, $rootScope, $state, $http, paCache, config, toaster) {
  return {
    loadGlobalStyle: function () {
      var conf = paCache.getConf();
      $http.get(config.apiUrl + '/ws/styles/global/' + $rootScope.user.channel).then(function (resp) {
        if (resp.data){
          conf.css = _.indexBy(resp.data, 'name');
        }
        if (!conf.css.general) {
          conf.css.general = {
            name: 'general',
            global:true,
            teacher: $rootScope.user.channel,
            style: {
              'background': '#fff'
            }
          }
        }
      })
    },
    loadPageStyles: function () {
      var conf = paCache.getConf();
      var data = paCache.getData();
      $http.get(config.apiUrl + '/ws/styles/pages/' + conf.currentPage._id + '/' + $rootScope.user.channel).then(function (resp) {
        if (resp.data) {
          data.css = _.indexBy(resp.data, 'name');
          if (!data.css.card){
            data.css.card = {
              name: 'card',
              global:false,
              teacher: $rootScope.user.channel,
              page: conf.currentPage._id,
              //style: conf.css.card.style
              style: {
                'border-width': '1px',
                'border-color': '#ddd',
                'border-style': 'solid',
                'background-color': '#fff'
              }
            }
          }
        }
      })
    },
    saveStyle: function (style) {
      var self=this;
      if (style._id) {
        $http.put(config.apiUrl + '/ws/styles/' + style._id, style).then(function (resp) {
          if (resp.data.global) {
            self.loadGlobalStyle();
          } else {
            self.loadPageStyles();
          }
          toaster.pop('success', 'Style', 'Style save succesfully');
        })
      } else {
        $http.post(config.apiUrl + '/ws/styles', style).then(function (resp) {
          if (resp.data.global) {
            self.loadGlobalStyle();
          } else {
            self.loadPageStyles();
          }
          toaster.pop('success', 'Style', 'Style save succesfully');
        })
      }
    },
    removeStyle: function(style){
      $http.delete(config.apiUrl + '/ws/styles/' + style._id).then(function (resp) {
        toaster.pop('success', 'Style', 'Style removed succesfully');
      })
    }
  }
}

"use strict";

paSubscription .$inject = ["$q", "$rootScope", "$state", "$http", "paCache", "config"];
angular.module('paApp').factory('paSubscription', paSubscription );

function paSubscription ($q, $rootScope, $state, $http, paCache, config) {
    return {
        getOrganizationSubscriptions: function(org){
            $http.get('/ws/organizations/'+org+'/subscriptions')
                .then(function(resp){
                    var pageScope=paCache.getPageScope();
                    pageScope.subscriptions = resp.data;
                })
        },
        getTeachersForSubscription: function(subscr){
            $http.get('/ws/subscriptions/'+subscr+'/teachers')
                .then(function(resp){
                    var pageScope=paCache.getPageScope();
                    pageScope.teachers = resp.data;
                })
        },
        linkSubscriptionToTeacher: function(subscr, teacher){
            var deferred = $q.defer();
            $http.put('/ws/subscriptions/'+subscr._id+'/teachers/'+teacher._id)
                .then(function(resp){
                    return deferred.resolve();
                })
            return deferred.promise;
        },
        unlinkSubscriptionFromTeacher: function(subscr){
            var deferred = $q.defer();
            $http.delete('/ws/subscriptions/'+subscr._id+'/teachers/'+subscr.teacher._id)
                .then(function(resp){
                    return deferred.resolve();
                })
            return deferred.promise;
        },
        findStudentSubscription: function(){
            var deferred = $q.defer();
            $http.post('/ws/findSubscription',{student:$rootScope.user.student}).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        loadPendingSubscriptions: function(){
            var events = paCache.getEvents();
            $http.get('/ws/findPendingSubscriptions/'+$rootScope.user.teacher).then(function(resp){
                  events.pendingSubscriptions = resp.data.length;
            })
        },
        sendSubscriptionRequest: function(teacher){
            var deferred = $q.defer();
            $http.post('/ws/requestSubscription/'+teacher+'/'+$rootScope.user.student).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        revokeSubscriptionRequest: function(subscr){
            var deferred = $q.defer();
            $http.delete('/ws/requestSubscription/'+subscr._id).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        acceptSubscriptionRequest: function(subscr){
            var deferred = $q.defer();
            $http.put('/ws/requestSubscription/'+subscr._id).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        }

    }
}
"use strict";

paTeacher.$inject = ["$q", "$rootScope", "$state", "$http", "paCache", "config"];
angular.module('paApp').factory('paTeacher', paTeacher);

function paTeacher($q, $rootScope, $state, $http, paCache, config) {
    return {
        getOrganizationTeachers: function(org) {
            var pageScope=paCache.getPageScope();
            $http.post(config.apiUrl + '/ws/findTeachers', {organization: org}).then(function (resp) {
                pageScope.teachers = resp.data;
            });
        },
        getFolderSubscriptions: function(teacher){
          var pageScope=paCache.getPageScope();
          $http.get(config.apiUrl + '/ws/menu/folderSubscriptions/'+teacher._id).then(function(resp){
            pageScope.folderSubscriptions = resp.data;
          })

        },
        linkTeacherToOrganization: function(teacher, organization) {
          var deferred = $q.defer();
          $http.post('/ws/organizations/'+organization+'/teachers/'+teacher)
            .then(function(resp){
              return deferred.resolve();
            })
          return deferred.promise;
        },

        unlinkTeacherFromOrganization: function(teacher, organization) {
          var deferred = $q.defer();
          $http.delete('/ws/organizations/'+organization+'/teachers/'+teacher)
            .then(function(resp){
              return deferred.resolve();
            })
          return deferred.promise;
        },

        getOrganizationTeachersByFolder: function(org, folder){
          var deferred = $q.defer();
          $http.get('/ws/organizations/'+org+'/teachers/folders/'+folder)
            .then(function(resp){
              return deferred.resolve(resp.data);
            })
          return deferred.promise;
        },

        loadCertificates:function(teacher){
          var pageScope = paCache.getPageScope();
          $http.get('/ws/teachers/'+teacher+'/certificates')
            .then(function(resp){
              pageScope.certificates = resp.data;
            })
        },

        getVkProfile:function(id){
          var pageScope = paCache.getPageScope();
          $http.get('/ws/users/'+id+'/vk')
            .then(function(resp){
              pageScope.vk = resp.data;
            })
        },

        getZoomProfile:function(id){
          var pageScope = paCache.getPageScope();
          $http.get('/ws/users/'+id+'/zoom')
            .then(function(resp){
              pageScope.zoom = resp.data;
            })
        },

        getMirgovoritProfile:function(id){
          var pageScope = paCache.getPageScope();
          $http.get('/ws/users/'+id+'/mirgovorit')
            .then(function(resp){
              pageScope.mirgovorit = resp.data;
            })
        },

        getTeacherMirgovoritProfile:function(id){
          var deferred = $q.defer();
          $http.get('/ws/teachers/'+id+'/mirgovorit')
            .then(function(resp){
              return deferred.resolve(resp.data);
            })
            return deferred.promise;
          }

   }
}
/*.factory('timestampMarker', ['$rootScope', '$log', 'LogglyLogger', function($rootScope, $log, LogglyLogger) {  
    var timestampMarker = {
        request: function(config) {
        	if (config.url.indexOf('/ws/') != -1){
		        config.requestTimestamp = new Date().getTime();
        		LogglyLogger.sendMessage({
					username: $rootScope.user.username,
					url: config.url, 
					data: config.data, 
					message: 'start'
				});
            }
            return config;
        },
        response: function(response) {
        	if (response.config.url.indexOf('/ws/') != -1){
	        	var t = new Date().getTime() - response.config.requestTimestamp;
        		LogglyLogger.sendMessage({
					username: $rootScope.user.username,
					url: response.config.url, 
					data: response.data, 
					duration: t, 
					message: 'end'
				});
            }
            return response;
        }
    };
    return timestampMarker;
}])*/
"use strict";

webinarService.$inject = ["$q", "$rootScope", "$state", "$http", "paCache", "config"];
angular.module('paApp').factory('webinarService', webinarService);

function webinarService($q, $rootScope, $state, $http, paCache, config) {
    return {
        loadUpcomingWebinar: function(teacherId){
            var pageScope = paCache.getPageScope();
            $http.get('/ws/teachers/'+teacherId+'/webinarSubscription').then(function(resp){
                var webinarSubscription = (resp.data) ? resp.data : {};
                pageScope.webinarSubscription = webinarSubscription;
                if (!webinarSubscription.webinar || Date.parse(webinarSubscription.webinar.date) > Date.now()){
                    pageScope.upcomingWebinar = true;
                }
            })
        },
        loadWebinars: function(){
            $http.get(config.apiUrl + '/ws/webinars/upcoming').then(function (resp) {
                var webinars = resp.data;
          
                _.each(webinars, function (webinar) {
                  if (!webinar.attendeeNo){
                    webinar.attendeeNo=6;
                  }
                  /*$http.get(config.apiUrl + '/ws/webinars/' + webinar._id + '/subscriptions').then(function (resp) {
                    webinar.subscriptions = resp.data.length;
                  });*/
                });

                var pageScope = paCache.getPageScope();
                pageScope.webinars = webinars;
              });
        },
        updateSubscription: function(subscr){
            var deferred = $q.defer();
            $http.post('/ws/webinars/'+subscr.webinar._id+'/subscriptions/'+$rootScope.user.teacher).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        },
        removeSubscription: function(subscr){
            var deferred = $q.defer();
            $http.delete('/ws/webinarSubscriptions/'+subscr._id).then(function(resp){
                return deferred.resolve(resp.data);
            })
            return deferred.promise;
        }
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjbC5zcnYuanMiLCJhdXRoLnNydi5qcyIsImNhY2hlLnNydi5qcyIsImNoYW5uZWwuc3J2LmpzIiwiZXhjZXB0aW9uSGFuZGxlci5zcnYuanMiLCJmZWVkLnNydi5qcyIsImhvbWV3b3JrLnNydi5qcyIsImludGVyY2VwdG9yLnNydi5qcyIsImludHJvLnNydi5qcyIsIm1lbnUuc3J2LmpzIiwicGEuc3J2LmpzIiwicGEudmlld3Muc3J2LmpzIiwicGF5bWVudC5zcnYuanMiLCJzb2NrZXQuc3J2LmpzIiwic3RvcmFnZS5zcnYuanMiLCJzdHVkZW50LnNydi5qcyIsInN0eWxlLnNydi5qcyIsInN1YnNjcmlwdGlvbi5zcnYuanMiLCJ0ZWFjaGVyLnNydi5qcyIsInRpbWVzdGFtcC5zcnYuanMiLCJ3ZWJpbmFyLnNydi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5dkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJzZXJ2aWNlcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhQWNsLiRpbmplY3QgPSBbXCIkaHR0cFwiLCBcIiRxXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZmFjdG9yeSgncGFBY2wnLCBwYUFjbCk7XHJcblxyXG5mdW5jdGlvbiBwYUFjbCgkaHR0cCwgJHEsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG4gIHZhciBwZXJtaXNzaW9ucyA9IHt9O1xyXG4gIHJldHVybiB7XHJcbiAgICBsb2FkUGVybWlzc2lvbnM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9hbGxvd2VkUGVybWlzc2lvbnMnKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgcGVybWlzc2lvbnMgPSByZXNwLmRhdGE7XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGlzQWxsb3dlZDogZnVuY3Rpb24gaXNBbGxvd2VkKHJlc291cmNlLCBwZXJtaXNzaW9uKSB7XHJcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9pc0FsbG93ZWQvJyArIHJlc291cmNlICsgJy8nICsgcGVybWlzc2lvbikudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH0sXHJcbiAgICBoYXNQZXJtaXNzaW9uOiBmdW5jdGlvbihyZXNvdXJjZSwgcGVybWlzc2lvbil7XHJcbiAgICAgIHJldHVybiBwZXJtaXNzaW9uc1tyZXNvdXJjZV0gJiYgcGVybWlzc2lvbnNbcmVzb3VyY2VdLmluY2x1ZGVzKHBlcm1pc3Npb24pO1xyXG4gICAgfSxcclxuICAgIGxvYWRTeXN0ZW1SZXNvdXJjZXM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9zeXN0ZW1SZXNvdXJjZXMnKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgY29uZi5zeXN0ZW1SZXNvdXJjZXMgPSBfLnNvcnRCeShyZXNwLmRhdGEsICdvcmRlcicpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxuYXV0aFNlcnZpY2UuJGluamVjdCA9IFtcIiRxXCIsIFwiJGh0dHBcIiwgXCIkd2luZG93XCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5mYWN0b3J5KCdhdXRoU2VydmljZScsIGF1dGhTZXJ2aWNlKTtcclxuXHJcbmZ1bmN0aW9uIGF1dGhTZXJ2aWNlKCRxLCAkaHR0cCwgJHdpbmRvdywgY29uZmlnKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIGxvZ2luOiBmdW5jdGlvbih1c2VybmFtZSwgcGFzc3dvcmQsIGNhbGxiYWNrKSB7XHJcbiAgICAgIC8vdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy9sb2dpbicsIHtcclxuICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUsXHJcbiAgICAgICAgcGFzc3dvcmQ6IHBhc3N3b3JkXHJcbiAgICAgIH0pLnRoZW4oXHJcbiAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEudG9rZW4pIHtcclxuICAgICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3BhLnRva2VuJywgcmVzcG9uc2UuZGF0YS50b2tlbik7XHJcbiAgICAgICAgICBjYWxsYmFjayh7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIGRhdGE6IHJlc3BvbnNlLmRhdGFcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjYWxsYmFjayh7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgY3JlZGVudGlhbHMnXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIG1pcmdvdm9yaXRMb2dpbjogZnVuY3Rpb24oZGF0YSwgY2FsbGJhY2spIHtcclxuICAgICAgLy92YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL21pcmdvdm9yaXQvbG9naW4nLCB7XHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgICB9KS50aGVuKFxyXG4gICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnRva2VuKSB7XHJcbiAgICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwYS50b2tlbicsIHJlc3BvbnNlLmRhdGEudG9rZW4pO1xyXG4gICAgICAgICAgY2FsbGJhY2soe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBkYXRhOiByZXNwb25zZS5kYXRhLnByb2ZpbGVcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBjYWxsYmFjayh7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBlcnJvcjogJ0ludmFsaWQgY3JlZGVudGlhbHMnXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKHtcclxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3I6IGVycm9yXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGxvZ291dDogZnVuY3Rpb24gbG9nb3V0KCkge1xyXG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvbG9nb3V0JykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGVmZXJyZWQ7XHJcbiAgICB9LFxyXG4gICAgZ2V0U3RyYXRlZ2llczogZnVuY3Rpb24oKXtcclxuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2F1dGgvc3RyYXRlZ2llcycpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhQ2FjaGUuJGluamVjdCA9IFtcIiRsb2dcIiwgJ2NvbmZpZyddO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5mYWN0b3J5KCdwYUNhY2hlJywgcGFDYWNoZSk7XHJcblxyXG5mdW5jdGlvbiBwYUNhY2hlKCRsb2csIGNvbmZpZykge1xyXG4gIHZhciBkYXRhID0ge1xyXG4gICAgaW5pdGlhbGl6ZWQ6IGZhbHNlXHJcbiAgfTtcclxuICB2YXIgY29uZiA9IHt9O1xyXG4gIHZhciBmZWVkID0ge307XHJcbiAgdmFyIHBhZ2VTY29wZSA9IHt9O1xyXG4gIHZhciBhbGVydHMgPSBbXTtcclxuICB2YXIgZXZlbnRzID0ge307XHJcbiAgdmFyIGNvdW50ZXJzPSBudWxsO1xyXG4gIHZhciBsb2NhbGl6YXRpb249e1xyXG4gICAgbG9jYWxlczogW1xyXG4gICAgICB7Y29kZTonaXQnLGRlc2M6J2l0YWxpYW5vJ30sXHJcbiAgICAgIHtjb2RlOidlbicsZGVzYzonZW5nbGlzaCd9LFxyXG4gICAgICB7Y29kZToncnUnLGRlc2M6J9GA0YPRgdGB0LrQuNC5J30sXHJcbiAgICAgIHtjb2RlOidmcicsZGVzYzonZnJhbmNhaXMnfSxcclxuICAgICAge2NvZGU6J2RlJyxkZXNjOidkZXV0c2NoZSd9XHJcbiAgICBdXHJcbiAgfVxyXG4gIHJldHVybiB7XHJcbiAgICBzZXRPbmxpbmVVc2VyczogZnVuY3Rpb24odXNlcnMpIHtcclxuICAgICAgY29uZi5vbmxpbmVVc2VycyA9IF8uaW5kZXhCeSh1c2VycywgJ3N0dWRlbnQnKTtcclxuICAgIH0sXHJcbiAgICBzZXRDdXJyZW50UGFnZTogZnVuY3Rpb24ocGFnZSkge1xyXG4gICAgICBjb25mLmN1cnJlbnRQYWdlID0gcGFnZTtcclxuICAgIH0sXHJcbiAgICBzZXRDdXJyZW50Rm9sZGVyOiBmdW5jdGlvbihmb2xkZXIpIHtcclxuICAgICAgY29uZi5jdXJyZW50Rm9sZGVyID0gZm9sZGVyO1xyXG4gICAgfSxcclxuICAgIHNldEN1cnJlbnRDb250ZW50OiBmdW5jdGlvbihjb250ZW50KSB7XHJcbiAgICAgIGNvbmYuY3VycmVudENvbnRlbnQgPSBjb250ZW50O1xyXG4gICAgfSxcclxuICAgIHNldEN1cnJlbnRIb21ld29yazogZnVuY3Rpb24oaG9tZXdvcmspIHtcclxuICAgICAgY29uZi5jdXJyZW50SG9tZXdvcmsgPSBob21ld29yaztcclxuICAgIH0sXHJcbiAgICBzZXRDdXJyZW50TW9kZTogZnVuY3Rpb24obW9kZSkge1xyXG4gICAgICBjb25mLmN1cnJlbnRNb2RlID0gbW9kZTtcclxuICAgIH0sXHJcbiAgICBzZXRTZWxlY3RlZDogZnVuY3Rpb24oaSwgc2VsKSB7XHJcbiAgICAgIGlmKCFkYXRhLnNlbGVjdGVkKXtcclxuICAgICAgICBkYXRhLnNlbGVjdGVkPXt9O1xyXG4gICAgICB9XHJcbiAgICAgIGRhdGEuc2VsZWN0ZWRbaV0gPSBzZWw7XHJcbiAgICB9LFxyXG4gICAgZ2V0U2VsZWN0ZWQ6IGZ1bmN0aW9uKGkpIHtcclxuICAgICAgcmV0dXJuIGRhdGEuc2VsZWN0ZWRbaV07XHJcbiAgICB9LFxyXG4gICAgc2V0U2VsZWN0ZWRJbWFnZTogZnVuY3Rpb24obXNnKSB7XHJcbiAgICAgIGRhdGEuc2VsZWN0ZWRJbWFnZSA9IG1zZy5faWQ7XHJcbiAgICB9LFxyXG4gICAgc2V0VGFiOiBmdW5jdGlvbihpKSB7XHJcbiAgICAgIGRhdGEudGFiID0gaTtcclxuICAgIH0sXHJcbiAgICBzZXRTaXplOiBmdW5jdGlvbihzKSB7XHJcbiAgICAgIGRhdGEuc2l6ZSA9IHM7XHJcbiAgICB9LFxyXG4gICAgc2V0U2l6ZTI6IGZ1bmN0aW9uKHMpIHtcclxuICAgICAgZGF0YS5zaXplMiA9IHM7XHJcbiAgICB9LFxyXG4gICAgc2V0OiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xyXG4gICAgICBkYXRhW25hbWVdID0gdmFsdWU7XHJcbiAgICB9LFxyXG4gICAgc3RvcFJlYzogZnVuY3Rpb24oKSB7XHJcbiAgICAgIGRhdGEucmVjID0gZmFsc2U7XHJcbiAgICB9LFxyXG4gICAgc2V0Q2hhbm5lbDogZnVuY3Rpb24oY2hhbm5lbCkge1xyXG4gICAgICBjb25mLmNoYW5uZWwgPSBjaGFubmVsO1xyXG4gICAgfSxcclxuICAgIHNldFNpZGViYXJUYWI6IGZ1bmN0aW9uKHRhYikge1xyXG4gICAgICBpZiAoIWNvbmYuc2lkZWJhcikge1xyXG4gICAgICAgIGNvbmYuc2lkZWJhcj17fTtcclxuICAgICAgfVxyXG4gICAgICBjb25mLnNpZGViYXIudGFiPXRhYjtcclxuICAgIH0sXHJcbiAgICBpbml0OiBmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIGpxID0gKGFuZ3VsYXIuZWxlbWVudCA9PT0gd2luZG93LmpRdWVyeSk7XHJcbiAgICAgIGlmICghanEpIHtcclxuICAgICAgICAkbG9nLmVycm9yKCd1c2luZyBqcUxpdGUnKTtcclxuICAgICAgfVxyXG4gICAgICBkYXRhID0ge1xyXG4gICAgICAgIGluaXRpYWxpemVkOiB0cnVlLFxyXG4gICAgICAgIHNlbGVjdGVkOiB7fSxcclxuICAgICAgICByYXRpbzogMSxcclxuICAgICAgICBzaXplOiAzLFxyXG4gICAgICAgIHNpemUyOiA3LFxyXG4gICAgICAgIG9wYWNpdHk6IC40LFxyXG4gICAgICAgIHNlbGVjdGVkSW1hZ2U6IC0xLFxyXG4gICAgICAgIHNlbGVjdGVkRGl2OiAtMSxcclxuICAgICAgICB0YWI6IDEsXHJcbiAgICAgICAgY291bnRlcjogMCxcclxuICAgICAgICBjb3VudGVyczoge30sXHJcbiAgICAgICAgdGVtcDoge30sXHJcbiAgICAgICAgbm90aWZpY2F0aW9uczogW10sXHJcbiAgICAgICAgdW5pdDogYW5ndWxhci5lbGVtZW50KCcjcGFuZWwnKS53aWR0aCgpIC8gMTIsXHJcbiAgICAgICAgdW5pdFc6IGFuZ3VsYXIuZWxlbWVudCgnI3BhbmVsJykud2lkdGgoKSAvIDEwMCxcclxuICAgICAgICB1bml0SDogYW5ndWxhci5lbGVtZW50KCcjcGFuZWwnKS5oZWlnaHQoKSAvIDEwMCxcclxuICAgICAgICBzZWxDb2xsZWN0aW9uczoge30sXHJcbiAgICAgICAgYXVkaW86IHt9LFxyXG4gICAgICAgIHRvb2x0aXBzOiB7fSxcclxuICAgICAgICBwbGF5ZXI6IHt9XHJcbiAgICAgIH07XHJcbiAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfSxcclxuICAgIGluaXRDb3VudGVyczogZnVuY3Rpb24ob2JqKXtcclxuICAgICAgY291bnRlcnMgPSBvYmo7XHJcbiAgICB9LFxyXG4gICAgZ2V0Q291bnRlcnM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgIHJldHVybiBjb3VudGVycztcclxuICAgIH0sXHJcbiAgICBpbml0UGFnZVNjb3BlOiBmdW5jdGlvbigpe1xyXG4gICAgICBwYWdlU2NvcGU9e307XHJcbiAgICAgIHJldHVybiBwYWdlU2NvcGU7XHJcbiAgICB9LFxyXG4gICAgZ2V0UGFnZVNjb3BlOiBmdW5jdGlvbigpe1xyXG4gICAgICByZXR1cm4gcGFnZVNjb3BlO1xyXG4gICAgfSxcclxuICAgIGdldERhdGE6IGZ1bmN0aW9uKCkge1xyXG4gICAgICByZXR1cm4gZGF0YTtcclxuICAgIH0sXHJcbiAgICBnZXRDb25mOiBmdW5jdGlvbigpIHtcclxuICAgICAgcmV0dXJuIGNvbmY7XHJcbiAgICB9LFxyXG4gICAgZ2V0RmVlZDogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHJldHVybiBmZWVkO1xyXG4gICAgfSxcclxuICAgIGdldEFsZXJ0czogZnVuY3Rpb24oKXtcclxuICAgICAgcmV0dXJuIGFsZXJ0cztcclxuICAgIH0sXHJcbiAgICBnZXRFdmVudHM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgIHJldHVybiBldmVudHM7XHJcbiAgICB9LFxyXG4gICAgZ2V0RHJvcHM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgIGlmICghZGF0YS5kcm9wcyl7XHJcbiAgICAgICAgZGF0YS5kcm9wcz17fTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZGF0YS5kcm9wcztcclxuICAgIH0sXHJcbiAgICBnZXRMb2NhbGl6YXRpb246IGZ1bmN0aW9uKCl7XHJcbiAgICAgIHJldHVybiBsb2NhbGl6YXRpb247XHJcbiAgICB9LFxyXG4gICAgaW5pdExvY2FsZTogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHZhciBzdG9yZWRMb2NhbGUgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BhLmxvY2FsZScpO1xyXG4gICAgICBpZiAoIXN0b3JlZExvY2FsZSkge1xyXG4gICAgICAgIHRoaXMuc2V0VXNlckxvY2FsZShjb25maWcuZGVmYXVsdExvY2FsZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zZXRVc2VyTG9jYWxlKHN0b3JlZExvY2FsZSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzZXRVc2VyTG9jYWxlOiBmdW5jdGlvbihsb2NhbGUpe1xyXG4gICAgICB2YXIgdXNlckxvY2FsZSA9IGxvY2FsaXphdGlvbi5sb2NhbGVzLmZpbmQoKGwpPT5sLmNvZGU9PWxvY2FsZSk7XHJcbiAgICAgIGlmICh1c2VyTG9jYWxlKSB7XHJcbiAgICAgICAgbG9jYWxpemF0aW9uLnVzZXJMb2NhbGUgPSB1c2VyTG9jYWxlO1xyXG4gICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncGEubG9jYWxlJywgdXNlckxvY2FsZS5jb2RlKTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGdldFVzZXJMb2NhbGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICByZXR1cm4gbG9jYWxpemF0aW9uLnVzZXJMb2NhbGU7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFDaGFubmVsLiRpbmplY3QgPSBbXCIkcVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmZhY3RvcnkoJ3BhQ2hhbm5lbCcsIHBhQ2hhbm5lbCk7XHJcblxyXG5mdW5jdGlvbiBwYUNoYW5uZWwoJHEsICRyb290U2NvcGUsICRodHRwLCBwYUNhY2hlLCBjb25maWcpIHtcclxuICByZXR1cm4ge1xyXG4gICAgbG9hZFZhbGlkU3R1ZGVudHM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kVXNlclN1YnNjcmlwdGlvbnMvJyArICRyb290U2NvcGUudXNlci5jaGFubmVsKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgdmFyIHBhZ2VTY29wZSA9IHBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgcGFnZVNjb3BlLnZhbGlkU3R1ZGVudHMgPSBfLmluZGV4QnkocmVzcC5kYXRhLCdzdHVkZW50Jyk7XHJcbiAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgc2F2ZUxlc3NvbjogZnVuY3Rpb24oc3Vic2NyaXB0aW9uKXtcclxuICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9uZXdMZXNzb24vJyArIHN1YnNjcmlwdGlvbi5zdHVkZW50Ll9pZCArICcvJyArICRyb290U2NvcGUudXNlci50ZWFjaGVyICsgJy8nICsgY29uZi5jaGFubmVsLl9pZCk7XHJcbiAgICB9LFxyXG4gICAgbG9hZFJvb206IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gIFxyXG4gICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kQ2hhbm5lbFN1YnNjcmlwdGlvbnMvJyArIGNvbmYuY2hhbm5lbC5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgIGNvbmYucm9vbS5zdWJzY3JpcHRpb25zPXJlc3AuZGF0YTtcclxuXHJcbiAgICAgICAgICB2YXIgcHJvbWlzZXM9W107XHJcbiAgICAgICAgICBfLmVhY2gocmVzcC5kYXRhLGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgICAgIHZhciBwcm9taXNlID0gJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3N0dWRlbnREYXRhLycrc3Vic2NyLnN0dWRlbnQuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXNwLmRhdGE7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHByb21pc2VzLnB1c2gocHJvbWlzZSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHZhciBwcm9taXNlID0gJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3RlYWNoZXJEYXRhLycrJHJvb3RTY29wZS51c2VyLmNoYW5uZWwpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwLmRhdGE7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgcHJvbWlzZXMucHVzaChwcm9taXNlKTtcclxuICBcclxuICAgICAgICAgICRxLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgICAgIC8vIHNvcnRcclxuICAgICAgICAgICAgICBjb25mLnJvb20udXNlcnM9cmVzdWx0O1xyXG4gICAgICAgICAgICAgIGNvbmYudXNlcj1fLmZpbmQocmVzdWx0LCBmdW5jdGlvbih1c2VyKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLmlkPT0kcm9vdFNjb3BlLnVzZXIuaWQ7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY29uZi5yb29tLnVzZXJzOicrcmVzdWx0Lmxlbmd0aCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0sXHJcbiAgICAgIGpvaW5DaGFubmVsOiBmdW5jdGlvbihpZCl7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAkaHR0cC5nZXQoJy93cy9jaGFubmVscy8nK2lkKycvam9pbicpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgIH0sXHJcbiAgICAgIGZpbmRPckNyZWF0ZUNoYW5uZWw6IGZ1bmN0aW9uKGlkKXtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICRodHRwLmdldCgnL3dzL2ZpbmRPckNyZWF0ZUNoYW5uZWwvdGVhY2hlcnMvJytpZCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgfSxcclxuICAgICAgc3Vic2NyaWJlQ2hhbm5lbDogZnVuY3Rpb24oc3Vic2NyKSB7XHJcbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAkaHR0cC5wb3N0KCcvd3Mvc3R1ZGVudHMvJytzdWJzY3Iuc3R1ZGVudCsnL3N1YnNjcmliZUNoYW5uZWwnLHN1YnNjcikudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgfSxcclxuICAgICAgdW5zdWJzY3JpYmVDaGFubmVsOiBmdW5jdGlvbihzdWJzY3IpIHtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICRodHRwLnBvc3QoJy93cy9zdHVkZW50cy8nK3N1YnNjci5zdHVkZW50KycvdW5zdWJzY3JpYmVDaGFubmVsJykudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgfSxcclxuICAgICAgc2F2ZVN1YnNjcmlwdGlvbnM6IGZ1bmN0aW9uKHN1YnNjcmlwdGlvbnMpIHtcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG5cclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICRodHRwLnBvc3QoJy93cy9jaGFubmVscy8nK2NvbmYuY2hhbm5lbC5faWQrJy9zdWJzY3JpcHRpb25zJywgc3Vic2NyaXB0aW9ucykudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgfSxcclxuICAgICAgb3BlbkNoYW5uZWw6IGZ1bmN0aW9uKGlkKXtcclxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvb3BlbkNoYW5uZWwvJyArIGlkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmV4Y2VwdGlvbkhhbmRsZXIuJGluamVjdCA9IFsnJGxvZycsICdMb2dnbHlMb2dnZXInLCAnJGluamVjdG9yJ107XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmZhY3RvcnkoJyRleGNlcHRpb25IYW5kbGVyJywgZXhjZXB0aW9uSGFuZGxlcik7XHJcblxyXG5mdW5jdGlvbiBleGNlcHRpb25IYW5kbGVyKCRsb2csIExvZ2dseUxvZ2dlciwgJGluamVjdG9yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24oZXhjZXB0aW9uLCBjYXVzZSkge1xyXG5cdFx0dmFyIHJvb3RTY29wZSA9ICRpbmplY3Rvci5nZXQoJyRyb290U2NvcGUnKTtcclxuXHRcdGlmIChyb290U2NvcGUpe1xyXG5cdFx0XHRMb2dnbHlMb2dnZXIuZmllbGRzKCB7IHVzZXJuYW1lOiByb290U2NvcGUudXNlci51c2VybmFtZSB9ICk7XHJcblx0XHR9XHJcblx0XHQkbG9nLmVycm9yKGV4Y2VwdGlvbiwgY2F1c2UpO1xyXG4gICAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFGZWVkLiRpbmplY3QgPSBbXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkcVwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmZhY3RvcnkoJ3BhRmVlZCcsIHBhRmVlZCk7XHJcblxyXG5mdW5jdGlvbiBwYUZlZWQoJHJvb3RTY29wZSwgJGh0dHAsICRxLCBwYUNhY2hlLCBjb25maWcpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbG9hZEZlZWRzOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJy93cy9mZWVkcycpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFnZVNjb3BlID0gcGFDYWNoZS5nZXRQYWdlU2NvcGUoKTtcclxuICAgICAgICAgICAgICAgIHBhZ2VTY29wZS5mZWVkcz1yZXNwLmRhdGE7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuICAgICAgICBhZGRGZWVkOiBmdW5jdGlvbihmZWVkKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJy93cy9mZWVkcycsIGZlZWQpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHVwZGF0ZUZlZWQ6IGZ1bmN0aW9uKGZlZWQpIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAucHV0KCcvd3MvZmVlZHMvJytmZWVkLl9pZCwgZmVlZCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVtb3ZlRmVlZDogZnVuY3Rpb24oZmVlZCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJy93cy9mZWVkcy8nK2ZlZWQuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG4gICB9XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhSG9tZXdvcmsuJGluamVjdCA9IFtcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRxXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZmFjdG9yeSgncGFIb21ld29yaycsIHBhSG9tZXdvcmspO1xyXG5cclxuZnVuY3Rpb24gcGFIb21ld29yaygkcm9vdFNjb3BlLCAkaHR0cCwgJHEsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBsb2FkSG9tZXdvcmtzOiBmdW5jdGlvbihzdHVkZW50KXtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvd3MvaG9tZXdvcmtzL3N0dWRlbnRzLycrc3R1ZGVudCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG4gICAgICAgICAgICAgICAgcGFnZVNjb3BlLmhvbWV3b3Jrcz1yZXNwLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2NvcGUuaG9tZXdvcmtzT3Blbj1fLmZpbHRlcihwYWdlU2NvcGUuaG9tZXdvcmtzLCBoPT4haC5kb25lKS5sZW5ndGg7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuICAgICAgICBhZGRIb21ld29yazogZnVuY3Rpb24oaG9tZXdvcmspIHtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3dzL2hvbWV3b3JrcycsIGhvbWV3b3JrKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlZGl0SG9tZXdvcms6IGZ1bmN0aW9uKGhvbWV3b3JrKSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLnB1dCgnL3dzL2hvbWV3b3Jrcy8nK2hvbWV3b3JrLl9pZCwgaG9tZXdvcmspLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlbW92ZUhvbWV3b3JrOiBmdW5jdGlvbihob21ld29yaykge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJy93cy9ob21ld29ya3MvJytob21ld29yay5faWQpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHBhdGNoSG9tZXdvcms6IGZ1bmN0aW9uKHN0dWRlbnQsIGNvbnRlbnQsIHBhdGNoKXtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAucHV0KCcvd3MvaG9tZXdvcmtzL3N0dWRlbnRzLycrc3R1ZGVudCsnL2NvbnRlbnRzLycrY29udGVudCwgcGF0Y2gpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNhdmVDb21tZW50OiBmdW5jdGlvbihob21ld29yaywgY29tbWVudCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvd3MvaG9tZXdvcmtzLycraG9tZXdvcmsuX2lkKycvY29tbWVudHMnLCB7Y29tbWVudDogY29tbWVudH0pLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHVwZGF0ZUNvbW1lbnQ6IGZ1bmN0aW9uKGhvbWV3b3JrLCBpLCBjb21tZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLnB1dCgnL3dzL2hvbWV3b3Jrcy8nK2hvbWV3b3JrLl9pZCsnL2NvbW1lbnRzLycraSwge2NvbW1lbnQ6IGNvbW1lbnR9KS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICByZW1vdmVDb21tZW50OiBmdW5jdGlvbihob21ld29yaywgaSkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJy93cy9ob21ld29ya3MvJytob21ld29yay5faWQrJy9jb21tZW50cy8nK2kpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmF1dGhJbnRlcmNlcHRvci4kaW5qZWN0ID0gW1wiJHdpbmRvd1wiLCBcIiRxXCIsIFwidG9hc3RlclwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZmFjdG9yeSgnYXV0aEludGVyY2VwdG9yJywgYXV0aEludGVyY2VwdG9yKTtcclxuXHJcbmZ1bmN0aW9uIGF1dGhJbnRlcmNlcHRvcigkd2luZG93LCAkcSwgdG9hc3Rlcikge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXF1ZXN0OiBmdW5jdGlvbiByZXF1ZXN0KGNvbmZpZykge1xyXG4gICAgICBpZighY29uZmlnLnVybC5zdGFydHNXaXRoKCdodHRwczovL2EzNGFsZWZlbGl6YS5naXRodWIuaW8nKSBcclxuICAgICAgJiYgIWNvbmZpZy51cmwuc3RhcnRzV2l0aCgnaHR0cHM6Ly9jdXN0b21zZWFyY2guZ29vZ2xlYXBpcy5jb20nKSBcclxuICAgICAgJiYgIWNvbmZpZy51cmwuc3RhcnRzV2l0aCgnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20veW91dHViZScpKXtcclxuICAgICAgICBjb25maWcuaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gJ0JlYXJlciAnICsgJHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGEudG9rZW4nKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgfSxcclxuICAgIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIHJlc3BvbnNlRXJyb3IocmVzcG9uc2UpIHtcclxuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgLy90b2FzdGVyLnBvcCgnZXJyb3InLCBcIkFjY2VzcyBkZW5pZWRcIiwgXCJub3QgYXV0aGVudGljYXRlZFwiKTsgLy8kd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL2xvZ2luJztcclxuICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMykge1xyXG4gICAgICAgIHRvYXN0ZXIucG9wKCdlcnJvcicsIFwiQWNjZXNzIGRlbmllZFwiLCBcIm5vdCBhdXRob3JpemVkXCIpO1xyXG4gICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNTAwKSB7XHJcbiAgICAgICAgdG9hc3Rlci5wb3AoJ2Vycm9yJywgXCJFcnJvclwiLCByZXNwb25zZS5kYXRhKTtcclxuICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCB8fCByZXNwb25zZS5zdGF0dXMgPT09IDQwOSkge1xyXG4gICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzcG9uc2UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFJbnRyby4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwiJHFcIiwgXCIkdGltZW91dFwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIiwgXCJuZ0ludHJvU2VydmljZVwiLCBcInRvYXN0ZXJcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmZhY3RvcnkoJ3BhSW50cm8nLCBwYUludHJvKTtcclxuXHJcbmZ1bmN0aW9uIHBhSW50cm8oJHJvb3RTY29wZSwgJHN0YXRlLCAkaHR0cCwgJHEsICR0aW1lb3V0LCBwYUNhY2hlLCBjb25maWcsIG5nSW50cm9TZXJ2aWNlLCB0b2FzdGVyKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc2V0SW50cm86IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvd3MvaW50cm8vcmVzZXQvJyskcm9vdFNjb3BlLnVzZXIuaWQpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYWdlVG91cjogZnVuY3Rpb24ocGFnZSkge1xyXG4gICAgICAgICAgICB2YXIgc2VsZj10aGlzO1xyXG4gICAgICAgICAgICBpZiAoY29uZmlnLmludHJvICYmICRyb290U2NvcGUudXNlci5yb2xlPT0nVCcpe1xyXG4gICAgICAgICAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwrJy93cy9pbnRyby8nK3BhZ2UpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhZ2VTdGVwcyA9IHJlc3AuZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocGFnZVN0ZXBzICYmIHBhZ2VTdGVwcy5sZW5ndGgpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNob3dVc2VyUHJvZmlsZSA9IF8uZmluZChwYWdlU3RlcHMsIGZ1bmN0aW9uKHN0ZXApe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHN0ZXAuc2hvd1VzZXJQcm9maWxlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dVc2VyUHJvZmlsZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZi5zaWRlYmFyPXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93OnRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFiOjFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vJHJvb3RTY29wZS4kYXBwbHkoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpe1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRyb09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1N0ZXBOdW1iZXJzOmZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dCdWxsZXRzOmZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dQcm9ncmVzczpmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwQ2xhc3M6J3BhLXRvb2x0aXAnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vZXhpdE9uRXNjOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGl0T25PdmVybGF5Q2xpY2s6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVQcmV2OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVOZXh0OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRUb0RvbmU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RlcHM6IHBhZ2VTdGVwc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5nSW50cm9TZXJ2aWNlLmNsZWFyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZ0ludHJvU2VydmljZS5zZXRPcHRpb25zKGludHJvT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZ0ludHJvU2VydmljZS5vbkNvbXBsZXRlKGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hcCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcFtwYWdlXSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL3dzL2ludHJvL2xhc3RTZWVuLycrJHJvb3RTY29wZS51c2VyLmlkLCBtYXApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5nSW50cm9TZXJ2aWNlLm9uRXhpdChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtYXAgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBbcGFnZV0gPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy93cy9pbnRyby9sYXN0U2Vlbi8nKyRyb290U2NvcGUudXNlci5pZCwgbWFwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZ0ludHJvU2VydmljZS5zdGFydCgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDAsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9ICAgIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0U3RlcHM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJy93cy9zdGVwcycpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNhdmVTdGVwczogZnVuY3Rpb24oc3RlcHMpe1xyXG4gICAgICAgICAgICAkaHR0cC5wdXQoJy93cy9zdGVwcycsIHN0ZXBzKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCAnU3RlcHMnLCAnU3RlcHMgc2F2ZWQgc3VjY2VzZnVsbHknKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNhdmVTdGVwOiBmdW5jdGlvbihzdGVwKXtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3dzL3N0ZXBzJywgc3RlcCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgIHRvYXN0ZXIucG9wKCdzdWNjZXNzJywgJ1N0ZXAnLCAnU3RlcCBzYXZlZCBzdWNjZXNmdWxseScpO1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnaW50cm8tc3RlcHMnKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlbW92ZVN0ZXA6IGZ1bmN0aW9uKHN0ZXApe1xyXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJy93cy9zdGVwcy8nK3N0ZXAuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCAnU3RlcCcsICdTdGVwIHJlbW92ZWQgc3VjY2VzZnVsbHknKTtcclxuICAgICAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2ludHJvLXN0ZXBzJyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFNZW51LiRpbmplY3QgPSBbXCIkaHR0cFwiLCBcIiRxXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZmFjdG9yeSgncGFNZW51JywgcGFNZW51KTtcclxuXHJcbmZ1bmN0aW9uIHBhTWVudSgkaHR0cCwgJHEsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG4gIHJldHVybiB7XHJcbiAgICBwYWdlczp7fSxcclxuICAgIGNvbnRlbnRzOnt9LFxyXG4gICAgbG9hZEZvbGRlcnM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZhciBjb25mPXBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICBpZighY29uZi5hbGxGb2xkZXJzKXtcclxuICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvbWVudS9maW5kQWxsRm9sZGVycycpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgIGNvbmYuYWxsRm9sZGVycyA9IF8uc29ydEJ5KHJlc3AuZGF0YSwgJ29yZGVyJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBsb2FkTXlGb2xkZXJzOiBmdW5jdGlvbih0ZWFjaGVyKXtcclxuICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL21lbnUvZmluZEZvbGRlcnMvJyArIHRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICBjb25mLm15Rm9sZGVycyA9IHJlc3AuZGF0YTtcclxuICAgICAgfSk7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9tZW51L2ZvbGRlclN1YnNjcmlwdGlvbnMvJyArIHRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICBjb25mLm15Rm9sZGVyU3Vic2NyaXB0aW9ucyA9IHJlc3AuZGF0YTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgbG9hZFBhZ2VzOiBmdW5jdGlvbihmb2xkZXIsIGZvcmNlUmVsb2FkKXtcclxuICAgICAgdmFyIHNlbGY9dGhpcztcclxuICAgICAgdmFyIGNvbmY9cGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgIGlmICghc2VsZi5wYWdlc1tmb2xkZXIuX2lkXSB8fCBmb3JjZVJlbG9hZCl7XHJcbiAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL21lbnUvZmluZFBhZ2VzLycgKyBmb2xkZXIuX2lkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgIF8uZWFjaChyZXN1bHQuZGF0YSwgZnVuY3Rpb24ocGFnZSl7XHJcbiAgICAgICAgICAgIHBhZ2UudGVtcGxhdGU9Y29uZi50ZW1wbGF0ZXNbcGFnZS50ZW1wbGF0ZV07XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgc2VsZi5wYWdlc1tmb2xkZXIuX2lkXSA9IF8uc29ydEJ5KHJlc3VsdC5kYXRhLCAncG9zJyk7XHJcbiAgICAgICAgICBmb2xkZXIucGFnZXMgPSBzZWxmLnBhZ2VzW2ZvbGRlci5faWRdO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGZvbGRlci5wYWdlcyA9IHNlbGYucGFnZXNbZm9sZGVyLl9pZF07XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBsb2FkQ29udGVudHM6IGZ1bmN0aW9uKGZvbGRlciwgZm9yY2VSZWxvYWQpe1xyXG4gICAgICB2YXIgc2VsZj10aGlzO1xyXG4gICAgICB2YXIgY29uZj1wYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgaWYgKCFzZWxmLmNvbnRlbnRzW2ZvbGRlci5faWRdIHx8ICFzZWxmLnBhZ2VzW2ZvbGRlci5faWRdIHx8IGZvcmNlUmVsb2FkKXtcclxuICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvZmluZENvbnRlbnRzQnlGb2xkZXIvJyArIGZvbGRlci5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG5cclxuICAgICAgICAgIF8uZWFjaChyZXN1bHQuZGF0YS5wYWdlcywgZnVuY3Rpb24ocGFnZSl7XHJcbiAgICAgICAgICAgIHBhZ2UudGVtcGxhdGU9Y29uZi50ZW1wbGF0ZXNbcGFnZS50ZW1wbGF0ZV07XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgc2VsZi5wYWdlc1tmb2xkZXIuX2lkXSA9IF8uc29ydEJ5KHJlc3VsdC5kYXRhLnBhZ2VzLCAncG9zJyk7XHJcbiAgICAgICAgICBmb2xkZXIucGFnZXMgPSBzZWxmLnBhZ2VzW2ZvbGRlci5faWRdO1xyXG5cclxuICAgICAgICAgIHZhciBwTWFwID0gXy5pbmRleEJ5KHJlc3VsdC5kYXRhLnBhZ2VzLCdfaWQnKTtcclxuICAgICAgICAgIF8uZWFjaChyZXN1bHQuZGF0YS5jb250ZW50cywgZnVuY3Rpb24oY29udGVudCl7XHJcbiAgICAgICAgICAgIGNvbnRlbnQucGFnZT1wTWFwW2NvbnRlbnQucGFnZV07XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgc2VsZi5jb250ZW50c1tmb2xkZXIuX2lkXSA9IF8uc29ydEJ5KHJlc3VsdC5kYXRhLmNvbnRlbnRzLCAnbmFtZScpO1xyXG4gICAgICAgICAgZm9sZGVyLmNvbnRlbnRzID0gc2VsZi5jb250ZW50c1tmb2xkZXIuX2lkXTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBmb2xkZXIuY29udGVudHMgPSBzZWxmLmNvbnRlbnRzW2ZvbGRlci5faWRdO1xyXG4gICAgICAgIGZvbGRlci5wYWdlcyA9IHNlbGYucGFnZXNbZm9sZGVyLl9pZF07XHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzZWFjaENvbGxlY3Rpb25zQnlOYW1lOiBmdW5jdGlvbihuYW1lKXtcclxuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgJGh0dHAucG9zdCgnL3dzL2NvbGxlY3Rpb25zL3NlYXJjaCcsIHtuYW1lOm5hbWV9KS50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzdWx0LmRhdGEpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFTZXJ2aWNlLiRpbmplY3QgPSBbXCIkcVwiLCBcIiRyb290U2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCIkaHR0cFwiLCBcInJ1bnRpbWVTdGF0ZXNcIiwgXCJwYUNhY2hlXCIsIFwicGFTb2NrZXRcIiwgXCJwYU1lbnVcIiwgXCJuZ0F1ZGlvXCIsIFwiY29uZmlnXCIsIFwidG9hc3RlclwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZmFjdG9yeSgncGFTZXJ2aWNlJywgcGFTZXJ2aWNlKTtcclxuXHJcbmZ1bmN0aW9uIHBhU2VydmljZSgkcSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICRodHRwLCBydW50aW1lU3RhdGVzLCBwYUNhY2hlLCBwYVNvY2tldCwgcGFNZW51LCBuZ0F1ZGlvLCBjb25maWcsIHRvYXN0ZXIpIHtcclxuICByZXR1cm4ge1xyXG4gICAgaW5pdDogZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmluaXQoKTtcclxuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgLyppZiAoY29uZi5jaGFubmVsICYmIGNvbmYuY2hhbm5lbC5vcGVuKSB7XHJcbiAgICAgICAgcGFDYWNoZS5zZXRTaWRlYmFyVGFiKDIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBhQ2FjaGUuc2V0U2lkZWJhclRhYigxKTtcclxuICAgICAgfSovXHJcbiAgXHJcbiAgICAgIGlmICgkc3RhdGUuY3VycmVudC5uYW1lKSB7XHJcbiAgICAgICAgaWYgKCRzdGF0ZVBhcmFtcy5jb250ZW50LnR5cGUgPT0gJ0MnKSB7XHJcbiAgICAgICAgICAvLyBieSBjb250ZW50XHJcbiAgICAgICAgICBkYXRhLnNlbENvbGxlY3Rpb25zLnJlYWRvbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgIHRoaXMubG9hZFBhZ2VDb250ZW50KGNvbmYuY3VycmVudENvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoJHN0YXRlUGFyYW1zLmNvbnRlbnQudHlwZSA9PSAnVycpIHtcclxuICAgICAgICAgIC8vIGJ5IHdvcmtwbGFuXHJcbiAgICAgICAgICBkYXRhLnNlbENvbGxlY3Rpb25zLnJlYWRvbmx5ID0gdHJ1ZTtcclxuICAgICAgICAgIHRoaXMubG9hZFBhZ2VDb250ZW50KGNvbmYuY3VycmVudENvbnRlbnQpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoJHN0YXRlUGFyYW1zLmNvbnRlbnQudHlwZSA9PSAnUCcpIHtcclxuICAgICAgICAgIC8vIGJ5IHBhZ2VcclxuICAgICAgICAgIGRhdGEuc2VsQ29sbGVjdGlvbnMucmVhZG9ubHkgPSBmYWxzZTtcclxuICAgICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9wYWdlQ29uZi8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwgKyAnLycgKyBjb25mLmN1cnJlbnRQYWdlLl9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICBpZiAocmVzcC5kYXRhKXtcclxuICAgICAgICAgICAgICBzZWxmLmxvYWRQYWdlQ29udGVudChyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIGluaXRpYWwgc2l6ZVxyXG4gICAgICAgIGRhdGEuc2l6ZSA9IDE1O1xyXG4gICAgICAgIGRhdGEuc2l6ZTIgPSAxMDtcclxuICAgICAgICBkYXRhLnRleHRzaXplID0gMjtcclxuICAgICAgICBkYXRhLnRleHRzaXplMiA9IDI7XHJcblxyXG4gICAgICAgIHZhciBwYXJhbXMgPSBfLmV4dGVuZChjb25mLmN1cnJlbnRQYWdlLnRlbXBsYXRlLnBhcmFtcywgY29uZi5jdXJyZW50UGFnZS5wYXJhbXMpO1xyXG4gICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgIGRhdGEucGFnZVBhcmFtcyA9IHBhcmFtcztcclxuXHJcbiAgICAgICAgICBpZiAocGFyYW1zLm9uQ2xpY2tBdWRpbykge1xyXG4gICAgICAgICAgICBkYXRhLm9uQ2xpY2tBdWRpbyA9IG5nQXVkaW8ubG9hZChwYXJhbXMub25DbGlja0F1ZGlvKTtcclxuICAgICAgICAgICAgaWYgKGRhdGEub25DbGlja0F1ZGlvLmVycm9yKXtcclxuICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9yIGxvYWRpbmcgYXVkaW8nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmIChwYXJhbXMuc2l6ZSkge1xyXG4gICAgICAgICAgICBkYXRhLnNpemUgPSBwYXJzZUludChwYXJhbXMuc2l6ZSk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKHBhcmFtcy5zaXplMikge1xyXG4gICAgICAgICAgICBkYXRhLnNpemUyID0gcGFyc2VJbnQocGFyYW1zLnNpemUyKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAocGFyYW1zLm9wYWNpdHkpIHtcclxuICAgICAgICAgICAgZGF0YS5vcGFjaXR5ID0gcGFyc2VGbG9hdChwYXJhbXMub3BhY2l0eSk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgaWYgKHBhcmFtcy50ZXh0c2l6ZSkge1xyXG4gICAgICAgICAgICBkYXRhLnRleHRzaXplID0gcGFyc2VGbG9hdChwYXJhbXMudGV4dHNpemUpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmIChwYXJhbXMudGV4dHNpemUyKSB7XHJcbiAgICAgICAgICAgIGRhdGEudGV4dHNpemUyID0gcGFyc2VGbG9hdChwYXJhbXMudGV4dHNpemUyKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAocGFyYW1zLnJhdGlvKSB7XHJcbiAgICAgICAgICAgIGRhdGEucmF0aW8gPSBwYXJzZUZsb2F0KHBhcmFtcy5yYXRpbyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZWxmLmZpbmRQYXJhbXMoKS50aGVuKGZ1bmN0aW9uIChwYXJhbXMpIHtcclxuICAgICAgICAgIGlmIChwYXJhbXMpIHtcclxuICAgICAgICAgICAgaWYgKHBhcmFtcy5zaXplKSB7XHJcbiAgICAgICAgICAgICAgZGF0YS5zaXplID0gcGFyc2VJbnQocGFyYW1zLnNpemUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocGFyYW1zLnNpemUyKSB7XHJcbiAgICAgICAgICAgICAgZGF0YS5zaXplMiA9IHBhcnNlSW50KHBhcmFtcy5zaXplMik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwYXJhbXMub3BhY2l0eSkge1xyXG4gICAgICAgICAgICAgIGRhdGEub3BhY2l0eSA9IHBhcnNlRmxvYXQocGFyYW1zLm9wYWNpdHkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAocGFyYW1zLnRleHRzaXplKSB7XHJcbiAgICAgICAgICAgICAgZGF0YS50ZXh0c2l6ZSA9IHBhcnNlRmxvYXQocGFyYW1zLnRleHRzaXplKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKHBhcmFtcy50ZXh0c2l6ZTIpIHtcclxuICAgICAgICAgICAgICBkYXRhLnRleHRzaXplMiA9IHBhcnNlRmxvYXQocGFyYW1zLnRleHRzaXplMik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChwYXJhbXMucmF0aW8pIHtcclxuICAgICAgICAgICAgICBkYXRhLnJhdGlvID0gcGFyc2VGbG9hdChwYXJhbXMucmF0aW8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gZGF0YTtcclxuICAgIH0sXHJcbiAgICBmaW5kVGV4dDogZnVuY3Rpb24gZmluZFRleHQoKSB7XHJcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcblxyXG4gICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICBpZiAoJHN0YXRlUGFyYW1zLmNvbnRlbnQudHlwZSA9PSAnQycpIHtcclxuICAgICAgICAvLyBieSBjb250ZW50XHJcbiAgICAgICAgZGF0YS5zZWxDb2xsZWN0aW9ucy5yZWFkb25seSA9IHRydWU7XHJcbiAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRUZXh0QnlDb2RlLycgKyAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbCArICcvJyArIGNvbmYuY3VycmVudENvbnRlbnQudGV4dCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgaWYgKHJlc3AuZGF0YSkge1xyXG4gICAgICAgICAgICBkYXRhLnNlbENvbGxlY3Rpb25zLnRleHQgPSByZXNwLmRhdGEuX2lkO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoJHN0YXRlUGFyYW1zLmNvbnRlbnQudHlwZSA9PSAnVycpIHtcclxuICAgICAgICAvLyBieSB3b3JrcGxhblxyXG4gICAgICAgIGRhdGEuc2VsQ29sbGVjdGlvbnMucmVhZG9ubHkgPSB0cnVlO1xyXG4gICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kVGV4dEJ5Q29kZS8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwgKyAnLycgKyBjb25mLmN1cnJlbnRDb250ZW50LnRleHQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgIGlmIChyZXNwLmRhdGEpIHtcclxuICAgICAgICAgICAgZGF0YS5zZWxDb2xsZWN0aW9ucy50ZXh0ID0gcmVzcC5kYXRhLl9pZDtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2UgaWYgKCRzdGF0ZVBhcmFtcy5jb250ZW50LnR5cGUgPT0gJ1AnKSB7XHJcbiAgICAgICAgLy8gYnkgcGFnZVxyXG4gICAgICAgIGRhdGEuc2VsQ29sbGVjdGlvbnMucmVhZG9ubHkgPSBmYWxzZTtcclxuICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvZmluZEFjdGl2ZVRleHQvJyArIGNvbmYuY3VycmVudFBhZ2UuX2lkICsgJy8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgIGlmIChyZXNwLmRhdGEpIHtcclxuICAgICAgICAgICAgZGF0YS5zZWxDb2xsZWN0aW9ucy50ZXh0ID0gcmVzcC5kYXRhLl9pZDtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH0sXHJcbiAgICBzcGxpdDogZnVuY3Rpb24gc3BsaXQoY2hhcnMsIHNlcCkge1xyXG4gICAgICB2YXIgY2h1bmtzID0gW107XHJcbiAgICAgIHZhciBpPTA7XHJcbiAgICAgIHZhciBjaHVuayA9IHtcclxuICAgICAgICBpOiBpLFxyXG4gICAgICAgIGNoYXJzOiBbXSxcclxuICAgICAgICB0ZXh0VmFsdWU6ICcnLFxyXG4gICAgICAgIHR5cGU6ICdjaHVuaydcclxuICAgICAgfTtcclxuICAgICAgY2h1bmtzLnB1c2goY2h1bmspO1xyXG5cclxuICAgICAgXy5lYWNoKGNoYXJzLCBmdW5jdGlvbiAoYykge1xyXG4gICAgICAgIGlmIChjLnZhbCA9PSBzZXApIHtcclxuICAgICAgICAgIGNodW5rID0ge1xyXG4gICAgICAgICAgICBpOiArK2ksXHJcbiAgICAgICAgICAgIGNoYXJzOiBbXSxcclxuICAgICAgICAgICAgdGV4dFZhbHVlOiAnJyxcclxuICAgICAgICAgICAgdHlwZTogJ2NodW5rJ1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIGNodW5rcy5wdXNoKGNodW5rKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY2h1bmsuY2hhcnMucHVzaChjKTtcclxuICAgICAgICAgIGNodW5rLnRleHRWYWx1ZSs9Yy52YWw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJldHVybiBjaHVua3M7XHJcbiAgICB9LFxyXG4gICAgZGVzdHJveTogZnVuY3Rpb24gZGVzdHJveSgpIHtcclxuICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuXHJcbiAgICAgIF8uZWFjaChkYXRhLmF1ZGlvQ29sbGVjdGlvbiwgZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICBpdGVtLmF1ZGlvLnBhdXNlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGxvYWRQYWdlQ29udGVudDogZnVuY3Rpb24gbG9hZFBhZ2VDb250ZW50KGNvbnRlbnQpIHtcclxuICAgICAgcGFDYWNoZS5zZXRDdXJyZW50Q29udGVudChjb250ZW50KTtcclxuICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgdmFyIHNlbGY9dGhpcztcclxuXHJcbiAgICAgIGlmIChjb250ZW50LnBhZ2UgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zICYmIGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucy5pbWcgJiYgY29udGVudC5pbWcpIHtcclxuICAgICAgICBkYXRhLnNlbENvbGxlY3Rpb25zLmltZyA9IGNvbnRlbnQuaW1nO1xyXG4gICAgICAgIHRoaXMuZmluZENvbGxlY3Rpb25CeUNvZGUoY29udGVudC5pbWcpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcclxuICAgICAgICAgIGlmIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGlmIChjb25mLmN1cnJlbnRQYWdlLnBhcmFtcyAmJiBjb25mLmN1cnJlbnRQYWdlLnBhcmFtcy5zaHVmZmxlSW1hZ2VzKSB7XHJcbiAgICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuYWRtaW4pIHtcclxuICAgICAgICAgICAgICAgIHBhU29ja2V0LmVtaXQoJ2ltYWdlcycsIF8uc2h1ZmZsZShjb2xsZWN0aW9uLnJlc291cmNlcykpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBkYXRhLmltYWdlcyA9IGNvbGxlY3Rpb24ucmVzb3VyY2VzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjb250ZW50LnBhZ2UgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zICYmIGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucy5pbWcyICYmIGNvbnRlbnQuaW1nMikge1xyXG4gICAgICAgIGRhdGEuc2VsQ29sbGVjdGlvbnMuaW1nMiA9IGNvbnRlbnQuaW1nMjtcclxuICAgICAgICB0aGlzLmZpbmRDb2xsZWN0aW9uQnlDb2RlKGNvbnRlbnQuaW1nMikudGhlbihmdW5jdGlvbiAoY29sbGVjdGlvbikge1xyXG4gICAgICAgICAgaWYgKGNvbGxlY3Rpb24pIHtcclxuICAgICAgICAgICAgaWYgKGNvbmYuY3VycmVudFBhZ2UucGFyYW1zICYmIGNvbmYuY3VycmVudFBhZ2UucGFyYW1zLnNodWZmbGVJbWFnZXMyKSB7XHJcbiAgICAgICAgICAgICAgaWYgKCRyb290U2NvcGUuYWRtaW4pIHtcclxuICAgICAgICAgICAgICAgIHBhU29ja2V0LmVtaXQoJ2ltYWdlczInLCBfLnNodWZmbGUoY29sbGVjdGlvbi5yZXNvdXJjZXMpKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgZGF0YS5pbWFnZXMyID0gY29sbGVjdGlvbi5yZXNvdXJjZXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNvbnRlbnQucGFnZSAmJiBjb250ZW50LnBhZ2UuY29sbGVjdGlvbnMgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zLnRleHQgJiYgY29udGVudC50ZXh0KSB7XHJcbiAgICAgICAgZGF0YS5zZWxDb2xsZWN0aW9ucy50ZXh0ID0gY29udGVudC50ZXh0O1xyXG4gICAgICAgIHRoaXMuZmluZFRleHRCeUNvZGUoY29udGVudC50ZXh0KS50aGVuKGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICBpZiAoY29sbGVjdGlvbikge1xyXG4gICAgICAgICAgICBkYXRhLnRleHQgPSBjb2xsZWN0aW9uLmNoYXJzO1xyXG4gICAgICAgICAgICBkYXRhLnRleHRSZXNvdXJjZXMgPSBjb2xsZWN0aW9uLnJlc291cmNlcztcclxuXHJcbiAgICAgICAgICAgIF8uZWFjaChjb2xsZWN0aW9uLmNoYXJzLCBmdW5jdGlvbiAoYywgaSkge1xyXG4gICAgICAgICAgICAgIGMuaW5kZXggPSBpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNvbnRlbnQucGFnZSAmJiBjb250ZW50LnBhZ2UuY29sbGVjdGlvbnMgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zLnRleHQyICYmIGNvbnRlbnQudGV4dDIpIHtcclxuICAgICAgICBkYXRhLnNlbENvbGxlY3Rpb25zLnRleHQyID0gY29udGVudC50ZXh0MjtcclxuICAgICAgICB0aGlzLmZpbmRUZXh0QnlDb2RlKGNvbnRlbnQudGV4dDIpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcclxuICAgICAgICAgIGlmIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGRhdGEudGV4dDIgPSBjb2xsZWN0aW9uLmNoYXJzO1xyXG5cclxuICAgICAgICAgICAgXy5lYWNoKGNvbGxlY3Rpb24uY2hhcnMsIGZ1bmN0aW9uIChjLCBpKSB7XHJcbiAgICAgICAgICAgICAgYy5pbmRleCA9IGk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoY29udGVudC5wYWdlICYmIGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucyAmJiBjb250ZW50LnBhZ2UuY29sbGVjdGlvbnMuYXVkaW8gJiYgY29udGVudC5hdWRpbykge1xyXG4gICAgICAgIGRhdGEuc2VsQ29sbGVjdGlvbnMuYXVkaW8gPSBjb250ZW50LmF1ZGlvO1xyXG4gICAgICAgIHRoaXMuZmluZENvbGxlY3Rpb25CeUNvZGUoY29udGVudC5hdWRpbykudGhlbihmdW5jdGlvbiAoY29sbGVjdGlvbikge1xyXG4gICAgICAgICAgaWYgKGNvbGxlY3Rpb24pIHtcclxuICAgICAgICAgICAgdmFyIGF1ZGlvQ29sbGVjdGlvbiA9IFtdO1xyXG5cclxuICAgICAgICAgICAgXy5lYWNoKGNvbGxlY3Rpb24ucmVzb3VyY2VzLCBmdW5jdGlvbiAocmVzLCBpKSB7XHJcbiAgICAgICAgICAgICAgdmFyIGF1ZGlvPW5nQXVkaW8ubG9hZChyZXMuc3JjKTtcclxuICAgICAgICAgICAgICBpZihhdWRpby5lcnJvcil7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9yIGxvYWRpbmcgYXVkaW8nKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgYXVkaW9Db2xsZWN0aW9uLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgYXVkaW86IGF1ZGlvLFxyXG4gICAgICAgICAgICAgICAgdGl0bGU6IHJlcy50aXRsZSxcclxuICAgICAgICAgICAgICAgIGk6IGlcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBkYXRhLmF1ZGlvQ29sbGVjdGlvbiA9IGF1ZGlvQ29sbGVjdGlvbjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNvbnRlbnQucGFnZSAmJiBjb250ZW50LnBhZ2UuY29sbGVjdGlvbnMgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zLmNhcmQgJiYgY29udGVudC5jYXJkKSB7XHJcbiAgICAgICAgZGF0YS5zZWxDb2xsZWN0aW9ucy5jYXJkID0gY29udGVudC5jYXJkO1xyXG4gICAgICAgIHRoaXMuZmluZENvbGxlY3Rpb25CeUNvZGUoY29udGVudC5jYXJkKS50aGVuKGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICBpZiAoY29sbGVjdGlvbikge1xyXG4gICAgICAgICAgICBkYXRhLmNhcmRzID0gY29sbGVjdGlvbi5yZXNvdXJjZXM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjb250ZW50LnBhZ2UgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zICYmIGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucy51cmwgJiYgY29udGVudC51cmwpIHtcclxuICAgICAgICBkYXRhLnNlbENvbGxlY3Rpb25zLnVybCA9IGNvbnRlbnQudXJsO1xyXG4gICAgICAgIHRoaXMuZmluZENvbGxlY3Rpb25CeUNvZGUoY29udGVudC51cmwpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcclxuICAgICAgICAgIGlmIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGRhdGEudXJsID0gY29sbGVjdGlvbi5yZXNvdXJjZXM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjb250ZW50LnBhZ2UgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zICYmIGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucy5taXhlZCAmJiBjb250ZW50Lm1peGVkKSB7XHJcbiAgICAgICAgZGF0YS5zZWxDb2xsZWN0aW9ucy5taXhlZCA9IGNvbnRlbnQubWl4ZWQ7XHJcbiAgICAgICAgdGhpcy5maW5kQ29sbGVjdGlvbkJ5Q29kZShjb250ZW50Lm1peGVkKS50aGVuKGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICBpZiAoY29sbGVjdGlvbikge1xyXG4gICAgICAgICAgICBkYXRhLm1peGVkID0gY29sbGVjdGlvbi5yZXNvdXJjZXM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjb250ZW50LnBhZ2UgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zICYmIGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucy5taXhlZDIgJiYgY29udGVudC5taXhlZDIpIHtcclxuICAgICAgICBkYXRhLnNlbENvbGxlY3Rpb25zLm1peGVkMiA9IGNvbnRlbnQubWl4ZWQyO1xyXG4gICAgICAgIHRoaXMuZmluZENvbGxlY3Rpb25CeUNvZGUoY29udGVudC5taXhlZDIpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcclxuICAgICAgICAgIGlmIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGRhdGEubWl4ZWQyID0gY29sbGVjdGlvbi5yZXNvdXJjZXM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChjb250ZW50LnBhZ2UgJiYgY29udGVudC5wYWdlLmNvbGxlY3Rpb25zICYmIGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucy5ncmlkICYmIGNvbnRlbnQuZ3JpZCkge1xyXG4gICAgICAgIGRhdGEuc2VsQ29sbGVjdGlvbnMuZ3JpZCA9IGNvbnRlbnQuZ3JpZDtcclxuICAgICAgICB0aGlzLmZpbmRDb2xsZWN0aW9uQnlDb2RlKGNvbnRlbnQuZ3JpZCkudGhlbihmdW5jdGlvbiAoY29sbGVjdGlvbikge1xyXG4gICAgICAgICAgaWYgKGNvbGxlY3Rpb24pIHtcclxuICAgICAgICAgICAgZGF0YS5ncmlkID0gY29sbGVjdGlvbi5yZXNvdXJjZXM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICgkcm9vdFNjb3BlLmFkbWluICYmIGNvbnRlbnQucGFnZSAmJiBjb250ZW50LnBhZ2UuY29sbGVjdGlvbnMpe1xyXG4gICAgICAgIHZhciBzZWw9MDtcclxuICAgICAgICBfLmVhY2goXy5rZXlzKGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucyksIGZ1bmN0aW9uKGNvbGwpe1xyXG4gICAgICAgICAgaWYgKGNvbnRlbnRbY29sbF0pe1xyXG4gICAgICAgICAgICBzZWwrKztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIGlmIChzZWw9PTAgJiYgXy5rZXlzKGNvbnRlbnQucGFnZS5jb2xsZWN0aW9ucykubGVuZ3RoPjEpe1xyXG4gICAgICAgICAgdG9hc3Rlci5wb3AoJ3dhcm5pbmcnLCdXYXJuaW5nJywgXCJObyBjb2xsZWN0aW9uIHNlbGVjdGVkLiBQbGVhc2Ugc2VsZWN0IGF0IGxlYXN0IG9uZSBjb2xsZWN0aW9uLlwiKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHByb2Nlc3NSZXNvdXJjZXM6IGZ1bmN0aW9uKHJlc291cmNlcyl7XHJcbiAgICAgIHZhciBjb3VudCA9IHBhQ2FjaGUuZ2V0Q291bnRlcnMoKTtcclxuICAgICAgdmFyIHNlbGY9dGhpcztcclxuICAgICAgXy5lYWNoKHJlc291cmNlcyxmdW5jdGlvbihyZXMpe1xyXG4gICAgICAgIHJlcy5pZD1jb3VudC5pKys7XHJcbiAgICAgICAgaWYgKHJlcy50eXBlPT0nY2FyZCcpe1xyXG4gICAgICAgICAgc2VsZi5wcm9jZXNzUmVzb3VyY2UocmVzLmZyb250KTtcclxuICAgICAgICAgIHNlbGYucHJvY2Vzc1Jlc291cmNlKHJlcy5iYWNrKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgc2VsZi5wcm9jZXNzUmVzb3VyY2UocmVzKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgcHJvY2Vzc1Jlc291cmNlOiBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgaWYgKHJlcykgeyAgICAgICAgXHJcbiAgICAgICAgdmFyIGNvdW50ID0gcGFDYWNoZS5nZXRDb3VudGVycygpO1xyXG4gICAgICAgIHZhciBzZWxmPXRoaXM7XHJcbiAgICAgICAgaWYgKHJlcy50eXBlPT0ndGV4dCcpe1xyXG4gICAgICAgICAgcmVzLndvcmRzPXNlbGYuc3BsaXQocmVzLmNoYXJzLCcgJyk7XHJcbiAgICAgICAgICBfLmVhY2gocmVzLndvcmRzLGZ1bmN0aW9uKHdvcmQpe1xyXG4gICAgICAgICAgICB3b3JkLmlkPWNvdW50LncrKztcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIF8uZWFjaChyZXMuY2hhcnMsZnVuY3Rpb24oY2hhcil7XHJcbiAgICAgICAgICBjaGFyLmlkPWNvdW50LmMrKztcclxuICAgICAgICB9KVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgZmluZENvbGxlY3Rpb25CeUNvZGU6IGZ1bmN0aW9uIGZpbmRDb2xsZWN0aW9uQnlDb2RlKGNvZGUpIHtcclxuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTsgLy8gY29uZi5jdXJyZW50Rm9sZGVyIGlzIG5vdCBkZWZpbmVkIG9uIHN0dWRlbnQgc2lkZVxyXG4gICAgICAvL3ZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcblxyXG4gICAgICB2YXIgc2VsZj10aGlzO1xyXG4gICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvZmluZENvbGxlY3Rpb25CeUNvZGUvJyArICRyb290U2NvcGUudXNlci5jaGFubmVsICsgJy8nICsgY29kZSkudGhlbihcclxuICAgICAgICBmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgdmFyIGNvbGxlY3Rpb24gPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICBwYUNhY2hlLmluaXRDb3VudGVycyh7aTowLHc6MCxjOjB9KTtcclxuICAgICAgICAgIGlmKGNvbGxlY3Rpb24udHlwZT09J2dyaWQnKXtcclxuICAgICAgICAgICAgXy5lYWNoKGNvbGxlY3Rpb24ucmVzb3VyY2VzLGZ1bmN0aW9uKGxpbmUpe1xyXG4gICAgICAgICAgICAgIHNlbGYucHJvY2Vzc1Jlc291cmNlcyhsaW5lLnJlc291cmNlcyk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWxmLnByb2Nlc3NSZXNvdXJjZXMoY29sbGVjdGlvbi5yZXNvdXJjZXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUoY29sbGVjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICApO1xyXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH0sXHJcbiAgICBmaW5kVGV4dEJ5Q29kZTogZnVuY3Rpb24gZmluZFRleHRCeUNvZGUoY29kZSkge1xyXG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpOyAvLyBjb25mLmN1cnJlbnRGb2xkZXIgaXMgbm90IGRlZmluZWQgb24gc3R1ZGVudCBzaWRlXHJcbiAgICAgIC8vdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuXHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kVGV4dEJ5Q29kZS8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwgKyAnLycgKyBjb2RlKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfSxcclxuICAgIGZpbmRQYXJhbXM6IGZ1bmN0aW9uIGZpbmRQYXJhbXMoKSB7XHJcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9wYWdlUGFyYW1zLycgKyBjb25mLmN1cnJlbnRQYWdlLl9pZCArICcvJyArICRyb290U2NvcGUudXNlci5jaGFubmVsKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgLy8gZGVmYXVsdHNcclxuICAgICAgICB2YXIgcGFyYW1zID0ge29kZDoxLGV2ZW46M307XHJcbiAgICAgICAgZm9yIChsZXQgcGFyYW0gb2YgcmVzcC5kYXRhKSB7XHJcbiAgICAgICAgICBwYXJhbXNbcGFyYW0ubmFtZV0gPSBwYXJhbS52YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNvbmYuY3VycmVudE1vZGUhPSdQJyAmJiBjb25mLmN1cnJlbnRDb250ZW50KSB7XHJcbiAgICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvY29udGVudFBhcmFtcy8nICsgY29uZi5jdXJyZW50Q29udGVudC5faWQgKyAnLycgKyAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICAgIGZvciAobGV0IHBhcmFtIG9mIHJlc3AuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgcGFyYW1zW3BhcmFtLm5hbWVdID0gcGFyYW0udmFsdWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHBhcmFtcyk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShwYXJhbXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH0sXHJcbiAgICBzYXZlUGFyYW06IGZ1bmN0aW9uIHNhdmVQYXJhbShuYW1lLCB2YWx1ZSwgc3lzdGVtKSB7XHJcbiAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgIGlmIChjb25mLmN1cnJlbnRNb2RlIT0nUCcgJiYgY29uZi5jdXJyZW50Q29udGVudCkge1xyXG4gICAgICAgICRodHRwLnB1dChjb25maWcuYXBpVXJsICsgJy93cy9jb250ZW50UGFyYW0nLCB7Y29udGVudDpjb25mLmN1cnJlbnRDb250ZW50Ll9pZCwgdGVhY2hlcjokcm9vdFNjb3BlLnVzZXIuY2hhbm5lbCwgbmFtZTpuYW1lLCB2YWx1ZTp2YWx1ZSwgc3lzdGVtUGFyYW06IHN5c3RlbX0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICRodHRwLnB1dChjb25maWcuYXBpVXJsICsgJy93cy9wYWdlUGFyYW0nLCB7cGFnZTpjb25mLmN1cnJlbnRQYWdlLl9pZCwgdGVhY2hlcjokcm9vdFNjb3BlLnVzZXIuY2hhbm5lbCwgbmFtZTpuYW1lLCB2YWx1ZTp2YWx1ZSwgc3lzdGVtUGFyYW06IHN5c3RlbX0pO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgbGlzdEJsb2JzOiBmdW5jdGlvbiBsaXN0QmxvYnMocHJlZml4KSB7XHJcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYnJvd3NlJywge1xyXG4gICAgICAgIGZvbGRlcjogY29uZi5jdXJyZW50Rm9sZGVyLmNvZGUsXHJcbiAgICAgICAgcHJlZml4OiBwcmVmaXhcclxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH0sXHJcbiAgICBnZXRCbG9iOiBmdW5jdGlvbiBnZXRCbG9iKG5hbWUpIHtcclxuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9nZXRCbG9iLycgKyBjb25mLmN1cnJlbnRGb2xkZXIuY29kZSwge1xyXG4gICAgICAgIG5hbWU6IG5hbWVcclxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgIH0sXHJcbiAgICBzYXZlQmxvYjogZnVuY3Rpb24gc2F2ZUJsb2IobmFtZSwgZGF0YSkge1xyXG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVCbG9iLycgKyBjb25mLmN1cnJlbnRGb2xkZXIuY29kZSwge1xyXG4gICAgICAgIG5hbWU6IG5hbWUsXHJcbiAgICAgICAgZGF0YTogZGF0YVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgfSxcclxuICAgIGxvYWRDb250ZW50czogZnVuY3Rpb24gbG9hZENvbnRlbnRzKGZvbGRlcikge1xyXG4gICAgICBwYU1lbnUubG9hZENvbnRlbnRzKGZvbGRlcik7XHJcbiAgICB9LFxyXG4gICAgbG9hZFdvcmtwbGFuczogZnVuY3Rpb24gbG9hZFdvcmtwbGFucygpIHtcclxuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3dvcmtwbGFucy90ZWFjaGVycy8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgIGNvbmYud29ya3BsYW5zID0gcmVzcC5kYXRhO1xyXG4gICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBsb2FkV29ya3BsYW46IGZ1bmN0aW9uIGxvYWRXb3JrcGxhbih3b3JrcGxhbikge1xyXG4gICAgICB2YXIgY29uZj1wYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3dvcmtwbGFucy8nICsgd29ya3BsYW4uX2lkICsgJy9jb250ZW50cycpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgIHdvcmtwbGFuLmNvbnRlbnRzID0gXy5maWx0ZXIocmVzdWx0LmRhdGEsJ3BhZ2UnKTtcclxuICAgICAgICBfLmVhY2god29ya3BsYW4uY29udGVudHMsZnVuY3Rpb24oY29udGVudCl7XHJcbiAgICAgICAgICBjb250ZW50LnBhZ2UudGVtcGxhdGU9Y29uZi50ZW1wbGF0ZXNbY29udGVudC5wYWdlLnRlbXBsYXRlXTtcclxuICAgICAgICAgIGNvbnRlbnQuc3Vic3JjID0gXy5maW5kKGNvbmYubXlGb2xkZXJTdWJzY3JpcHRpb25zLCBmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAgICAgICByZXR1cm4gc3Vic2NyLmZvbGRlci5faWQ9PWNvbnRlbnQucGFnZS5mb2xkZXI7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBsb2FkUGFnZXM6IGZ1bmN0aW9uIGxvYWRQYWdlcyhmb2xkZXIpIHtcclxuICAgICAgcGFNZW51LmxvYWRQYWdlcyhmb2xkZXIpO1xyXG4gICAgfSxcclxuICAgIGxvYWRBbGVydHM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvYWxlcnRzJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgICBjb25mLmFsZXJ0cz1yZXN1bHQuZGF0YTtcclxuICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBsb2FkU3RhdGVzOiBmdW5jdGlvbiBsb2FkU3RhdGVzKCkge1xyXG4gICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvdGVtcGxhdGVzJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgXy5lYWNoKHJlc3VsdC5kYXRhLCBmdW5jdGlvbiAodGVtcGxhdGUpIHtcclxuICAgICAgICAgIHJ1bnRpbWVTdGF0ZXMuYWRkU3RhdGUoe1xyXG4gICAgICAgICAgICBuYW1lOiB0ZW1wbGF0ZS5uYW1lLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiB0ZW1wbGF0ZS5jb250cm9sbGVyLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGUudGVtcGxhdGVVcmwsXHJcbiAgICAgICAgICAgIHBhcmFtczogdGVtcGxhdGUucGFyYW1zXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgIGNvbmYudGVtcGxhdGVzPV8uaW5kZXhCeShyZXN1bHQuZGF0YSwnX2lkJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIGxvYWRGcmVlU3RpY2tlcnM6IGZ1bmN0aW9uIGxvYWRGcmVlU3RpY2tlcnMoKSB7XHJcbiAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5pbml0KCk7XHJcbiAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZyZWVDb250ZW50L3N0aWNrZXJzJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgc2VsZi5sb2FkUGFnZUNvbnRlbnQocmVzdWx0LmRhdGEpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9LFxyXG4gICAgbG9hZFN0dWRlbnRDb21tZW50czogZnVuY3Rpb24gbG9hZFN0dWRlbnRDb21tZW50cyhpZCkge1xyXG4gICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvY29tbWVudHMvc3R1ZGVudHMvJyArIGlkKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEuY29tbWVudHMgPSByZXMuZGF0YTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgbG9nQ29udGVudDogZnVuY3Rpb24gbG9nQ29udGVudChjb250ZW50KSB7XHJcbiAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcblxyXG4gICAgICBpZiAoY29uZi5jaGFubmVsLm9wZW4pIHtcclxuICAgICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2NoYW5uZWwvbG9nJywge1xyXG4gICAgICAgICAgY2hhbm5lbDogY29uZi5jaGFubmVsLFxyXG4gICAgICAgICAgZm9sZGVyOiBjb25mLmN1cnJlbnRGb2xkZXIsXHJcbiAgICAgICAgICB0ZWFjaGVyOiAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbCxcclxuICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnRcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGxvYWRBdWRpb0NvbGxlY3Rpb25zOiBmdW5jdGlvbihmb2xkZXIpIHtcclxuICAgICAgaWYgKGZvbGRlciAmJiBmb2xkZXIuX2lkKXtcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvbWVudS9maW5kUGFnZXMnLHt0eXBlOidBJyxmb2xkZXI6Zm9sZGVyLl9pZH0pLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICBpZiAocmVzcC5kYXRhICYmIHJlc3AuZGF0YS5sZW5ndGgpe1xyXG4gICAgICAgICAgICB2YXIgcGFnZSA9cmVzcC5kYXRhWzBdO1xyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRDb2xsZWN0aW9ucycsIHt0eXBlOidhdWRpbycsZm9sZGVyOmZvbGRlci5faWQscGFnZTpwYWdlLl9pZH0pLnRoZW4oXHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgICAgICAgIGNvbmYuY3VycmVudEZvbGRlci5hdWRpb0NvbGxlY3Rpb25zPXJlc3AuZGF0YTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbmZpZyhbJyR1cmxSb3V0ZXJQcm92aWRlcicsICckc3RhdGVQcm92aWRlcicsIGZ1bmN0aW9uICgkdXJsUm91dGVyUHJvdmlkZXIsICRzdGF0ZVByb3ZpZGVyKSB7XHJcbiAgLy8kdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvaG9tZScpO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdsb2dpbicsIHtcclxuICAgIC8vdXJsOiAnL2xvZ2luJyxcclxuICAgIGNvbnRyb2xsZXI6ICdsb2dpbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEubG9naW4uaHRtbCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnYXV0aCcsIHtcclxuICAgIHVybDogJy9hdXRoLzp0b2tlbicsXHJcbiAgICBjb250cm9sbGVyOiAnYXV0aEN0cmwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2pvaW4nLCB7XHJcbiAgICB1cmw6ICcvam9pbi86Y2hhbm5lbCcsXHJcbiAgICBjb250cm9sbGVyOiAnY2hhbm5lbEN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuc3Vic2NyaXB0aW9uLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ21pcmdvdm9yaXQtbGluaycsIHtcclxuICAgIHVybDogJy9taXJnb3Zvcml0L2xpbmsnLFxyXG4gICAgY29udHJvbGxlcjogJ21pcmdvdm9yaXRDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL21pcmdvdm9yaXQtbGluay5odG1sJyxcclxuICAgIHBhcmFtczp7XHJcbiAgICAgIG1pcmdvdm9yaXRQcm9maWxlOm51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnbWlyZ292b3JpdC1sb2dpbicsIHtcclxuICAgIHVybDogJy9taXJnb3Zvcml0L2xvZ2luJyxcclxuICAgIGNvbnRyb2xsZXI6ICdtaXJnb3Zvcml0Q3RybCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgncGEnLCB7XHJcbiAgICB1cmw6ICcvcGEvOnRvJyxcclxuICAgIGNvbnRyb2xsZXI6ICdob21lQ3RybCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnZGFzaGJvYXJkJyx7XHJcbiAgICAvL3VybDogJy8nLFxyXG4gICAgY29udHJvbGxlcjogJ2Rhc2hib2FyZENvbnRyb2xsZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuZGFzaGJvYXJkLmh0bWwnLFxyXG4gICAgcGFyYW1zOntcclxuICAgICAgdGFiOm51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnZGFzaGJvYXJkLW8nLHtcclxuICAgIC8vdXJsOiAnLycsXHJcbiAgICBjb250cm9sbGVyOiAnZGFzaGJvYXJkQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5kYXNoYm9hcmQtby5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdkYXNoYm9hcmQtZScse1xyXG4gICAgLy91cmw6ICcvJyxcclxuICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDb250cm9sbGVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmRhc2hib2FyZC1lLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2VkaXQtZm9sZGVyJyx7XHJcbiAgICAvL3VybDogJy8nLFxyXG4gICAgY29udHJvbGxlcjogJ3BhRm9sZGVyQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5lZGl0LWZvbGRlci5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBmb2xkZXI6bnVsbCxcclxuICAgICAgZm9yY2VSZWxvYWQ6bnVsbFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdjb3B5LXBhZ2UnLHtcclxuICAgIC8vdXJsOiAnLycsXHJcbiAgICBjb250cm9sbGVyOiAncGFDb3B5UGFnZUN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29weS1wYWdlLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FkZC1wYWdlJyx7XHJcbiAgICAvL3VybDogJy8nLFxyXG4gICAgY29udHJvbGxlcjogJ3BhRWRpdFBhZ2VDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmVkaXQtcGFnZS5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdlZGl0LXBhZ2UnLHtcclxuICAgIC8vdXJsOiAnLycsXHJcbiAgICBjb250cm9sbGVyOiAncGFFZGl0UGFnZUN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuZWRpdC1wYWdlLmh0bWwnLFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIHBhZ2U6bnVsbFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdlZGl0LWNvbnRlbnQnLHtcclxuICAgIC8vdXJsOiAnLycsXHJcbiAgICBjb250cm9sbGVyOiAncGFFZGl0Q29udGVudEN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuZWRpdC1jb250ZW50Lmh0bWwnLFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIGNvbnRlbnQ6bnVsbFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdwcm9maWxlJyx7XHJcbiAgICAvL3VybDogJy9wcm9maWxlJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYVByb2ZpbGVDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLnByb2ZpbGUuaHRtbCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnZWRpdC1wcm9maWxlJyx7XHJcbiAgICAvL3VybDogJy9lZGl0LXByb2ZpbGUnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhUHJvZmlsZUN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuZWRpdC1wcm9maWxlLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ29wZW50b2snLHtcclxuICAgIC8vdXJsOiAnL29wZW50b2snLFxyXG4gICAgY29udHJvbGxlcjogJ3BhUHJvZmlsZUN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuZWRpdC1vcGVudG9rLmh0bWwnXHJcbiAgfSk7XHJcbiRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdzdHVkZW50cycse1xyXG4gICAgLy91cmw6ICcvc3R1ZGVudHMnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhU3R1ZGVudHNDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLnN0dWRlbnRzLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FkZC1zdHVkZW50Jyx7XHJcbiAgICAvL3VybDogJy9hZGQtc3R1ZGVudCcsXHJcbiAgICBjb250cm9sbGVyOiAncGFTdHVkZW50Q3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5hZGQtc3R1ZGVudC5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdlZGl0LXN0dWRlbnQnLHtcclxuICAgIC8vdXJsOiAnL2VkaXQtc3R1ZGVudC86aWQnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhU3R1ZGVudEN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAuZWRpdC1zdHVkZW50Lmh0bWwnLFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIGlkOiBudWxsXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3NlbGVjdC1zdHVkZW50Jyx7XHJcbiAgICAvL3VybDogJy9zZWxlY3Qtc3R1ZGVudC86aWQnLFxyXG4gICAgY29udHJvbGxlcjogJ2Rhc2hib2FyZENvbnRyb2xsZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuZGFzaGJvYXJkLmh0bWwnLFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIGlkOiBudWxsLFxyXG4gICAgICB0YWI6IG51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnYWRkLWdyb3VwJyx7XHJcbiAgICAvL3VybDogJy9hZGQtc3R1ZGVudCcsXHJcbiAgICBjb250cm9sbGVyOiAncGFHcm91cEN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAuZ3JvdXAuaHRtbCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnZWRpdC1ncm91cCcse1xyXG4gICAgLy91cmw6ICcvYWRkLXN0dWRlbnQnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhR3JvdXBDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmdyb3VwLmh0bWwnLFxyXG4gICAgcGFyYW1zOntcclxuICAgICAgZ3JvdXA6IG51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnbGVzc29ucycse1xyXG4gICAgLy91cmw6ICcvbGVzc29ucycsXHJcbiAgICBjb250cm9sbGVyOiAnbGVzc29uc0N0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEubGVzc29ucy5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdsZXZlbHMnLHtcclxuICAgIC8vdXJsOiAnL2xldmVscycsXHJcbiAgICBjb250cm9sbGVyOiAnbGV2ZWxzQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5sZXZlbHMuaHRtbCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgncGF5bWVudHMnLHtcclxuICAgIC8vdXJsOiAnL3BheW1lbnRzJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYVBheW1lbnRzQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5wYXltZW50cy5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCd3ZWJpbmFyJyx7XHJcbiAgICAvL3VybDogJy91bmxvY2snLFxyXG4gICAgY29udHJvbGxlcjogJ3BhV2ViaW5hckN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEud2ViaW5hci5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCd1bmxvY2snLHtcclxuICAgIC8vdXJsOiAnL3VubG9jaycsXHJcbiAgICBjb250cm9sbGVyOiAncGFVbmxvY2tDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnVubG9jay5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdjaGFuZ2UtcGFzc3dvcmQnLHtcclxuICAgIC8vdXJsOiAnL2NoYW5nZS1wYXNzd29yZCcsXHJcbiAgICBjb250cm9sbGVyOiAncGFDaGFuZ2VQYXNzd29yZEN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY2hhbmdlLXBhc3N3b3JkLmh0bWwnXHJcbiAgfSk7XHJcbiRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdzdWJzY3JpcHRpb25zJyx7XHJcbiAgICAvL3VybDogJy9zdWJzY3JpcHRpb25zJyxcclxuICAgIGNvbnRyb2xsZXI6ICdzdWJzY3JpcHRpb25zQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS9wYS5zdWJzY3JpcHRpb25zLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3dhbGwnLHtcclxuICAgIC8vdXJsOiAnL3dhbGwnLFxyXG4gICAgY29udHJvbGxlcjogJ2xpa2VzQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5saWtlcy5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdwb3N0cycse1xyXG4gICAgLy91cmw6ICcvcG9zdHMnLFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIHRhYjogNVxyXG4gICAgfSxcclxuICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDb250cm9sbGVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmRhc2hib2FyZC5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdhZG1pbicse1xyXG4gICAgLy91cmw6ICcvYWRtaW4nLFxyXG4gICAgY29udHJvbGxlcjogJ2FkbWluQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5hZG1pbi5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBvcHRpb25zOiBudWxsXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2NhbnZhcycse1xyXG4gICAgLy91cmw6ICcvY2FudmFzJyxcclxuICAgIGNvbnRyb2xsZXI6ICdjYW52YXNDb250cm9sbGVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmNhbnZhcy5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBjb250ZW50OiBudWxsXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FkZC1jb2xsZWN0aW9uJyx7XHJcbiAgICBjb250cm9sbGVyOiAnQ29sbGVjdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEucG9wdXAuaHRtbCcsXHJcbiAgICBwYXJhbXM6IHtcclxuICAgICAgY29sbGVjdGlvbjoge30sXHJcbiAgICAgIG9wdGlvbnM6IG51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnY29sbGVjdGlvbi1taXhlZCcse1xyXG4gICAgY29udHJvbGxlcjogJ0NvbGxlY3Rpb25DdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmNvbGxlY3Rpb24tbWl4ZWQuaHRtbCcsXHJcbiAgICBwYXJhbXM6IHtcclxuICAgICAgY29sbGVjdGlvbjoge30sXHJcbiAgICAgIG9wdGlvbnM6IG51bGwsXHJcbiAgICAgIHRhYjogMFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdjb2xsZWN0aW9uLW1peGVkMicse1xyXG4gICAgY29udHJvbGxlcjogJ0NvbGxlY3Rpb25DdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmNvbGxlY3Rpb24tbWl4ZWQuaHRtbCcsXHJcbiAgICBwYXJhbXM6IHtcclxuICAgICAgY29sbGVjdGlvbjoge30sXHJcbiAgICAgIG9wdGlvbnM6IG51bGwsXHJcbiAgICAgIHRhYjogMFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdjb2xsZWN0aW9uLWdyaWQnLHtcclxuICAgIGNvbnRyb2xsZXI6ICdDb2xsZWN0aW9uQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jb2xsZWN0aW9uLWdyaWQuaHRtbCcsXHJcbiAgICBwYXJhbXM6IHtcclxuICAgICAgY29sbGVjdGlvbjoge30sXHJcbiAgICAgIG9wdGlvbnM6IG51bGwsXHJcbiAgICAgIHRhYjogMFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdlZGl0LWNhcmQnLHtcclxuICAgIGNvbnRyb2xsZXI6ICdjYXJkRWRpdG9yQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jYXJkLmVkaXRvci5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBjb2xsZWN0aW9uOiB7fSxcclxuICAgICAgY2FyZDoge30sXHJcbiAgICAgIG9wdGlvbnM6IG51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnZWRpdC1jb2xsZWN0aW9uJyx7XHJcbiAgICBjb250cm9sbGVyOiAnQ29sbGVjdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEucG9wdXAuaHRtbCcsXHJcbiAgICBwYXJhbXM6IHtcclxuICAgICAgY29sbGVjdGlvbjoge30sXHJcbiAgICAgIG9wdGlvbnM6IG51bGwsXHJcbiAgICAgIHRhYjogbnVsbCxcclxuICAgICAgYmFjazogbnVsbFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdjb3B5LWNvbGxlY3Rpb24nLHtcclxuICAgIGNvbnRyb2xsZXI6ICdDb2xsZWN0aW9uQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5wb3B1cC5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBjb2xsZWN0aW9uOiB7fSxcclxuICAgICAgY29weUZyb206IG51bGwsXHJcbiAgICAgIG9wdGlvbnM6IG51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnY29weS1jb2xsZWN0aW9uLW1peGVkJyx7XHJcbiAgICBjb250cm9sbGVyOiAnQ29sbGVjdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29sbGVjdGlvbi1taXhlZC5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBjb2xsZWN0aW9uOiB7fSxcclxuICAgICAgY29weUZyb206IG51bGwsXHJcbiAgICAgIG9wdGlvbnM6IG51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnY29weS1jb2xsZWN0aW9uLWdyaWQnLHtcclxuICAgIGNvbnRyb2xsZXI6ICdDb2xsZWN0aW9uQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jb2xsZWN0aW9uLWdyaWQuaHRtbCcsXHJcbiAgICBwYXJhbXM6IHtcclxuICAgICAgY29sbGVjdGlvbjoge30sXHJcbiAgICAgIGNvcHlGcm9tOiBudWxsLFxyXG4gICAgICBvcHRpb25zOiBudWxsXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2VkaXQtcGljdG9ncmFtJyx7XHJcbiAgICAvL3VybDogJy9lZGl0LXBpY3RvZ3JhbScsXHJcbiAgICBjb250cm9sbGVyOiAncGljdG9ncmFtQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5waWN0b2dyYW0uZWRpdG9yLmh0bWwnLFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIGNvbGxlY3Rpb246IHt9LFxyXG4gICAgICB0eXBlOiBudWxsXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3NpemUtZmFjdG9yJyx7XHJcbiAgICAvL3VybDogJy9zaXplLWZhY3RvcicsXHJcbiAgICBjb250cm9sbGVyOiAnc2l6ZUZhY3RvckN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuc2l6ZS1mYWN0b3IuZWRpdG9yLmh0bWwnLFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIGNvbGxlY3Rpb246IHt9XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2xlc3Nvbicse1xyXG4gICAgLy91cmw6ICcvbGVzc29uLzpsZXNzb25JZCcsXHJcbiAgICBjb250cm9sbGVyOiAnZGFzaGJvYXJkQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5kYXNoYm9hcmQuaHRtbCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnb3JnLXRlYWNoZXJzJyx7XHJcbiAgICAvL3VybDogJy9sZXNzb24vOmxlc3NvbklkJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYU9yZ2FuaXphdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEub3JnLXRlYWNoZXJzLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ29yZy10ZWFjaGVyJyx7XHJcbiAgICAvL3VybDogJy9sZXNzb24vOmxlc3NvbklkJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYU9yZ2FuaXphdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEub3JnLXRlYWNoZXIuaHRtbCcsXHJcbiAgICBwYXJhbXM6e1xyXG4gICAgICB0ZWFjaGVyOm51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnb3JnLXN0dWRlbnRzJyx7XHJcbiAgICAvL3VybDogJy9sZXNzb24vOmxlc3NvbklkJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYU9yZ2FuaXphdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEub3JnLXN0dWRlbnRzLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ29yZy1ncm91cHMnLHtcclxuICAgIC8vdXJsOiAnL2xlc3Nvbi86bGVzc29uSWQnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhT3JnYW5pemF0aW9uQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5vcmctZ3JvdXBzLmh0bWwnXHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ29yZy1zdHVkZW50Jyx7XHJcbiAgICAvL3VybDogJy9sZXNzb24vOmxlc3NvbklkJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYU9yZ2FuaXphdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEub3JnLXN0dWRlbnQuaHRtbCcsXHJcbiAgICBwYXJhbXM6e1xyXG4gICAgICBzdHVkZW50Om51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnb3JnLXVubG9jaycse1xyXG4gICAgLy91cmw6ICcvdW5sb2NrJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYVVubG9ja0N0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAub3JnLXVubG9jay5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdvcmctd29ya3BsYW5zJyx7XHJcbiAgICAvL3VybDogJy9sZXNzb24vOmxlc3NvbklkJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYU9yZ2FuaXphdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEub3JnLXdvcmtwbGFucy5odG1sJ1xyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdvcmctcGF5bWVudHMnLHtcclxuICAgIC8vdXJsOiAnL2xlc3Nvbi86bGVzc29uSWQnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhT3JnYW5pemF0aW9uQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5vcmctcGF5bWVudHMuaHRtbCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnbWFya2V0cGxhY2UnLHtcclxuICAgIC8vdXJsOiAnL2xlc3Nvbi86bGVzc29uSWQnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhTWFya2V0cGxhY2VDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLm1hcmtldHBsYWNlLmh0bWwnLFxyXG4gICAgcGFyYW1zOntcclxuICAgICAgdGVhY2hlcjpudWxsXHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ29yZy1zdWJzY3JpcHRpb25zJyx7XHJcbiAgICAvL3VybDogJy9sZXNzb24vOmxlc3NvbklkJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYU9yZ2FuaXphdGlvbkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEub3JnLXN1YnNjcmlwdGlvbnMuaHRtbCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnc3R5bGVzJyx7XHJcbiAgICAvL3VybDogJy9sZXNzb24vOmxlc3NvbklkJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYVN0eWxlQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5nbG9iYWxTdHlsZS5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBnbG9iYWw6dHJ1ZVxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdpbnRyby1zdGVwcycse1xyXG4gICAgLy91cmw6ICcvbGVzc29uLzpsZXNzb25JZCcsXHJcbiAgICBjb250cm9sbGVyOiAncGFJbnRyb0NvbnRyb2xsZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuaW50cm9TdGVwcy5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBnbG9iYWw6dHJ1ZVxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdpbnRyby1zdGVwJyx7XHJcbiAgICAvL3VybDogJy9sZXNzb24vOmxlc3NvbklkJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYUludHJvQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5pbnRyb1N0ZXAuaHRtbCcsXHJcbiAgICBwYXJhbXM6IHtcclxuICAgICAgc3RlcDogbnVsbFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdmZWVkcycse1xyXG4gICAgLy91cmw6ICcvbGVzc29uLzpsZXNzb25JZCcsXHJcbiAgICBjb250cm9sbGVyOiAncGFGZWVkc0NvbnRyb2xsZXInLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuZmVlZHMuaHRtbCdcclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnZmVlZCcse1xyXG4gICAgLy91cmw6ICcvbGVzc29uLzpsZXNzb25JZCcsXHJcbiAgICBjb250cm9sbGVyOiAncGFGZWVkQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5mZWVkLmh0bWwnLFxyXG4gICAgcGFyYW1zOiB7XHJcbiAgICAgIGZlZWQ6bnVsbFxyXG4gICAgfVxyXG4gIH0pO1xyXG4gICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdzZWFyY2gtY29sbGVjdGlvbnMnLHtcclxuICAgIC8vdXJsOiAnL2xlc3Nvbi86bGVzc29uSWQnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhQ29sbGVjdGlvbnNDb250cm9sbGVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLnNlYXJjaC1jb2xsZWN0aW9ucy5odG1sJyxcclxuICAgIHBhcmFtczoge1xyXG4gICAgICBmZWVkOm51bGxcclxuICAgIH1cclxuICB9KTtcclxuICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnYXhlcnZlJywge1xyXG4gICAgLy91cmw6ICcvcGEvYXhlcnZlJyxcclxuICAgIGNvbnRyb2xsZXI6ICdheGVydmVDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL2F4ZXJ2ZS5odG1sJyxcclxuICB9KTtcclxufV0pOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFQYXltZW50IC4kaW5qZWN0ID0gW1wiJHFcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJGh0dHBcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5mYWN0b3J5KCdwYVBheW1lbnQnLCBwYVBheW1lbnQgKTtcclxuXHJcbmZ1bmN0aW9uIHBhUGF5bWVudCAoJHEsICRyb290U2NvcGUsICRzdGF0ZSwgJGh0dHAsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBnZXRPcmdhbml6YXRpb25QYXltZW50czogZnVuY3Rpb24ob3JnKXtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvd3Mvb3JnYW5pemF0aW9ucy8nK29yZysnL3BheW1lbnRzJylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdlU2NvcGU9cGFDYWNoZS5nZXRQYWdlU2NvcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBwYWdlU2NvcGUucGF5bWVudHMgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgfVxyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYVNvY2tldC4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRsb2dcIiwgXCIkbG9jYXRpb25cIiwgXCIkZG9jdW1lbnRcIiwgXCIkd2luZG93XCIsIFwiJHRpbWVvdXRcIiwgXCIkdWliTW9kYWxcIiwgXCIkaHR0cFwiLCBcInBhQ2FjaGVcIiwgXCJwYUNoYW5uZWxcIiwgXCJuZ0F1ZGlvXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5mYWN0b3J5KCdwYVNvY2tldCcsIHBhU29ja2V0KTtcclxuXHJcbmZ1bmN0aW9uIHBhU29ja2V0KCRyb290U2NvcGUsICRzdGF0ZSwgJGxvZywgJGxvY2F0aW9uLCAkZG9jdW1lbnQsICR3aW5kb3csICR0aW1lb3V0LCAkdWliTW9kYWwsICRodHRwLCBwYUNhY2hlLCBwYUNoYW5uZWwsIG5nQXVkaW8sIGNvbmZpZykge1xyXG4gIHZhciBzb2NrZXQ7XHJcbiAgcmV0dXJuIHtcclxuICAgIG9uOiBmdW5jdGlvbiBvbihldmVudE5hbWUsIGNhbGxiYWNrKSB7XHJcbiAgICAgIC8qTG9nZ2x5TG9nZ2VyLnNlbmRNZXNzYWdlKHtcclxuICAgICAgdXNlcm5hbWU6ICRyb290U2NvcGUudXNlci51c2VybmFtZSxcclxuICAgICAgbWVzc2FnZTogJ29uICcgKyBldmVudE5hbWVcclxuICAgICAgfSk7Ki9cclxuICAgICAgZnVuY3Rpb24gd3JhcHBlcigpIHtcclxuICAgICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcclxuXHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBpZighZGF0YS5pbml0aWFsaXplZCl7XHJcbiAgICAgICAgICBkYXRhID0gcGFDYWNoZS5pbml0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgbXNnID0gYXJnc1swXTtcclxuICAgICAgICBpZiAobXNnICYmIG1zZy5faWQgJiYgbXNnLl91c2VyICYmIG1zZy5fdXNlci5yb2xlPT0nUycpe1xyXG4gICAgICAgICAgdmFyIG5hbWUgPSBtc2cuX3VzZXIuZGF0YS5uYW1lKycgJyttc2cuX3VzZXIuZGF0YS5zdXJuYW1lO1xyXG4gICAgICAgICAgZGF0YS50b29sdGlwc1ttc2cuX2lkXSA9IHtcclxuICAgICAgICAgICAgdGV4dDogbmFtZSxcclxuICAgICAgICAgICAgb3BlbjogdHJ1ZVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgZGF0YS50b29sdGlwc1ttc2cuX2lkXSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgIH0sIDMwMDApO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICB9XHJcbiAgXHJcbiAgICAgICAgJHJvb3RTY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgY2FsbGJhY2suYXBwbHkoc29ja2V0LCBhcmdzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgc29ja2V0Lm9uKGV2ZW50TmFtZSwgd3JhcHBlcik7XHJcbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc29ja2V0LnJlbW92ZUxpc3RlbmVyKGV2ZW50TmFtZSwgd3JhcHBlcik7XHJcbiAgICAgIH07XHJcbiAgICB9LFxyXG4gICAgZW1pdDogZnVuY3Rpb24gZW1pdChldmVudE5hbWUsIGRhdGEsIGNhbGxiYWNrKSB7XHJcblxyXG4gICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICB2YXIgaXNMb2NrZWQgPSBjb25mLnVzZXIgJiYgY29uZi51c2VyLnBhcmFtcyAmJiBjb25mLnVzZXIucGFyYW1zLmxvY2tlZD09J3RydWUnO1xyXG4gICAgICBpZiAoIWlzTG9ja2VkIHx8ICRyb290U2NvcGUuYWRtaW4pIHtcclxuICAgICAgICAvKkxvZ2dseUxvZ2dlci5zZW5kTWVzc2FnZSh7IFxyXG4gICAgICAgIFx0dXNlcm5hbWU6ICRyb290U2NvcGUudXNlci51c2VybmFtZSxcclxuICAgICAgICBcdG1lc3NhZ2U6ICdlbWl0ICcgKyBldmVudE5hbWVcclxuICAgICAgICB9KTsqL1xyXG4gICAgICAgIGlmIChwYUNhY2hlLmdldERhdGEoKS5yZWMpIHtcclxuICAgICAgICAgIHZhciBldmVudCA9IHtcclxuICAgICAgICAgICAgbmFtZTogZXZlbnROYW1lLFxyXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICByZWM6IHBhQ2FjaGUuZ2V0RGF0YSgpLnJlYy5faWRcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2V2ZW50L3NhdmUnLCBldmVudCwgZnVuY3Rpb24gKGVycm9yLCBldmVudCkge30pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKF8uaXNPYmplY3QoZGF0YSkpe1xyXG4gICAgICAgICAgZGF0YS5fdXNlciA9IGNvbmYudXNlcjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNvY2tldC5lbWl0KGV2ZW50TmFtZSwgZGF0YSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XHJcbiAgICAgICAgICAkcm9vdFNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xyXG4gICAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KHNvY2tldCwgYXJncyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgcmVtb3ZlQWxsTGlzdGVuZXJzOiBmdW5jdGlvbiByZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnROYW1lLCBjYWxsYmFjaykge1xyXG4gICAgICAvL3NvY2tldC5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcclxuICAgIH0sXHJcbiAgICBpbml0OiBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgICB2YXIgbnMgPSAkbG9jYXRpb24ucHJvdG9jb2woKSArICc6Ly8nICsgJGxvY2F0aW9uLmhvc3QoKSArICc6JyArICRsb2NhdGlvbi5wb3J0KCkgKyAnL3doaXRlYm9hcmQnO1xyXG4gICAgICB2YXIgcGFUb2tlbiA9ICR3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BhLnRva2VuJyk7XHJcbiAgICAgIHNvY2tldCA9IGlvLmNvbm5lY3QobnMsIHtcclxuICAgICAgICBxdWVyeToge3Rva2VuOiBwYVRva2VufVxyXG4gICAgICB9KTtcclxuICAgICAgJGxvZy5pbmZvKFwic29ja2V0IGNyZWF0ZWQ6IFwiICsgbnMpO1xyXG4gICAgICBzb2NrZXQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc29ja2V0LmVtaXQoJ3JlZ2lzdGVyJywgJHJvb3RTY29wZS51c2VyKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHNvY2tldC5vbignZGlzY29ubmVjdCBtZXNzYWdlJywgZnVuY3Rpb24gKHN0dWRlbnQpIHtcclxuICAgICAgICAkbG9nLmluZm8oXCJkaXNjb25uZWN0IHN0dWRlbnQgXCIgKyBzdHVkZW50KTtcclxuXHJcbiAgICAgICAgaWYgKHN0dWRlbnQgPT0gJHJvb3RTY29wZS51c2VyLnN0dWRlbnQpIHtcclxuICAgICAgICAgIHNvY2tldC5kaXNjb25uZWN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgc29ja2V0Lm9uKCdyZWxvYWQnLCBmdW5jdGlvbiAodGVhY2hlcikge1xyXG4gICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBzb2NrZXQub24oXCJwYWdlIG1lc3NhZ2VcIiwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHBhQ2FjaGUuc3RvcFJlYygpO1xyXG4gICAgICAgIHZhciBwYXJhbXM9bnVsbDtcclxuICAgICAgICBpZiAobXNnLnBhZ2Upe1xyXG4gICAgICAgICAgcGFDYWNoZS5zZXRDdXJyZW50Q29udGVudChudWxsKTtcclxuICAgICAgICAgIHBhQ2FjaGUuc2V0Q3VycmVudFBhZ2UobXNnLnBhZ2UpO1xyXG4gICAgICAgICAgcGFyYW1zID0gXy5leHRlbmQobXNnLnBhZ2UucGFyYW1zP21zZy5wYWdlLnBhcmFtczp7fSx7Y29udGVudDoge3R5cGU6ICdQJ319KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25Ubyhtc2cuY29kZSwgcGFyYW1zLCB7XCJyZWxvYWRcIjogdHJ1ZX0pO1xyXG4gICAgICB9KTtcclxuICAgICAgc29ja2V0Lm9uKFwiY29udGVudCBtZXNzYWdlXCIsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICBwYUNhY2hlLnN0b3BSZWMoKTtcclxuICAgICAgICB2YXIgcGFyYW1zPW1zZy5jb250ZW50LnBhZ2UucGFyYW1zfHx7fTtcclxuICAgICAgICBpZiAobXNnLmNvbnRlbnQpe1xyXG4gICAgICAgICAgcGFDYWNoZS5zZXRDdXJyZW50Q29udGVudChtc2cuY29udGVudCk7XHJcbiAgICAgICAgICBwYUNhY2hlLnNldEN1cnJlbnRQYWdlKG1zZy5jb250ZW50LnBhZ2UpO1xyXG4gICAgICAgICAgcGFyYW1zID0gXy5leHRlbmQocGFyYW1zLHtjb250ZW50OiBtc2cuY29udGVudH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKG1zZy5jb2RlLCBwYXJhbXMsIHtcInJlbG9hZFwiOiB0cnVlfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBzb2NrZXQub24oXCJwb3MgbWVzc2FnZVwiLCBmdW5jdGlvbiAoZWxlbSkge1xyXG4gICAgICAgIHZhciBlbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KFwiI1wiICsgZWxlbS5pZCk7XHJcbiAgICAgICAgdmFyIHcgPSAkKFwiI3BhbmVsXCIpLndpZHRoKCk7XHJcbiAgICAgICAgdmFyIGggPSAkKFwiI3BhbmVsXCIpLmhlaWdodCgpO1xyXG4gICAgICAgIGVsZW1lbnQuY3NzKHtcclxuICAgICAgICAgIHRvcDogZWxlbS55ICogaCArICdweCcsXHJcbiAgICAgICAgICBsZWZ0OiBlbGVtLnggKiB3ICsgJ3B4J1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgICAgc29ja2V0Lm9uKFwiZHJhZ1wiLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoXCIjXCIgKyBldnQuc291cmNlKTtcclxuICAgICAgICB2YXIgdyA9IGVsZW1lbnQud2lkdGgoKTtcclxuICAgICAgICB2YXIgaCA9IGVsZW1lbnQuaGVpZ2h0KCk7XHJcbiAgICAgICAgdmFyIHRhcmdldCA9IGFuZ3VsYXIuZWxlbWVudChcIiNcIiArIGV2dC50YXJnZXQpO1xyXG4gICAgICAgIGVsZW1lbnQuZGV0YWNoKCkuYXBwZW5kVG8odGFyZ2V0KTtcclxuICAgICAgICBlbGVtZW50LmNzcyh7XHJcbiAgICAgICAgICB0b3A6IGV2dC55ICsgJyUnLFxyXG4gICAgICAgICAgbGVmdDogZXZ0LnggKyAnJScsXHJcbiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcclxuICAgICAgICAgIHdpZHRoOiB3LFxyXG4gICAgICAgICAgaGVpZ2h0OiBoXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIGRyb3BzID0gcGFDYWNoZS5nZXREcm9wcygpO1xyXG4gICAgICAgIGRyb3BzW2V2dC5zb3VyY2VdID0gdHJ1ZTtcclxuICAgICAgfSk7XHJcbiAgICAgIHNvY2tldC5vbihcInVuZG8tZHJhZ1wiLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoXCIjXCIgKyBldnQuc291cmNlKTtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gYW5ndWxhci5lbGVtZW50KFwiI1wiICsgZXZ0LnRhcmdldCk7IC8vdGFyZ2V0LmVtcHR5KCk7XHJcblxyXG4gICAgICAgIGVsZW1lbnQuZGV0YWNoKCkuYXBwZW5kVG8odGFyZ2V0KTtcclxuICAgICAgICBlbGVtZW50LmNzcyh7XHJcbiAgICAgICAgICB0b3A6IDAsXHJcbiAgICAgICAgICBsZWZ0OiAwLFxyXG4gICAgICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZSdcclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgZHJvcHMgPSBwYUNhY2hlLmdldERyb3BzKCk7XHJcbiAgICAgICAgZHJvcHNbZXZ0LnNvdXJjZV0gPSBmYWxzZTtcclxuICAgICAgfSk7XHJcbiAgICAgIHNvY2tldC5vbihcImZpdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoXCIjXCIgKyBldnQuc291cmNlKTtcclxuICAgICAgICB2YXIgdyA9IGVsZW1lbnQud2lkdGgoKTtcclxuICAgICAgICB2YXIgaCA9IGVsZW1lbnQuaGVpZ2h0KCk7XHJcbiAgICAgICAgdmFyIHRhcmdldCA9IGFuZ3VsYXIuZWxlbWVudChcIiNcIiArIGV2dC50YXJnZXQpO1xyXG4gICAgICAgIGVsZW1lbnQuZGV0YWNoKCkuYXBwZW5kVG8odGFyZ2V0KTtcclxuICAgICAgICBlbGVtZW50LmNzcyh7XHJcbiAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcclxuICAgICAgICAgIGxlZnQ6ICcwJyxcclxuICAgICAgICAgIHRvcDogJzAnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGFyZ2V0LmNzcyh7XHJcbiAgICAgICAgICB3aWR0aDogdyxcclxuICAgICAgICAgIGhlaWdodDogaFxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgdmFyIGRyb3BzID0gcGFDYWNoZS5nZXREcm9wcygpO1xyXG4gICAgICAgIGRyb3BzW2V2dC5zb3VyY2VdID0gdHJ1ZTtcclxuICAgICAgfSk7XHJcbiAgICAgIHNvY2tldC5vbihcImFwcGVuZFwiLCBmdW5jdGlvbiAoZXZ0KSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoXCIjXCIgKyBldnQuc291cmNlKTtcclxuICAgICAgICB2YXIgdyA9IGVsZW1lbnQud2lkdGgoKTtcclxuICAgICAgICB2YXIgaCA9IGVsZW1lbnQuaGVpZ2h0KCk7XHJcbiAgICAgICAgdmFyIHRhcmdldCA9IGFuZ3VsYXIuZWxlbWVudChcIiNcIiArIGV2dC50YXJnZXQpO1xyXG4gICAgICAgIGVsZW1lbnQuZGV0YWNoKCkuYXBwZW5kVG8odGFyZ2V0KTtcclxuICAgICAgICBlbGVtZW50LmNzcyh7XHJcbiAgICAgICAgICBwb3NpdGlvbjogZXZ0LnBvc2l0aW9uID8gZXZ0LnBvc2l0aW9uIDogJycsXHJcbiAgICAgICAgICBsZWZ0OiAnJyxcclxuICAgICAgICAgIHRvcDogJycsXHJcbiAgICAgICAgICB3aWR0aDogdyxcclxuICAgICAgICAgIGhlaWdodDogaFxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciBkcm9wcyA9IHBhQ2FjaGUuZ2V0RHJvcHMoKTtcclxuICAgICAgICBkcm9wc1tldnQuc291cmNlXSA9IHRydWU7XHJcbiAgICAgIH0pO1xyXG4gICAgICBzb2NrZXQub24oJ2NsaWNrLW1zZycsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gYW5ndWxhci5lbGVtZW50KFwiI1wiICsgbXNnLmlkKTtcclxuICAgICAgICB2YXIgeCA9IG1zZy54ICogdGFyZ2V0LndpZHRoKCk7XHJcbiAgICAgICAgdmFyIHkgPSBtc2cueSAqIHRhcmdldC5oZWlnaHQoKTtcclxuICAgICAgICB2YXIgZWxlbWVudDtcclxuXHJcbiAgICAgICAgaWYgKG1zZy5zaW5nbGUpIHtcclxuICAgICAgICAgIGVsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoXCIuY2xpY2stbXNnXCIpO1xyXG5cclxuICAgICAgICAgIGlmICghZWxlbWVudC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudCgnPGkgY2xhc3M9XCJmYSAnICsgbXNnLmljb24gKyAnIGZhLTJ4IGNsaWNrLW1zZ1wiPjwvaT4nKTtcclxuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyh0YXJnZXQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBlbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KCc8aSBjbGFzcz1cImZhICcgKyBtc2cuaWNvbiArICcgZmEtMnggY2xpY2stbXNnXCI+PC9pPicpO1xyXG4gICAgICAgICAgZWxlbWVudC5hcHBlbmRUbyh0YXJnZXQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZWxlbWVudC5jc3Moe1xyXG4gICAgICAgICAgdG9wOiB5IC0gZWxlbWVudC5oZWlnaHQoKSAvIDIsXHJcbiAgICAgICAgICBsZWZ0OiB4IC0gZWxlbWVudC53aWR0aCgpIC8gMixcclxuICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBzb2NrZXQub24oJ2NsZWFyLWNsaWNrLW1zZycsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgbCA9IGFuZ3VsYXIuZWxlbWVudChcIi5jbGljay1tc2dcIik7XHJcblxyXG4gICAgICAgIF8uZWFjaChsLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgZS5yZW1vdmUoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICAgIHNvY2tldC5vbihcInBsYXktdHJhY2tcIiwgZnVuY3Rpb24gKGEpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGlmICghZGF0YS5hdWRpb0NvbGxlY3Rpb24pe1xyXG4gICAgICAgICAgZGF0YS5hdWRpb0NvbGxlY3Rpb249e307XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoYS5wbGF5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgIGRhdGEudHJhY2sgPSBhLnBsYXk7XHJcbiAgICAgICAgICBpZiAoIWRhdGEuYXVkaW9Db2xsZWN0aW9uW2EucGxheV0pIHtcclxuICAgICAgICAgICAgdmFyIGF1ZGlvPW5nQXVkaW8ubG9hZChhLnBsYXkpO1xyXG4gICAgICAgICAgICBpZiAoYXVkaW8uZXJyb3Ipe1xyXG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZXJyb3IgbG9hZGluZyBhdWRpbycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGRhdGEuYXVkaW9Db2xsZWN0aW9uW2EucGxheV09e2F1ZGlvOmF1ZGlvfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGRhdGEuYXVkaW9Db2xsZWN0aW9uW2EucGxheV0uYXVkaW8ucGxheSgpO1xyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKGEucGF1c2UgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmF1ZGlvQ29sbGVjdGlvblthLnBhdXNlXSkge1xyXG4gICAgICAgICAgZGF0YS50cmFjayA9IC0xO1xyXG4gICAgICAgICAgZGF0YS5hdWRpb0NvbGxlY3Rpb25bYS5wYXVzZV0uYXVkaW8ucGF1c2UoKTtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmIChhLnN0b3AgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmF1ZGlvQ29sbGVjdGlvblthLnN0b3BdKSB7XHJcbiAgICAgICAgICBkYXRhLnRyYWNrID0gLTE7XHJcbiAgICAgICAgICBkYXRhLmF1ZGlvQ29sbGVjdGlvblthLnN0b3BdLmF1ZGlvLnBhdXNlKCk7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAoYS50cmFjayAhPT0gdW5kZWZpbmVkICYmIGEucHJvZ3Jlc3MgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmF1ZGlvQ29sbGVjdGlvblthLnRyYWNrXSkge1xyXG4gICAgICAgICAgZGF0YS5hdWRpb0NvbGxlY3Rpb25bYS50cmFja10uYXVkaW8ucHJvZ3Jlc3MgPSBhLnByb2dyZXNzO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHNvY2tldC5vbihcImF1ZGlvIG1lc3NhZ2VcIiwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcblxyXG4gICAgICAgIHZhciByZXMgPSBfLmZpbmQoZGF0YS5hdWRpb0NvbGxlY3Rpb24sIGZ1bmN0aW9uIChhdWRpbykge1xyXG4gICAgICAgICAgcmV0dXJuIGF1ZGlvLnRpdGxlID09IG1zZy50aXRsZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKG1zZy5hY3Rpb24gPT0gJ3BsYXknKSB7XHJcbiAgICAgICAgICByZXMuYXVkaW8ucGxheSgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobXNnLmFjdGlvbiA9PSAncGF1c2UnKSB7XHJcbiAgICAgICAgICByZXMuYXVkaW8ucGF1c2UoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG1zZy5hY3Rpb24gPT0gJ3N0b3AnKSB7XHJcbiAgICAgICAgICByZXMuYXVkaW8ucGF1c2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBzb2NrZXQub24oXCJzbWlsZSBtZXNzYWdlXCIsIGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBkYXRhLnNlbGVjdGVkU21pbGVzW2ldID0gdHJ1ZTtcclxuICAgICAgICBkYXRhLmNvdW50ZXIgPSBkYXRhLmNvdW50ZXIgKyAxO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbignY291bnQnLCBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBkYXRhLmNvdW50ZXJzW21zZy51c2VyXSA9IG1zZy5jb3VudGVyO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbigndGV4dCcsIGZ1bmN0aW9uIChvYmopIHtcclxuICAgICAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbikge1xyXG4gICAgICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSkgeyAgLy8gQ2hyb21lXHJcbiAgICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5lbXB0eSgpO1xyXG4gICAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKSB7ICAvLyBGaXJlZm94XHJcbiAgICAgICAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5yZW1vdmVBbGxSYW5nZXMoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9ICAgICAgICAgXHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBkYXRhLnN0YXJ0ID0gTnVtYmVyKG9iai5zdGFydCk7XHJcbiAgICAgICAgZGF0YS5lbmQgPSBOdW1iZXIob2JqLmVuZCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKCd1c2VyLXNlbGVjdGlvbicsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIHZhciB3b3JkID0gZGF0YS5ncmlkW21zZy5pXS5yZXNvdXJjZXNbbXNnLmpdO1xyXG5cclxuICAgICAgICBpZiAod29yZC5zZWxlY3RlZCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICB3b3JkLnNlbGVjdGVkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAoIWRhdGEucGxheWVycykge1xyXG4gICAgICAgICAgICBkYXRhLnBsYXllcnMgPSBbXTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoIV8uY29udGFpbnMoZGF0YS5wbGF5ZXJzLCBtc2cudXNlcikpIHtcclxuICAgICAgICAgICAgZGF0YS5wbGF5ZXJzLnB1c2gobXNnLnVzZXIpO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIHZhciBzZWwgPSBfLmluZGV4T2YoZGF0YS5wbGF5ZXJzLCBtc2cudXNlcik7XHJcblxyXG4gICAgICAgICAgd29yZC5zZWxlY3RlZCA9IHNlbDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKCdiaW5vY3VsYXInLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHZhciByZWxYID0gZS5vZmZzZXRYIC0gMTQwO1xyXG4gICAgICAgIHZhciByZWxZID0gZS5vZmZzZXRZIC0gODA7XHJcbiAgICAgICAgJCgnbWFzayBnJykuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgnICsgcmVsWCArICcsJyArIHJlbFkgKyAnKScpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImltZyBtZXNzYWdlXCIsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICBwYUNhY2hlLnNldFNlbGVjdGVkSW1hZ2UobXNnKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJpbWcyIG1lc3NhZ2VcIiwgZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgIHZhciBpID0gb2JqWzBdO1xyXG4gICAgICAgIHZhciBzZWwgPSBvYmpbMV07XHJcbiAgICAgICAgcGFDYWNoZS5zZXRTZWxlY3RlZChpLCBzZWwpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImZsaXBcIiwgZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgIHZhciBpID0gb2JqWzBdO1xyXG4gICAgICAgIHZhciBzZWwgPSBvYmpbMV07XHJcbiAgICAgICAgcGFDYWNoZS5zZXRTZWxlY3RlZChpLCBzZWwpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImJvb2sgbWVzc2FnZVwiLCBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgJCgnI2JiLWJvb2tibG9jaycpLmJvb2tibG9jayhtc2cpO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJ0YWJcIiwgZnVuY3Rpb24gKGkpIHtcclxuICAgICAgICBwYUNhY2hlLnNldFRhYihpKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJzaG93IG1lc3NhZ2VcIiwgZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgIHZhciBpID0gb2JqWzBdO1xyXG4gICAgICAgIHZhciB2YWwgPSBvYmpbMV07XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBkYXRhLmltYWdlc1tpXS5zaG93ID0gdmFsO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImhpZGUgbWVzc2FnZVwiLCBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICAgICAgdmFyIGkgPSBvYmpbMF07XHJcbiAgICAgICAgdmFyIHZhbCA9IG9ialsxXTtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEuaW1hZ2VzW2ldLmhpZGUgPSB2YWw7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwidmFyXCIsIGZ1bmN0aW9uIChvYmopIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGFbb2JqW1widmFyXCJdXSA9IG9iai52YWw7XHJcblxyXG4gICAgICAgIGlmIChvYmpbXCJ2YXJcIl0gPT0gJ2VuYWJsZUpjcm9wJyAmJiAhb2JqLnZhbCAmJiBkYXRhLmpjcm9wX2FwaSkge1xyXG4gICAgICAgICAgZGF0YS5qY3JvcF9hcGkuZGVzdHJveSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJqc29uXCIsIGZ1bmN0aW9uKGpzb24pe1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgICAgXy5tYXBPYmplY3QoanNvbixmdW5jdGlvbih2YWwsa2V5KXtcclxuICAgICAgICAgIGRhdGFba2V5XT12YWw7XHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJjb25mXCIsIGZ1bmN0aW9uIChvYmopIHtcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgIF8uZXh0ZW5kKGNvbmZbb2JqW1widmFyXCJdXSwgb2JqLnZhbCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwiaW1hZ2VzXCIsIGZ1bmN0aW9uIChpbWFnZXMpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEuaW1hZ2VzID0gaW1hZ2VzO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImltYWdlczJcIiwgZnVuY3Rpb24gKGltYWdlczIpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEuaW1hZ2VzMiA9IGltYWdlczI7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwid29yZHNcIiwgZnVuY3Rpb24gKHdvcmRzKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBkYXRhLndvcmRzID0gd29yZHM7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwibGluZVwiLCBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBkYXRhLmxpbmVzW21zZy5pXS53b3Jkcy5zb3J0KGZ1bmN0aW9uKGEsYil7XHJcbiAgICAgICAgICB2YXIgcG9zQT1tc2cub3JkZXIuaW5kZXhPZihhLmkpO1xyXG4gICAgICAgICAgdmFyIHBvc0I9bXNnLm9yZGVyLmluZGV4T2YoYi5pKTtcclxuICAgICAgICAgIHJldHVybiAocG9zQT5wb3NCKT8xOi0xO1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwicG9wIG1lc3NhZ2VcIiwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcblxyXG4gICAgICAgIGlmIChkYXRhLmltYWdlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICBkYXRhLmltYWdlcy5wb3AoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwiaW1nIHBhcmFtc1wiLCBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICB2YXIgaSA9IG9ialswXTtcclxuICAgICAgICB2YXIgdmFsID0gb2JqWzFdO1xyXG4gICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGRhdGEuaW1hZ2VzW2ldLCB2YWwpO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImNsZWFyXCIsIGZ1bmN0aW9uIChiKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuXHJcbiAgICAgICAgaWYgKGRhdGEuamNyb3BfYXBpKSB7XHJcbiAgICAgICAgICBkYXRhLmpjcm9wX2FwaS5kZXN0cm95KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkYXRhLnNlbGVjdGVkSW1hZ2UgPSAtMTtcclxuICAgICAgICB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkucmVtb3ZlQWxsUmFuZ2VzKCk7XHJcbiAgICAgICAgZGF0YS5zdGFydCA9IC0xO1xyXG4gICAgICAgIGRhdGEuZW5kID0gLTE7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwidGV4dHNpemVcIiwgZnVuY3Rpb24gKHNpemUpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEudGV4dHNpemUgPSBzaXplO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcInJhdGlvXCIsIGZ1bmN0aW9uIChyYXRpbykge1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgICAgZGF0YS5yYXRpbyA9IHJhdGlvO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcInNpemVcIiwgZnVuY3Rpb24gKHNpemUpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEuc2l6ZSA9IHNpemU7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwic2l6ZTJcIiwgZnVuY3Rpb24gKHNpemUpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEuc2l6ZTIgPSBzaXplO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImhpZGVcIiwgZnVuY3Rpb24gKGJvb2wpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEuaGlkZSA9IGJvb2w7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwiZmVlZFwiLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgIHZhciBmZWVkID0gcGFDYWNoZS5nZXRGZWVkKCk7XHJcbiAgICAgICAgZmVlZC5zaG93ID0gdHJ1ZTtcclxuICAgICAgICBmZWVkLmRhdGEgPSBkYXRhO1xyXG5cclxuICAgICAgICBpZiAoZGF0YS5hdWRpbykge1xyXG4gICAgICAgICAgdmFyIHNvdW5kID0gbmdBdWRpby5sb2FkKGRhdGEuYXVkaW8pO1xyXG4gICAgICAgICAgaWYgKHNvdW5kLmVycm9yKXtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdlcnJvciBsb2FkaW5nIGF1ZGlvJyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBzb3VuZC52b2x1bWUgPSAwLjI7XHJcbiAgICAgICAgICBzb3VuZC5wbGF5KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICBmZWVkLmRhdGEgPSBudWxsO1xyXG4gICAgICAgICAgZmVlZC5zaG93ID0gZmFsc2U7XHJcbiAgICAgICAgfSwgZGF0YS50aW1lb3V0IHx8IDMwMDApO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcInRvZ2dsZVwiLCBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgdmFyIGZlZWQgPSBwYUNhY2hlLmdldEZlZWQoKTtcclxuICAgICAgICBmZWVkLnRvZ2dsZSA9ICFmZWVkLnRvZ2dsZTtcclxuICAgICAgICBmZWVkLnRvZ2dsZURhdGEgPSBtc2c7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwicmVwbGFjZS10ZXh0XCIsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEudGVtcFttc2cuaV0gPSBtc2cudmFsO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImZpbHRlckJ5XCIsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEuZmlsdGVyQnkgPSBtc2c7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwic2Nyb2xsXCIsIGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgICAgZGF0YS5zZWxlY3RlZEltYWdlID0gaWQ7XHJcbiAgICAgICAgdmFyIGVsID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKSk7XHJcbiAgICAgICAgJGRvY3VtZW50LnNjcm9sbFRvRWxlbWVudEFuaW1hdGVkKGVsKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJjc3NcIiwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHZhciBlbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KFwiI1wiICsgbXNnLmlkKTtcclxuICAgICAgICBlbGVtZW50LmNzcyhtc2cuY3NzKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJsaXN0XCIsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGEubGlzdCA9IG1zZztcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJleGVjXCIsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG5cclxuICAgICAgICBpZiAobXNnID09ICdjb3VudGRvd24nKSB7XHJcbiAgICAgICAgICB2YXIgYXVkaW8gPSBuZ0F1ZGlvLmxvYWQoY29uZmlnLnN0b3JhZ2VCYXNlVXJsKycvaW1nL2NvbnRyb2xwYW5lbC9Db3VudGRvd24lMjAobXAzY3V0LnJ1KS5tcDMnKTtcclxuICAgICAgICAgIGlmIChhdWRpby5lcnJvcil7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZXJyb3IgbG9hZGluZyBhdWRpbycpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZGF0YS5jb3VudGRvd25TZWwgPSA1O1xyXG5cclxuICAgICAgICAgIHZhciBleGVjID0gZnVuY3Rpb24gZXhlYygpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEuY291bnRkb3duU2VsID4gMCkge1xyXG4gICAgICAgICAgICAgIGRhdGEuY291bnRkb3duU2VsIC09IDE7XHJcblxyXG4gICAgICAgICAgICAgICR0aW1lb3V0KGV4ZWMsIDEwMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIGF1ZGlvLnBsYXkoKTsgLy9kYXRhLmF1ZGlvLmJpcC5wbGF5KCk7XHJcblxyXG4gICAgICAgICAgJHRpbWVvdXQoZXhlYywgMTAwMCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChtc2cubWV0aG9kICYmIG1zZy5tZXRob2QgPT0gXCJwaWNrVXBOdW1iZXJcIikge1xyXG4gICAgICAgICAgZGF0YS5waWNrVXBTZWwgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICBkYXRhLmRpY2UgPSBtc2cuYXJnO1xyXG4gICAgICAgICAgdmFyIGkgPSAwO1xyXG5cclxuICAgICAgICAgIHZhciBfbmV4dDIgPSBmdW5jdGlvbiBuZXh0KCkge1xyXG4gICAgICAgICAgICBpZiAoaSA8IG1zZy5hcmcubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgZGF0YS5waWNrVXBTZWwgPSBpO1xyXG4gICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgICAkdGltZW91dChfbmV4dDIsIDMwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgZGF0YS5ydW5uaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgZGF0YS5ydW5uaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICR0aW1lb3V0KF9uZXh0MiwgMzAwKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG1zZy5tZXRob2QgJiYgbXNnLm1ldGhvZCA9PSBcIm9uZU9yVHdvXCIpIHtcclxuICAgICAgICAgIGRhdGEub25lT3JUd28gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICBkYXRhLm9uZU9yVHdvTGVuID0gXy5yYW5nZShtc2cuYXJnKTtcclxuICAgICAgICAgIHZhciBpID0gMDtcclxuXHJcbiAgICAgICAgICB2YXIgX25leHQyID0gZnVuY3Rpb24gbmV4dCgpIHtcclxuICAgICAgICAgICAgaWYgKGkgPCBtc2cuYXJnKSB7XHJcbiAgICAgICAgICAgICAgZGF0YS5vbmVPclR3byA9IGk7XHJcbiAgICAgICAgICAgICAgaSArPSAxO1xyXG4gICAgICAgICAgICAgICR0aW1lb3V0KF9uZXh0MiwgNTAwKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBkYXRhLnJ1bm5pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICBkYXRhLnJ1bm5pbmcgPSB0cnVlO1xyXG4gICAgICAgICAgJHRpbWVvdXQoX25leHQyLCA1MDApO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobXNnLm1ldGhvZCAmJiBtc2cubWV0aG9kID09IFwiZGljZUZvclNlbnRlbmNlXCIpIHtcclxuICAgICAgICAgIGRhdGEucGlja1VwU2VsID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgZGF0YS5kaWNlRm9yU2VudGVuY2UgPSBtc2cuYXJnO1xyXG4gICAgICAgICAgdmFyIGkgPSAwO1xyXG5cclxuICAgICAgICAgIHZhciBfbmV4dDIgPSBmdW5jdGlvbiBfbmV4dCgpIHtcclxuICAgICAgICAgICAgaWYgKGkgPCBtc2cuYXJnLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgIGRhdGEucGlja1VwU2VsID0gaTtcclxuICAgICAgICAgICAgICBpICs9IDE7XHJcbiAgICAgICAgICAgICAgJHRpbWVvdXQoX25leHQyLCAzMDApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGRhdGEucnVubmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIGRhdGEucnVubmluZyA9IHRydWU7XHJcbiAgICAgICAgICAkdGltZW91dChfbmV4dDIsIDMwMCk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChtc2cubWV0aG9kICYmIG1zZy5tZXRob2QgPT0gXCJwYXBlclN0b25lU2Npc3NvcnNcIikge1xyXG4gICAgICAgICAgZGF0YS5waWNrVXBTZWwgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICBkYXRhLnBhcGVyU3RvbmVTY2lzc29ycyA9IG1zZy5hcmc7XHJcbiAgICAgICAgICB2YXIgaSA9IDA7XHJcblxyXG4gICAgICAgICAgdmFyIF9uZXh0MiA9IGZ1bmN0aW9uIF9uZXh0KCkge1xyXG4gICAgICAgICAgICBpZiAoaSA8IG1zZy5hcmcubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgZGF0YS5waWNrVXBTZWwgPSBpO1xyXG4gICAgICAgICAgICAgIGkgKz0gMTtcclxuICAgICAgICAgICAgICAkdGltZW91dChfbmV4dDIsIDMwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgZGF0YS5ydW5uaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgZGF0YS5ydW5uaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICR0aW1lb3V0KF9uZXh0MiwgMzAwKTtcclxuICAgICAgICB9IGVsc2UgaWYgKG1zZyA9PSAnZGlzdHJpYnV0ZUZyb21EZWNrJykge1xyXG4gICAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuXHJcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRhdGEubWl4ZWQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHNvdXJjZSA9ICQoJyNzJyArIGkpO1xyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gJCgnI3QnICsgaSk7XHJcbiAgICAgICAgICAgIHZhciBsZWZ0ID0gdGFyZ2V0Lm9mZnNldCgpLmxlZnQgLSBzb3VyY2Uub2Zmc2V0KCkubGVmdDtcclxuICAgICAgICAgICAgdmFyIHRvcCA9IHRhcmdldC5vZmZzZXQoKS50b3AgLSBzb3VyY2Uub2Zmc2V0KCkudG9wO1xyXG4gICAgICAgICAgICBkYXRhLm1peGVkMltpXS50cmFuc2l0aW9uID0ge1xyXG4gICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgnICsgbGVmdCArICdweCwnICsgdG9wICsgJ3B4KSdcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwiY2FwdHVyZS1zY3JlZW5cIiwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKCRyb290U2NvcGUudXNlci5zdHVkZW50ID09IG1zZykge1xyXG4gICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIHVzZUNPUlM6IHRydWVcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBodG1sMmNhbnZhcyhkb2N1bWVudC5ib2R5LCBvcHRpb25zKS50aGVuKGZ1bmN0aW9uIChjYW52YXMpIHtcclxuICAgICAgICAgICAgc2VsZi5lbWl0KFwicG5nXCIsIGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJwbmdcIiwgZnVuY3Rpb24gKGJhc2U2NCkge1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgICAgZGF0YS5iYXNlNjQgPSBiYXNlNjQ7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKCdsZXNzb25TdGFydGVkJywgZnVuY3Rpb24gKGNoYW5uZWwpIHtcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgIGNvbmYuY2hhbm5lbCA9IGNoYW5uZWw7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKCdsZXNzb25FbmRlZCcsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgIGNvbmYuY2hhbm5lbC5vcGVuID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5mZWVkYmFjay5odG1sJyxcclxuICAgICAgICAgIGNvbnRyb2xsZXI6ICdwYUZlZWRiYWNrQ3RybCcsXHJcbiAgICAgICAgICBjaGFubmVsOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICByZXR1cm4gbXNnO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge30pO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbigndXNlclBhcmFtJywgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgICAgdmFyIHVzZXIgPSBfLmZpbmQoY29uZi5yb29tLnVzZXJzLCBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICAgICAgcmV0dXJuIHVzZXIuaWQgPT0gbXNnLnVzZXI7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKHVzZXIpe1xyXG4gICAgICAgICAgdXNlci5wYXJhbXNbbXNnLm5hbWVdID0gbXNnLnZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJiYXR0ZXJ5XCIsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG5cclxuICAgICAgICB2YXIgdXNlciA9IF8uZmluZChjb25mLnJvb20udXNlcnMsIGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICByZXR1cm4gdXNlci5pZCA9PSBtc2cudXNlcjtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdXNlci5wYXJhbXNbJ2JhdHRlcnknXSA9IG1zZy52YWx1ZTtcclxuXHJcbiAgICAgICAgaWYgKG1zZy52YWx1ZSA9PSAwKSB7XHJcbiAgICAgICAgICB2YXIgYXVkaW8gPSBuZ0F1ZGlvLmxvYWQoY29uZmlnLnN0b3JhZ2VCYXNlVXJsKycvaW1nL2JhdHRlcnkvU291bmRfMDQ2NzUubXAzJyk7XHJcbiAgICAgICAgICBpZiAoYXVkaW8uZXJyb3Ipe1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9yIGxvYWRpbmcgYXVkaW8nKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGF1ZGlvLnBsYXkoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwidXNlcnNcIiwgZnVuY3Rpb24gKHVzZXJzKSB7XHJcbiAgICAgICAgcGFDYWNoZS5zZXRPbmxpbmVVc2Vycyh1c2Vycyk7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKFwidG9nZ2xlIG1lc3NhZ2VcIiwgZnVuY3Rpb24gKHYpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGRhdGFbdl0gPSAhZGF0YVt2XTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oJ3N0dWRlbnQtaWQnLCBmdW5jdGlvbiAoc3R1ZGVudCkge1xyXG4gICAgICAgIGlmICgkcm9vdFNjb3BlLnVzZXIudGVhY2hlciB8fCAkcm9vdFNjb3BlLnVzZXIuc3R1ZGVudCA9PSBzdHVkZW50Ll9pZCkge1xyXG4gICAgICAgICAgJGh0dHAucG9zdCgnL3dzL21lbnUvZmluZFBhZ2VzJyx7dHlwZTonUycsY29kZTonc3RpY2tlcnMnfSkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgdmFyIHBhZ2U9cmVzcC5kYXRhWzBdO1xyXG4gICAgICAgICAgICBwYUNhY2hlLnNldEN1cnJlbnRNb2RlKCdTJyk7XHJcbiAgICAgICAgICAgIHBhQ2FjaGUuc2V0Q3VycmVudEZvbGRlcihwYWdlLmZvbGRlcik7XHJcbiAgICAgICAgICAgIHBhQ2FjaGUuc2V0Q3VycmVudFBhZ2UocGFnZSk7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnc3RpY2tlcnMnLCB7XHJcbiAgICAgICAgICAgICAgc3R1ZGVudDogc3R1ZGVudCxcclxuICAgICAgICAgICAgICBjb250ZW50OiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAnUCdcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKCd2aWRlbycsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgIGNvbmYudmlkZW8gPSBtc2c7XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm9uKCd5b3V0dWJlJywgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcblxyXG4gICAgICAgIGlmIChtc2cucGxheSkge1xyXG4gICAgICAgICAgZGF0YS5wbGF5ZXJbbXNnLnZpZGVvSWRdLnBsYXlWaWRlbygpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBkYXRhLnBsYXllclttc2cudmlkZW9JZF0ucGF1c2VWaWRlbygpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oJ3JlbG9hZENoYW5uZWwnLCBmdW5jdGlvbihtc2cpe1xyXG4gICAgICAgIC8vIHJlbG9hZCBjaGFubmVsIGR1ZSB0byByb29tIGNoYW5nZWQsIGJlZm9yZSBvciBhZnRlciBsZXNzb24gc3RhcnRcclxuICAgICAgICBwYUNoYW5uZWwubG9hZFJvb20oKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHRoaXMub24oXCJjaGF0Lm9wZW5cIiwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgICAgY29uZi5jaGF0Lm9wZW49bXNnLnZhbHVlO1xyXG4gICAgICB9KTtcclxuICAgICAgdGhpcy5vbihcImNoYXQubWVzc2FnZVwiLCBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgICBpZiAobXNnLmFjdGlvbj09J2FkZCcpIHtcclxuICAgICAgICAgIGNvbmYuY2hhdC5tZXNzYWdlcy5wdXNoKG1zZyk7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAobXNnLmFjdGlvbj09J3VwZGF0ZScpIHtcclxuICAgICAgICAgIHZhciBtID0gXy5maW5kKGNvbmYuY2hhdC5tZXNzYWdlcywgZnVuY3Rpb24obSl7XHJcbiAgICAgICAgICAgIHJldHVybiBtc2cuaWQ9PW0uaWQ7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgaWYgKG0pIHtcclxuICAgICAgICAgICAgbS50ZXh0PW1zZy50ZXh0O1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKG1zZy5hY3Rpb249PSdyZW1vdmUnKXtcclxuICAgICAgICAgIHZhciBpID0gXy5maW5kSW5kZXgoY29uZi5jaGF0Lm1lc3NhZ2VzLCBmdW5jdGlvbihtKXtcclxuICAgICAgICAgICAgcmV0dXJuIG1zZy5pZD09bS5pZDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgaWYgKGkhPS0xKXtcclxuICAgICAgICAgICAgY29uZi5jaGF0Lm1lc3NhZ2VzLnNwbGljZShpLDEpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICB2YXIgc2VuZENvb3JkcyA9IGZ1bmN0aW9uKGMpe1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgICAgc29ja2V0LmVtaXQoXCJjb29yZHMgbWVzc2FnZVwiLCB7XHJcbiAgICAgICAgICB4OiBjLnggLyBkYXRhLmltZ1dpZHRoLFxyXG4gICAgICAgICAgeTogYy55IC8gZGF0YS5pbWdIZWlnaHQsXHJcbiAgICAgICAgICB4MjogYy54MiAvIGRhdGEuaW1nV2lkdGgsXHJcbiAgICAgICAgICB5MjogYy55MiAvIGRhdGEuaW1nSGVpZ2h0XHJcbiAgICAgICAgfSlcclxuICAgICAgfTtcclxuICBcclxuICAgICAgdmFyIGluaXRKY3JvcCA9IGZ1bmN0aW9uKGkpe1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICBvblNlbGVjdDogc2VuZENvb3JkcyxcclxuICAgICAgICAgIGJnQ29sb3I6ICdsaWdodGdyZXknLFxyXG4gICAgICAgICAgYmdPcGFjaXR5OiBwYXJzZUludChkYXRhLm9wYWNpdHkpIC8gMTBcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciBpbWcgPSBhbmd1bGFyLmVsZW1lbnQoJyMnICsgaSk7XHJcbiAgICAgICAgZGF0YS5pbWdXaWR0aCA9IGltZy53aWR0aCgpO1xyXG4gICAgICAgIGRhdGEuaW1nSGVpZ2h0ID0gaW1nLmhlaWdodCgpO1xyXG4gICAgICAgIGltZy5KY3JvcChvcHRpb25zLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICBkYXRhLmpjcm9wX2FwaSA9IHRoaXM7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH07XHJcbiAgXHJcbiAgICAgIHRoaXMub24oXCJqY3JvcCBtZXNzYWdlXCIsIGZ1bmN0aW9uIChpKSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBpZiAoZGF0YS5qY3JvcF9hcGkpIHtcclxuICAgICAgICAgIGRhdGEuamNyb3BfYXBpLmRlc3Ryb3koKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGF0YS5zZWxlY3RlZEltYWdlID0gaTtcclxuICAgICAgICBpZiAoZGF0YS5lbmFibGVKY3JvcCl7XHJcbiAgICAgICAgICBpbml0SmNyb3AoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIFxyXG4gICAgICB0aGlzLm9uKFwiY29vcmRzIG1lc3NhZ2VcIiwgZnVuY3Rpb24gKGMpIHtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIGlmIChkYXRhLmpjcm9wX2FwaSkge1xyXG4gICAgICAgICAgZGF0YS5qY3JvcF9hcGkuc2V0T3B0aW9ucyh7XHJcbiAgICAgICAgICAgIG9uU2VsZWN0OiBudWxsXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGRhdGEuamNyb3BfYXBpLnNldFNlbGVjdChbYy54ICogZGF0YS5pbWdXaWR0aCwgYy55ICogZGF0YS5pbWdIZWlnaHQsIGMueDIgKiBkYXRhLmltZ1dpZHRoLCBjLnkyICogZGF0YS5pbWdIZWlnaHRdKTtcclxuICAgICAgICAgIGRhdGEuamNyb3BfYXBpLnNldE9wdGlvbnMoe1xyXG4gICAgICAgICAgICBvblNlbGVjdDogc2VuZENvb3Jkc1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMub24oXCJvcGFjaXR5XCIsIGZ1bmN0aW9uIChvcGFjaXR5KSB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgICBpZiAoZGF0YS5qY3JvcF9hcGkpIHtcclxuICAgICAgICAgIGRhdGEuamNyb3BfYXBpLnNldE9wdGlvbnMoe1xyXG4gICAgICAgICAgICBiZ09wYWNpdHk6IHBhcnNlSW50KG9wYWNpdHkpIC8gMTBcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgdmFyIG9wdGlvbnMgPSBkYXRhLmpjcm9wX2FwaS5nZXRPcHRpb25zKCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhvcHRpb25zKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGF0YS5vcGFjaXR5ID0gb3BhY2l0eTtcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgfVxyXG5cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYVN0b3JhZ2UuJGluamVjdCA9IFtcIiRxXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZmFjdG9yeSgncGFTdG9yYWdlJywgcGFTdG9yYWdlKTtcclxuXHJcbmZ1bmN0aW9uIHBhU3RvcmFnZSgkcSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkaHR0cCwgcGFDYWNoZSwgY29uZmlnKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIG1hcEJsb2I6IGZ1bmN0aW9uIChibG9iLCBjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICB2YXIgYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICBpZiAoY29sbGVjdGlvbiAmJiBjb2xsZWN0aW9uLnJlc291cmNlcyl7XHJcbiAgICAgICAgICAgIGFjdGl2ZSA9IF8uc29tZShjb2xsZWN0aW9uLnJlc291cmNlcywgZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAgICAgICAgIHJldHVybiByZXMubmFtZSA9PSBibG9iLk5hbWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgIG5hbWU6IGJsb2IuTmFtZSxcclxuICAgICAgICAgICAgICBmb2xkZXI6IGJsb2IuTmFtZS5pbmRleE9mKCcvJykgIT0gYmxvYi5OYW1lLmxhc3RJbmRleE9mKCcvJykgPyBibG9iLk5hbWUuc3Vic3RyaW5nKGJsb2IuTmFtZS5pbmRleE9mKCcvJykgKyAxLCBibG9iLk5hbWUubGFzdEluZGV4T2YoJy8nKSkgOiAnJyxcclxuICAgICAgICAgICAgICB0aXRsZTogYmxvYi5OYW1lLnN1YnN0cmluZyhibG9iLk5hbWUubGFzdEluZGV4T2YoJy8nKSArIDEsIGJsb2IuTmFtZS5sYXN0SW5kZXhPZignLicpKSxcclxuICAgICAgICAgICAgICBzcmM6IGNvbmZpZy5zdG9yYWdlQmFzZVVybCtcIi9cIiArIGNvbmYuY3VycmVudEZvbGRlci5jb2RlICsgXCIvXCIgKyBibG9iLk5hbWUsXHJcbiAgICAgICAgICAgICAgYWN0aXZlOiBhY3RpdmUsXHJcbiAgICAgICAgICAgICAgY29udGVudFR5cGU6IGJsb2IuUHJvcGVydGllc1snQ29udGVudC1UeXBlJ11cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldExldmVsczogZnVuY3Rpb24gZ2V0TGV2ZWxzKHByZWZpeCkge1xyXG4gICAgICAgICAgICB2YXIgbGV2ZWxzID0gW107XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChwcmVmaXgpIHtcclxuICAgICAgICAgICAgICB2YXIgcHJldiA9ICcnO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAgIF8uZWFjaChwcmVmaXguc3BsaXQoJy8nKSwgZnVuY3Rpb24gKGwpIHtcclxuICAgICAgICAgICAgICAgIGlmIChsKSB7XHJcbiAgICAgICAgICAgICAgICAgIHByZXYgPSBwcmV2ICsgbCArICcvJztcclxuICAgICAgICAgICAgICAgICAgbGV2ZWxzLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGwsXHJcbiAgICAgICAgICAgICAgICAgICAgcHJlZml4OiBwcmV2XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiBsZXZlbHM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBsb2FkQmxvYnM6IGZ1bmN0aW9uIChwcmVmaXgsIGNvbnRlbnRUeXBlLCBjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICAgICAgaWYgKGNvbmYuY3VycmVudEZvbGRlci5jb2RlKXtcclxuICAgICAgICAgICAgICBjb25mLnN0b3JhZ2U9e1xyXG4gICAgICAgICAgICAgICAgYmxvYnM6IFtdLFxyXG4gICAgICAgICAgICAgICAgZGlyZWN0b3JpZXM6IFtdLFxyXG4gICAgICAgICAgICAgICAgbGV2ZWxzOiBzZWxmLmdldExldmVscyhwcmVmaXgpXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYnJvd3NlJywge1xyXG4gICAgICAgICAgICAgICAgZm9sZGVyOiBjb25mLmN1cnJlbnRGb2xkZXIuY29kZSxcclxuICAgICAgICAgICAgICAgIHByZWZpeDogcHJlZml4XHJcbiAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3AuZGF0YS5CbG9iKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBmaWx0ID0gXy5maWx0ZXIoW10uY29uY2F0KHJlc3AuZGF0YS5CbG9iKSwgZnVuY3Rpb24oYmxvYil7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnRUeXBlLmluZGV4T2YoYmxvYi5Qcm9wZXJ0aWVzW1wiQ29udGVudC1UeXBlXCJdKSAhPSAtMTtcclxuICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgIGNvbmYuc3RvcmFnZS5ibG9icyA9IF8ubWFwKGZpbHQsIGZ1bmN0aW9uKGJsb2Ipe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLm1hcEJsb2IoYmxvYiwgY29sbGVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcC5kYXRhLkJsb2JQcmVmaXgpIHtcclxuICAgICAgICAgICAgICAgICAgY29uZi5zdG9yYWdlLmRpcmVjdG9yaWVzID0gXy5tYXAoW10uY29uY2F0KHJlc3AuZGF0YS5CbG9iUHJlZml4KSwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcHJlZml4OiBkLk5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBkLk5hbWUuc3Vic3RyaW5nKHByZWZpeCA/IHByZWZpeC5sZW5ndGggOiAwLCBkLk5hbWUubGVuZ3RoIC0gMSlcclxuICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gICAgICAgIFxyXG4gICAgfSAgIFxyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYVN0dWRlbnQuJGluamVjdCA9IFtcIiRxXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZmFjdG9yeSgncGFTdHVkZW50JywgcGFTdHVkZW50KTtcclxuXHJcbmZ1bmN0aW9uIHBhU3R1ZGVudCgkcSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkaHR0cCwgcGFDYWNoZSwgY29uZmlnKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGdldFN1YnNjcmlwdGlvbnM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9tZW51L2ZpbmRBbGxGb2xkZXJzJykudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICAgIHZhciBhbGxGb2xkZXJzID0gXy5pbmRleEJ5KHJlc3AuZGF0YSwnY29kZScpO1xyXG4gICAgICAgICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kU3Vic2NyaXB0aW9ucy8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgICAgICAgIHBhZ2VTY29wZS5zdWJzY3JpcHRpb25zID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgXy5lYWNoKHBhZ2VTY29wZS5zdWJzY3JpcHRpb25zLCBmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAgICAgICAgICAgICBzdWJzY3Iuc3R1ZGVudC5mb2xkZXIgPSBhbGxGb2xkZXJzW3N1YnNjci5zdHVkZW50LmNvdXJzZV07XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kVXNlclN1YnNjcmlwdGlvbnMvJyArICRyb290U2NvcGUudXNlci50ZWFjaGVyKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2NvcGUudmFsaWRTdHVkZW50cyA9IF8uaW5kZXhCeShyZXNwLmRhdGEsJ3N0dWRlbnQnKTtcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlbW92ZVN1YnNjcmlwdGlvbjogZnVuY3Rpb24gKHN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9yZW1vdmVTdWJzY3JpcHRpb24vJyArIHN1YnNjcmlwdGlvbi5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuZ2V0U3Vic2NyaXB0aW9ucygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LCAgICAgICAgXHJcbiAgICAgICAgZ2V0R3JvdXBzOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy90ZWFjaGVycy8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIgKyAnL2dyb3VwcycpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgICAgICAgIHBhZ2VTY29wZS5ncm91cHMgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2F2ZUdyb3VwIDogZnVuY3Rpb24oZ3JvdXApe1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgIHZhciBjb25mPXBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgICAgICB2YXIgdG89KGNvbmYub3JnYW5pemF0aW9uKT8nb3JnLWdyb3Vwcyc6J3N0dWRlbnRzJztcclxuICAgICAgICAgICAgZ3JvdXAuc3Vic2NyaXB0aW9ucyA9IF8uZmlsdGVyKHBhZ2VTY29wZS5zdWJzY3JpcHRpb25zLCAnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgIGlmKGdyb3VwLl9pZCl7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy93cy9ncm91cHMvJytncm91cC5faWQsIGdyb3VwKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbyh0byk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy93cy9ncm91cHMnLCBncm91cCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28odG8pO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVtb3ZlR3JvdXA6IGZ1bmN0aW9uKGdyb3VwKXtcclxuICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCcvd3MvZ3JvdXBzLycrZ3JvdXAuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgIHZhciBjb25mPXBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgICAgICAgIGlmKGNvbmYub3JnYW5pemF0aW9uKXtcclxuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnb3JnLWdyb3VwcycpO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3N0dWRlbnRzJyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbG9hZEZvbGRlcnM6IGZ1bmN0aW9uIGxvYWRGb2xkZXJzKCkge1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9tZW51L2ZpbmRBbGxGb2xkZXJzJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgcGFnZVNjb3BlLmFsbEZvbGRlcnMgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlZGl0U3R1ZGVudDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBwYWdlU2NvcGU9cGFDYWNoZS5nZXRQYWdlU2NvcGUoKTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRVc2VyL3N0dWRlbnQvJyArICRzdGF0ZS5wYXJhbXMuaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgICAgICBpZiAocmVzcC5kYXRhKXtcclxuICAgICAgICAgICAgICAgIHBhZ2VTY29wZS51c2VyID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2NvcGUudXNlciA9IHtsb2NhbDp7fX07XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRTdHVkZW50LycgKyAkc3RhdGUucGFyYW1zLmlkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICAgcGFnZVNjb3BlLnN0dWRlbnQgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3Mvc3R1ZGVudHMvJysgJHN0YXRlLnBhcmFtcy5pZCArICcvZ3JvdXBzJykudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgIHZhciBncm91cEluZGV4ID0gXy5pbmRleEJ5KHJlc3AuZGF0YSwgJ2dyb3VwJyk7XHJcbiAgICAgICAgICAgICAgICBfLmVhY2gocGFnZVNjb3BlLmdyb3VwcywgZnVuY3Rpb24oZ3JvdXApe1xyXG4gICAgICAgICAgICAgICAgICAgIGdyb3VwLmFjdGl2ZT1fLmhhcyhncm91cEluZGV4LCBncm91cC5faWQpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIGFkZFN0dWRlbnQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgIHZhciBjb25mPXBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgICAgICBwYWdlU2NvcGUuc3R1ZGVudCA9IHtvcmdhbml6YXRpb246Y29uZi5vcmdhbml6YXRpb259O1xyXG4gICAgICAgICAgICBwYWdlU2NvcGUudXNlciA9IHt9O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXHJcbiAgICAgICAgc2F2ZVN0dWRlbnQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgIHZhciBjb25mPXBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgICAgICBpZihjb25mLm9yZ2FuaXphdGlvbil7XHJcblxyXG4gICAgICAgICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYWRkU3R1ZGVudCcsIHBhZ2VTY29wZS5zdHVkZW50KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2NvcGUudXNlci5yb2xlID0gJ1MnO1xyXG4gICAgICAgICAgICAgICAgcGFnZVNjb3BlLnVzZXIuc3R1ZGVudCA9IHJlc3AuZGF0YS5faWQ7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2FkZFVzZXInLCBwYWdlU2NvcGUudXNlcikudGhlbihmdW5jdGlvbiAocmVzcDMpIHtcclxuICAgICAgICAgICAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25Ubygnb3JnLXN0dWRlbnRzJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICB9KTtcclxuICBcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9hZGRTdHVkZW50JywgcGFnZVNjb3BlLnN0dWRlbnQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYWRkU3Vic2NyaXB0aW9uLycgKyAkcm9vdFNjb3BlLnVzZXIudGVhY2hlciArIFwiL1wiICsgcmVzcC5kYXRhLl9pZCkudGhlbihmdW5jdGlvbiAocmVzcDIpIHtcclxuICAgICAgICAgICAgICAgICAgcGFnZVNjb3BlLnVzZXIucm9sZSA9ICdTJztcclxuICAgICAgICAgICAgICAgICAgcGFnZVNjb3BlLnVzZXIuc3R1ZGVudCA9IHJlc3AuZGF0YS5faWQ7XHJcbiAgICAgICAgICAgICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYWRkVXNlcicsIHBhZ2VTY29wZS51c2VyKS50aGVuKGZ1bmN0aW9uIChyZXNwMykge1xyXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ3N0dWRlbnRzJyk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIFxyXG4gICAgICAgIHVwZGF0ZVN0dWRlbnQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgIHZhciBjb25mPXBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICAgICAgICB2YXIgdG8gPSAoY29uZi5vcmdhbml6YXRpb24pPydvcmctc3R1ZGVudHMnOidzdHVkZW50cyc7XHJcblxyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVTdHVkZW50LycgKyBwYWdlU2NvcGUuc3R1ZGVudC5faWQsIHBhZ2VTY29wZS5zdHVkZW50KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICAgcGFnZVNjb3BlLnVzZXIucm9sZSA9ICdTJztcclxuICAgICAgICAgICAgICBwYWdlU2NvcGUudXNlci5zdHVkZW50ID0gcmVzcC5kYXRhLl9pZDtcclxuICAgICAgICAgICAgICBpZiAocGFnZVNjb3BlLnVzZXIuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVVc2VyLycgKyBwYWdlU2NvcGUudXNlci5faWQsIHBhZ2VTY29wZS51c2VyKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8odG8pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYWRkVXNlcicsIHBhZ2VTY29wZS51c2VyKS50aGVuKGZ1bmN0aW9uIChyZXNwMykge1xyXG4gICAgICAgICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKHRvKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcclxuICAgICAgICBzYXZlT3JVcGRhdGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgIHBhZ2VTY29wZS5lcnJvcnMgPSB7fTtcclxuICAgICAgICAgICAgcGFnZVNjb3BlLnN0dWRlbnQuZ3JvdXBzID0gXy5maWx0ZXIocGFnZVNjb3BlLmdyb3VwcywnYWN0aXZlJyk7XHJcblxyXG4gICAgICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvZmluZFVzZXIvJyArIHBhZ2VTY29wZS51c2VyLmxvY2FsLnVzZXJuYW1lKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICAgaWYgKCFyZXNwLmRhdGEgfHwgcmVzcC5kYXRhLl9pZCA9PSBwYWdlU2NvcGUudXNlci5faWQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwYWdlU2NvcGUuc3R1ZGVudC5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZVN0dWRlbnQoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlU3R1ZGVudCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2NvcGUuZXJyb3JzLnVzZXJuYW1lID0gcGFnZVNjb3BlLnVzZXIubG9jYWwudXNlcm5hbWUgKyAnIGFscmVhZHkgZXhpc3RzLiBQbGVhc2UgY2hvb3NlIGEgZGlmZmVyZW50IHVzZXJuYW1lLic7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBmaW5kU3R1ZGVudChpZCkge1xyXG4gICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICRodHRwLmdldCgnL3dzL2ZpbmRTdHVkZW50LycraWQpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdXBkYXRlU3Vic2NyaXB0aW9uOiBmdW5jdGlvbihzdWJzY3IpIHtcclxuICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAkaHR0cC5wb3N0KCcvd3MvYWRkU3Vic2NyaXB0aW9uLycrc3Vic2NyLnRlYWNoZXIrJy8nK3N1YnNjci5zdHVkZW50KS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGdldE9yZ2FuaXphdGlvblN0dWRlbnRzOiBmdW5jdGlvbihvcmcpe1xyXG4gICAgICAgICAgJGh0dHAuZ2V0KCcvd3Mvb3JnYW5pemF0aW9ucy8nK29yZysnL3N0dWRlbnRzJykudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgdmFyIHBhZ2VTY29wZSA9IHBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgIHBhZ2VTY29wZS5zdHVkZW50cyA9IHJlc3AuZGF0YTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZ2V0T3JnYW5pemF0aW9uU3R1ZGVudFN1YnNjcmlwdGlvbnM6IGZ1bmN0aW9uKG9yZyl7XHJcbiAgICAgICAgICAkaHR0cC5nZXQoJy93cy9vcmdhbml6YXRpb25zLycrb3JnKycvc3R1ZGVudHMnKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlID0gcGFDYWNoZS5nZXRQYWdlU2NvcGUoKTtcclxuICAgICAgICAgICAgcGFnZVNjb3BlLnN1YnNjcmlwdGlvbnMgPSBfLm1hcChyZXNwLmRhdGEsZnVuY3Rpb24oc3R1ZGVudCl7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHtzdHVkZW50OnN0dWRlbnR9O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgdW5saW5rU3R1ZGVudEZyb21Pcmdhbml6YXRpb246IGZ1bmN0aW9uKHN0dWRlbnQpIHtcclxuICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAkaHR0cC5kZWxldGUoJy93cy9zdHVkZW50cy8nK3N0dWRlbnQuX2lkKycvdW5saW5rJykudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBnZXRPcmdhbml6YXRpb25Hcm91cHM6IGZ1bmN0aW9uKG9yZyl7XHJcbiAgICAgICAgICAkaHR0cC5nZXQoJy93cy9vcmdhbml6YXRpb25zLycrb3JnKycvZ3JvdXBzJykudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgdmFyIHBhZ2VTY29wZSA9IHBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgIHBhZ2VTY29wZS5ncm91cHMgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHN1YnNjcmliZVN0dWRlbnQ6IGZ1bmN0aW9uKHRlYWNoZXIsc3R1ZGVudCl7XHJcbiAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgJGh0dHAucG9zdCgnL3dzL2FkZFN1YnNjcmlwdGlvbi8nK3RlYWNoZXIrJy8nK3N0dWRlbnQpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHN1YnNjcmliZUdyb3VwOiBmdW5jdGlvbih0ZWFjaGVyLGdyb3VwKXtcclxuICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAkaHR0cC5wb3N0KCcvd3MvYWRkR3JvdXBTdWJzY3JpcHRpb24vJyt0ZWFjaGVyKycvJytncm91cCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxufSIsIlxyXG5cInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhU3R5bGUuJGluamVjdCA9IFtcIiRxXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiLCBcInRvYXN0ZXJcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmZhY3RvcnkoJ3BhU3R5bGUnLCBwYVN0eWxlKTtcclxuXHJcbmZ1bmN0aW9uIHBhU3R5bGUoJHEsICRyb290U2NvcGUsICRzdGF0ZSwgJGh0dHAsIHBhQ2FjaGUsIGNvbmZpZywgdG9hc3Rlcikge1xyXG4gIHJldHVybiB7XHJcbiAgICBsb2FkR2xvYmFsU3R5bGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3N0eWxlcy9nbG9iYWwvJyArICRyb290U2NvcGUudXNlci5jaGFubmVsKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgaWYgKHJlc3AuZGF0YSl7XHJcbiAgICAgICAgICBjb25mLmNzcyA9IF8uaW5kZXhCeShyZXNwLmRhdGEsICduYW1lJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghY29uZi5jc3MuZ2VuZXJhbCkge1xyXG4gICAgICAgICAgY29uZi5jc3MuZ2VuZXJhbCA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ2dlbmVyYWwnLFxyXG4gICAgICAgICAgICBnbG9iYWw6dHJ1ZSxcclxuICAgICAgICAgICAgdGVhY2hlcjogJHJvb3RTY29wZS51c2VyLmNoYW5uZWwsXHJcbiAgICAgICAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgICAgICAgJ2JhY2tncm91bmQnOiAnI2ZmZidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBsb2FkUGFnZVN0eWxlczogZnVuY3Rpb24gKCkge1xyXG4gICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3Mvc3R5bGVzL3BhZ2VzLycgKyBjb25mLmN1cnJlbnRQYWdlLl9pZCArICcvJyArICRyb290U2NvcGUudXNlci5jaGFubmVsKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgaWYgKHJlc3AuZGF0YSkge1xyXG4gICAgICAgICAgZGF0YS5jc3MgPSBfLmluZGV4QnkocmVzcC5kYXRhLCAnbmFtZScpO1xyXG4gICAgICAgICAgaWYgKCFkYXRhLmNzcy5jYXJkKXtcclxuICAgICAgICAgICAgZGF0YS5jc3MuY2FyZCA9IHtcclxuICAgICAgICAgICAgICBuYW1lOiAnY2FyZCcsXHJcbiAgICAgICAgICAgICAgZ2xvYmFsOmZhbHNlLFxyXG4gICAgICAgICAgICAgIHRlYWNoZXI6ICRyb290U2NvcGUudXNlci5jaGFubmVsLFxyXG4gICAgICAgICAgICAgIHBhZ2U6IGNvbmYuY3VycmVudFBhZ2UuX2lkLFxyXG4gICAgICAgICAgICAgIC8vc3R5bGU6IGNvbmYuY3NzLmNhcmQuc3R5bGVcclxuICAgICAgICAgICAgICBzdHlsZToge1xyXG4gICAgICAgICAgICAgICAgJ2JvcmRlci13aWR0aCc6ICcxcHgnLFxyXG4gICAgICAgICAgICAgICAgJ2JvcmRlci1jb2xvcic6ICcjZGRkJyxcclxuICAgICAgICAgICAgICAgICdib3JkZXItc3R5bGUnOiAnc29saWQnLFxyXG4gICAgICAgICAgICAgICAgJ2JhY2tncm91bmQtY29sb3InOiAnI2ZmZidcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgc2F2ZVN0eWxlOiBmdW5jdGlvbiAoc3R5bGUpIHtcclxuICAgICAgdmFyIHNlbGY9dGhpcztcclxuICAgICAgaWYgKHN0eWxlLl9pZCkge1xyXG4gICAgICAgICRodHRwLnB1dChjb25maWcuYXBpVXJsICsgJy93cy9zdHlsZXMvJyArIHN0eWxlLl9pZCwgc3R5bGUpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgIGlmIChyZXNwLmRhdGEuZ2xvYmFsKSB7XHJcbiAgICAgICAgICAgIHNlbGYubG9hZEdsb2JhbFN0eWxlKCk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzZWxmLmxvYWRQYWdlU3R5bGVzKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsICdTdHlsZScsICdTdHlsZSBzYXZlIHN1Y2Nlc2Z1bGx5Jyk7XHJcbiAgICAgICAgfSlcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3N0eWxlcycsIHN0eWxlKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICBpZiAocmVzcC5kYXRhLmdsb2JhbCkge1xyXG4gICAgICAgICAgICBzZWxmLmxvYWRHbG9iYWxTdHlsZSgpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2VsZi5sb2FkUGFnZVN0eWxlcygpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCAnU3R5bGUnLCAnU3R5bGUgc2F2ZSBzdWNjZXNmdWxseScpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICByZW1vdmVTdHlsZTogZnVuY3Rpb24oc3R5bGUpe1xyXG4gICAgICAkaHR0cC5kZWxldGUoY29uZmlnLmFwaVVybCArICcvd3Mvc3R5bGVzLycgKyBzdHlsZS5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsICdTdHlsZScsICdTdHlsZSByZW1vdmVkIHN1Y2Nlc2Z1bGx5Jyk7XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFTdWJzY3JpcHRpb24gLiRpbmplY3QgPSBbXCIkcVwiLCBcIiRyb290U2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkaHR0cFwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmZhY3RvcnkoJ3BhU3Vic2NyaXB0aW9uJywgcGFTdWJzY3JpcHRpb24gKTtcclxuXHJcbmZ1bmN0aW9uIHBhU3Vic2NyaXB0aW9uICgkcSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkaHR0cCwgcGFDYWNoZSwgY29uZmlnKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGdldE9yZ2FuaXphdGlvblN1YnNjcmlwdGlvbnM6IGZ1bmN0aW9uKG9yZyl7XHJcbiAgICAgICAgICAgICRodHRwLmdldCgnL3dzL29yZ2FuaXphdGlvbnMvJytvcmcrJy9zdWJzY3JpcHRpb25zJylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdlU2NvcGU9cGFDYWNoZS5nZXRQYWdlU2NvcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBwYWdlU2NvcGUuc3Vic2NyaXB0aW9ucyA9IHJlc3AuZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXRUZWFjaGVyc0ZvclN1YnNjcmlwdGlvbjogZnVuY3Rpb24oc3Vic2NyKXtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvd3Mvc3Vic2NyaXB0aW9ucy8nK3N1YnNjcisnL3RlYWNoZXJzJylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYWdlU2NvcGU9cGFDYWNoZS5nZXRQYWdlU2NvcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICBwYWdlU2NvcGUudGVhY2hlcnMgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGlua1N1YnNjcmlwdGlvblRvVGVhY2hlcjogZnVuY3Rpb24oc3Vic2NyLCB0ZWFjaGVyKXtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAucHV0KCcvd3Mvc3Vic2NyaXB0aW9ucy8nK3N1YnNjci5faWQrJy90ZWFjaGVycy8nK3RlYWNoZXIuX2lkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdW5saW5rU3Vic2NyaXB0aW9uRnJvbVRlYWNoZXI6IGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnL3dzL3N1YnNjcmlwdGlvbnMvJytzdWJzY3IuX2lkKycvdGVhY2hlcnMvJytzdWJzY3IudGVhY2hlci5faWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBmaW5kU3R1ZGVudFN1YnNjcmlwdGlvbjogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3dzL2ZpbmRTdWJzY3JpcHRpb24nLHtzdHVkZW50OiRyb290U2NvcGUudXNlci5zdHVkZW50fSkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbG9hZFBlbmRpbmdTdWJzY3JpcHRpb25zOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICB2YXIgZXZlbnRzID0gcGFDYWNoZS5nZXRFdmVudHMoKTtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvd3MvZmluZFBlbmRpbmdTdWJzY3JpcHRpb25zLycrJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICAgIGV2ZW50cy5wZW5kaW5nU3Vic2NyaXB0aW9ucyA9IHJlc3AuZGF0YS5sZW5ndGg7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZW5kU3Vic2NyaXB0aW9uUmVxdWVzdDogZnVuY3Rpb24odGVhY2hlcil7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJy93cy9yZXF1ZXN0U3Vic2NyaXB0aW9uLycrdGVhY2hlcisnLycrJHJvb3RTY29wZS51c2VyLnN0dWRlbnQpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJldm9rZVN1YnNjcmlwdGlvblJlcXVlc3Q6IGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnL3dzL3JlcXVlc3RTdWJzY3JpcHRpb24vJytzdWJzY3IuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhY2NlcHRTdWJzY3JpcHRpb25SZXF1ZXN0OiBmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5wdXQoJy93cy9yZXF1ZXN0U3Vic2NyaXB0aW9uLycrc3Vic2NyLl9pZCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhVGVhY2hlci4kaW5qZWN0ID0gW1wiJHFcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJGh0dHBcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5mYWN0b3J5KCdwYVRlYWNoZXInLCBwYVRlYWNoZXIpO1xyXG5cclxuZnVuY3Rpb24gcGFUZWFjaGVyKCRxLCAkcm9vdFNjb3BlLCAkc3RhdGUsICRodHRwLCBwYUNhY2hlLCBjb25maWcpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgZ2V0T3JnYW5pemF0aW9uVGVhY2hlcnM6IGZ1bmN0aW9uKG9yZykge1xyXG4gICAgICAgICAgICB2YXIgcGFnZVNjb3BlPXBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvZmluZFRlYWNoZXJzJywge29yZ2FuaXphdGlvbjogb3JnfSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICAgICAgcGFnZVNjb3BlLnRlYWNoZXJzID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldEZvbGRlclN1YnNjcmlwdGlvbnM6IGZ1bmN0aW9uKHRlYWNoZXIpe1xyXG4gICAgICAgICAgdmFyIHBhZ2VTY29wZT1wYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG4gICAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL21lbnUvZm9sZGVyU3Vic2NyaXB0aW9ucy8nK3RlYWNoZXIuX2lkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICBwYWdlU2NvcGUuZm9sZGVyU3Vic2NyaXB0aW9ucyA9IHJlc3AuZGF0YTtcclxuICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGlua1RlYWNoZXJUb09yZ2FuaXphdGlvbjogZnVuY3Rpb24odGVhY2hlciwgb3JnYW5pemF0aW9uKSB7XHJcbiAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgJGh0dHAucG9zdCgnL3dzL29yZ2FuaXphdGlvbnMvJytvcmdhbml6YXRpb24rJy90ZWFjaGVycy8nK3RlYWNoZXIpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICB1bmxpbmtUZWFjaGVyRnJvbU9yZ2FuaXphdGlvbjogZnVuY3Rpb24odGVhY2hlciwgb3JnYW5pemF0aW9uKSB7XHJcbiAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgJGh0dHAuZGVsZXRlKCcvd3Mvb3JnYW5pemF0aW9ucy8nK29yZ2FuaXphdGlvbisnL3RlYWNoZXJzLycrdGVhY2hlcilcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGdldE9yZ2FuaXphdGlvblRlYWNoZXJzQnlGb2xkZXI6IGZ1bmN0aW9uKG9yZywgZm9sZGVyKXtcclxuICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAkaHR0cC5nZXQoJy93cy9vcmdhbml6YXRpb25zLycrb3JnKycvdGVhY2hlcnMvZm9sZGVycy8nK2ZvbGRlcilcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGxvYWRDZXJ0aWZpY2F0ZXM6ZnVuY3Rpb24odGVhY2hlcil7XHJcbiAgICAgICAgICB2YXIgcGFnZVNjb3BlID0gcGFDYWNoZS5nZXRQYWdlU2NvcGUoKTtcclxuICAgICAgICAgICRodHRwLmdldCgnL3dzL3RlYWNoZXJzLycrdGVhY2hlcisnL2NlcnRpZmljYXRlcycpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgIHBhZ2VTY29wZS5jZXJ0aWZpY2F0ZXMgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZ2V0VmtQcm9maWxlOmZ1bmN0aW9uKGlkKXtcclxuICAgICAgICAgIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG4gICAgICAgICAgJGh0dHAuZ2V0KCcvd3MvdXNlcnMvJytpZCsnL3ZrJylcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgcGFnZVNjb3BlLnZrID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIGdldFpvb21Qcm9maWxlOmZ1bmN0aW9uKGlkKXtcclxuICAgICAgICAgIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG4gICAgICAgICAgJGh0dHAuZ2V0KCcvd3MvdXNlcnMvJytpZCsnL3pvb20nKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICBwYWdlU2NvcGUuem9vbSA9IHJlc3AuZGF0YTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBnZXRNaXJnb3Zvcml0UHJvZmlsZTpmdW5jdGlvbihpZCl7XHJcbiAgICAgICAgICB2YXIgcGFnZVNjb3BlID0gcGFDYWNoZS5nZXRQYWdlU2NvcGUoKTtcclxuICAgICAgICAgICRodHRwLmdldCgnL3dzL3VzZXJzLycraWQrJy9taXJnb3Zvcml0JylcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgcGFnZVNjb3BlLm1pcmdvdm9yaXQgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgZ2V0VGVhY2hlck1pcmdvdm9yaXRQcm9maWxlOmZ1bmN0aW9uKGlkKXtcclxuICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAkaHR0cC5nZXQoJy93cy90ZWFjaGVycy8nK2lkKycvbWlyZ292b3JpdCcpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgfVxyXG59IiwiLyouZmFjdG9yeSgndGltZXN0YW1wTWFya2VyJywgWyckcm9vdFNjb3BlJywgJyRsb2cnLCAnTG9nZ2x5TG9nZ2VyJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvZywgTG9nZ2x5TG9nZ2VyKSB7ICBcclxuICAgIHZhciB0aW1lc3RhbXBNYXJrZXIgPSB7XHJcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24oY29uZmlnKSB7XHJcbiAgICAgICAgXHRpZiAoY29uZmlnLnVybC5pbmRleE9mKCcvd3MvJykgIT0gLTEpe1xyXG5cdFx0ICAgICAgICBjb25maWcucmVxdWVzdFRpbWVzdGFtcCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgIFx0XHRMb2dnbHlMb2dnZXIuc2VuZE1lc3NhZ2Uoe1xyXG5cdFx0XHRcdFx0dXNlcm5hbWU6ICRyb290U2NvcGUudXNlci51c2VybmFtZSxcclxuXHRcdFx0XHRcdHVybDogY29uZmlnLnVybCwgXHJcblx0XHRcdFx0XHRkYXRhOiBjb25maWcuZGF0YSwgXHJcblx0XHRcdFx0XHRtZXNzYWdlOiAnc3RhcnQnXHJcblx0XHRcdFx0fSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgIFx0aWYgKHJlc3BvbnNlLmNvbmZpZy51cmwuaW5kZXhPZignL3dzLycpICE9IC0xKXtcclxuXHQgICAgICAgIFx0dmFyIHQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHJlc3BvbnNlLmNvbmZpZy5yZXF1ZXN0VGltZXN0YW1wO1xyXG4gICAgICAgIFx0XHRMb2dnbHlMb2dnZXIuc2VuZE1lc3NhZ2Uoe1xyXG5cdFx0XHRcdFx0dXNlcm5hbWU6ICRyb290U2NvcGUudXNlci51c2VybmFtZSxcclxuXHRcdFx0XHRcdHVybDogcmVzcG9uc2UuY29uZmlnLnVybCwgXHJcblx0XHRcdFx0XHRkYXRhOiByZXNwb25zZS5kYXRhLCBcclxuXHRcdFx0XHRcdGR1cmF0aW9uOiB0LCBcclxuXHRcdFx0XHRcdG1lc3NhZ2U6ICdlbmQnXHJcblx0XHRcdFx0fSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gdGltZXN0YW1wTWFya2VyO1xyXG59XSkqLyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxud2ViaW5hclNlcnZpY2UuJGluamVjdCA9IFtcIiRxXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZmFjdG9yeSgnd2ViaW5hclNlcnZpY2UnLCB3ZWJpbmFyU2VydmljZSk7XHJcblxyXG5mdW5jdGlvbiB3ZWJpbmFyU2VydmljZSgkcSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkaHR0cCwgcGFDYWNoZSwgY29uZmlnKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGxvYWRVcGNvbWluZ1dlYmluYXI6IGZ1bmN0aW9uKHRlYWNoZXJJZCl7XHJcbiAgICAgICAgICAgIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJy93cy90ZWFjaGVycy8nK3RlYWNoZXJJZCsnL3dlYmluYXJTdWJzY3JpcHRpb24nKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgdmFyIHdlYmluYXJTdWJzY3JpcHRpb24gPSAocmVzcC5kYXRhKSA/IHJlc3AuZGF0YSA6IHt9O1xyXG4gICAgICAgICAgICAgICAgcGFnZVNjb3BlLndlYmluYXJTdWJzY3JpcHRpb24gPSB3ZWJpbmFyU3Vic2NyaXB0aW9uO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF3ZWJpbmFyU3Vic2NyaXB0aW9uLndlYmluYXIgfHwgRGF0ZS5wYXJzZSh3ZWJpbmFyU3Vic2NyaXB0aW9uLndlYmluYXIuZGF0ZSkgPiBEYXRlLm5vdygpKXtcclxuICAgICAgICAgICAgICAgICAgICBwYWdlU2NvcGUudXBjb21pbmdXZWJpbmFyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxvYWRXZWJpbmFyczogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3dlYmluYXJzL3VwY29taW5nJykudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHdlYmluYXJzID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBfLmVhY2god2ViaW5hcnMsIGZ1bmN0aW9uICh3ZWJpbmFyKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICghd2ViaW5hci5hdHRlbmRlZU5vKXtcclxuICAgICAgICAgICAgICAgICAgICB3ZWJpbmFyLmF0dGVuZGVlTm89NjtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAvKiRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy93ZWJpbmFycy8nICsgd2ViaW5hci5faWQgKyAnL3N1YnNjcmlwdGlvbnMnKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2ViaW5hci5zdWJzY3JpcHRpb25zID0gcmVzcC5kYXRhLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgICAgfSk7Ki9cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG4gICAgICAgICAgICAgICAgcGFnZVNjb3BlLndlYmluYXJzID0gd2ViaW5hcnM7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB1cGRhdGVTdWJzY3JpcHRpb246IGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XHJcbiAgICAgICAgICAgICRodHRwLnBvc3QoJy93cy93ZWJpbmFycy8nK3N1YnNjci53ZWJpbmFyLl9pZCsnL3N1YnNjcmlwdGlvbnMvJyskcm9vdFNjb3BlLnVzZXIudGVhY2hlcikudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5yZXNvbHZlKHJlc3AuZGF0YSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVtb3ZlU3Vic2NyaXB0aW9uOiBmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJy93cy93ZWJpbmFyU3Vic2NyaXB0aW9ucy8nK3N1YnNjci5faWQpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucmVzb2x2ZShyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iXX0=