"use strict";

adminController.$inject = ["$scope", "$http", "$state", "$stateParams", "$uibModal", "$rootScope", "paCache", "paAcl", "config"];
angular.module('paApp').controller('adminController', adminController);

function adminController($scope, $http, $state, $stateParams, $uibModal, $rootScope, paCache, paAcl, config) {
  var conf = paCache.getConf();
  $scope.init = function () {
    $scope.tab = 1;
    $scope.loadResources();
    $scope.conf = paCache.getConf();
    $scope.options = _.extend($stateParams.options,$scope.conf.currentPage.collections);
    $scope.data = paCache.getData();
    $scope.isFolderAdmin = ($rootScope.user.role=='E' && conf.currentFolder.isAdmin);
  };

  $scope.loadResources = function () {
    $scope.page = {
      collections: [],
      texts: []
    };

    var sortFunct = function sortFunct(a, b) {
      var r = 0;
      var aa = a.name.split(/[ -.]/);
      var bb = b.name.split(/[ -.]/);

      if (aa.length > 0 && bb.length > 0) {
        var l = aa.length > bb.length ? bb.length : aa.length;
        var i = 0;

        while (i < l && r == 0) {
          var aaa = aa[i];
          var bbb = bb[i];

          if (aaa == bbb) {
            i = i + 1;
          } else if (parseInt(aaa) && parseInt(bbb)) {
            return parseInt(aaa) > parseInt(bbb) ? 1 : -1;
          } else {
            return aaa > bbb ? 1 : -1;
          }
        }
      }

      return r;
    };

    $http.get(config.apiUrl + '/ws/findCollections/' + conf.currentPage._id + '/' + $rootScope.user.channel).then(function (resp) {
      resp.data.sort(sortFunct);
      var data = paCache.getData();

      _.each(resp.data, function (coll) {
        if (data.selCollections){
          var s = data.selCollections[coll.type];
          if (s) {
            coll.selected = s == coll._id || s == coll.parent;
          }
        }

        coll.isPrivate = coll.teacher && !coll.parent;
      });

      $scope.page.collections = resp.data;
    });
  };

  $scope.copyCollection = function (coll) {
    var c = {
      name: coll.name+' - Copy',
      page: coll.page,
      folder: coll.folder,
      type: coll.type,
      teacher: $rootScope.user.channel
    };
    if (coll.type=='mixed'||coll.type=='mixed2'){
      $state.transitionTo('copy-collection-mixed', {
        collection: c,
        copyFrom: coll._id,
        options: $scope.options
      });
    } else if (coll.type=='grid'){
      $state.transitionTo('copy-collection-grid', {
        collection: c,
        copyFrom: coll._id,
        options: $scope.options
      });
    } else {
      $state.transitionTo('copy-collection', {
        collection: c,
        copyFrom: coll._id,
        options: $scope.options
      });
    }
  };

  $scope.editCollection = function (coll) {
    $http.get(config.apiUrl + '/ws/collections/' + coll._id).then(function(res){

      $state.transitionTo('edit-collection', {
        collection: res.data,
        options: $scope.options,
        tab: 2
      });

    })
  };

  $scope.editCollectionNew = function (coll) {
    $http.get(config.apiUrl + '/ws/collections/' + coll._id).then(function(res){

      $state.transitionTo('collection-'+coll.type, {
        collection: res.data,
        options: $scope.options,
        tab: 2
      });

    })
  };

  $scope.renameCollection = function (coll) {
    $http.get(config.apiUrl + '/ws/collections/' + coll._id).then(function(res){

      $state.transitionTo('edit-collection', {
        collection: res.data,
        options: $scope.options,
        tab: 0
      });

    })
  };

  $scope.labelPanel = function (coll) {
    $http.get(config.apiUrl + '/ws/collections/' + coll._id).then(function(res){

      $state.transitionTo('edit-collection', {
        collection: res.data,
        options: $scope.options,
        tab: 3
      });

    })
  };

  $scope.sizeFactorPanel = function (coll) {
    $http.get(config.apiUrl + '/ws/collections/' + coll._id).then(function(res){

      $state.transitionTo('edit-collection', {
        collection: res.data,
        options: $scope.options,
        tab: 4
      });

    })
  };

  $scope.addCollection = function (type) {
    var conf = paCache.getConf();
    var c = {
      page: conf.currentPage._id,
      folder: conf.currentFolder._id,
      type: type,
      teacher: $rootScope.user.channel
    };
    $state.transitionTo('add-collection', {
      collection: c,
      options: $scope.options
    });
  };

  $scope.addCollectionNew = function (type) {
    var conf = paCache.getConf();
    var c = {
      page: conf.currentPage._id,
      folder: conf.currentFolder._id,
      type: type,
      teacher: $rootScope.channel,
      resources: []
    };
    $state.transitionTo('collection-'+type, {
      collection: c,
      options: $scope.options
    });
  };

  $scope.remove = function (collection) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.removeCollection.html?6d6ae7f2834c9218',
      controller: 'collectionRemoveCtrl',
      size: 'lg',
      resolve: {
        collection: function(){
          return collection
        }
      }

    });
    modalInstance.result.then(function () {
      $http.get(config.apiUrl + '/ws/removeCollection/' + collection._id).then(function (resp) {
        $scope.loadResources();
      });
    });
  };

  $scope.toPictogramEditor = function (res, type) {
    $state.transitionTo('edit-pictogram', {
      collection: res,
      type: type
    });
  };

  $scope.toSizeFactor = function (res) {
    $state.transitionTo('size-factor', {
      collection: res
    });
  };

  $scope.setActive = function (coll) {
    var v = {
      teacher: $rootScope.user.channel,
      page: coll.page,
      type: coll.type,
      coll: coll.selected ? coll._id : null
    };
    $http.post(config.apiUrl + '/ws/pageConf', v).then(function (resp) {
      $scope.data.selCollections = resp.data;
      $scope.loadResources();
    });
  };

  $scope.keys = function(coll) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.keys.html?ce66fbc6f1e6bcad',
      controller: 'paKeyCtrl',
      size: 'lg',
      resolve: {
        collection: function(){
          return coll
        }
      }
    });
  }
  
  $scope.init();
}
"use strict";

alertsCtrl.$inject = ["$scope", "paCache", "paService"];
angular.module('paApp').controller('alertsCtrl', alertsCtrl);

function alertsCtrl($scope, paCache, paService) {
    $scope.conf = paCache.getConf();
    paService.loadAlerts();
}
"use strict";

authCtrl.$inject = ["$window", "$state", "$stateParams"];
angular.module('paApp').controller('authCtrl', authCtrl);

function authCtrl($window, $state, $stateParams) {
    $window.localStorage.setItem('pa.token', $stateParams.token);
    $state.go('pa',{to:'dashboard'});
}
"use strict";

axerveCtrl.$inject = ["$scope", "$state", "$stateParams", "$http", "$window", "$location", "authService", "config"];
angular.module('paApp').controller('axerveCtrl', axerveCtrl);

function axerveCtrl($scope, $state, $stateParams, $http, $window, $location, authService, config){	
    
    $scope.init = function(){
        var params = $location.search();
        $http.get(config.apiUrl + '/ws/axerve/status', {params: params}).then(function (resp) {
            $scope.payment=resp.data;
        })
    }

    $scope.init();
}

"use strict";

paBookCtrl.$inject = ["$scope", "$uibModalInstance", "$http", "paCache", "config"];
angular.module('paApp').controller('paBookCtrl', paBookCtrl);

function paBookCtrl($scope, $uibModalInstance, $http, paCache, config) {
  $scope.data = paCache.getData();
  $scope.conf = paCache.getConf();

  $scope.bookmark = function () {
    var data = paCache.getData();
    var conf = paCache.getConf();
    var content = {
      img: data.selCollections.img,
      img2: data.selCollections.img2,
      audio: data.selCollections.audio,
      text: data.selCollections.text,
      text2: data.selCollections.text2,
      card: data.selCollections.card,
      mixed: data.selCollections.mixed,
      mixed2: data.selCollections.mixed2,
      grid: data.selCollections.grid,
      type: 'C',
      page: conf.currentPage,
      name: $scope.name,
      lesson: $scope.lesson
    };
    $http.post(config.apiUrl + '/ws/addContent', content).then(function (resp) {
      $uibModalInstance.close();
    });
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
}
"use strict";

paBookmarkCtrl.$inject = ["$scope", "$uibModalInstance", "$http", "paCache", "name", "config"];
angular.module('paApp').controller('paBookmarkCtrl', paBookmarkCtrl);

function paBookmarkCtrl($scope, $uibModalInstance, $http, paCache, name, config) {
  $scope.data = paCache.getData();
  $scope.conf = paCache.getConf();
  $scope.name = name;

  $scope.bookmark = function () {
    var data = paCache.getData();
    var conf = paCache.getConf();
    var content = {
      workplan: $scope.selectedWorkplan._id,
      img: data.selCollections.img,
      img2: data.selCollections.img2,
      audio: data.selCollections.audio,
      text: data.selCollections.text,
      text2: data.selCollections.text2,
      card: data.selCollections.card,
      mixed: data.selCollections.mixed,
      mixed2: data.selCollections.mixed2,
      grid: data.selCollections.grid,
      type: 'W',
      page: conf.currentPage._id,
      name: $scope.name,
      order: 100
    };
    $http.post(config.apiUrl + '/ws/addContent', content).then(function (resp) {
      console.log('content:'+resp.data);
      $uibModalInstance.close();
    });
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
}
"use strict";

paCaptureCtrl.$inject = ["$scope", "$rootScope", "$http", "$uibModalInstance", "paSocket", "paCache", "config"];
angular.module('paApp').controller("paCaptureCtrl", paCaptureCtrl);

function paCaptureCtrl($scope, $rootScope, $http, $uibModalInstance, paSocket, paCache, config) {
  $scope.capture = function (id) {
    paSocket.emit("capture-screen", id);
  };

  $scope.getSubscriptions = function () {
    $http.get(config.apiUrl + '/ws/findSubscriptions/' + $rootScope.user.channel).then(function (resp) {
      $scope.data.subscriptions = _.filter(resp.data, function (subscr) {
        return subscr.active;
      });
    });
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.init = function () {
    $scope.selected = {};
    $scope.data = paCache.getData();
    $scope.conf = paCache.getConf();
    $scope.getSubscriptions();
  };

  $scope.init();
}
"use strict";

paChangePasswordCtrl.$inject = ["$scope", "$rootScope", "$http", "$state", "toaster", "config"];
angular.module('paApp').controller('paChangePasswordCtrl', paChangePasswordCtrl);

function paChangePasswordCtrl($scope, $rootScope, $http, $state, toaster, config) {
  $scope.user = $rootScope.user;

  $scope.checkPassword = function () {
    if ($scope.user.password == $scope.user.password2) {
      savePassword();
    } else {
      $scope.error = "Passwords are not the same: re-type again";
    }
  };

  var savePassword = function savePassword() {
    $http.post(config.apiUrl + '/ws/changePassword/' + $scope.user.id, {
      password: $scope.user.password
    }).then(function (resp) {
      toaster.pop('success', 'Password', 'Password changed');
      $state.transitionTo('dashboard');
    });
  };
}
"use strict";

channelCtrl.$inject = ["$scope", "$state", "$stateParams", "$location", "paChannel", "authService"];
angular.module('paApp').controller('channelCtrl', channelCtrl);

function channelCtrl($scope, $state, $stateParams, $location, paChannel, authService) {

    var init = function() {

          var params = $location.search();
          if (params.data){

            authService.mirgovoritLogin(params.data, function (result) {
              if (result.success === true) {
                $scope.mirgovoritProfile = result.data;
                paChannel.joinChannel($stateParams.channel).then(function(channel){
                  $scope.channel=channel;
                });
  
              } else {
                $scope.error = result.error;
              }
      
            });
  
          } else {
            $scope.anonymous=true;
          }
    }

    $scope.enter = function(){
      $state.go('pa',{to:'dashboard'});
    }

    $scope.open = function(){
      paChannel.openChannel($scope.channel._id).then(function (resp) {
        $state.go('pa',{to:'dashboard'});
      });
    }

    init();
}
"use strict";

CollectionCtrl.$inject = ["$scope", "$rootScope", "$http", "$state", "$stateParams", "$uibModal", "paCache", "paAcl", "config"];
angular.module('paApp').controller('CollectionCtrl', CollectionCtrl);

function CollectionCtrl($scope, $rootScope, $http, $state, $stateParams, $uibModal, paCache, paAcl, config) {

  var conf = paCache.getConf();

  var init = function(){
    $scope.conf = conf;
    $scope.isFolderAdmin = ($rootScope.user.role=='E' && conf.currentFolder.isAdmin);

    if ($stateParams.copyFrom){
      // copy
      $http.get(config.apiUrl + '/ws/collections/' + $stateParams.copyFrom).then(function(res){
        var coll = $stateParams.collection;
        coll.resources = res.data.resources;
        coll.chars = res.data.chars;
        coll.isSystem = $scope.isFolderAdmin;
        $scope.collection = coll;
      })
    } else {
      // add or edit
      var coll = $stateParams.collection;
      coll.isSystem = $scope.isFolderAdmin;
      $scope.collection = coll;
    }
    $scope.tab = $stateParams.tab;
  
  }
 
  $scope.next = function () {
    $scope.tab = ['text', 'text2'].includes($scope.collection.type) && !$scope.collection.chars ? 1 : 2;
  };

  $scope.saveText = function () {
    // remove empty chars
    $scope.collection.chars = _.filter($scope.collection.chars, function (c) {
      return c.val != '';
    });

    if ($scope.isFolderAdmin) {
      $scope.collection.teacher = null;
      $http.post(config.apiUrl + '/ws/saveSystemCollection', $scope.collection).then(function (resp) {
        $scope.back();
      });
    } else {
      $scope.collection.teacher = $rootScope.user.channel;
      $http.post(config.apiUrl + '/ws/saveCollection', $scope.collection).then(function (resp) {
        $scope.back();
      });
    }
  };

  $scope.addText = function () {
    //$scope.collection.page = $stateParams.page;
    $scope.collection.chars = [];

    for (var i = 0, l = $scope.collection.text.length; i < l; i++) {
      $scope.collection.chars.push({
        val: $scope.collection.text.charAt(i)
      });
    }

    if ($scope.isFolderAdmin) {
      $scope.collection.teacher = null;
      $http.post(config.apiUrl + '/ws/saveSystemCollection', $scope.collection).then(function (resp) {
        $scope.collection = resp.data;
        $scope.tab = 2;
      });
    } else {
      $scope.collection.teacher = $rootScope.user.channel;
      $http.post(config.apiUrl + '/ws/saveCollection', $scope.collection).then(function (resp) {
        $scope.collection = resp.data;
        $scope.tab = 2;
      });
    }
  };

  $scope.quickInsert = function(){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.quick-insert.html?aaf52b6d1035fcd1',
      controller: 'popupResourcesCtrl',
      size: 'lg',
      resolve: {
        resource: function () {
          return null;
        },
        type: function(){
          return null;
        }
      }
  });
    modalInstance.result.then(function(text) {
      if (!$scope.collection.resources){
        $scope.collection.resources=[];
      }
  
      var lines  = text.split('\n');
      _.each(lines,function(line){
        var row={type:'mixed',resources:[]};
        $scope.collection.resources.push(row);

        var chunks = line.split('#');
        _.each(chunks, function(chunk){
          chunk = chunk.trim();
          var resource = {
            chars: [],
            type: 'text'
          };
          for (var i = 0, l = chunk.length; i < l; i++) {
            resource.chars.push({
              val: chunk.charAt(i)
            });
          }
          row.resources.push(resource);
        })      
      
      })
    });
  }

  $scope.addLine = function() {
    if (!$scope.collection.resources){
      $scope.collection.resources=[];
    }
    $scope.line={type:'mixed',resources:[]};
    $scope.collection.resources.push($scope.line);
    $scope.action=1;
  }

  $scope.editLine = function(line) {
    $scope.line=line;
    $scope.action=2;
  }

  $scope.ok = function(){
    $scope.action=0;
  }
  
  $scope.addUrlResource = function(resource){
    if (!$scope.collection.resources){
      $scope.collection.resources=[];
    }
    $scope.collection.resources.push(resource);
    $scope.resource={};
  }


  $scope.removeUrlResource = function(i){
    $scope.collection.resources.splice(i,1);
  }
  
  $scope.editResource = function (resource) {
    if (resource.type=='card'){

      $state.transitionTo('edit-card',{
        collection: $scope.collection,
        card:resource,
        options: $stateParams.options
      });

    } else {

      var modalInstance = $uibModal.open({
        animation: true,
        templateUrl: '/pa/popup.resource-edit.html?45f2ba40a23be962',
        controller: 'popupResourcesCtrl',
        size: 'lg',
        resolve: {
          resource: function () {
            return _.clone(resource);
          },
          type: function(){
            return null;
          }
        }
      });
      modalInstance.result.then(function(res) {
        _.extend(resource, res);
      });
    }

  }

  $scope.removeResource = function(resources, i){
    resources.splice(i,1);
  }

  $scope.saveCollection = function () {
    //$scope.collection.page = $stateParams.page;
    if ($scope.isFolderAdmin) {
      $scope.collection.teacher = null;
      $http.post(config.apiUrl + '/ws/saveSystemCollection', $scope.collection).then(function (resp) {
        $scope.back();
      });
    } else {
      $scope.collection.teacher = $rootScope.user.channel;
      $http.post(config.apiUrl + '/ws/saveCollection', $scope.collection).then(function (resp) {
        $scope.back();
      });
    }
  };

  $scope.back = function () {
    if ($stateParams.back=="edit-folder"){
      $state.transitionTo("edit-folder", {
        "folder": $scope.conf.currentFolder
      });
    } else {
      $state.transitionTo("admin", {
        "page": $scope.collection.page,
        "options": $stateParams.options
      });
    }
  };

  $scope.reduceSize = function (item) {
    var factor = item.sizeFactor || 1;
    item.sizeFactor = factor - 0.2;
  };

  $scope.increaseSize = function (item) {
    var factor = item.sizeFactor || 1;
    item.sizeFactor = factor + 0.2;
  };

  $scope.addResources = function(resources, type) {
    if (type=='card'){

      var r={
        type:'card',
        front:{},
        back:{}
      };
      resources.push(r);
      
      $state.transitionTo('edit-card',{
        collection: $scope.collection,
        card: r,
        options: $stateParams.options
      });

    } else {

      var modalInstance = $uibModal.open({
          animation: true,
          templateUrl: '/pa/popup.resources-add.html?a75ae1e17ab438f3',
          controller: 'popupResourcesCtrl',
          size: 'lg',
          resolve: {
            resource: function(){
              return null;
            },
            type: function(){
              return type;
            }
          }
      });
      modalInstance.result.then(function(c) {

        _.each(c.resources, function(res){
          resources.push(res);
        });

      });
    }

  }

  init();
}
"use strict";

collectionRemoveCtrl.$inject = ["$scope", "$rootScope", "$http", "$state", "$stateParams", "$uibModalInstance", "paCache", "paAcl", "config", "collection"];
angular.module('paApp').controller('collectionRemoveCtrl', collectionRemoveCtrl);

function collectionRemoveCtrl($scope, $rootScope, $http, $state, $stateParams, $uibModalInstance, paCache, paAcl, config, collection) {

  var conf = paCache.getConf();
  $scope.collection = collection;

  var init = function(){
    $scope.conf = conf;
    $scope.isFolderAdmin = ($rootScope.user.role=='E' && conf.currentFolder.isAdmin);

    var filter={};
    filter[collection.type] = collection._id;
    $http.post('/ws/findContents', filter).then(function(resp){
      $scope.contents = _.filter(resp.data, function(content){
        return content.type=='C';
      });
      $scope.workplans = _.filter(resp.data, function(content){
        return content.type=='W';
      });
      $scope.preventRemoval = !_.isEmpty($scope.contents);
    })
  }
 
  $scope.confirm = function () {
    $uibModalInstance.close();
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };

  init();
}
"use strict";

paCommentCtrl.$inject = ["$scope", "$rootScope", "$http", "$uibModalInstance", "paCache", "comment", "config"];
angular.module('paApp').controller('paCommentCtrl', paCommentCtrl);

function paCommentCtrl($scope, $rootScope, $http, $uibModalInstance, paCache, comment, config) {
  $scope.init = function () {
    var conf = paCache.getConf();
    $scope.conf = conf;

    if (comment) {
      // from dashboard
      $scope.comment = comment;
    } else if (conf.room.subscriptions.length == 1) {
      // from control panel
      var student = conf.room.subscriptions[0].student._id;
      $scope.loadComment(student);
    }
  };

  $scope.loadComment = function (student) {
    if (student) {
      var filter = {
        student: student,
        content: $scope.conf.currentContent._id
      };
      $http.post(config.apiUrl + '/ws/comments/search', filter).then(function (res) {
        if (res.data && res.data.length) {
          $scope.comment = res.data[0];
        } else {
          $scope.comment = {
            teacher: $rootScope.user.channel,
            folder: $scope.conf.currentContent.page.folder,
            content: $scope.conf.currentContent._id,
            student: student
          };
        }
      });
    }
  };

  $scope.saveComment = function () {
    $http.post(config.apiUrl + '/ws/comments', $scope.comment).then(function (res) {
      //toaster.pop('success', "Comment", "comment added");
      $uibModalInstance.dismiss('cancel');
    });
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.init();
}
"use strict";

paCommentsCtrl.$inject = ["$scope", "$uibModalInstance", "paService", "paCache", "user"];
angular.module('paApp').controller('paCommentsCtrl', paCommentsCtrl);

function paCommentsCtrl($scope, $uibModalInstance, paService, paCache, user) {
  $scope.init = function () {
    paService.loadStudentComments(user.student);
    $scope.data = paCache.getData();
    $scope.user = user;
  };

  $scope.close = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.setContent = function (comment) {
    paCache.setCurrentMode('C');
    paCache.setCurrentFolder(comment.folder);
    paCache.setCurrentContent(comment.content);
    $uibModalInstance.close(comment.content);
  };

  $scope.init();
}
"use strict";

conditionsCtrl.$inject = ["$scope", "$uibModalInstance"];
angular.module('paApp').controller('conditionsCtrl', conditionsCtrl);

function conditionsCtrl($scope, $uibModalInstance) {
  $scope.close = function () {
    $uibModalInstance.dismiss();
  };
}
"use strict";

feedCtrl.$inject = ["$scope", "paCache"];
angular.module('paApp').controller('feedCtrl', feedCtrl);

function feedCtrl($scope, paCache) {
  $scope.feed = paCache.getFeed();
}
"use strict";

paFeedbackCtrl.$inject = ["$scope", "$rootScope", "$http", "$sce", "$uibModalInstance", "config", "channel"];
angular.module('paApp').controller('paFeedbackCtrl', paFeedbackCtrl);

function paFeedbackCtrl($scope, $rootScope, $http, $sce, $uibModalInstance, config, channel) {
  $scope.feedback = {
    type: 'lesson',
    rate: 0
  };

  $scope.channel = channel;
  
  $scope.close = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.sendFeedback = function () {
    if ($scope.feedback.rate || $scope.feedback.comment) {
      $http.post(config.apiUrl + '/ws/feedbacks', $scope.feedback);
    }

    $uibModalInstance.dismiss('cancel');
  };
}
"use strict";

findWordController.$inject = ["$scope", "$http", "$state", "$rootScope", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('findWordController', findWordController);

function findWordController($scope, $http, $state, $rootScope, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();
  };

  $scope.init();
}
"use strict";

paGroupCtrl.$inject = ["$scope", "$rootScope", "$http", "$uibModal", "$state", "paCache", "paStudent", "config"];
angular.module('paApp').controller('paGroupCtrl', paGroupCtrl);

function paGroupCtrl($scope, $rootScope, $http, $uibModal, $state, paCache, paStudent, config) {
    var pageScope = paCache.getPageScope();

    var init = function(){
        $scope.pageScope = pageScope;
        if ($state.params.group){
            // edit
            pageScope.group = $state.params.group;
            $http.get('/ws/groups/'+pageScope.group._id+'/subscriptions').then(function(resp){
                var groupIndex = _.indexBy(resp.data, 'student');
                _.each(pageScope.subscriptions, function(subscr){
                    subscr.active=_.has(groupIndex, subscr.student._id);
                })
              })
        } else {
            // add
            pageScope.group = {
                teacher: $rootScope.user.teacher,
                organization: $rootScope.user.organization,
            }
            _.each(pageScope.subscriptions, function(subscr){
                subscr.active=false;
            })
        }
    }

    $scope.saveGroup=function(group){
        paStudent.saveGroup(group);
    }

    $scope.removeGroup = function(group){
        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
            controller: 'paConfirmCtrl',
            resolve: {
              message: function(){
                return 'Are you sure?'
              }
            }
        });
        modalInstance.result.then(function () {
            paStudent.removeGroup(group);
        });
    }

    $scope.back = function(){
        var conf=paCache.getConf();
        var to=(conf.organization)?'org-groups':'students';
        $state.go(to);
    }
    
    init();
}
"use strict";

paHelpCtrl.$inject = ["$scope", "$http", "$uibModalInstance", "paCache", "config"];
angular.module('paApp').controller('paHelpCtrl', paHelpCtrl);

function paHelpCtrl($scope, $http, $uibModalInstance, paCache, config) {
    var conf = paCache.getConf();

    var init = function(){
        $http.get(config.apiUrl + '/ws/help/' + conf.currentFolder.code + '/' + conf.currentPage.code)
            .then(function(resp){
                if (resp && resp.data){
                    $scope.helpMd = resp.data;
                }else {
                    $scope.helpMd = 'Help for this page is not yet available.';
                }
            })
        $scope.keys=[];
        if (conf.currentContent){
            loadKeys(conf.currentContent.img);
            loadKeys(conf.currentContent.img2);
            loadKeys(conf.currentContent.audio);
            loadKeys(conf.currentContent.text);
            loadKeys(conf.currentContent.text2);
            loadKeys(conf.currentContent.card);
            loadKeys(conf.currentContent.url);
            loadKeys(conf.currentContent.mixed);
            loadKeys(conf.currentContent.mixed2);
            loadKeys(conf.currentContent.grid);
        }
    }

    var loadKeys = function(collection){
        if (collection){
            $http.get(config.apiUrl + '/ws/collections/' + collection + '/keys')
                .then(function(resp){
                    $scope.keys = $scope.keys.concat(resp.data);
                })
        }
    
    }

    $scope.cancel=function(){
        $uibModalInstance.dismiss();
    }

    init();
}
'use strict';

homeCtrl.$inject = ["$state", "$stateParams", "$http", "$rootScope", "paService", "paCache", "paSocket", "paStyle", "config", "features"];
angular.module('paApp').controller('homeCtrl', homeCtrl);

function homeCtrl($state, $stateParams, $http, $rootScope, paService, paCache, paSocket, paStyle, config, features) {

  paCache.initLocale();
  $http.get(config.apiUrl + '/ws/home').then(function (resp) {
    if (resp && resp.data) {
      $rootScope.admin = resp.data.admin;
      $rootScope.user = resp.data.user;
      paCache.setUserLocale($rootScope.user.locale);
      $rootScope.zoomEnabled = resp.data.zoomEnabled;
      $rootScope.paConfig = config;
      $rootScope.paFeatures = features || {};
      paService.loadStates();
      paSocket.init();
      paStyle.loadGlobalStyle();
      if (resp.data.user.role=='O'){
        $state.go($stateParams.to+'-o');
      } else if (resp.data.user.role=='E'){
        $state.go($stateParams.to+'-e');
      } else {
        $state.go($stateParams.to);
      }
    } else {
      // error
      $state.go('login');
    }
  });
}
'use strict';

paHomeworkCtrl.$inject=["$scope","$rootScope","$state","$http","$uibModal","paCache","paHomework","config"];
angular.module('paApp').controller('paHomeworkCtrl', paHomeworkCtrl);

function paHomeworkCtrl($scope, $rootScope, $state, $http, $uibModal, paCache, paHomework, config){

    var conf = paCache.getConf();

    $scope.open = function(homework){
        $http.get('/ws/menu/findPage/'+homework.content.page).then(function(resp){
            homework.content.page=resp.data;
            paCache.setCurrentHomework(homework);
            paCache.setCurrentContent(homework.content);
            paCache.setCurrentPage(homework.content.page);
            paCache.setCurrentMode('H');
            $state.transitionTo(homework.content.page.template.name, 
                {content: homework.content}, 
                {"reload": true});
        })
    }

    $scope.done = function(){
        paHomework.patchHomework($rootScope.user.student, conf.currentContent._id, {done: true}).then(function(homework){
            $state.transitionTo('dashboard',{tab: 6});
        })
    }

    $scope.close = function(){
        paHomework.patchHomework(conf.asStudent._id, conf.currentContent._id, {closed: true}).then(function(homework){
            $state.transitionTo('select-student',{tab: 6, id: conf.asStudent._id});
        })
    }

    $scope.reopen = function(){
        paHomework.patchHomework(conf.asStudent._id, conf.currentContent._id, {done: false}).then(function(homework){
            $state.transitionTo('select-student',{tab: 6, id: conf.asStudent._id});
        })
    }

    $scope.addHomework = function(){
        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/popup.homework.html?67843dda9d78d032',
            controller: 'popupHomeworkCtrl',
            resolve: {
                homework: function(){
                    return {
                        teacher: $rootScope.user.channel,
                        student: conf.asStudent._id,
                        done: false,
                        closed: false
                    }
                },
                options: function(){
                    return {
                        students: [conf.asStudent],
                        mode: 0
                    }
                }
            }
        });
	    modalInstance.result.then(function(coll) {
	    	paHomework.loadHomeworks(conf.asStudent._id);
        });
    }

    $scope.editHomework = function(homework){
        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/popup.homework.html?67843dda9d78d032',
            controller: 'popupHomeworkCtrl',
            resolve: {
                homework: function(){
                    return _.clone(homework)
                },
                options: function(){
                    return {
                        students: [conf.asStudent],
                        mode: 1
                    }
                }
            }
        });
	    modalInstance.result.then(function(coll) {
	    	paHomework.loadHomeworks(conf.asStudent._id);
        });
    }

    $scope.removeHomework = function(homework){
        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/popup.homework.html?67843dda9d78d032',
            controller: 'popupHomeworkCtrl',
            resolve: {
                homework: function(){
                    return _.clone(homework)
                },
                options: function(){
                    return {
                        students: [conf.asStudent],
                        mode: 2
                    }
                }
            }
        });
	    modalInstance.result.then(function(res) {
            paHomework.loadHomeworks(conf.asStudent._id);
        });
    }

}
'use strict';

paHomeworkCommentsCtrl.$inject=["$scope","$rootScope","$state","$http","$uibModal","paCache","paHomework","config"];
angular.module('paApp').controller('paHomeworkCommentsCtrl', paHomeworkCommentsCtrl);

function paHomeworkCommentsCtrl($scope, $rootScope, $state, $http, $uibModal, paCache, paHomework, config){

    var conf = paCache.getConf();
    $scope.homework = conf.currentHomework;
    
    $scope.addComment = function() {
        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/popup.homework-comment.html?482b705a189769f3',
            controller: 'popupHomeworkCommentCtrl',
            size: 'lg',
            resolve: {
                p: function(){
                    return null;
                }
            }
        });
	    modalInstance.result.then(function(homework) {
	    	$scope.homework = homework;
        });
    }

    $scope.editComment = function(i) {
        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/popup.homework-comment.html?482b705a189769f3',
            controller: 'popupHomeworkCommentCtrl',
            size: 'lg',
            resolve: {
                p: function(){
                    return {action:1, i:i};
                }
            }
        });
	    modalInstance.result.then(function(homework) {
	    	$scope.homework = homework;
        });
    }

    $scope.removeComment = function(i) {
        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/popup.homework-comment.html?482b705a189769f3',
            controller: 'popupHomeworkCommentCtrl',
            size: 'lg',
            resolve: {
                p: function(){
                    return {action:2, i:i};
                }
            }
        });
	    modalInstance.result.then(function(homework) {
	    	$scope.homework = homework;
        });
    }

}
"use strict";

paKeyCtrl.$inject = ["$scope", "$rootScope", "$uibModalInstance", "$http", "paCache", "collection"];
angular.module('paApp').controller('paKeyCtrl', paKeyCtrl);

function paKeyCtrl($scope, $rootScope, $uibModalInstance, $http, paCache, collection) {
    var conf = paCache.getConf();
    $scope.init = function () {
        $scope.isFolderAdmin = ($rootScope.user.role=='E' && conf.currentFolder.isAdmin);
        loadKeys(collection);
        $scope.data = paCache.getData();
    };

    $scope.close = function () {
        $uibModalInstance.dismiss('cancel');
    };

    $scope.editKey = function(key){
        $scope.mode='edit';
        $scope.key=key;
    }

    $scope.addKey = function(){
        $scope.mode='add';
        $scope.key={
            value:null
        };
    }

    $scope.saveKey = function (key) {
        if (key._id){
            $http.put('/ws/collections/' + collection._id + '/keys/' + key._id, {value: key.value}).then(function (resp) {
                loadKeys(collection);
            })
        } else {
            var key = {
                coll: collection._id,
                value: key.value
            };
            if (!$scope.isFolderAdmin){
                key.teacher = $rootScope.user.teacher
            }
            $http.post('/ws/collections/' + collection._id + '/keys', key).then(function (resp) {
                loadKeys(collection);
            })
        }
    };

    $scope.removeKey = function (key) {
        $http.delete('/ws/collections/' + collection._id + '/keys/' + key._id).then(function (resp) {
            loadKeys(collection);
        })
    };

    var loadKeys = function (collection) {
        $http.get('/ws/collections/' + collection._id + '/keys').then(function (resp) {
            $scope.keys = resp.data;
            $scope.mode = null;
        })
    }
    $scope.init();
}
'use strict';

labelCtrl.$inject=["$scope","paCache","labels","config"];
angular.module('paApp').controller('labelCtrl', labelCtrl);

function labelCtrl($scope, paCache, labels, config){
    var userLocale = paCache.getUserLocale();
    var locale = (userLocale && userLocale.code) ? userLocale.code : config.defaultLocale;
    $scope.label = (labels[locale] && labels[locale][$scope.key]) ? labels[locale][$scope.key] : $scope.default;
}
"use strict";

paLessonCtrl.$inject = ["$scope", "$uibModalInstance", "paCache", "data"];
angular.module('paApp').controller('paLessonCtrl', paLessonCtrl);

function paLessonCtrl($scope, $uibModalInstance, paCache, data) {
  $scope.lesson = data.lesson;
  $scope.conf = paCache.getConf();

  $scope.ok = function () {
    $uibModalInstance.close();
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
}
"use strict";

lessonsCtrl.$inject = ["$scope", "$rootScope", "$http", "paCache", "config"];
angular.module('paApp').controller('lessonsCtrl', lessonsCtrl);

function lessonsCtrl($scope, $rootScope, $http, paCache, config) {
  var conf = paCache.getConf();

  var init = function init() {
    var today = new Date();
    $scope.months = {
      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
      options: _.range(0, 12),
      selected: today.getMonth()
    };
    $scope.years = {
      options: _.range(2015, today.getFullYear() + 1),
      selected: today.getFullYear()
    };
    $scope.loadLessons();
    $scope.loadNextLessons();
  };

  $scope.loadLessons = function () {
    $http.get(config.apiUrl + '/ws/findLessonsByTeacher/' + $rootScope.user.teacher + '/' + $scope.months.selected + '/' + $scope.years.selected).then(function (resp) {
      $scope.allLessons = resp.data;
    });
  };

  $scope.loadNextLessons = function() {
    $http.get(config.apiUrl + '/ws/findNextLessonsByTeacher/' + $rootScope.user.teacher).then(function (resp) {
      $scope.nextLessons = resp.data;
    });
  }

  init();
}
"use strict";

likesController.$inject = ["$scope", "$http", "$rootScope", "$uibModal", "paSocket", "paCache", "toaster", "config"];
angular.module('paApp').controller('likesController', likesController);

function likesController($scope, $http, $rootScope, $uibModal, paSocket, paCache, toaster, config) {
  $scope.animateElementIn = function ($el) {
    $el.removeClass('not-visible');
    $el.addClass('animated zoomIn');
  };

  $scope.animateElementOut = function ($el) {
    $el.addClass('not-visible');
    $el.removeClass('animated zoomIn');
  };

  $scope.scrollToElement = function (id) {
    paSocket.emit("scroll", id);
  };

  $scope.init = function () {
    $scope.filterBy = {};
    $scope.getPosts();
    $scope.data = paCache.getData();
    $http.get(config.apiUrl + '/ws/vk/getUser').then(function (resp) {
      if (resp.data.error) {
        $scope.auth = true;
      } else {
        $scope.vkUser = resp.data[0];
      }
    });
  };

  var distinctPages = function distinctPages(posts) {
    var pages = _.map(posts, function (post) {
      return post.page;
    });

    return _.uniq(pages, function (page) {
      return page._id;
    });
  };

  $scope.getPosts = function () {
    var from = new Date();
    from.setMonth(from.getMonth() - 1);
    var criteria = {
      date: {
        $gt: from
      },
      private: {
        $ne: true
      }
    };
    $http.post(config.apiUrl + '/ws/getPosts', criteria).then(function (resp) {
      var posts = _.filter(resp.data, function (post) {
        return post.student && post.student.length && post.teacher && post.page;
      });

      $scope.posts = posts;
      $scope.pages = distinctPages(posts);

      var conf = paCache.getConf();
      _.each(posts, function (post) {
        post.like = post.likes.indexOf($rootScope.user.student) != -1;
        post.isMine = _.contains(post.student, function(s){
          return s._id==$rootScope.user.student;
        })
      });
    });
  };

  $scope.filterByPage = function (page) {
    paSocket.emit('filterBy', {
      page: page
    });
  };

  $scope.addLike = function (post) {
    var like = {
      post: post._id,
      student: $rootScope.user.student
    };
    $http.post(config.apiUrl + '/ws/addLike', like).then(function (resp) {
      post.likes = resp.data.likes;
      post.like = post.likes && post.likes.indexOf($rootScope.user.student) != -1;
    });
  };

  $scope.confirmRemove = function (post) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Are you sure?'
        }
      }
    });
    modalInstance.result.then(function () {
      $http.get(config.apiUrl + '/ws/removePost/' + post._id).then(function (resp) {
        $scope.init();
      });
    });
  };

  $scope.removeLike = function (post) {
    var like = {
      post: post._id,
      student: $rootScope.user.student
    };
    $http.post(config.apiUrl + '/ws/removeLike', like).then(function (resp) {
      post.likes = resp.data.likes;
      post.like = post.likes.indexOf($rootScope.user.student) != -1;
    });
  };

  $scope.init();
}
'use strict';

paLinkSubscriptionCtrl.$inject=["$scope","$uibModalInstance","subscr","paCache","paSubscription","config"];
angular.module('paApp').controller('paLinkSubscriptionCtrl', paLinkSubscriptionCtrl);

function paLinkSubscriptionCtrl($scope, $uibModalInstance, subscr, paCache, paSubscription, config){

    $scope.pageScope = paCache.initPageScope();
    paSubscription.getTeachersForSubscription(subscr._id);

    $scope.cancel = function(){
        $uibModalInstance.dismiss();
    }

    $scope.select = function(teacher){
        $scope.sel=teacher;
    }
    
    $scope.link=function(){
        $uibModalInstance.close($scope.sel);
    }
}
'use strict';

loginCtrl.$inject = ["$q", "$http", "$scope", "$state", "$stateParams", "authService", "config"];
angular.module('paApp').controller('loginCtrl', loginCtrl);

function loginCtrl($q, $http, $scope, $state, $stateParams, authService, config) {
  
  var init = function(){
    authService.getStrategies().then(function(res){
      $scope.auth = res;
    })
  }

  $scope.login = function (strategy) {
    authService.login($scope.username, $scope.password, function (result) {
      if (result.success === true) {
        $state.go('pa',{to:'dashboard'});
      } else {
        $scope.error = result.error;
      }
    });
  };

  var pwd = function pwd(user) {
    var deferred = $q.defer();
    $http.post(config.apiUrl + '/ws/forgotPassword', user).then(function (resp) {
      return deferred.resolve(resp.data);
    });
    return deferred.promise;
  };

  $scope.forgotPassword = function (email) {
    pwd({
      email: email
    }).then(function (result) {
      $scope.ptab = result;
    }, function (error) {});
  };

  /*$scope.popupPrivacy = function(){
  	$uibModal.open({
  		animation: true,
  		templateUrl: '/privacy.html'),
  		controller: 'conditionsCtrl',
  		size: 'lg'            
  	});
  }
  
  $scope.popupConditions = function(){
  	$uibModal.open({
  		animation: true,
  		templateUrl: '/conditions.html'),
  		controller: 'conditionsCtrl',
  		size: 'lg'            
  	});
  }*/

  init();
}
"use strict";

paMarketplaceCtrl.$inject = ["$scope", "$state", "$rootScope", "$http", "$window", "paCache", "paMenu", "config", "countries"];
angular.module('paApp').controller('paMarketplaceCtrl', paMarketplaceCtrl);


function paMarketplaceCtrl($scope, $state, $rootScope, $http, $window, paCache, paMenu, config, countries) {

  var conf = paCache.getConf();
  $scope.countries=countries;

  $scope.init = function () {
    $scope.checkoutTab=-1;
    $scope.paymentConfig = config.payments;

    $scope.loadProducts();
    if ($state.params.teacher){
      // organization: pay on-behalf-of a teacher
      $scope.loadPendingPayments($state.params.teacher);
      $scope.loadFolderSubscriptions($state.params.teacher);
      $scope.newOrgPayment($state.params.teacher);
      $scope.subscriptionPlan=conf.organization.subscriptionPlan;
    } else {
      $scope.loadPendingPayments($rootScope.user.teacher);
      $scope.loadFolderSubscriptions($rootScope.user.teacher);
      $scope.newPayment();
      $scope.subscriptionPlan=conf.teacher.subscriptionPlan;
    }
  };

  $scope.setTab = function(t){
    $scope.checkoutTab=t;
  }

  $scope.loadFolderSubscriptions = function (teacher) {
    $http.get(config.apiUrl + '/ws/menu/folderSubscriptions/' + teacher).then(function (resp) {
      $scope.folderSubscriptions = resp.data;
    });
  };

  $scope.loadPendingPayments = function(teacher) {
    $http.post(config.apiUrl + '/ws/findPayments', {teacher:teacher, status:'pending', currency:'€'}).then(function(resp) {
      if (resp.data.length==0){
        $scope.checkoutTab=0;
      } else {
        $scope.pendingPayments=resp.data;
      }
    });
  }

  $scope.loadProducts = function() {
    $http.get(config.apiUrl + '/ws/products').then(function (resp) {
      $scope.products = _.filter(resp.data, function (p) {
        return p.folder;
      });
    });
  };

  $scope.setDeferring = function(){
    $scope.deferring=true;
    $scope.checkoutTab=2;
  }

  $scope.setPaymentType = function(type){
    $scope.payment.type=type;
    $http.post(config.apiUrl + '/ws/savePayment/' + $scope.payment._id, $scope.payment).then(function (resp) {
      $scope.payment = resp.data;
      $scope.checkoutTab=2;
    });
  }

  var initBillingInfo = function(){
    var fullname = conf.teacher.name + " " + conf.teacher.surname;
    if (conf.teacher.middle) {
      fullname += " "+conf.teacher.middle;
    }
    $scope.payment.billingInfo = {
      email: conf.teacher.email,
      firstname: conf.teacher.name,
      lastname: conf.teacher.surname,
      middlename: conf.teacher.middle,
      fullname: fullname,
      countryCode: conf.teacher.address.countryCode || 'RU'
    }    
  }

  $scope.newPayment = function () {
    $http.get(config.apiUrl + '/ws/newPayment/' + $rootScope.user.teacher).then(function (resp) {
      $scope.payment = resp.data;
      $scope.payment.items = {};
      initBillingInfo();
    });
  };

  $scope.newOrgPayment = function (teacher) {
    var conf = paCache.getConf();
    $http.post(config.apiUrl + '/ws/organizations/' + $rootScope.user.organization + '/teachers/' + teacher + "/payments").then(function (resp) {
      $scope.payment = resp.data;
      $scope.payment.items = {};
      $scope.payment.email = conf.organization.email;
      $scope.payment.fullname = conf.organization.director;
    });
  };

  $scope.toggle = function (product) {
    var sel = $scope.payment.items[product.folder.code];
    if (sel && sel._id==product._id) {
      $scope.payment.items[product.folder.code] = null;
    } else {
      $scope.payment.items[product.folder.code] = product;
    }

    savePayment();
  };

  var savePayment = function savePayment() {
    $http.post(config.apiUrl + '/ws/savePayment/' + $scope.payment._id, $scope.payment).then(function (resp) {
      $scope.payment = resp.data;
      expiryDates();
    });
  };

  var expiryDates = function expiryDates() {
    _.each(_.values($scope.payment.items), function (product) {
      var subscr = _.find($scope.folderSubscriptions, function(subscr) {
        return subscr.folder.code==product.folder.code;
      });

      if (!subscr || !subscr.expiryDate || Date.parse(subscr.expiryDate) < Date.now()) {
        product.prevExpiryDate = new Date();
      } else {
        product.prevExpiryDate = new Date(subscr.expiryDate);
      }

      var newExpiry = new Date(product.prevExpiryDate);
      newExpiry.setDate(newExpiry.getDate() + product.days);
      product.newExpiryDate = newExpiry;

    });

  };

  $scope.applyPromoCode = function() {
    $http.put(config.apiUrl + '/ws/payments/applyPromo', $scope.payment).then(
      function(resp){
        $scope.payment = resp.data;
      }, 
      function(resp){
        $scope.promoCodeError=resp.data;
    })
  }

  $scope.removePromoCode = function() {
    $http.put(config.apiUrl + '/ws/payments/removePromo', $scope.payment).then(
      function(resp){
        $scope.payment = resp.data;
      })
  }

  $scope.payOrder = function(payment){
    $scope.payment = payment;
    $scope.checkoutTab = 2;
    initBillingInfo();
  }

  $scope.cancelOrder = function(payment){
    $http.delete(config.apiUrl + '/ws/revolut/orders?paymentId='+payment._id).then(function (resp) {
      $scope.init();
    })
  }

  $scope.abandonPayment = function(payment){
    if (payment.type=='creditCard'){
      $http.delete(config.apiUrl + '/ws/revolut/orders?abandon=true&paymentId='+payment._id).then(function (resp) {
        $scope.init();
      })
    } else {
      $http.delete(config.apiUrl + '/ws/payments/'+payment._id).then(function (resp) {
        $scope.init();
      })
    }
  }

  $scope.paymentDetails = function(payment){
    $scope.payment=payment;
    $scope.checkoutTab=5;
  }

  $scope.checkoutPending = function(payment) {
    $http.put(config.apiUrl + '/ws/payments/'+payment._id+'/checkout/pending').then(function (resp) {
      $scope.payment = resp.data;
      $scope.checkoutTab = 1;
      initBillingInfo();
    });
  }

  $scope.axerveCheckout = function(payment, paymentType){
    $scope.checkoutTab = 3;
    $http.post(config.apiUrl + '/ws/payments/' + payment._id + '/checkout/axerve/'+paymentType, payment).then(function (resp) {
      $window.location.href = resp.data.formUrl;    
    })
  }

  $scope.confirmBankTransfer = function(payment){
    $http.post(config.apiUrl + '/ws/payments/' + payment._id + '/checkout/bankTransfer', payment).then(function (resp) {
      $scope.checkoutTab = 4;
    })
  }

  $scope.checkout = function (payment) {
    //$scope.checkoutTab = 3;
    $http.post(config.apiUrl + '/ws/payments/' + payment._id + '/checkout/revolut', payment).then(function (resp) {
      RevolutCheckout(resp.data.public_id, config.payments.env).then((instance) => {
        instance.payWithPopup({
          name: $scope.payment.billingInfo.fullname,
          email: $scope.payment.billingInfo.email,
          onSuccess() {
            $scope.checkOrderStatus(resp.data.id);
          },
          onError(message) {
            $scope.checkOrderStatus(resp.data.id);
          },
          onCancel() {
          }          
        });
      });      
    },function(resp){
      $scope.checkoutTab = 5;
    });
  };

  $scope.checkOrderStatus = function(orderId){
    $http.post(config.apiUrl + '/ws/revolut/callback',{order_id:orderId}).then(function (resp) {
      var payment=resp.data;
      if (payment.status=='valid'){
        paMenu.loadMyFolders($rootScope.user.teacher);
        $state.go('levels');
      } else {
        $scope.checkoutTab = 4;
        $scope.payment = payment;
      }
    })
  }

  $scope.defer = function () {
    $http.post(config.apiUrl + '/ws/payments/' + $scope.payment._id + '/defer', $scope.payment).then(function (resp) {
      paMenu.loadMyFolders($rootScope.user.teacher);
      $scope.rows=resp.data;
      $scope.checkoutTab=4;
    });
  };

  $scope.init();
}
"use strict";

mdCtrl.$inject = ["$scope", "$http"];
angular.module('paApp').controller('mdCtrl', mdCtrl);

function mdCtrl($scope, $http){	
    $http.get('/ws/help/home/' + $scope.page).then(function(resp){
        if (resp && resp.data){
            $scope.md = resp.data;
        }
    })   
}

"use strict";

mirgovoritCtrl.$inject = ["$scope", "$state", "$stateParams", "$http", "$window", "$location", "authService", "config"];
angular.module('paApp').controller('mirgovoritCtrl', mirgovoritCtrl);

function mirgovoritCtrl($scope, $state, $stateParams, $http, $window, $location, authService, config){	
    
    $scope.init = function(){
        switch ($state.current.name){
            case 'mirgovorit-link':
                $scope.link();
                break;
            case 'mirgovorit-login':
                $scope.login();
                break;
        }
    }

    $scope.setTab = function(tab){
        $scope.tab = tab;
    }

    $scope.link = function(mode) {

        var params = $location.search();
        $scope.tab = mode || params.mode;

        if (params.data) {
            $http.post(config.apiUrl + '/ws/mirgovorit/decrypt', {data:params.data}).then(
                function(resp) {
                    $scope.mirgovoritProfile = resp.data;
                }
            )
        }

        if (!$scope.tab || $scope.tab!='register') {
            $http.get(config.apiUrl + '/ws/profile').then(
                function (resp) {
                    if (resp && resp.data){
                        $scope.pikimoniProfile = resp.data;
                        $scope.tab = 'link';
                    } else {
                        $scope.tab = 'login';
                    }
                }
            )
        }
    }
    $scope.confirmLink = function(){
        var params = $location.search();
        $http.post(config.apiUrl + '/ws/mirgovorit/link', {data: params.data}).then(
            function(resp){
                if (params.redirectUrl) {
                    $window.location.href = decodeURIComponent(params.redirectUrl);
                } else {
                    $location.url('/pa/dashboard');
                }
            })
    }

    $scope.pikimoniLogin = function () {
        authService.login($scope.username, $scope.password, function (result) {
          if (result.success === true) {
            $scope.username = undefined;
            $scope.password = undefined;
            $scope.loggedIn = true;
            $scope.link('link');
          } else {
            $scope.error = result.error;
          }
        });
    };

    $scope.register = function(){
        var params = $location.search();
        $http.post(config.apiUrl + '/ws/mirgovorit/register', {data: params.data}).then(
          function(resp){
              if (resp.data && resp.data._id){
                  if (params.redirectUrl){
                    $window.location.href = decodeURIComponent(params.redirectUrl);
                  } else {
                      $scope.login();
                  }
              } else {
                $scope.error=resp.data.error;
              }
          }
        )
    };
    
    $scope.login = function () {
        var params = $location.search();
        authService.mirgovoritLogin(params.data, function (result) {
          if (result.success === true) {
            $state.go('pa',{to:'dashboard'});
          } else {
            $scope.error = result.error;
          }
        });
    };
    
    $scope.forgotPassword = function() {
        $http.post(config.apiUrl + '/ws/forgotPassword', {email: $scope.email}).then(function (resp) {
            if (resp.data=='E') {
                $scope.error='Email not found';
                $scope.setTab('forgotPwd');
            } else {
                $scope.setTab('mailSent');
            }
          });        
    }
    $scope.init();
}

"use strict";

mixedResourceCtrl.$inject = ["$scope", "paCache", "paSocket", "paService"];
angular.module('paApp').controller('mixedResourceCtrl', mixedResourceCtrl);

function mixedResourceCtrl($scope, paCache, paSocket, paService){	
    $scope.conf = paCache.getConf();
    $scope.data = paCache.getData();

    /*if ($scope.paResource && $scope.paResource.type=='text'){
      $scope.paResource.words=paService.split($scope.paResource.chars,' ');
    }*/

    $scope.playAudio = function (url) {
        paSocket.emit("play-track", {
          play: url
        });
    };

    $scope.pauseAudio = function (url) {
      paSocket.emit("play-track", {
        pause: url
      });
    };

    $scope.emitMessage = function (message, value) {
      paSocket.emit(message, value);
    };
  
    $scope.undo = function (s, t) {
      paSocket.emit("undo-drag", {
        source: s,
        target: t
      });
    };

    $scope.flip = function (i) {
      var data = paCache.getData();
      var sel = data.selected[i];
      paSocket.emit("flip", [i, !sel]);
    };
  
    $scope.sendText = function (i, text) {
      if (!text){
        var data = paCache.getData();
        text = data.temp[i];
      }
      paSocket.emit('replace-text', {
        i: i,
        val: text
      });
    };
  
}

"use strict";

opentokCtrl.$inject = ["$scope", "$http", "$rootScope", "paCache", "paSocket", "OTSession", "config"];
angular.module('paApp').controller('opentokCtrl', opentokCtrl);

function opentokCtrl($scope, $http, $rootScope, paCache, paSocket, OTSession, config) {
  var conf = paCache.getConf();
  $scope.fullscreenStyle = {
    width: '96vw',
    height: '86vh'
  };
  $scope.standardStyle = {
    width: '15vw',
    height: '50vh'
  };

  var init = function init() {
    if (conf.video.active) {
      initSession();
    } else {
      closeSession();
    }
  };

  var initSession = function initSession() {
    $http.get(config.apiUrl + '/ws/opentok/' + conf.channel._id).then(function (resp) {
      OTSession.init(resp.data.apiKey, conf.channel.opentok, resp.data.token, function (err, session) {// Here you can do things to the OpenTok session
        // The err is bubbled up from session.connect
      });
      $scope.streams = OTSession.streams;
      $scope.token = resp.data.token;
    });
  };

  init();
}

;
"use strict";

paOrganizationCtrl.$inject = ["$scope", "$rootScope", "$http", "$uibModal", "$state", "paCache", "paTeacher", "paSubscription", "paPayment", "paStudent", "config"];
angular.module('paApp').controller('paOrganizationCtrl', paOrganizationCtrl);

function paOrganizationCtrl($scope, $rootScope, $http, $uibModal, $state, paCache, paTeacher, paSubscription, paPayment, paStudent, config) {
  var pageScope = paCache.initPageScope();
  pageScope.filter={};
  $scope.pageScope = pageScope;

  var init = function init() {
    if ($state.current.name=='org-teachers'){
      paTeacher.getOrganizationTeachers($rootScope.user.organization);

    } else if ($state.current.name=='org-teacher'){
      $scope.teacher=$state.params.teacher;
      paTeacher.getFolderSubscriptions($state.params.teacher);

    } else if ($state.current.name=='org-students'){
      paStudent.getOrganizationStudents($rootScope.user.organization);
      paStudent.getOrganizationGroups($rootScope.user.organization);

    } else if ($state.current.name=='org-groups'){
      paStudent.getOrganizationStudentSubscriptions($rootScope.user.organization);
      paStudent.getOrganizationGroups($rootScope.user.organization);

    } else if ($state.current.name=='org-subscriptions'){
      paSubscription.getOrganizationSubscriptions($rootScope.user.organization);

    } else if ($state.current.name=='org-payments'){
      paPayment.getOrganizationPayments($rootScope.user.organization);

    } else if ($state.current.name=='org-new-payment'){
      $scope.teacher=$state.params.teacher;
      $scope.folder=$state.params.folder;
      paPayment.newOrganizationPayment($rootScope.user.organization, $state.params.teacher, $state.params.folder);
    }
  };

  $scope.linkTeacher = function(teacherId){
    paTeacher.linkTeacherToOrganization(teacherId, $rootScope.user.organization)
      .then(function(resp){
        $scope.teacherId=null;
        paTeacher.getOrganizationTeachers($rootScope.user.organization);
      })
  };

  $scope.unlinkTeacher = function (teacher) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Are you sure?'
        }
      }
    });
    modalInstance.result.then(function () {
      paTeacher.unlinkTeacherFromOrganization(teacher._id, $rootScope.user.organization)
        .then(function(resp){
          paTeacher.getOrganizationTeachers($rootScope.user.organization);
        })
    });
  };

  $scope.unlinkSubscription = function(subscr){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Are you sure?'
        }
      }
    });
    modalInstance.result.then(function () {
      paSubscription.unlinkSubscriptionFromTeacher(subscr)
        .then(function(resp){
          paSubscription.getOrganizationSubscriptions($rootScope.user.organization);
        })
    });
  }
  $scope.linkSubscriptionPopup = function(subscr){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.linkSubscription.html?8aa2c28f2687db98',
      controller: 'paLinkSubscriptionCtrl',
      resolve: {
        subscr: function(){
          return subscr
        }
      }
    });
    modalInstance.result.then(function (teacher) {
      paSubscription.linkSubscriptionToTeacher(subscr, teacher)
        .then(function(resp){
          paSubscription.getOrganizationSubscriptions($rootScope.user.organization);
        })
    });
  }

  $scope.filterByGroup = function(group){
    pageScope.filter.group={_id:group._id};
  }

  $scope.clearFilter = function(){
    pageScope.filter={};
  }

  $scope.unlinkStudentPopup = function(student){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Are you sure?'
        }
      }
    });
    modalInstance.result.then(function () {
      paStudent.unlinkStudentFromOrganization(student)
        .then(function(resp){
          paStudent.getOrganizationStudents($rootScope.user.organization);
        })
    });
  }

  init();
}
"use strict";

canvasCtrl.$inject = ["$scope"];
angular.module('paApp').controller('canvasCtrl', canvasCtrl);

function canvasCtrl($scope) {
  $scope.init = function () {
    $scope.loadImage();
  };

  $scope.loadImage = function () {
    var img = new Image();

    img.onload = function () {
      var w = img.width,
          h = img.height;
      var canvas = document.getElementById($scope.name);
      $scope.scale = w > h ? canvas.width / w : canvas.height / h;
      $scope.resize(canvas, img);
    };

    img.src = $scope.resource.src;
  };

  $scope.resize = function (canvas, img) {
    var ctx = canvas.getContext("2d");
    var w = img.width * $scope.scale,
        h = img.height * $scope.scale;
    var x = canvas.width > w ? (canvas.width - w) / 2 : 0;
    var y = canvas.height > h ? (canvas.height - h) / 2 : 0;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "rgba(0,0,0,0)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, x, y, w, h);
  };

  $scope.init();
}

;
"use strict";

cardEditorController.$inject = ["$scope", "$http", "$state", "$stateParams", "$uibModal", "$rootScope", "paCache", "paStorage", "config"];
angular.module('paApp').controller('cardEditorController', cardEditorController);

function cardEditorController($scope, $http, $state, $stateParams, $uibModal, $rootScope, paCache, paStorage, config) {
  $scope.init = function () {

    $scope.card = $stateParams.card;

  };

  $scope.addResource = function(resource, type){
    resource.type = type;
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.resource-add.html',
      controller: 'popupResourcesCtrl',
      size: 'lg',
      resolve: {
        type: function () {
          return null;
        },
        resource: function () {
          return _.clone(resource);
        }
      }
    });
    modalInstance.result.then(function(res) {
      _.extend(resource, res);
    });

  }

  $scope.clearResource = function(resource) {
    _.mapObject(resource, function(val, key) {
      delete resource[key];
    });
  }

  $scope.editResource = function(resource) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.resource-edit.html?45f2ba40a23be962',
      controller: 'popupResourcesCtrl',
      size: 'lg',
      resolve: {
        type: function () {
          return null;
        },
        resource: function () {
          return _.clone(resource);
        }
      }
    });
    modalInstance.result.then(function(res) {
      _.extend(resource, res);
    });
  };

  $scope.ok = function() {
    $state.transitionTo('collection-'+$stateParams.collection.type, {
      collection: $stateParams.collection,
      options: $stateParams.options,
      tab: 2
    })
  }
  $scope.init();
}

;
"use strict";

chatController.$inject = ["$scope", "paSocket", "paCache"];
angular.module('paApp').controller('chatController', chatController);

function chatController($scope, paSocket, paCache) {
  var conf = paCache.getConf();
  conf.chat= {
    open: false,
    messages: []
  }
  $scope.conf = conf;

  $scope.sendMessage = function () {
    if ($scope.text){
      paSocket.emit("chat.message", {text: $scope.text, id: Date.now(), action: 'add'});
      $scope.text = '';
    }
  };

  $scope.updateMessage = function(msg) {
    msg.action='update';
    msg.editMode=undefined;
    paSocket.emit("chat.message", msg);
  }

  $scope.removeMessage = function(msg) {
    msg.action='remove';
    paSocket.emit("chat.message", msg);
  }

  $scope.openChat = function(b){
    paSocket.emit('chat.open', {
      value: b
    });
  }
};
"use strict";

collectionEditorController.$inject = ["$scope", "$http", "$state", "$stateParams", "$uibModal", "$rootScope", "paCache", "paStorage", "config"];
angular.module('paApp').controller('collectionEditorController', collectionEditorController);

function collectionEditorController($scope, $http, $state, $stateParams, $uibModal, $rootScope, paCache, paStorage, config) {

  var conf = paCache.getConf();
  var pageScope = paCache.getPageScope();

  $scope.init = function () {
    if ($scope.collection) {

      if (!$scope.collection.resources) {
        $scope.collection.resources = [];
      }
  
      _.each($scope.collection.resources, function (res) {
        res.active = true;
      }); 
      
      //$scope.removeDuplicates();
    }

    if (conf.currentPage.storage) {
      paStorage.loadBlobs(conf.currentPage.storage + '/', $scope.contentType, $scope.collection);
    } else {
      paStorage.loadBlobs(null, $scope.contentType, $scope.collection);
    }

    $scope.conf = conf;
    $scope.pageScope = pageScope;
  };
  /*$scope.removeDuplicates = function(){
  	var uniq=[];
  	_.each($scope.collection.resources, function(res){
  		if (!$scope.find(uniq,res)){
  			uniq.push(res);
  		}
  	});
  	$scope.collection.resources = uniq;
  }
     $scope.find = function(resources,blob){
     	return resources.some(function(res){
  		return res.name && blob.name && res.name==blob.name;
  	});
     };*/

  $scope.selResource = function(res){
    pageScope.r = res;
  }

  $scope.loadBlobs = function(prefix){
    paStorage.loadBlobs(prefix, $scope.contentType, $scope.collection)
  }


  $scope.toggle = function (res) {
    if (res.active) {
      $scope.collection.resources.push(res);
      /*$scope.notSelected = _.filter($scope.notSelected, function(r){
      return r.name!=res.name;
      });*/
    } else {
      /*$scope.notSelected.push(res);*/
      var b = _.find($scope.blobs, function (b) {
        return b.name == res.name;
      });

      if (b) {
        b.active = false;
      }

      $scope.collection.resources = _.filter($scope.collection.resources, function (r) {
        return r.name != res.name;
      });
    }
  };

  $scope.newCard = function () {
    $scope.collection.resources.push({
      type: 'card',
      front: {},
      back: {}
    });
  };

  $scope.addImage = function (_bean) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.card.html?8e95b513fbe003e2',
      controller: 'popupCardCtrl',
      size: 'lg',
      resolve: {
        bean: function bean() {
          _bean.type = 'img';
          return _bean;
        },
        blobs: function blobs() {
          return $scope.blobs;
        }
      }
    });
    modalInstance.result.then(function (coll) {});
  };

  $scope.addText = function (_bean2) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.card.html?8e95b513fbe003e2',
      controller: 'popupCardCtrl',
      size: 'lg',
      resolve: {
        bean: function bean() {
          _bean2.type = 'text';
          return _bean2;
        },
        blobs: function blobs() {
          return $scope.blobs;
        }
      }
    });
    modalInstance.result.then(function (coll) {});
  };

  $scope.editBean = function (_bean3) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.card.html?8e95b513fbe003e2',
      controller: 'popupCardCtrl',
      size: 'lg',
      resolve: {
        bean: function bean() {
          return _bean3;
        },
        blobs: function blobs() {
          return $scope.blobs;
        }
      }
    });
    modalInstance.result.then(function (coll) {});
  };

  $scope.removeCard = function (i) {
    $scope.collection.resources.splice(i, 1);
  };

  $scope.init();
}

;
"use strict";

paCollectionsController.$inject = ["$scope", "$rootScope", "$state", "$http", "paCache", "paMenu", "config"];
angular.module('paApp').controller('paCollectionsController', paCollectionsController);

function paCollectionsController($scope, $rootScope, $state, $http, paCache, paMenu, config) {

    $scope.init = function(){
        $scope.search={};
    }
    $scope.searchCollections = function(){
        paMenu.seachCollectionsByName($scope.search.name).then(function(results){
            $scope.results = results;
        });
    }
    $scope.settings = function(coll){
        var conf = paCache.getConf();
        conf.currentPage = coll.page;
        conf.currentContent = null
        conf.currentFolder = coll.page.folder;
        conf.currentMode = 'P';
        $http.get(config.apiUrl + '/ws/pageConf/' + $rootScope.user.channel + '/' + conf.currentPage._id).then(function (resp) {
            if (resp.data){
                var data = paCache.getData();
                data.selCollections = resp.data;
            }
            var options={
                selected: coll._id
            };
            $state.transitionTo("admin", {
                "options": options
            });
        });
    }
    $scope.init();
};
"use strict";

paConfirmCtrl.$inject = ["$scope", "$uibModalInstance", "message"];
angular.module('paApp').controller('paConfirmCtrl', paConfirmCtrl);

function paConfirmCtrl($scope, $uibModalInstance, message) {

  $scope.message = message;
  
  $scope.ok = function () {
    $uibModalInstance.close();
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
};
"use strict";

controlPanelCtrl.$inject = ["$scope", "$http", "$state", "$stateParams", "$uibModal", "$rootScope", "ngAudio", "paService", "paCache", "paSocket", "paAcl", "paStyle", "config", "paIntro"];
angular.module('paApp').controller('controlPanelCtrl', controlPanelCtrl);

function controlPanelCtrl($scope, $http, $state, $stateParams, $uibModal, $rootScope, ngAudio, paService, paCache, paSocket, paAcl, paStyle, config, paIntro) {

  var conf = paCache.getConf();

  $scope.init = function () {
    $scope.data = paCache.getData();
    $scope.conf = paCache.getConf();
    $scope.showHelp = config.helpBaseUrl;

    if (!$scope.size) {
      $scope.size = {
        min: 1,
        max: 100,
        step: 1
      };
    }

    if (!$scope.size2) {
      $scope.size2 = {
        min: 1,
        max: 100,
        step: 1
      };
    }

    if (!$scope.text) {
      $scope.text = {
        min: 1,
        max: 10,
        step: 0.2
      };
    }

    $scope.data.timerValue = 90;
    $scope.data.timerValues = [30,45,60,90,120];
    $scope.stopwatch = ngAudio.load(config.storageBaseUrl+'/img/controlpanel/Gong%20low.mp3');
    if ($scope.stopwatch.error){
      throw new Error('error loading audio');
    }

    $scope.getRecs();
    $scope.isFolderAdmin = ($rootScope.user.role=='E' && conf.currentFolder.isAdmin);
    getFeeds();
    getCorrections();
    getPointers();

    if ($rootScope.admin){
      // load audio collection here.
      var folder;
      if (conf.currentMode=='W'){
        var folder = _.find(conf.myFolders, function(folder){
          return folder._id==conf.currentPage.folder;
        });
      } else {
        folder = conf.currentFolder;
      }
      paService.loadAudioCollections(folder);
    }
  };

  function getFeeds() {
    $http.get(config.apiUrl + '/ws/feeds/F').then(function (result) {
      $scope.feeds = result.data;
    });
  }

  function getCorrections() {
    $http.get(config.apiUrl + '/ws/feeds/C').then(function (result) {
      $scope.corrections = result.data;
    });
  }

  $scope.setAction = function (value) {
    paSocket.emit('var', {
      "var": 'action',
      val: value
    });
  };

  $scope.setTab = function (val) {
    $scope.tab == val ? $scope.tab = undefined : $scope.tab = val;
  };

  $scope.settings = function () {
    $state.transitionTo("admin", {
      "options": $scope.options
    });
  };

  $scope.capture = function () {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.capture.html?45bd820bed720625',
      controller: 'paCaptureCtrl',
      size: 'lg'
    });
  };

  $scope.playAudio = function (sel) {
    paSocket.emit("play-track", {
      play: sel.i
    });
  };

  $scope.pauseAudio = function (sel) {
    paSocket.emit("play-track", {
      pause: sel.i
    });
  };

  $scope.stop = function (sel) {
    paSocket.emit("play-track", {
      stop: sel.i
    });
  };

  $scope.setProgress = function (sel) {
    paSocket.emit("play-track", {
      track: sel.i,
      progress: sel.audio.progress
    });
  };

  $scope.save = function (data) {
    $http.post(config.apiUrl + '/ws/saveScreenshot', data, {
      transformRequest: angular.identity,
      headers: {
        'Content-Type': undefined
      }
    }).then(function (resp) {
      $scope.popup(resp.data);
    });
  };

  $scope.setRatio = function () {
    paService.saveParam('ratio', Number($scope.data.ratio));
    paSocket.emit("ratio", Number($scope.data.ratio));
  };

  $scope.setSize = function () {
    paService.saveParam('size', $scope.data.size);
    paSocket.emit("size", $scope.data.size);
  };

  $scope.setSize2 = function () {
    paService.saveParam('size2', $scope.data.size2);
    paSocket.emit("size2", $scope.data.size2);
  };

  $scope.saveSystemParams = function() {
    if ($scope.data.size) {
      paService.saveParam('size', $scope.data.size, true);
    }
    if ($scope.data.size2) {
      paService.saveParam('size2', $scope.data.size2, true);
    }
    if ($scope.data.textsize) {
      paService.saveParam('textsize', $scope.data.textsize, true);
    }
    if ($scope.data.textsize2) {
      paService.saveParam('textsize2', $scope.data.textsize2, true);
    }
  };

  $scope.clear = function () {
    paSocket.emit("clear", true);
  };

  $scope.hide = function () {
    paSocket.emit("hide", !$scope.data.hide);
  };

  $scope.flag = function () {
    paSocket.emit("toggle", {
      src: config.storageBaseUrl+'/img/controlpanel/flag3.jpg'
    });
  };

  $scope.correction = function (c) {
    paSocket.emit("feed", {
      src: c.src,
      audio: c.audio,
      timeout: c.timeout,
      "class": 'notify',
      align: 'align-items-start'
    });
  };

  $scope.feed = function (f) {
    paSocket.emit("feed", {
      src: f.src,
      audio: f.audio,
      timeout: f.timeout,
      "class": 'feed',
      align: 'align-items-center'
    });
  };

  $scope.record = function () {
    if (!$scope.data.rec) {
      var conf = paCache.getConf();
      var rec = {
        name: $scope.data.recName,
        page: conf.currentPage._id,
        teacher: $rootScope.user.teacher
      };
      $http.post(config.apiUrl + '/ws/rec/save', rec).then(function (resp) {
        $scope.data.rec = resp.data;
        $scope.tab = undefined;
      });
    }
  };

  $scope.stopRec = function () {
    $scope.data.rec = false;
  };

  $scope.getRecs = function () {
    var conf = paCache.getConf();
    $http.get(config.apiUrl + '/ws/rec/' + conf.currentPage._id + '/' + $rootScope.user.channel + '/find').then(function (resp) {
      var data = paCache.getData();
      data.recs = resp.data;
    });
  };

  $scope.playEvents = function (rec) {
    var data = paCache.getData();
    $http.get(config.apiUrl + '/ws/event/' + rec._id + '/find').then(function (resp) {
      _.each(resp.data, function (msg) {
        paSocket.emit(msg.name, msg.data);
      });
    });
  };

  $scope.removeRec = function (rec) {
    var data = paCache.getData();
    $http.post(config.apiUrl + '/ws/event/' + rec._id + '/remove').then(function (resp) {
      $scope.getRecs();
    });
  };

  $scope.setTextSize = function () {
    paService.saveParam('textsize', $scope.data.textsize);
    paSocket.emit("textsize", $scope.data.textsize);
  };

  $scope.setTextSize2 = function () {
    paService.saveParam('textsize2', $scope.data.textsize2);
    paSocket.emit("textsize2", $scope.data.textsize2);
  };

  $scope.selectMark = function (mark) {
    paSocket.emit("var", {
      "var": 'mark',
      val: mark
    });
  };

  $scope.popupComment = function () {
    var conf = paCache.getConf();
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.comment.html?67be8b7aadb235c1',
      controller: 'paCommentCtrl',
      resolve: {
        comment: function comment() {
          return undefined;
        }
      }
    });
  };

  $scope.popupBookmark = function () {
    var conf = paCache.getConf();
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.bookmark.html?47791d5f4c5b41d3',
      controller: 'paBookmarkCtrl',
      resolve: {
        name: function name() {
          return conf.currentMode == 'P' ? conf.currentPage.name : conf.currentContent.name+' ('+conf.currentPage.name+')';
        }
      }
    });
  };

  $scope.popupHomework = function () {
    var conf = paCache.getConf();
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.homework.html?67843dda9d78d032',
      controller: 'popupHomeworkCtrl',
      resolve: {
        homework: function(){
            return {
                teacher: $rootScope.user.channel,
                content: conf.currentContent._id,
                done: false,
                closed: false
            }
        },
        options: function(){
          return {
              students: _.map(conf.room.subscriptions,'student')
          }
      }
}

    });
  };

  $scope.popupBook = function () {
    var conf = paCache.getConf();
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.book.html?ddb26d8ea4918e35',
      controller: 'paBookCtrl'
    });
  };

  $scope.displayTimer = function () {
    var data = paCache.getData();
    paSocket.emit('var', {
      'var': 'displayTimer',
      'val': !data.displayTimer
    });
  };

  $scope.displayCountdown = function () {
    var data = paCache.getData();
    paSocket.emit('var', {
      'var': 'displayCountdown',
      'val': !data.displayCountdown
    });
  };

  $scope.displayCounter = function () {
    var data = paCache.getData();
    paSocket.emit('var', {
      'var': 'displayCounter',
      'val': !data.displayCounter
    });
  };

  $scope.displayBattery = function (user) {
    var data = paCache.getData();
    paSocket.emit('var', {
      'var': 'displayBattery',
      'val': !data.displayBattery
    });
  };

  $scope.batteryInc = function (user) {
    if (user.params.battery < 6) {
      paSocket.emit('battery', {
        user: user.id,
        value: user.params.battery + 1
      });
    }
  };

  $scope.batteryDec = function (user) {
    if (user.params.battery > 0) {
      paSocket.emit('battery', {
        user: user.id,
        value: user.params.battery - 1
      });
    }
  };

  $scope.toggleCorrections = function () {
    $scope.displayCorrections = !$scope.displayCorrections;
  };

  $scope.toggleFeeds = function () {
    $scope.displayFeeds = !$scope.displayFeeds;
  };

  $scope.startTimer = function () {
    paSocket.emit('timer', 'timer-start');
    $scope.timerRunning = 1;
  };

  $scope.stopTimer = function () {
    paSocket.emit('timer', 'timer-stop');
    $scope.timerRunning = 0;
    $scope.progressBar=0;
  };

  $scope.pauseTimer = function () {
    paSocket.emit('timer', 'timer-clear');
    $scope.timerRunning = 2;
  };

  $scope.resumeTimer = function () {
    paSocket.emit('timer', 'timer-resume');
    $scope.timerRunning = 1;
  };

  paSocket.on('timer', function (msg) {
    $scope.$broadcast(msg);
  });

  $scope.$on('timer-tick',function(e, val) {
    var data = paCache.getData();
    var sec = Math.floor(val.millis / 1000);
    var perc = sec*100/data.timerValue;
    $scope.progressbar = 100-perc;
    if (data.timerValue>=sec){
      $scope.timeLeft = data.timerValue-sec;
      if ($scope.timeLeft == 0) {
        $scope.stopwatch.play();
        $scope.$broadcast('timer-stop');
      }
    }
  });

  $scope.$on('timer-stopped',function(e, val) {
    $scope.progressbar = 100;
    $scope.timerRunning = 0;
  });

  $scope.setCounter = function (type,color) {
    paSocket.emit('var', {
      "var": 'counters',
      val: {
        type: type,
        color: color
      }
    });
  };
  $scope.setTarget = function (target) {
    paSocket.emit('var', {
      "var": 'counterTarget',
      val: target
    });
  };

  $scope.increment = function (name) {
    var data = paCache.getData();
    var c = data.counters[name] || 0;
    paSocket.emit('count', {
      user: name,
      counter: c + 1
    });
  };

  $scope.decrement = function (name) {
    var data = paCache.getData();
    var c = data.counters[name] || 0;
    paSocket.emit('count', {
      user: name,
      counter: c - 1
    });
  };

  $scope.range = function (name) {
    var data = paCache.getData();
    return _.range(data.counters[name]);
  };

  $scope.displayGamepad = function() {
    var data = paCache.getData();
    paSocket.emit('var', {
      'var': 'gamepad',
      'val': !data.gamepad
    });
  }

  $scope.playPickUpNumber = function () {
    paSocket.emit('var', {
      'var': 'game',
      'val': 'pickUpNumber'
    });
  };

  $scope.playPaperStoneScissors = function () {
    paSocket.emit('var', {
      'var': 'game',
      'val': 'paperStoneScissors'
    });
  };

  $scope.playDiceForSentence = function () {
    paSocket.emit('var', {
      'var': 'game',
      'val': 'diceForSentence'
    });
  };

  $scope.playOneOrTwo = function () {
    paSocket.emit('var', {
      'var': 'game',
      'val': 'oneOrTwo'
    });
  };

  $scope.pickUpNumberStart = function () {
    var shuffle = _.shuffle([config.storageBaseUrl+"/img/dice/1.png", config.storageBaseUrl+"/img/dice/2.png", config.storageBaseUrl+"/img/dice/3.png", config.storageBaseUrl+"/img/dice/4.png", config.storageBaseUrl+"/img/dice/5.png", config.storageBaseUrl+"/img/dice/6.png"]);

    paSocket.emit('exec', {
      method: 'pickUpNumber',
      arg: shuffle
    });
  };

  $scope.oneOrTwoStart = function () {
    paSocket.emit('exec', {
      method: 'oneOrTwo',
      arg: _.random(4,8)
    });
  };

  $scope.paperStoneScissorsStart = function () {
    var shuffle = _.shuffle([config.storageBaseUrl+"/img/paper%20stone/%20paper%202.png", config.storageBaseUrl+"/img/paper%20stone/scissors.jpg", config.storageBaseUrl+"/img/paper%20stone/stone.jpeg"]);

    paSocket.emit('exec', {
      method: 'paperStoneScissors',
      arg: shuffle.concat(shuffle)
    });
  };

  $scope.diceForSentenceStart = function () {
    var shuffle = _.shuffle([config.storageBaseUrl+"/cdn/controlpanel/diceForSentence/%2B.gif", config.storageBaseUrl+"/cdn/controlpanel/diceForSentence/-.gif", config.storageBaseUrl+"/cdn/controlpanel/diceForSentence/q.gif"]);

    paSocket.emit('exec', {
      method: 'diceForSentence',
      arg: shuffle.concat(shuffle)
    });
  };

  $scope.countdown = function () {
    var data = paCache.getData();
    paSocket.emit('var', {
      'var': 'countdown',
      'val': !data.countdown
    });
  };

  $scope.countdownStart = function () {
    paSocket.emit('exec', 'countdown');
  };

  $scope.setTimerValue = function (value) {
    paSocket.emit('var', {
      'var': 'timerValue',
      'val': Number(value)
    });
  };

  $scope.popupHelp = function(){
    $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.help.html?d0068ab76e02cae9',
      controller: 'paHelpCtrl',
      size: 'lg'
    });
  }

  var getPointers = function(){
    $scope.pointers=[];
    $scope.pointers.push({src:'https://pikimoni.blob.core.windows.net/img/controlpanel/pointers/arrow.gif'});
    $scope.pointers.push({src:'https://pikimoni.blob.core.windows.net/img/controlpanel/pointers/CURSOR-pink.gif'});
    $scope.pointers.push({src:'https://pikimoni.blob.core.windows.net/img/controlpanel/pointers/pointer2.gif'});
    $scope.pointers.push({src:'https://pikimoni.blob.core.windows.net/img/controlpanel/pointers/pointing-with-pointer.gif'});
    $scope.pointers.push({src:'https://pikimoni.blob.core.windows.net/img/controlpanel/pointers/right-arrow.gif'});
  }
  $scope.togglePointers = function () {
    var data = paCache.getData();
    if (!data.enableJcrop){
      paSocket.emit('var', {
        'var': 'enableJcrop',
        'val': false
      });
    }
    paSocket.emit('var', {
      'var': 'displayPointers',
      'val': !data.displayPointers
    });
  };
  $scope.toggleCrop = function(){
    var data = paCache.getData();
    if (data.displayPointers){
      paSocket.emit('var', {
        'var': 'displayPointers',
        'val': false
      });
    }
    paSocket.emit('var', {
      'var': 'enableJcrop',
      'val': !data.enableJcrop
    });
  }
  $scope.undo = function (s, t) {
    paSocket.emit("undo-drag", {
      source: s,
      target: t
    });
  };

  $scope.popupAudioCollection = function(coll){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.songs.html?9c4e3717e7694b46',
      controller: 'paSongsCtrl',
      size: 'lg',
      resolve: {
        coll: function(){
          return coll;
        }
      }
    });
    modalInstance.result.then(function(sel){
      var data = paCache.getData();
      data.sel=sel;
    })
   
  }
  $scope.init();
  angular.element(document).ready(function() {
    paIntro.pageTour('controlPanel')
  })
}
"use strict";

paCopyPageCtrl.$inject = ["$scope", "$rootScope", "$state", "$http", "paCache", "paService", "paMenu", "config"];
angular.module('paApp').controller('paCopyPageCtrl', paCopyPageCtrl);

function paCopyPageCtrl($scope, $rootScope, $state, $http, paCache, paService, paMenu, config) {

    var conf = paCache.getConf();
    $scope.conf = conf;

    $scope.init=function(){
        paMenu.loadFolders();
    }
    
    $scope.loadPages = function(folder){
        paService.loadPages(folder);
    }

    $scope.copyPage = function(page){
        var newPage = {
            name:page.name + ' - Copy',
            type:page.type,
            folder:conf.currentFolder._id,
            template:page.template,
            params:page.params,
            collections:page.collections
        };
        $state.transitionTo('edit-page', {page: newPage});
    }

    $scope.init();
}
"use strict";

paCtrl.$inject = ["$scope", "$rootScope", "$state", "$http", "$uibModal", "paSocket", "paAcl", "paService", "paCache", "$document", "toaster", "config"];
angular.module('paApp').controller('paCtrl', paCtrl);

function paCtrl($scope, $rootScope, $state, $http, $uibModal, paSocket, paAcl, paService, paCache, $document, toaster, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.reload = function () {
    paSocket.emit("reload");
  };

  $scope.setHome = function () {
    paSocket.emit("page message", {
      code: 'dashboard'
    });
  };

  $scope.setWall = function () {
    paSocket.emit("page message", {
      code: 'wall'
    });
  };

  $scope.setPage = function (page) {
    var conf = paCache.getConf();
    var f = conf.currentFolder;
    if (!f){
      f = _.find(conf.myFolders, function(f){
        return f._id==page.folder;
      })
    }
    if (f.isExpired) {
      toaster.pop('error', "Access denied", "Subscription for " + f.name + " has expired. Go on payment to renrew the subscription.");
    } else {
      var t=page.template;
      if(!t.name){
        t = _.find(conf.templates,function(template){
          return template._id==t;
        })
      }
      paSocket.emit("page message", {code: t.name, page: page});
    }
  };

  $scope.setContent = function (content) {
    var conf = paCache.getConf();
    var f = conf.currentFolder;
    if (!f){
      f = _.find(conf.myFolders, function(f){
        return f._id==content.page.folder;
      })
    }
    if (f.isExpired && !content.free) {
      toaster.pop('error', "Access denied", "Subscription for " + f.name + " has expired. Go on payment to renrew the subscription.");
    } else {
      //paService.logContent(content);
      var t=content.page.template;
      if(!t.name){
        t = _.find(conf.templates,function(template){
          return template._id==t;
        })
      }
      paSocket.emit("content message", {code: t.name, content: content});
    }
  };

  $scope.setTab = function (i) {
    paSocket.emit('tab', i);
  };

  $scope.adminSelectImage = function (i) {
    if ($scope.admin) {
      paSocket.emit("img message", {_id: i});
    }
  };

  $scope.selectImage = function (i) {
    paSocket.emit("img message", {_id: i});
  };

  $scope.next = function () {
    var data = paCache.getData();
    paSocket.emit("img message", {_id: data.selectedImage + 1});
  };

  $scope.selectNextImage = function () {
    var data = paCache.getData();
    var next = (data.selectedImage + 1) % data.images.length;
    paSocket.emit("img message", {_id: next});
  };

  $scope.selectPrevImage = function () {
    var data = paCache.getData();
    var next = (data.selectedImage - 1) % data.images.length;
    paSocket.emit("img message", {_id: next});
  };

  $scope.showImage = function (i, val) {
    paSocket.emit("show message", [i, val]);
  };

  $scope.hideImage = function (i, val) {
    paSocket.emit("hide message", [i, val]);
  };

  $scope.toggleImage = function (i) {
    var data = paCache.getData();
    var sel = data.selected[i];
    paSocket.emit("img2 message", [i, !sel]);
  };

  $scope.adminToggleImage = function (i) {
    if ($scope.admin) {
      var data = paCache.getData();
      var sel = data.selected[i];
      paSocket.emit("img2 message", [i, !sel]);
    }
  };

  $scope.tagImage = function (i, tag) {
    paSocket.emit("img2 message", [i, tag]);
  };

  $scope.emitUserParam = function (user, name, value) {
    paSocket.emit("userParam", {
      user: user.id,
      name: name,
      value: value
    });
  };

  $scope.emitMessage = function (message, value) {
    paSocket.emit(message, value);
  };

  $scope.over = function (name) {
    paSocket.emit('var', {
      "var": name,
      val: true
    });
  };

  $scope.out = function (name) {
    paSocket.emit('var', {
      "var": name,
      val: false
    });
  };

  $scope.findAudioByTitle = function (title) {
    var data = paCache.getData();
    return _.find(data.audioCollection, function (audio) {
      return audio.title == title;
    });
  };

  $scope.playByTitle = function (title) {
    paSocket.emit("audio message", {
      action: 'play',
      title: title
    });
  };

  $scope.pauseByTitle = function (title) {
    paSocket.emit("audio message", {
      action: 'pause',
      title: title
    });
  };

  $scope.stopByTitle = function (i) {
    paSocket.emit("audio message", {
      action: 'stop',
      title: title
    });
  };

  $scope.doAction = function (action, i) {
    if (action == 'select') {
      paSocket.emit('img message', {_id: i});
    } else if (action == 'remove') {
      paSocket.emit('img2 message', [i, true]);
    }
  };

  $scope.sendVar = function (name, value) {
    paSocket.emit('var', {
      "var": name,
      val: value
    });
  };

  $scope.selectColor = function (i) {
    var data = paCache.getData();
    paSocket.emit('img params', [i, {
      color: data.color
    }]);
  };

  $scope.clickMe = function (event, icon) {
    var data = paCache.getData();
    var mark = data.mark || icon || 'fa-check-circle';
    var target = angular.element("#" + event.currentTarget.id);
    paSocket.emit("click-msg", {
      id: event.currentTarget.id,
      x: event.offsetX / target.width(),
      y: event.offsetY / target.height(),
      icon: mark
    });
  };

  $scope.singleClickMe = function (event, icon) {
    if (!icon) {
      icon = 'fa-check-circle';
    }

    var target = angular.element("#" + event.currentTarget.id);
    paSocket.emit("click-msg", {
      id: event.currentTarget.id,
      x: event.offsetX / target.width(),
      y: event.offsetY / target.height(),
      icon: icon,
      single: true
    });
  };

  $scope.clearClick = function () {
    paSocket.emit("clear-click-msg", {});
  };

  $scope.initBook = function () {
    $('#bb-bookblock').bookblock({
      speed: 800,
      shadowSides: 0.8,
      shadowFlip: 0.7
    });
  };

  $scope.nextPage = function () {
    paSocket.emit("book message", "next");
  };

  $scope.prevPage = function () {
    paSocket.emit("book message", "prev");
  };

  $scope.pop = function () {
    paSocket.emit('pop message', 'pop');
  };

  $scope.undo = function (s, t) {
    paSocket.emit("undo-drag", {
      source: s,
      target: t
    });
  };

  $scope.move = function (e) {
    if ($scope.m) {
      var relX = e.offsetX - 140;
      var relY = e.offsetY - 80;
      $('mask g').attr('transform', 'translate(' + relX + ',' + relY + ')');
    }
  };

  $scope.startMove = function (e) {
    $scope.m = true;
  };

  $scope.stopMove = function (e) {
    $scope.m = false;
    paSocket.emit('binocular', {
      offsetX: e.offsetX,
      offsetY: e.offsetY
    });
  };

  $scope.selectOne = function (i, j) {
    paSocket.emit('user-selection', {
      i: i,
      j: j,
      user: $rootScope.user.username
    });
  };

  $scope.fontSize = function (elem) {
    var w = angular.element('#' + elem).width();
    return {
      'font-size': w + 'px'
    };
  };

  $scope.sendText = function (i, text) {
    if (!text){
      var data = paCache.getData();
      text = data.temp[i];
    }
    paSocket.emit('replace-text', {
      i: i,
      val: text
    });
  };

  $scope.setFolder = function (folder) {
    paCache.setCurrentMode('P');
    paCache.setCurrentFolder(folder);
    //paService.loadPages(folder);
    paService.loadContents(folder);

    $scope.popupMenu();
  };

  $scope.setWorkplan = function (workplan) {
    paCache.setCurrentMode('W');
    paCache.setCurrentFolder(workplan);
    paService.loadWorkplan(workplan);
    $scope.popupWorkplan();
  };

  $scope.setStickers = function () {

    var conf = paCache.getConf();
    $http.post('/ws/menu/findPages',{type:'S',code:'stickers'}).then(function(resp){
      var page=resp.data[0];
      var folder = page.folder;

      var res = _.find(conf.systemResources, function(res){
        return res.code==folder.code;
      });
      folder.isAdmin = res&&res.isAdmin;
      
      paCache.setCurrentMode('S');
      paCache.setCurrentFolder(folder);
      paCache.setCurrentPage(page);
      $state.go('stickers', {
        student: null,
        content: {
          type: 'P'
        }
      });
    })
  };

  $scope.popupMenu = function () {
    var modalInstance = $uibModal.open({
      animation: true,
      controller: 'sidebarCtrl',
      templateUrl: '/pa/pa.sidebar.html?288aa3c08226bcc6',
      size: 'lg'
    });
    modalInstance.result.then(function (item) {
      if (item.type == 'P') {
        $scope.setPage(item);
      } else if (item.type == 'C') {
        $scope.setContent(item);
      }
    });
  };

  $scope.popupWorkplan = function () {
    var modalInstance = $uibModal.open({
      animation: true,
      controller: 'sidebarCtrl',
      templateUrl: '/pa/popup.sidebarW.html?2e6696d3a33649fc',
      size: 'lg'
    });
    modalInstance.result.then(function (item) {
      $scope.setContent(item);
    });
  };

  $scope.selectSmile = function (i) {
    paSocket.emit("smile message", i);
  };

  $scope.distributeFromDeck = function () {
    paSocket.emit("exec", "distributeFromDeck");
  };

  $scope.updateUserText = function (user, _char, color) {
    _char.color = color;
    paSocket.emit("userParam", {
      user: user.id,
      name: 'chars',
      value: user.params.chars
    });
  };

  $scope.publishVk = function (post) {
    $scope.spinning = true;
    $http.get(config.apiUrl + '/ws/vk/album').then(function (resp) {
      if (resp.data.error) {
        $scope.auth = true;
      } else {
        $http.post(config.apiUrl + '/ws/vk/publish', {
          album: resp.data,
          post: post
        }).then(function (resp) {
          if (resp.data.error) {
            $scope.auth = true;
          } else {
            $scope.spinning = false;
            toaster.pop('success', "Success", "image published");
            /*
            wall permission not allowed: https://vk.com/dev/permissions
            $http.post(config.apiUrl+'/ws/vk/post',{media:resp.data[0],post:post}).then(function(resp){
                if (resp.data.error){
                    $scope.auth=true;
                } else {
                    $scope.spinning=false;
                    toaster.pop('success', "Post", "post published");			
                }
            })
            */
          }
        });
      }
    });
  };

  $scope.playAudio = function (url) {
    paSocket.emit("play-track", {
      play: url
    });
  };

  $scope.startLine = function(i){
    paSocket.emit("json", {lineId:i,cellId:0});
  }

  $scope.getSelectionText = function () {
    if (window.getSelection()) {
      if (window.getSelection().toString()) {
        // text selection
        var range = window.getSelection().getRangeAt(0);
        var s = range.startContainer.parentElement.id;
        var e = range.endContainer.parentElement.id;
        paSocket.emit('text', {
          start: s,
          end: e
        });
      }
    }
  };

  $scope.setSidebarTab = function(tab) {
    if (tab==1){
      paCache.setSidebarTab(1);
    } else {
      paSocket.emit('conf', {
        "var": 'sidebar',
        val: {
          tab:tab
        }
      });
    }
  }
}
"use strict";

dashboardController.$inject = ["$scope", "$rootScope", "$http", "$window", "$location", "$uibModal", "$log", "$state", "$stateParams", "paSocket", "paCache", "paService", "paChannel", "paAcl", "paMenu", "paHomework", "paSubscription", "paTeacher", "toaster", "config", "paIntro"];
angular.module('paApp').controller('dashboardController', dashboardController);

function dashboardController($scope, $rootScope, $http, $window, $location, $uibModal, $log, $state, $stateParams, paSocket, paCache, paService, paChannel, paAcl, paMenu, paHomework, paSubscription, paTeacher, toaster, config, paIntro) {

  var pageScope = paCache.initPageScope();

  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.conf = paCache.getConf();
    $scope.data = paCache.getData();
    $scope.pageScope = pageScope;

    if ($scope.conf.channel && $scope.conf.channel.open) {
      paCache.setSidebarTab(2);
    } else {
      paCache.setSidebarTab(1);
    }

    if ($state.current.name == 'select-student') {
      // teacher as student
      paMenu.loadFolders();
      $scope.selectStudent($state.params.id);
      paHomework.loadHomeworks($state.params.id);

    } else if ($rootScope.user.role=='T' || $rootScope.user.role=='E') {
      // teacher's login
      $scope.student = null;
      $http.get(config.apiUrl + '/ws/findTeacher/' + $rootScope.user.teacher).then(function (resp) {
        $scope.conf.teacher = resp.data;
        $scope.conf.teacher.hasFull=($scope.conf.teacher.subscriptionPlan=='full'||($scope.conf.teacher.organization && $scope.conf.teacher.organization.subscriptionPlan=='enterprise'));
        if(!$scope.conf.teacher.email){
          toaster.pop('warning', "Edit your profile", "Insert your email address");
        }
      });

      if ($rootScope.user.role=='E'){
        paAcl.loadSystemResources();
        $scope.conf.room={
          users:[]
        };

      } else {

        paChannel.findOrCreateChannel($rootScope.user.teacher).then(function(channel){
          $scope.conf.channel = channel;
          if (channel.status==1){
            // lesson already started
            $scope.conf.channel.open=true;
          }
          $scope.conf.room={};
          paChannel.loadRoom();
          paChannel.loadValidStudents();
          paSubscription.loadPendingSubscriptions();
        });
        
        paMenu.loadMyFolders($rootScope.user.teacher);
        paService.loadWorkplans();
        paAcl.loadPermissions();
      }

    } else if ($rootScope.user.role=='S') {
      // student's login
      paMenu.loadFolders();
      $scope.selectStudent($rootScope.user.student);
      
      if($rootScope.user.channel){ 
        // user subscribed classroom
        $http.get(config.apiUrl + '/ws/findOpenOrNewChannel/teachers/' + $rootScope.user.channel).then(function (resp) {
          if (resp.data){
            // lesson already started
            $scope.conf.channel = resp.data;
            $scope.conf.channel.open = (resp.data.status==1);

            $scope.conf.room={};
            paChannel.loadRoom();
    
          }
        });
      }
      paHomework.loadHomeworks($rootScope.user.student);

    } else if ($rootScope.user.role=='O') {
      $http.get('/ws/organizations/'+$rootScope.user.organization).then(function(resp){
        $scope.conf.organization = resp.data;
      })
      paAcl.loadPermissions();

    }

    $scope.showModal = false;
    $scope.lessons = [];
    $log.info('browser: ' + $window.navigator.userAgent);
  };

  $scope.unlockFolder = function(folder){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.unlockFolder.html?a7b64d14d8e03a89',
      controller: 'popupUnlockFolderCtrl',
      resolve: {
        folder: function() {
          return folder;
        }
      }
    });
    modalInstance.result.then(function(subscriptions) {
      _.each(subscriptions, function(subscr){
        $http.post('/ws/folderSubscriptions',subscr)
          .then(function(resp){
            paMenu.loadMyFolders($rootScope.user.teacher);
          })
      })
    });
  }
  $scope.popupVideo = function () {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.video.html?ca1c62dc417bb90c',
      controller: 'paVideoCtrl',
      size: 'lg'
    });
    modalInstance.result.then(function () {});
  };
  $scope.resetIntro = function() {
    paIntro.resetIntro().then(function(data){
      paIntro.pageTour('dashboard-'+$rootScope.user.role);
    });
  }
  $scope.editScore = function (_unit, _folder) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.score.html?80af4cd3a809992b',
      controller: 'paScoreCtrl',
      unit: _unit,
      resolve: {
        unit: function unit() {
          return _unit;
        },
        folder: function folder() {
          return _folder;
        }
      }
    });
    modalInstance.result.then(function () {
      $scope.saveScore(_unit);
    });
  };

  $scope.editLesson = function (lesson) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.lesson.html?15c62ce3d85dab7b',
      controller: 'paLessonCtrl',
      resolve: {
        data: function data() {
          return {
            lesson: lesson
          };
        }
      }
    });
    modalInstance.result.then(function () {
      $scope.saveLesson(lesson);
    });
  };

  $scope.editRoom = function () {
    $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.room.html?b9d7ae9fb8f1ebea',
      controller: 'paRoomCtrl',
      size: 'lg',
      resolve: {
        subscriptions: function subscriptions() {
          return $scope.subscriptions;
        }
      }
    });
  };

  $scope.inviteLink = function() {
    $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.inviteLink.html?bfb656fd6ff05258',
      controller: 'paRoomCtrl',
      size: 'lg'
    });
  }

  $scope.startLesson = function () {
    var conf = paCache.getConf();
    paChannel.openChannel(conf.channel._id).then(function (resp) {
      //toaster.pop('success', "Start", "lesson started");
      paSocket.emit('lessonStarted', resp.data);
    });
  };

  $scope.finishLesson = function () {
    var conf = paCache.getConf();
    paSocket.emit('lessonEnded', conf.channel);
    closeChannel();
    disconnectStudents();
    clearChat();
  };

  var closeChannel = function closeChannel() {
    var conf = paCache.getConf();
    $http.post(config.apiUrl + '/ws/closeChannel/' + conf.channel._id).then(function (resp) {
      $scope.conf.channel = resp.data;
    });
  };

  var disconnectStudents = function disconnectStudents() {

    _.each($scope.conf.room.subscriptions, function(subscription){
        paChannel.saveLesson(subscription);
        paChannel.unsubscribeChannel({student:subscription.student._id});
    });

    $scope.conf.showOnlineUsers=false;
    $scope.conf.room={};
  };

  var clearChat = function(){
    $scope.conf.chat.messages=[];
    paSocket.emit('chat.open', {
      value: false
    });    
  }

  $scope.addLesson = function () {
    $http.post(config.apiUrl + '/ws/newLesson/' + $scope.student._id + '/' + $rootScope.user.teacher).then(function (resp) {
      $scope.getLessons($scope.student._id);
    });
  };

  $scope.saveLesson = function (lesson) {
    $http.post(config.apiUrl + '/ws/saveLesson', lesson).then(function (resp) {
      $scope.getLessons($scope.student._id);
    });
  };

  $scope.removeLesson = function (lesson) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Are you sure?'
        }
      }
    });
    modalInstance.result.then(function () {
      $http.get(config.apiUrl + '/ws/removeLesson/' + lesson._id).then(function (resp) {
        $scope.getLessons($scope.student._id);
      });
    });
  };

  $scope.selectCourse = function (id) {
    if (id) {
      $scope.cl = true;
      $scope.hmt = id == 'icanread';
      $scope.rh = id == 'icanread';
      $rootScope.course = id;
      $http.get(config.apiUrl + '/ws/findUnits/' + id).then(function (resp) {
        $scope.units = resp.data;
        $scope.checkUnits();
      });
    }
  };

  $scope.selectStudent = function (id) {
    if (id) {
      $scope.tab = $stateParams.tab||1;
      $scope.getStudent(id);
      $scope.getLessons(id);
      $scope.getScores(id);
      paService.loadStudentComments(id);
    } else {
      $scope.student = null;
    }
  };

  $scope.getStudent = function (id) {
    $http.get(config.apiUrl + '/ws/findStudent/' + id).then(function (resp) {
      $scope.student = resp.data;
      $scope.conf.asStudent = resp.data;
      $scope.student.coinsL = _.range(0, $scope.student.coins);
      $scope.courseSt = $scope.student.course;
      $scope.courseUn = $scope.student.course;
      $scope.getStickers(id, $scope.student.course);
      $scope.selectCourse($scope.student.course);
      $scope.loadSubscription(id);
    });
  };

  $scope.loadSubscription = function(id){
    $http.post(config.apiUrl + '/ws/findSubscription', {student: id}).then(function (resp) {
      $scope.conf.subscription = resp.data;
      paTeacher.getTeacherMirgovoritProfile(resp.data.teacher._id).then(function(profile){
        $scope.conf.subscription.teacher.mirgovoritProfile = profile;
      });
    });
  };

  $scope.popupComment = function (_comment) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.comment.html?67be8b7aadb235c1',
      controller: 'paCommentCtrl',
      resolve: {
        comment: function comment() {
          return _comment;
        }
      }
    });
    modalInstance.result.then(function () {
      paService.loadStudentComments($scope.student._id);
    });
  };

  $scope.deleteComment = function (comment) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Are you sure?'
        }
      }
    });
    modalInstance.result.then(function () {
      $http["delete"](config.apiUrl + '/ws/comments/' + comment._id).then(function (resp) {
        paService.loadStudentComments($scope.student._id);
      });
    });
  };

  $scope.addWorkplan = function () {
    var workplan = {
      teacher: $rootScope.user.channel
    };
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.workplan.html?088627e0a3487118',
      controller: 'paWorkplanCtrl',
      resolve: {
        data: function data() {
          return workplan;
        }
      }
    });
    modalInstance.result.then(function () {
      paService.loadWorkplans();
    });
  };

  $scope.editWorkplan = function (workplan) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.workplan.html?088627e0a3487118',
      controller: 'paWorkplanCtrl',
      resolve: {
        data: function data() {
          return workplan;
        }
      }
    });
    modalInstance.result.then(function () {
      paService.loadWorkplans();
    });
  };

  $scope.getLessons = function (id) {
    $http.get(config.apiUrl + '/ws/findLessonsByStudent/' + id).then(function (resp) {
      var folderMap = {};

      _.each($scope.conf.allFolders, function (folder) {
        folderMap[folder.code] = folder;
      });

      _.each(resp.data, function (lesson) {
        lesson.folder = folderMap[lesson.course];
      });

      $scope.lessons = resp.data;
    });
  };

  $scope.getStickers = function (id, course) {
    $http.get(config.apiUrl + '/ws/findStickers/' + id + '/' + course).then(function (resp) {
      $scope.stickers = resp.data;
    });
  };

  $scope.getScores = function (id) {
    $http.get(config.apiUrl + '/ws/findScores/' + id).then(function (resp) {
      $scope.scores = resp.data;
      $scope.checkUnits();
    });
  };

  $scope.checkUnits = function () {
    if ($scope.units && $scope.scores) {
      var map = {};

      for (var j = 0; j < $scope.scores.length; j++) {
        var score = $scope.scores[j];

        if (score.course == $scope.course) {
          map[score.unit] = score;
        }
      }

      for (var i = 0; i < $scope.units.length; i++) {
        var unit = $scope.units[i];

        if (map[unit.id]) {
          unit.score = map[unit.id];
        }
      }
    }
  };

  $scope.saveScore = function (unit) {
    unit.score.course = $rootScope.course;
    unit.score.student = $scope.student._id;
    unit.score.unit = unit.id;
    $http.post(config.apiUrl + '/ws/saveScore', unit.score).then(function (resp) {
      $scope.getScores($scope.student._id);
    });
  };

  $scope.addSticker = function () {
    paSocket.emit('student-id', $scope.student);
  };

  $scope.removeSticker = function (sticker) {
    $http.get(config.apiUrl + '/ws/removeSticker/' + sticker._id).then(function (resp) {
      $scope.getStickers($scope.student._id, $scope.student.course);
    });
  };

  $scope.setTab = function (i) {
    $scope.tab = i;
  };

  $scope.toggleVar = function (v) {
    paSocket.emit("toggle message", v);
  };

  $scope.togglePaid = function (lesson) {
    $http.post(config.apiUrl + '/ws/lessons/' + lesson._id + '/togglePaid').then(function (res) {
      $scope.getLessons($scope.student._id);
      $scope.getStudent($scope.student._id);
    });
  };

  $scope.addCoins = function (coins) {
    $http.post(config.apiUrl + '/ws/addCoins', {
      student: $scope.student._id,
      coins: Number(coins)
    }).then(function (res) {
      $scope.getStudent($scope.student._id);
      $("#coins").val(undefined);
    });
  };

  $scope.toggleTips = function(){
    var conf = paCache.getConf();
    $http.post('/ws/saveTeacher/'+conf.teacher._id, conf.teacher);
  }

  $scope.goto = function(state){
    $state.transitionTo(state,{organization:$rootScope.user.organization},{"reload":true});
  }

  $scope.editFolder = function(folder){
    $state.transitionTo('edit-folder',{folder:folder},{"reload":true});
  }

  $scope.subscribeChannel = function(channel){
    paChannel.subscribeChannel({channel:channel,student:$root.user.student}).then(function(student){

    })
  }

  $scope.popupTeacherProfile = function(teacher){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.teacherProfile.html?7f31e8897293210b',
      controller: 'popupTeacherProfileCtrl',
      resolve: {
        teacher: function() {
          return teacher;
        }
      }
    });
    modalInstance.result.then(function () {
      $scope.init();
    });  
  }

  $scope.init();
  angular.element(document).ready(function() {
    paIntro.pageTour('dashboard-'+$rootScope.user.role);
  })
}
"use strict";

dominoController.$inject = ["$scope", "$rootScope", "$http", "$state", "paSocket", "paCache", "paService", "config"];
angular.module('paApp').controller('dominoController', dominoController);

function dominoController($scope, $rootScope, $http, $state, paSocket, paCache, paService, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();
    var conf = paCache.getConf();
    $scope.data.players = _.map(conf.room.users, function (user) {
      return user.username;
    });
    $scope.player = $rootScope.user.username;

    if ($scope.admin) {
      if (conf.currentMode == 'P') {
        $http.get(config.apiUrl + '/ws/pageConf/' + $rootScope.user.channel + '/' + conf.currentPage._id).then(function (resp) {
          if (resp.data.img){
            loadResources(resp.data.img);
          } else if (resp.data.card){
            loadResources(resp.data.card);
          }
        });
      } else if (conf.currentContent.img){
        loadResources(conf.currentContent.img);
      } else if (conf.currentContent.card){
        loadResources(conf.currentContent.card);
      }
    }
  };

  paSocket.on('collection', function (collection) {
    var i = $scope.data.players.indexOf($scope.player);
    $scope.myCards = collection.resources.slice(i * 4, i * 4 + 4);
    $scope.resources = collection.resources.slice($scope.data.players.length * 4 + 1, collection.resources.length);
    $scope.cards = [];
  });

  $scope.getCard = function () {
    paSocket.emit('img message', {_id: $scope.player});
  };

  paSocket.on('img message', function (msg) {
    var card = $scope.resources.shift();

    if (msg._id == $scope.player) {
      $scope.myCards.push(card);
    }
  });

  $scope.playCard = function (card) {
    card.player = $scope.player;
    paSocket.emit('src message', card);
  };

  paSocket.on('src message', function (card) {
    card.push ? $scope.cards.push(card) : $scope.cards.unshift(card);

    if (card.player == $scope.player) {
      var leftCards = $scope.myCards.filter(function (c) {
        return c.id != card.id;
      });
      $scope.myCards = leftCards;
    }
  });

  $scope.undo = function (card) {
    if ($scope.admin && card.player) {
      paSocket.emit('undo', card);
    }
  };

  paSocket.on('undo', function (card) {
    var last = _.find($scope.cards, function (res) {
      return res.id == card.id;
    });

    if (last.player == $scope.player) {
      $scope.myCards.push(last);
    }

    var leftCards = $scope.cards.filter(function (c) {
      return c.id != card.id;
    });
    $scope.cards = leftCards;
  });

  var loadResources = function loadResources(code) {
    paService.findCollectionByCode(code).then(function (collection) {
      collection.resources = _.shuffle(collection.resources);
      paSocket.emit('collection', collection);
    });
  };

  $scope.init();
}

;
"use strict";

paEditContentCtrl.$inject = ["$scope", "$rootScope", "$state", "$http", "paCache", "paService", "paMenu", "config", "$uibModal"];
angular.module('paApp').controller('paEditContentCtrl', paEditContentCtrl);

function paEditContentCtrl($scope, $rootScope, $state, $http, paCache, paService, paMenu, config, $uibModal) {

    var conf = paCache.getConf();
    $scope.conf = conf;
    $scope.content = $state.params.content;

    $scope.template=$scope.content.page.template;

    $http.get('/ws/findSystemCollections/'+$scope.content.page._id).then(function(resp){
        $scope.collections = _.groupBy(resp.data, 'type');
    })

    $scope.saveContent=function(){
        $http.post('/ws/saveContent/'+$scope.content._id, $scope.content).then(
            function(result){
                $state.transitionTo('edit-folder',{folder:conf.currentFolder, forceReload:true});
            });
    }
    
    $scope.removeContent=function(){

        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
            controller: 'paConfirmCtrl',
            resolve: {
              message: function(){
                return 'Are you sure?'
              }
            }
          });
          modalInstance.result.then(function () {
            $http.put('/ws/contents/'+$scope.content._id,{deleted:true}).then(
                function(result){
                    $state.transitionTo('edit-folder',{folder:conf.currentFolder, forceReload:true});
                });
          });
      
    }

}
"use strict";

paEditPageCtrl.$inject = ["$scope", "$rootScope", "$state", "$http", "paCache", "paService", "paMenu", "config", "$uibModal", "toaster"];
angular.module('paApp').controller('paEditPageCtrl', paEditPageCtrl);

function paEditPageCtrl($scope, $rootScope, $state, $http, paCache, paService, paMenu, config, $uibModal, toaster) {

    var conf = paCache.getConf();
    $scope.conf = conf;
    $scope.templates=_.values(conf.templates);

    $scope.page = $state.params.page;
    if (!$scope.page){
        // add
        $scope.page={
            folder: conf.currentFolder._id,
            template: {},
            params: {}
        }
    }
    $scope.page.type='P';

    $scope.savePage=function(){
        $http.post('/ws/menu/savePage',$scope.page).then(
            function(result){
                if (result){
                    $state.transitionTo('edit-folder',{folder:conf.currentFolder, forceReload:true});
                }
            });
    }
    
    $scope.removePage=function(){

        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
            controller: 'paConfirmCtrl',
            resolve: {
              message: function(){
                return 'Are you sure?'
              }
            }
          });
          modalInstance.result.then(function () {
            $http.get('/ws/menu/removePage/'+$scope.page._id).then(
                function(result){
                    $state.transitionTo('edit-folder',{folder:conf.currentFolder, forceReload:true});
                });
          });
      
    }

}
"use strict";

eraserController.$inject = ["$scope", "$http", "$state", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('eraserController', eraserController);

function eraserController($scope, $http, $state, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();
  };

  $scope.showImage = function (i, val) {
    paSocket.emit("show message", [i, val]);
  };

  paSocket.on("show message", function (msg) {
    var i = msg[0];
    var val = msg[1];
    $scope.data.images[i].show = val;

    if (val) {
      $scope.initCanvas(i, '#ddd');
      $scope.setBg(i);
    }
  });

  $scope.initCanvas = function (i, fillColor) {
    var canvas = document.getElementById('c' + i);
    var ctx = canvas.getContext('2d'); // define a custom fillCircle method

    ctx.fillCircle = function (x, y, radius, fillColor) {
      this.fillStyle = fillColor;
      this.beginPath();
      this.moveTo(x, y);
      this.arc(x, y, radius, 0, Math.PI * 2, false);
      this.fill();
    };

    ctx.clearTo = function (fillColor) {
      ctx.fillStyle = fillColor;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    };

    ctx.clearTo(fillColor || "#ddd"); // bind mouse events

    canvas.onmousemove = function (e) {
      if (!canvas.isDrawing) {
        return;
      }

      var x = e.offsetX;
      var y = e.offsetY;
      var radius = 20; // or whatever

      var fillColor = '#ff0000';
      ctx.globalCompositeOperation = 'destination-out';
      ctx.fillCircle(x, y, radius, fillColor);
    };

    canvas.onmousedown = function (e) {
      canvas.isDrawing = true;
    };

    canvas.onmouseup = function (e) {
      canvas.isDrawing = false;
    };
  };

  $scope.setBg = function (i) {
    var div = angular.element('#d' + i);
    var image = $scope.data.images[i];
    div.css({
      'background': 'url(' + image.src + ')',
      'background-repeat': 'no-repeat',
      'background-size': '100%'
    });
  };

  $scope.init();
}

;
"use strict";

paFeedController.$inject = ["$scope", "$uibModal", "$state", "paFeed", "paService", "paCache", "config"];
angular.module('paApp').controller('paFeedController', paFeedController);

function paFeedController($scope, $uibModal, $state, paFeed, paService, paCache, config) {

    $scope.feed = _.clone($state.params.feed);

    $scope.saveFeed=function(feed){
        if (feed._id){
            paFeed.updateFeed(feed).then(function(resp){
                $state.go('feeds');
            });
        } else {
            paFeed.addFeed(feed).then(function(resp){
                $state.go('feeds');
            });
        }
    }

    $scope.removeFeed = function(feed){
        var modalInstance = $uibModal.open({
            animation: true,
            templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
            controller: 'paConfirmCtrl',
            resolve: {
              message: function(){
                return 'Are you sure?'
              }
            }
        });
        modalInstance.result.then(function () {
            paFeed.removeFeed(feed).then(function(resp){
                $state.go('feeds');
            });
        });

    }
};
"use strict";

paFeedsController.$inject = ["$scope", "$http", "$state", "paFeed", "paService", "paCache", "config"];
angular.module('paApp').controller('paFeedsController', paFeedsController);

function paFeedsController($scope, $http, $state, paFeed, paService, paCache, config) {

    var pageScope = paCache.getPageScope();
    $scope.pageScope = pageScope;
    $scope.type = 'F';

    var init=function(){
        paFeed.loadFeeds();
    }

    $scope.setType = function(type){
        $scope.type=type;
    }

    init();

};
"use strict";

paFolderCtrl.$inject = ["$scope", "$rootScope", "$state", "$http", "$uibModal", "paCache", "paMenu", "paService", "config"];
angular.module('paApp').controller('paFolderCtrl', paFolderCtrl);

function paFolderCtrl($scope, $rootScope, $state, $http, $uibModal, paCache, paMenu, paService, config) {

  var conf = paCache.getConf();
  conf.currentFolder = $state.params.folder;
  paCache.setCurrentMode('P');
  $scope.conf = conf;

  var res = _.find(conf.systemResources, function(res){
    return res.code==conf.currentFolder.code;
  });
  conf.currentFolder.isAdmin=res.isAdmin;

  $scope.init = function () {

    $scope.search={};
    paCache.setCurrentFolder(conf.currentFolder);
    paMenu.loadContents(conf.currentFolder, $state.params.forceReload);
    //paMenu.loadPages(conf.currentFolder, $state.params.forceReload);
  }

  $scope.setMode = function (mode) {
    paCache.setCurrentMode(mode);
    if (mode=='A' && !conf.currentFolder.audioCollections) {
      paService.loadAudioCollections(conf.currentFolder);
    }
  };


  $scope.startsWith = function (value) {
    if (value && value.name && $scope.search && $scope.search.name) {
      return value.name.toUpperCase().startsWith($scope.search.name.toUpperCase());
    } else {
      return true;
    }
  };

  $scope.sortPages = function (pages) {
    $http.post('/ws/menu/sortPages', pages).then(
      function (result) {
        conf.currentMode = 'P';
      });
  };

  $scope.addAudioCollection = function(collName){
    
    var conf = paCache.getConf();
    var audio = _.find(conf.currentFolder.pages, (page)=>{return page.type=='A'});
    if (audio) {
      var coll = {
        page: audio._id,
        folder: conf.currentFolder._id,
        type: 'audio',
        name: collName
      };
      $http.post(config.apiUrl + '/ws/saveSystemCollection', coll).then(function (resp) {
        paService.loadAudioCollections(conf.currentFolder);
      });
    }
  
  }

  $scope.editAudioCollection = function(coll){
    var conf = paCache.getConf();
    var audio = _.find(conf.currentFolder.pages, (page)=>{return page.type=='A'});
    if (audio) {
      conf.currentPage = audio;
      $http.get(config.apiUrl + '/ws/collections/' + coll._id).then(function(res){

        $state.transitionTo('edit-collection', {
          collection: res.data,
          tab: 2,
          back: 'edit-folder'
        });

      })
    }
  }

  $scope.removeAudioCollection = function(coll){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Are you sure?'
        }
      }
    });
    modalInstance.result.then(function () {
      $http.get(config.apiUrl + '/ws/removeCollection/' + coll._id).then(function (resp) {
        paService.loadAudioCollections(conf.currentFolder);
      });
    });
    
  }

  $scope.init();
}
"use strict";

gameController.$inject = ["$scope", "$rootScope", "$http", "paSocket", "paCache", "paService", "config"];
angular.module('paApp').controller('gameController', gameController);

function gameController($scope, $rootScope, $http, paSocket, paCache, paService, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  var conf = paCache.getConf();
  var data = paCache.init();

  $scope.init = function () {
    $scope.data = data;
    $scope.data.players = _.map(conf.room.users, function (user) {
      return user.username;
    });
    $scope.player = $rootScope.user.username;

    if ($scope.admin) {
      if (conf.currentMode == 'P') {
        $http.get(config.apiUrl + '/ws/pageConf/' + $rootScope.user.channel + '/' + conf.currentPage._id).then(function (resp) {
          if (resp.data && resp.data.mixed){
            loadResources(resp.data.mixed);
          }
        });
      } else if (conf.currentContent && conf.currentContent.mixed) {
        loadResources(conf.currentContent.mixed);
      }
    }

  };

  paSocket.on('images', function (images) {
    $scope.images = images.slice($scope.data.players.length * 4, images.length);
    var i = $scope.data.players.indexOf($scope.player);
    $scope.myCards = images.slice(i * 4, i * 4 + 4);
    $scope.cache = [];
  });

  $scope.getCard = function () {
    paSocket.emit('img message', {_id: $scope.player});
  };

  paSocket.on('img message', function (msg) {
    var card = $scope.images.shift();

    if (msg._id == $scope.player) {
      $scope.myCards.push(card);
    }
  });

  $scope.playCard = function (card) {
    card.player = $scope.player;
    paSocket.emit('src message', card);
  };

  paSocket.on('src message', function (card) {
    $scope.image = card;
    $scope.cache.push(card);

    if (card.player == $scope.player) {
      var leftCards = $scope.myCards.filter(function (c) {
        return c.id != card.id;
      });
      $scope.myCards = leftCards;
    }
  });

  $scope.undo = function () {
    paSocket.emit('undo', 'undo');
  };

  paSocket.on('undo', function (msg) {
    var last = $scope.cache.pop();

    if (last.player == $scope.player) {
      $scope.myCards.push(last);
    }

    if ($scope.cache.length > 0) {
      $scope.image = $scope.cache[$scope.cache.length - 1];
    } else {
      $scope.image = "";
    }
  });

  var loadResources = function (code) {
    data.selCollections.mixed = code;

    var mutiplier=Number(conf.currentPage.params.multiplier)||7;
    paService.findCollectionByCode(code).then(function (collection) {
      var resources = [];
      _.each(collection.resources, function(res){
        for (i=0;i<mutiplier;i++){
          resources.push(_.clone(res));
        }
      })
      for (var i = 0, l = resources.length; i < l; i++) {
        resources[i].id = i;
      }
      paSocket.emit('images', _.shuffle(resources));
  
    })

  }

  $scope.init();
}

;
"use strict";

game2Controller.$inject = ["$scope", "$http", "$state", "paSocket", "paService", "paCache", "config", "toaster"];
angular.module('paApp').controller('game2Controller', game2Controller);

function game2Controller($scope, $http, $state, paSocket, paService, paCache, config, toaster) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paCache.init();

    if ($scope.admin) {
      $http.get(config.apiUrl + '/ws/pageConf/' + $rootScope.user.channel + '/' + conf.currentPage._id).then(function (resp) {
        if (resp.data.img){
          paService.findCollectionByCode(resp.data.img).then(function (collection) {
            $scope.randomize(collection.resources);
          });
        } else {
          toaster.pop('warning','Warning', "No collection selected. Please select at least one collection.")
        }
      });
    }

    paService.findParams();
  };

  $scope.randomize = function (images) {
    for (var i = 0, l = images.length; i < l; i++) {
      images[i].id = i;
      images[i].rand = Math.random() * 100000;
    }

    images.sort(function (a, b) {
      return a.rand - b.rand;
    });
    paSocket.emit("images", images);
  };

  paSocket.on("images", function (images) {
    $scope.data.images = images;
  });

  $scope.adminToggleImage = function (i) {
    if ($scope.admin) {
      $scope.toggleImage(i);
    }
  };

  $scope.toggleImage = function (i) {
    var sel = $scope.data.selected[i];
    paSocket.emit("img2 message", [i, !sel]);
  };

  paSocket.on("img2 message", function (obj) {
    var i = obj[0];
    var sel = obj[1];
    paCache.setSelected(i, sel);
  });

  $scope.pop = function () {
    paSocket.emit('pop message', 'pop');
  };

  paSocket.on('pop message', function (msg) {
    if ($scope.data.images.length > 0) {
      $scope.data.images.pop();
    }
  });

  $scope.ratio = function (img) {
    return {
      'padding-bottom': img.height / img.width * 100 + '%'
    };
  };

  $scope.fontSize = function (elem) {
    var w = angular.element('#' + elem).width();
    return {
      'font-size': w + 'px'
    };
  };

  $scope.init();
}

;
"use strict";

guessNumberCtrl.$inject = ["$scope", "$state", "$rootScope", "$http", "$uibModal", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('guessNumberCtrl', guessNumberCtrl);

function guessNumberCtrl($scope, $state, $rootScope, $http, $uibModal, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();
    $scope.numbers = _.range(1, 101);
  };

  $scope.tagImage = function (i, tag) {
    paSocket.emit("img2 message", [i, tag]);
  };

  paSocket.on("img2 message", function (obj) {
    var i = obj[0];
    var sel = obj[1];
    paCache.setSelected(i, sel);
  });
  $scope.init();
}

;
"use strict";

paIntroController.$inject = ["$scope", "$http", "$state", "paIntro", "paService", "paCache", "config"];
angular.module('paApp').controller('paIntroController', paIntroController);

function paIntroController($scope, $http, $state, paIntro, paService, paCache, config) {

  $scope.init = function(){
    $scope.step=$state.params.step;
    paIntro.getSteps().then(function(steps){
      $scope.steps=steps;
    });
  }

  $scope.saveSteps = function() {
    paIntro.saveSteps($scope.steps);
  }

  $scope.saveStep = function() {
    paIntro.saveStep($scope.step);
  }

  $scope.removeStep = function() {
    paIntro.removeStep($scope.step);
  }

  $scope.init();
};
"use strict";

jcropController.$inject = ["$scope", "$http", "$state", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('jcropController', jcropController);

function jcropController($scope, $http, $state, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();

    if (!$scope.opacity) {
      $scope.opacity = {
        min: 0,
        max: 10,
        step: 1
      };
    }
  };

  $scope.cropImage = function (i) {
    if (i != $scope.data.selectedImage || ($scope.data.enableJcrop && !$scope.data.jcrop_api)) {
      paSocket.emit("jcrop message", i);
    }
  };


  $scope.setOpacity = function () {
    paService.saveParam('opacity', $scope.data.opacity);
    paSocket.emit("opacity", $scope.data.opacity);
  };


  $scope.init();
};
"use strict";

levelsCtrl.$inject = ["$scope", "$rootScope", "$state", "$http", "$uibModal", "paCache", "paMenu"];
angular.module('paApp').controller('levelsCtrl', levelsCtrl);

function levelsCtrl($scope, $rootScope, $state, $http, $uibModal, paCache, paMenu) {

    $scope.conf = paCache.getConf();
    console.log('levels: has full:'+$scope.conf.teacher.hasFull);

    $scope.unlockFolder = function(folder){
      $http.post('/ws/folders/'+folder._id+'/unlock').then(function(resp){
        paMenu.loadMyFolders($rootScope.user.teacher);
      })
    }

      $scope.goto = function(state){
        $state.transitionTo(state);
      }
        
}
"use strict";

navCtrl.$inject = ["$scope", "$rootScope", "$http", "$uibModal", "$window", "paCache", "paSocket", "config"];
angular.module('paApp').controller('navCtrl', navCtrl);

function navCtrl($scope, $rootScope, $http, $uibModal, $window, paCache, paSocket, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.logout = function () {
    $window.localStorage.removeItem('pa.token');
    $http.get(config.apiUrl + '/ws/logout').then(function (resp) {
      $window.location = '/';
    });
  };

  $scope.toggleSidebar = function () {
    var conf = paCache.getConf();
    var show = conf.sidebar && conf.sidebar.show;
    paSocket.emit('conf', {
      "var": 'sidebar',
      val: {
        show:!show
      }
    });
  };

  $scope.toggleLock = function (user) {
    var locked=user.params.locked=='true';
    paSocket.emit('saveUserParam', {
      user: user.id,
      name: 'locked',
      value: !locked
    });
  };

  $scope.addPoint = function (user) {
    paSocket.emit("saveUserParam", {
      user: user.id,
      name: 'points',
      value: Number(user.params.points) + 1
    });
  };

  $scope.remPoint = function (user) {
    paSocket.emit("saveUserParam", {
      user: user.id,
      name: 'points',
      value: Number(user.params.points) - 1
    });
  };

  var conf = paCache.getConf();

  this.init = function () {
    $scope.conf = conf;
    $scope.data = paCache.getData();
    $scope.feed = paCache.getFeed();
    $scope.alerts = paCache.getAlerts();
    $scope.events = paCache.getEvents();
    $scope.localization = paCache.getLocalization();

    $rootScope.$watch('user', function (oldVal, newVal) {
      if ($rootScope.user && $rootScope.user.student) {
        $http.post(config.apiUrl + '/ws/getPosts', {
          student: $rootScope.user.student,
          winner: true
        }).then(function (resp) {
          $scope.posts = resp.data;
        });
      }
    });
  };

  $scope.saveLocale = function (l) {
    if ($rootScope.user && $rootScope.user.id) {
      $http.post(config.apiUrl + '/ws/saveUser/' + $rootScope.user.id, {locale: l.code}).then(function (resp) {
        paCache.setUserLocale(resp.data.locale);
        $window.location = '/home.html';
      });
    } else {
      paCache.setUserLocale(l.code);
      $window.location = '/home.html';
    }
  };

  $scope.popupComments = function (_user) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.comments.html?4c83952bd1b46c71',
      controller: 'paCommentsCtrl',
      size: 'lg',
      resolve: {
        user: function user() {
          return _user;
        }
      }
    });
    modalInstance.result.then(function (item) {
      $scope.setContent(item);
    });
  };

  $scope.popupPrivacy = function () {
    $uibModal.open({
      animation: true,
      templateUrl: '/privacy.html',
      controller: 'conditionsCtrl',
      size: 'lg'
    });
  };

  $scope.popupConditions = function () {
    $uibModal.open({
      animation: true,
      templateUrl: '/conditions.html',
      controller: 'conditionsCtrl',
      size: 'lg'
    });
  };

  $scope.toggleVideo = function () {
    var active = conf.video && conf.video.active;
    paSocket.emit('video', {
      active: !active,
      fullscreen: false
    });
  };

  $scope.toggleFullscreen = function () {
    paSocket.emit('video', {
      active: true,
      fullscreen: !conf.video.fullscreen
    });
  };

  /*var loadOpentok = function loadOpentok() {
    $http.get(config.apiUrl + '/ws/opentokClient/' + $rootScope.user.teacher).then(function (resp) {
      $scope.opentokClient = resp.data;
    });
  };*/

  $scope.editRoom = function () {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.room.html?b9d7ae9fb8f1ebea',
      controller: 'paRoomCtrl',
      size: 'lg',
      resolve: {
        subscriptions: function subscriptions() {
          return $scope.subscriptions;
        }
      }
    });
  };

  $scope.lockAll = function(){
    var conf = paCache.getConf();
    conf.lockAll=!conf.lockAll;
    _.each(conf.room.users, function(user){
      if (user.student){
        paSocket.emit('saveUserParam', {
          user: user.id,
          name: 'locked',
          value: conf.lockAll
        });
      }
    })
  }

  $scope.popupUserParams = function (_user) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.userParams.html?4564b26df7f54d07',
      controller: 'popupUserParamsCtrl',
      size: 'lg',
      resolve: {
        user: function user() {
          return _user;
        }
      }
    });
    modalInstance.result.then(function (item) {
      $scope.setContent(item);
    });
  };

  this.init();
}
"use strict";

pictogramCtrl.$inject = ["$scope", "$rootScope", "$stateParams", "$http", "paService", "paCache", "paAcl", "toaster", "config"];
angular.module('paApp').controller('pictogramCtrl', pictogramCtrl);

function pictogramCtrl($scope, $rootScope, $stateParams, $http, paService, paCache, paAcl, toaster, config) {
  $scope.init = function () {
    $scope.type = $stateParams.type;
    $http.get(config.apiUrl + '/ws/collections/' + $stateParams.collection._id).then(function(res){
      var coll = res.data;
      coll.isSystem = !coll.teacher;
      $scope.collection = coll;

      if ($scope.type == 'text') {
          var words = paService.split($scope.collection.chars, '#');

          if (!$scope.collection.resources) {
            $scope.collection.resources = words;
          } else {
            _.each($scope.collection.resources, function (res, i) {
              res.chars = words[i].chars;
            });
          }
      }

    })

    var conf = paCache.getConf();
    $scope.isFolderAdmin = ($rootScope.user.role=='E' && conf.currentFolder.isAdmin);
  };

  $scope.setSize = function (i, e) {
    var event = window.event || e;
    var item = $scope.collection.resources[i];

    if (!item.width) {
      item.width = 10;
    }

    var delta = Math.max(-1, Math.min(1, event.wheelDelta || -event.detail));

    if (delta > 0) {
      item.width++;
    } else {
      item.width--;
    }
  };

  $scope.setFontSize = function (i, e) {
    var event = window.event || e;
    var item = $scope.collection.resources[i];

    if (!item.fontSize) {
      item.fontSize = 10;
    }

    var delta = Math.max(-1, Math.min(1, event.wheelDelta || -event.detail));

    if (delta > 0) {
      item.fontSize++;
    } else {
      item.fontSize--;
    }
  };

  $scope.setPosition = function (i, e) {
    var event = window.event || e;
    var item = $scope.collection.resources[i];
    if (event.keyCode == 38) item.top++;else if (event.keyCode == 39) item.left++;else if (event.keyCode == 40) item.top--;else if (event.keyCode == 37) item.left--;
  };

  $scope.saveItems = function () {
    if ($scope.isFolderAdmin) {
      $http.post(config.apiUrl + '/ws/saveSystemCollection', $scope.collection).then(function (resp) {
        toaster.pop('success', 'Pictogram', 'pictogram saved');
      });
    } else {
      $http.post(config.apiUrl + '/ws/saveCollection', $scope.collection).then(function (resp) {
        toaster.pop('success', 'Pictogram', 'pictogram saved');
      });
    }
  };

  $scope.selectItem = function (i) {
    $scope.selected = i;
  };

  $scope.init();
}

;
"use strict";

publishCtrl.$inject = ["$scope", "$http", "$rootScope", "$state", "$uibModalInstance", "paCache", "div", "text", "time", "toaster", "config"];
angular.module('paApp').controller('publishCtrl', publishCtrl);

function publishCtrl($scope, $http, $rootScope, $state, $uibModalInstance, paCache, div, text, time, toaster, config) {
  $scope.init = function () {
    $scope.data = paCache.getData();
    $scope.getSubscriptions();
    var conf = paCache.getConf();
    $scope.post = {
      page: conf.currentPage._id,
      date: new Date(),
      teacher: conf.teacher
    };

    if (text) {
      $scope.textValue = text;
    } else if (time) {
      var e = angular.element('#' + time);
      $scope.timeValue = e.text();
    } else {
      var e = document.getElementById(div);

      if (e) {
        var options = {
          ignoreElements: function ignoreElements(element) {
            return element.className.indexOf('fa') != -1 || element.className.indexOf('bottombar') != -1;
          },
          useCORS: true
        };
        html2canvas(e, options).then(function (canvas) {
          console.log('canvas width: ' + canvas.width);
          console.log('canvas height: ' + canvas.height);
          $scope.base64 = canvas.toDataURL('image/jpeg', 0.8);
          console.log('base64 length: ' + $scope.base64.length + ' bytes');
          $scope.$apply();
        });
      }
    }
  };

  $scope.getSubscriptions = function () {
    var conf = paCache.getConf();
    $scope.data.students = _.map(conf.room.subscriptions, function (subscr) {
      return subscr.student;
    });
  };

  $scope.savePost = function () {
    $scope.post.student = _.filter($scope.data.students, 'selected');
    if ($scope.post.student.length) {
      $scope.spinning = true;
      var now = new Date();
      $http.post(config.apiUrl + '/ws/saveBlob/home', {
        folder: $scope.post.student,
        name: now.getTime(),
        data: $scope.base64
      }).then(function (resp) {
        if ($scope.base64) {
          $scope.post.image = resp.data;
        }

        if ($scope.timeValue) {
          $scope.post.timeValue = $scope.timeValue;
        }

        if ($scope.textValue) {
          $scope.post.textValue = $scope.textValue;
        }

        $http.post(config.apiUrl + '/ws/savePost', $scope.post).then(function (resp) {
          $scope.spinning = false;
          toaster.pop('success', "Post", "post published");
          $uibModalInstance.dismiss('cancel');
        });
      });
    } else {
      toaster.pop('error', "Post", "select student");
    }
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.init();
}

;
"use strict";

shopController.$inject = ["$scope", "$rootScope", "$state", "$http", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('shopController', shopController);

function shopController($scope, $rootScope, $state, $http, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();
    $scope.data.selectedSmiles = {};
    $scope.smiles = [];
    $scope.data.counter = 0;

    for (var i = 0; i < 30; i++) {
      $scope.smiles.push(i);
    }
  };

  $scope.init();
}

;
"use strict";

sidebarCtrl.$inject = ["$scope", "$rootScope", "$uibModalInstance", "paCache", "paService"];
angular.module('paApp').controller('sidebarCtrl', sidebarCtrl);

function sidebarCtrl($scope, $rootScope, $uibModalInstance, paCache, paService) {
  $scope.init = function () {
    $scope.conf = paCache.getConf();

    if ($scope.conf.currentFolder.demoMode || !$rootScope.paFeatures.pages) {
      $scope.conf.currentMode = 'C';
    }
  };

  $scope.open = function (folder) {
    $scope.selected != folder.name ? $scope.selected = folder.name : $scope.selected = null;
  };

  $scope.setFolder = function (folder) {
    paCache.setCurrentFolder(folder);
    paService.loadContents(folder);
    //paService.loadPages(folder);

    if ($scope.conf.currentFolder.demoMode) {
      $scope.conf.currentMode = 'C';
    }
  };

  $scope.setWorkplan = function (workplan) {
    paCache.setCurrentFolder(workplan);
    paService.loadWorkplan(workplan);
  };

  $scope.init();

  $scope.setMode = function (mode) {
    paCache.setCurrentMode(mode);
  };

  $scope.setPage = function (page) {
    $uibModalInstance.close(page);
  };

  $scope.setContent = function (content) {
    paCache.setCurrentContent(content);
    $uibModalInstance.close(content);
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.startsWith = function (value) {
    if (value && value.name && $scope.search && $scope.search.name) {
      return value.name.toUpperCase().startsWith($scope.search.name.toUpperCase());
    } else {
      return true;
    }
  };
}

;
"use strict";

sizeFactorCtrl.$inject = ["$scope", "$stateParams", "$http", "config"];
angular.module('paApp').controller('sizeFactorCtrl', sizeFactorCtrl);

function sizeFactorCtrl($scope, $stateParams, $http, config) {
  $scope.init = function () {
    $scope.collection = $stateParams.collection;

    _.each($scope.collection.resources, function (resource) {
      if (!resource.sizeFactor) {
        resource.sizeFactor = 1;
      }
    });
  };

  $scope.factorMe = function (v, sizeFactor) {
    var w = sizeFactor ? v * sizeFactor : v;
    return {
      width: w + 'vw',
      position: 'relative',
      "float": 'left'
    };
  };

  $scope.saveItems = function () {
    $http.post(config.apiUrl + '/ws/saveCollection', $scope.collection);
  };

  $scope.init();
}

;
"use strict";

paSongsCtrl.$inject = ["$scope", "$uibModalInstance", "paService", "paCache", "ngAudio", "coll"];
angular.module('paApp').controller('paSongsCtrl', paSongsCtrl);

function paSongsCtrl($scope, $uibModalInstance, paService, paCache, ngAudio, coll) {

    var init = function(){
      var audioCollection = [];
      _.each(coll.resources, function (res) {
        audioCollection.push({
          title: res.title,
          i: res.src
        });
      });
      $scope.audioCollection = audioCollection;

    }

    $scope.select = function(audio){
        $uibModalInstance.close(audio);
    }

    init();
};
"use strict";

stickersController.$inject = ["$scope", "$rootScope", "$http", "$state", "$stateParams", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('stickersController', stickersController);

function stickersController($scope, $rootScope, $http, $state, $stateParams, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    if ($stateParams.student && $stateParams.student._id) {
      $scope.student = $stateParams.student;
    }

    $scope.data = paService.init();
  }

  $scope.selectImage = function (i) {
    paSocket.emit("img message", {_id: i});
  };

  $scope.selected = [];
  paSocket.on("img message", function (msg) {
    $scope.selected[msg._id] = !$scope.selected[msg._id];
  });

  $scope.save = function () {
    for (var i in $scope.selected) {
      if ($scope.selected[i]) {
        $http.post(config.apiUrl + '/ws/addSticker/' + $scope.student._id + '/' + $scope.student.course, {
          "src": $scope.data.images[i].src
        }).then(function (resp) {
          // force student dashboard to reload
          paSocket.emit("page message", {
            code: "dashboard"
          });
        });
      }
    }
  };

  $scope.init();
}

;
"use strict";

subscriptionsController.$inject = ["$scope", "$rootScope", "$http", "paSocket", "config"];
angular.module('paApp').controller('subscriptionsController', subscriptionsController);

function subscriptionsController($scope, $rootScope, $http, paSocket, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.getSubscriptions();
  };

  $scope.getSubscriptions = function () {
    $http.get(config.apiUrl + '/ws/findSubscriptions/' + $rootScope.user.channel).then(function (resp) {
      $scope.subscriptions = resp.data;
    });
  };

  $scope.saveSubscription = function (subscription) {
    $http.post(config.apiUrl + '/ws/saveSubscription/' + subscription._id, subscription);
  };

  $scope.init();
}

;
"use strict";

textController.$inject = ["$scope", "$http", "$state", "$rootScope", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('textController', textController);

function textController($scope, $http, $state, $rootScope, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();
    paService.findText().then(function (data) {
      if (data) {
        $scope.chars = _.filter(data.chars, function (c) {
          return c.val != '';
        });
      }
    });
    $scope.selected = -1;
  };

  $scope.isSelected = function (i) {
    return i >= $scope.data.start && i <= $scope.data.end;
  };

  $scope.getSelectionText = function () {
    if (window.getSelection()) {
      if (window.getSelection().toString()) {
        // text selection
        var range = window.getSelection().getRangeAt(0);
        var s = range.startContainer.parentElement.id;
        var e = range.endContainer.parentElement.id;
        paSocket.emit('text', {
          start: s,
          end: e
        });
      } else {
        // click
        var b = '., ';
        var anchorNode = window.getSelection().anchorNode;

        if (b.indexOf(anchorNode.nodeValue) == -1) {
          var l = $scope.chars.length;
          var i = parseInt(anchorNode.parentElement.id);
          var e = i;

          while (e < l && $scope.chars[e + 1] && b.indexOf($scope.chars[e + 1].val) == -1) {
            e = e + 1;
          }

          var s = i;

          while (s > 0 && $scope.chars[s - 1] && b.indexOf($scope.chars[s - 1].val) == -1) {
            s = s - 1;
          }

          paSocket.emit('text', {
            start: s,
            end: e
          });
        }
      }
    }
  };

  $scope.hideText = function (bool) {
    paSocket.emit('var', {
      'var': 'hideText',
      'val': bool
    });
  };

  $scope.init();
}

;
"use strict";

textEditorController.$inject = ["$scope", "$http", "$state", "$stateParams", "$uibModal", "$rootScope", "config"];
angular.module('paApp').controller('textEditorController', textEditorController);

function textEditorController($scope, $http, $state, $stateParams, $uibModal, $rootScope, config) {
  $scope.init = function () {
    $scope.text=$scope.paText;
    $scope.editable = false;
    $scope.fontFamilies = ['Segoe UI', 'Georgia', 'Palatino Linotype', 'Book Antiqua', 'Times New Roman', 'Arial', 'Helvetica', 'Arial Black', 'Impact', 'Lucida Sans Unicode', 'Tahoma', 'Verdana', 'Courier New', 'Lucida Console', 'Sans-serif', 'Comic Sans MS', 'initial'];
  };

  $scope.getSelectionText = function () {
    if (window.getSelection().toString()) {
      // text selection
      var range = window.getSelection().getRangeAt(0);
      $scope.start = parseInt(range.startContainer.parentElement.id);
      $scope.end = parseInt(range.endContainer.parentElement.id);
    }
  };

  $scope.clearSelection = function () {
    $scope.start = undefined;
    $scope.end = undefined;
    window.getSelection().removeAllRanges();
  };

  $scope.applyFontFamily = function (family) {
    for (var i = $scope.start; i <= $scope.end; i++) {
      $scope.text.chars[i].fontFamily = family;
    }

    $scope.clearSelection();
  };

  $scope.applyColor = function (style) {
    for (var i = $scope.start; i <= $scope.end; i++) {
      $scope.text.chars[i].color = style;
    }

    $scope.clearSelection();
  };

  $scope.applyWeight = function (style) {
    for (var i = $scope.start; i <= $scope.end; i++) {
      $scope.text.chars[i].weight = style;
    }

    $scope.clearSelection();
  };

  $scope.applySize = function (style) {
    for (var i = $scope.start; i <= $scope.end; i++) {
      $scope.text.chars[i].size = style;
    }

    $scope.clearSelection();
  };

  $scope.clearStyle = function () {
    for (var i = $scope.start; i <= $scope.end; i++) {
      $scope.text.chars[i].color = null;
      $scope.text.chars[i].weight = null;
      $scope.text.chars[i].size = null;
      $scope.text.chars[i].fontFamily = null;
    }

    $scope.clearSelection();
  };

  $scope.init();
}

;
"use strict";

paWebinarCtrl.$inject = ["$scope", "$rootScope", "$uibModal", "webinarService", "paCache", "config"];
angular.module('paApp').controller('paWebinarCtrl', paWebinarCtrl);

function paWebinarCtrl($scope, $rootScope, $uibModal, webinarService, paCache, config) {

    var pageScope = paCache.initPageScope();

    $scope.init = function init() {
        $scope.pageScope = pageScope;
        webinarService.loadUpcomingWebinar($rootScope.user.teacher);
    };

  $scope.removeWebinarSubscription = function(subscr){
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Вы уверены? Отказавшись от участия в вебинаре, Вы будете изучать платформу САМОСТОЯТЕЛЬНО по вебинарам в записи?'
        }
      }
    });
    modalInstance.result.then(function () {
      webinarService.removeSubscription(subscr).then(function(subscr){
        webinarService.loadUpcomingWebinar();
      });
    });
  }

  $scope.editWebinarSubscription = function(subscr){
    $uibModal.open({
      animation: true,
      templateUrl: '/pa/popup.webinarSubscription.html?2f31c0dd7e70f3b7',
      controller: 'webinarSubscriptionCtrl',
      size: 'lg',
      resolve : {
        webinarSubscription : function(){
          return subscr;
        }
      }
    });
  }

  $scope.init();
}
"use strict";

paController.$inject = ["$scope", "$rootScope", "$http", "paSocket", "paService", "paCache", "paStyle", "config"];
angular.module('paApp').controller('paController', paController);

function paController($scope, $rootScope, $http, paSocket, paService, paCache, paStyle, config) {
  $scope.$on('$destroy', function (event) {
    paService.destroy();
  });

  $scope.init = function () {
    $scope.data = paService.init();
    $scope.conf = paCache.getConf();
    if ($scope.conf.currentMode == 'H'){
      var student=$rootScope.user.student||$scope.conf.asStudent._id;
      $http.get('/ws/rec/contents/'+$scope.conf.currentContent._id+'/students/'+student).then(function(resp){
        var rec = resp.data;
        $http.get('/ws/event/'+resp.data._id+'/find').then(function(resp){
            if (resp.data){
                _.each(resp.data, function (msg) {
                    paSocket.emit(msg.name, msg.data);
                });
            }
            if ($rootScope.user.role=='S'){
              $scope.data.rec = rec;
            }
        })
      })

    }
    $scope.sortableOptions = {
      'ui-floating': true,
      stop: function stop(e, ui) {
        paSocket.emit('images', $scope.data.images);
      }
    };
    $scope.sortableOptions2 = {
      'ui-floating': true,
      stop: function stop(e, ui) {
        paSocket.emit('images2', $scope.data.images2);
      }
    };
    $scope.sortableLineWords = {
      'ui-floating': true,
      stop: function stop(e, ui) {
        var i = Number(e.target.id);
        var order = _.map($scope.data.lines[i].words,'i');
        paSocket.emit('line', {i:i, order:order});
      }
    };
    paStyle.loadPageStyles();
  };

  $scope.init();
}
"use strict";

paPaymentsCtrl.$inject = ["$scope", "$rootScope", "$http", "$window", "paCache", "config"];
angular.module('paApp').controller('paPaymentsCtrl', paPaymentsCtrl);

function paPaymentsCtrl($scope, $rootScope, $http, $window, paCache, config) {
  $scope.init = function init() {
    $scope.findPayments();
  };

  $scope.findPayments = function findPayments() {
    $http.get(config.apiUrl + '/ws/findPaymentRows/' + $rootScope.user.teacher).then(function (res) {
      $scope.rows = res.data;
    });
  };

  $scope.init();
}
"use strict";

popupCtrl.$inject = ["$scope", "$uibModal"];
angular.module('paApp').controller('popupCtrl', popupCtrl);

function popupCtrl($scope, $uibModal) {
  $scope.popup = function (res) {
    window.scrollTo(0,0);
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.publish.html?f8edff017f11d780',
      controller: 'publishCtrl',
      size: 'lg',
      resolve: {
        div: function div() {
          return $scope.paDiv;
        },
        text: function text() {
          return $scope.paText;
        },
        time: function time() {
          return $scope.paTime;
        }
      }
    });
  };
}
'use strict';

popupHomeworkCommentCtrl.$inject=["$scope","$rootScope","$uibModalInstance","paHomework","paCache","p"];
angular.module('paApp').controller('popupHomeworkCommentCtrl', popupHomeworkCommentCtrl);

function popupHomeworkCommentCtrl($scope, $rootScope, $uibModalInstance, paHomework, paCache, p){

    var conf = paCache.getConf();
    if (p) {
        // edit or remove
        $scope.comment = conf.currentHomework.comments[p.i];
        $scope.action = p.action;
    }

    $scope.saveComment = function(){
        paHomework.saveComment(conf.currentHomework, $scope.comment).then(function(res){
            $uibModalInstance.close(res);
        })
    }

    $scope.updateComment = function(){
        paHomework.updateComment(conf.currentHomework, p.i, $scope.comment).then(function(res){
            $uibModalInstance.close(res);
        })
    }

    $scope.removeComment = function(){
        paHomework.removeComment(conf.currentHomework, p.i).then(function(res){
            $uibModalInstance.close(res);
        })
    }

    $scope.close = function(){
        $uibModalInstance.dismiss('cancel');
    }

}
'use strict';

popupHomeworkCtrl.$inject=["$scope","$rootScope","$uibModalInstance","paHomework","paCache","homework","options", "toaster"];
angular.module('paApp').controller('popupHomeworkCtrl', popupHomeworkCtrl);

function popupHomeworkCtrl($scope, $rootScope, $uibModalInstance, paHomework, paCache, homework, options, toaster){

    var conf = paCache.getConf();
    $scope.conf = conf;
    $scope.homework = homework;
    $scope.options = options;
    $scope.pageScope = paCache.getPageScope();

    $scope.loadHomeworks = function(student){
        paHomework.loadHomeworks(student);
    }

    $scope.addToHomework = function() {
        paHomework.addHomework($scope.homework).then(function(res){
            toaster.pop('success', 'Homework', 'Task added succesfully to homeworks');
            $uibModalInstance.close();
        });
    }

    $scope.editHomework = function() {
        paHomework.editHomework($scope.homework).then(function(res){
            toaster.pop('success', 'Homework', 'Task saved succesfully to homeworks');
            $uibModalInstance.close();
        });
    }

    $scope.removeHomework = function() {
        paHomework.removeHomework($scope.homework).then(function(res){
            toaster.pop('success', 'Homework', 'Task removed succesfully from homeworks');
            $uibModalInstance.close();
        });
    }

    $scope.close = function(){
        $uibModalInstance.dismiss('cancel');
    }
}
"use strict";

popupOrgSubscriptionCtrl.$inject = ["$scope", "$uibModalInstance", "$rootScope", "subsr", "paTeacher"];
angular.module('paApp').controller('popupOrgSubscriptionCtrl', popupOrgSubscriptionCtrl);

function popupOrgSubscriptionCtrl($scope, $uibModalInstance, $rootScope, subscr, paTeacher) {
    $scope.folder = subsr.folder;

    paTeacher.getOrganizationTeachersByFolder($rootScope.user.organization, subscr.folder.id)
        .then(function(resp){
            $scope.teachers = resp.data;
        })

    $scope.select = function(teacher){
        $uibModalInstance.close({teacher:teacher});
    }

    $scope.cancel = function(){
        $uibModalInstance.dismiss();
    }

}
"use strict";

popupResourcesCtrl.$inject = ["$scope", "$rootScope", "$uibModalInstance", "paCache", "type", "resource", "$http", "$q", "googleApiConfig", "$sce"];
angular.module('paApp').controller('popupResourcesCtrl', popupResourcesCtrl);
angular.module("paApp").filter('trustThisUrl', ["$sce", function ($sce) {
  return function (val) {
    return $sce.trustAsResourceUrl(val);
  };
}]);

function popupResourcesCtrl($scope, $rootScope, $uibModalInstance, paCache, type, resource, $http, $q, googleApiConfig, $sce) {

  var conf = paCache.getConf();
  var pageScope = paCache.initPageScope();

  var init = function () {
    $scope.conf = conf;
    $scope.pageScope = pageScope;

    $scope.isFolderAdmin = ($rootScope.user.role == 'E' && conf.currentFolder.isAdmin);

    $scope.resource = resource;
    $scope.type = type;
    pageScope.r = {};
    pageScope.c = {
      resources: []
    };
    $scope.googleImages = []
    $scope.loadingGoogleImages = false;
    $scope.youtubeVideos = []
    $scope.loadingYoutubeVideos = false;

  }

  $scope.next = function () {
    $scope.resource.chars = [];
    for (var i = 0, l = pageScope.r.text.length; i < l; i++) {
      $scope.resource.chars.push({
        val: pageScope.r.text.charAt(i)
      });
    }
  };

  $scope.addText = function () {

    var chunks = pageScope.r.text.split('#');
    _.each(chunks, function (chunk) {
      chunk = chunk.trim();
      var resource = {
        chars: [],
        type: 'text'
      };
      for (var i = 0, l = chunk.length; i < l; i++) {
        resource.chars.push({
          val: chunk.charAt(i)
        });
      }
      pageScope.c.resources.push(resource);
    })

    $uibModalInstance.close(pageScope.c);
  };

  $scope.addAudio = function () {
    _.each(pageScope.c.resources, function (res) {
      res.type = 'audio';
    });
    $uibModalInstance.close(pageScope.c);
  }

  $scope.addVideo = function () {
    pageScope.r.type = 'video';
    pageScope.c.resources.push(pageScope.r);
    $uibModalInstance.close(pageScope.c);
  }

  $scope.addUrl = function () {
    pageScope.r.type = 'url';
    pageScope.c.resources.push(pageScope.r);
    $uibModalInstance.close(pageScope.c);
  }

  $scope.save = function () {
    _.extend($scope.resource, pageScope.r);
    $uibModalInstance.close($scope.resource);
  }

  $scope.addImages = function () {
    _.each(pageScope.c.resources, function (res) {
      res.type = 'img';
    });

    $uibModalInstance.close(pageScope.c);
  }

  $scope.cancel = function () {
    $uibModalInstance.dismiss();
  }

  $scope.submitQuickInsert = function () {
    $uibModalInstance.close(pageScope.text);
  }

  $scope.searchGoogleImages = function (name) {
    if (!name) {
      alert("please add name")
    } else {
      $scope.googleImages = [];
      $scope.loadingGoogleImages = true
      for (let i = 0; i < googleApiConfig.maxImagesResults / 10; i++) {
        $scope.searchEngine((i * 10), name)

      }
    }
  }
  $scope.searchEngine = function (pageNum, query) {
    $http.get(googleApiConfig.imageSearchUrl + '?key=' + googleApiConfig.projectKey + '&cx=' + googleApiConfig.cx + '&q=' + query + '&searchType=' + googleApiConfig.searchType + '&start=' + pageNum)
      .then(function (response) {
        if (response.data.searchInformation.totalResults > 0) {
          Array.prototype.push.apply($scope.googleImages, response.data.items);
          $scope.loadingGoogleImages = false;
        }
      });

  }

  $scope.setImageUrl = function (imgUrl) {
    pageScope.r.src = imgUrl;
    $scope.googleImages = [];
  }

  $scope.updateImageUrl = function (imgUrl) {
    $scope.resource.src = imgUrl;
    $scope.googleImages = [];
  }

  $scope.checkAndSearchGoogleImages = function (keyEvent, name) {
    if (keyEvent.which === 13) {
      $scope.searchGoogleImages(name);
    }
  }


  //youtube apis
  $scope.searchYoutubeVideos = function (name) {
    if (!name) {
      alert("please add name")
    } else {
      $scope.youtubeVideos = [];
      $scope.loadingYoutubeVideos = true;
      $scope.searchYoutubeEngine(name)
    }
  }
  $scope.searchYoutubeEngine = function (query) {
    $http.get(googleApiConfig.youtubeSearchUrl + '?key=' + googleApiConfig.projectKey + '&q=' + query + '&type=video&part=snippet&maxResults=' + googleApiConfig.maxYoutubeVideoResults)
      .then(function (response) {
        if (response.data.pageInfo.totalResults > 0) {
          $scope.youtubeVideos = response.data.items;
          $scope.youtubeVideos.forEach(item => item.url = "https://www.youtube.com/embed/" + item.id.videoId)
          $scope.loadingYoutubeVideos = false;
        }
      });

  }

  $scope.setVideoUrl = function (videoObj) {
    pageScope.r.src = videoObj.id.videoId;
    $scope.youtubeVideos = [];
  }

  $scope.updateVideoUrl = function (videoObj) {
    $scope.resource.src = videoObj.id.videoId;
    $scope.youtubeVideos = [];
  }

  $scope.checkAndSearchYoutubeVideos = function (keyEvent, name) {
    if (keyEvent.which === 13) {
      $scope.searchYoutubeVideos(name);
    }
  }


  init();
}
"use strict";

popupTeacherProfileCtrl.$inject = ["$scope", "$uibModalInstance", "$rootScope", "$http", "paCache", "paSubscription", "paTeacher", "teacher"];
angular.module('paApp').controller('popupTeacherProfileCtrl', popupTeacherProfileCtrl);

function popupTeacherProfileCtrl($scope, $uibModalInstance, $rootScope, $http, paCache, paSubscription, paTeacher, teacher) {
    $scope.teacher = teacher;

    var conf = paCache.getConf();
    $scope.conf = conf;

    $scope.init = function(){
        paTeacher.getTeacherMirgovoritProfile(teacher._id).then(function(profile){
            $scope.teacher.mirgovoritProfile = profile;
        });
        paTeacher.getFolderSubscriptions(teacher);
    }

    $scope.connect = function(){
        paSubscription.sendSubscriptionRequest(teacher._id).then(function(subscr){
            $uibModalInstance.close({reload:true});
        })
    }

    $scope.revoke = function(subscr){
        paSubscription.revokeSubscriptionRequest(subscr).then(function(subscr){
            $uibModalInstance.close({reload:true});
        })
    }

    $scope.close = function(){
        $uibModalInstance.dismiss();
    }

    $scope.init();
}
"use strict";

popupUnlockFolderCtrl.$inject = ["$scope", "$uibModalInstance", "$rootScope", "$http", "folder"];
angular.module('paApp').controller('popupUnlockFolderCtrl', popupUnlockFolderCtrl);

function popupUnlockFolderCtrl($scope, $uibModalInstance, $rootScope, $http, folder) {
    $scope.folder = folder;

    $scope.checkCertificate = function(number){
        $http.get('/ws/certificates/'+number).then(
            function(resp){
                if (!resp.data) {
                    $scope.error={message:'Certificate not found'};
                } else {
                    $scope.certificate=resp.data;
                    $scope.tab=1;
                }
            }
        )
    }
    $scope.unlock = function(){
        if (folder.requiresCertificate){
            $http.post('/ws/certificates/'+$scope.certificate._id+'/register', {teacher:$rootScope.user.teacher}).then(function(resp){
                $uibModalInstance.close();
            })
    

        } else {
            var subscr = {folder:folder._id,teacher:$rootScope.user.teacher,active:true};
            $http.post('/ws/folderSubscriptions', subscr)
                .then(function(resp){
                    $uibModalInstance.close();
                });
        }
    }
    $scope.next = function(){
        $scope.tab+=1;
    }
    $scope.cancel = function(){
        $uibModalInstance.dismiss();
    }

}
"use strict";

popupUserParamsCtrl.$inject = ["$scope", "$uibModalInstance", "paSocket", "user"];
angular.module('paApp').controller('popupUserParamsCtrl', popupUserParamsCtrl);

function popupUserParamsCtrl($scope, $uibModalInstance, paSocket, user) {
  $scope.init = function () {
    $scope.user = user;
  };

  $scope.close = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.save = function () {
    paSocket.emit("saveUserParam", {
      user: user.id,
      name: 'points',
      value: Number(user.params.points)
    });
    paSocket.emit("saveUserParam", {
      user: user.id,
      name: 'team',
      value: user.params.team
    });
    paSocket.emit("saveUserParam", {
      user: user.id,
      name: 'mark',
      value: user.params.mark
    });
    $uibModalInstance.close();

  };

  $scope.init();
}
"use strict";

popupWallpaperCtrl.$inject = ["$scope", "$uibModalInstance", "$rootScope", "$http", "config"];
angular.module('paApp').controller('popupWallpaperCtrl', popupWallpaperCtrl);

function popupWallpaperCtrl($scope, $uibModalInstance, $rootScope, $http, config) {

    $scope.init = function(){
        $scope.loadBlobs('wallpapers/');
    }

    $scope.loadBlobs = function(prefix){
        $http.post(config.apiUrl + '/ws/browse', {
            folder: 'cdn',
            prefix: prefix
          }).then(function (resp) {
            $scope.images = null;
            if (resp.data.Blob) {
                $scope.images = _.map([].concat(resp.data.Blob), function(blob){
                    return {
                        title: blob.Name.substring(blob.Name.lastIndexOf('/') + 1, blob.Name.lastIndexOf('.')),
                        src: config.storageBaseUrl+"/cdn/" + blob.Name,
                    }
                });
            }
            $scope.directories = null;
            if (resp.data.BlobPrefix) {
                $scope.directories = _.map([].concat(resp.data.BlobPrefix), function (d) {
                  return {
                    prefix: d.Name,
                    name: d.Name.substring(prefix ? prefix.length : 0, d.Name.length - 1)
                  };
                });
            }

          });        
    }
    $scope.select = function(i){
        $scope.sel=i;
        $scope.selected=true;
    }
    $scope.ok = function(){
        $uibModalInstance.close($scope.images[$scope.sel]);
    }
    $scope.close = function(){
        $uibModalInstance.dismiss();
    }
    $scope.init();

}
"use strict";

popupCardCtrl.$inject = ["$scope", "$uibModalInstance", "paCache", "paStorage", "bean", "blobs"];
angular.module('paApp').controller('popupCardCtrl', popupCardCtrl);

function popupCardCtrl($scope, $uibModalInstance, paCache, paStorage, bean, blobs) {
  $scope.bean = bean;
  $scope.blobs = blobs;
  $scope.conf = paCache.getConf();

  var getChars = function getChars(text) {
    var chars = [];

    for (var i = 0, l = text.length; i < l; i++) {
      chars.push({
        val: text.charAt(i)
      });
    }

    return chars;
  };

  $scope.loadBlobs = function(prefix){
    paStorage.loadBlobs(prefix, "image/gif,image/jpeg,image/png")
  }

  $scope.select = function(r) {
    _.extend(bean,r);
  }
  $scope.saveBean = function (bean) {
    if (bean.type == 'text' && !bean.chars) {
      bean.chars = getChars(bean.tmp);
      delete bean.tmp;
    }

    $uibModalInstance.close(bean);
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
}

;
"use strict";

postsController.$inject = ["$scope", "$http", "$rootScope", "$uibModal", "paSocket", "paCache", "toaster", "config"];
angular.module('paApp').controller('postsController', postsController);

function postsController($scope, $http, $rootScope, $uibModal, paSocket, paCache, toaster, config) {
  $scope.animateElementIn = function ($el) {
    $el.removeClass('not-visible');
    $el.addClass('animated zoomIn');
  };

  $scope.animateElementOut = function ($el) {
    $el.addClass('not-visible');
    $el.removeClass('animated zoomIn');
  };

  $scope.scrollToElement = function (id) {
    paSocket.emit("scroll", id);
  };

  $scope.init = function () {
    $scope.getPosts();
    $http.get(config.apiUrl + '/ws/vk/getUser').then(function (resp) {
      if (resp.data.error) {
        $scope.auth = true;
      } else {
        $scope.vkUser = resp.data[0];
      }
    });
  };

  $scope.getPosts = function () {
    var conf = paCache.getConf();
    var student = $rootScope.user.student || conf.asStudent._id;
    $http.post(config.apiUrl + '/ws/getPosts', {
      student: student
    }).then(function (resp) {
      $scope.posts = resp.data;
    });
  };

  $scope.init();
}
"use strict";

paProfileCtrl.$inject = ["$scope", "$rootScope", "$http", "$state", "paCache", "paTeacher", "toaster", "config", "countries"];
angular.module('paApp').controller('paProfileCtrl', paProfileCtrl);

function paProfileCtrl($scope, $rootScope, $http, $state, paCache, paTeacher, toaster, config, countries) {
  var conf = paCache.getConf();
  var pageScope = paCache.initPageScope();

  var init = function init() {
    $scope.countries=countries;
    $scope.teacher = _.clone(conf.teacher);
    if (!$scope.teacher.address){
      $scope.teacher.address={};
    }
    $scope.user = _.clone($rootScope.user);
    loadOpentok();
    $scope.pageScope = pageScope;
    paTeacher.loadCertificates(conf.teacher._id);
    paTeacher.getVkProfile($rootScope.user.id);
    paTeacher.getMirgovoritProfile($rootScope.user.id);
    paTeacher.getZoomProfile($rootScope.user.id);
  };

  $scope.saveProfile = function () {
    $http.post(config.apiUrl + '/ws/saveTeacher/' + $scope.teacher._id, $scope.teacher).then(function (resp) {
      conf.teacher = resp.data;
      $state.transitionTo('profile');
    });
  };

  var loadOpentok = function loadOpentok() {
    $http.get(config.apiUrl + '/ws/opentokClient/' + $scope.teacher._id).then(function (resp) {
      $scope.opentokClient = resp.data;
    });
  };

  $scope.saveOpentok = function () {
    $http.post(config.apiUrl + '/ws/opentokClient', $scope.opentokClient).then(function (resp) {
      toaster.pop('success', 'Opentok', 'Opentok profile saved');
      $state.transitionTo('profile');
    });
  };

  init();
}
"use strict";

randomWordsController.$inject = ["$scope", "$http", "$state", "$rootScope", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('randomWordsController', randomWordsController);

function randomWordsController($scope, $http, $state, $rootScope, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();

    if ($rootScope.admin) {
      paService.findText().then(function (coll) {
        var words = _.shuffle(paService.split(coll.chars, ','));

        paSocket.emit('words', words);
      });
    }
  };

  $scope.setBoards = function (n) {
    paSocket.emit("var", {
      "var": 'boards',
      val: n
    });
  };

  $scope.init();
}
"use strict";

paRoomCtrl.$inject = ["$scope", "$rootScope", "$http", "$sce", "$uibModalInstance", "paSocket", "paChannel", "paCache", "config"];
angular.module('paApp').controller('paRoomCtrl', paRoomCtrl);

function paRoomCtrl($scope, $rootScope, $http, $sce, $uibModalInstance, paSocket, paChannel, paCache, config) {

  var conf = paCache.getConf();

  $scope.init=function(){
    $scope.conf=conf;
    $scope.loadSubscriptions();
    $scope.loadGroups();
  }

  $scope.loadSubscriptions = function(){
    $http.get(config.apiUrl + '/ws/findUserSubscriptions/' + $rootScope.user.teacher).then(function (resp) {
      var users=_.indexBy(resp.data,'student');
      $http.get(config.apiUrl + '/ws/findSubscriptions/' + $rootScope.user.teacher).then(function (resp) {
        $scope.subscriptions = _.filter(resp.data,function(subscr){
          return _.has(users,subscr.student._id);
        });
        _.each($scope.subscriptions, function(subscr){
          subscr.active=(subscr.student.channel!=null);
        })
      });
    });
  }

  $scope.saveSubscriptions = function () {
    paChannel.saveSubscriptions($scope.subscriptions).then(function(resp){
      paSocket.emit('reloadChannel', null);
      $uibModalInstance.dismiss('cancel');
    });
  };

  $scope.loadGroups = function(){
    $http.get(config.apiUrl + '/ws/teachers/' + $rootScope.user.teacher + '/groups').then(function (resp) {
      $scope.groups = resp.data;
    });
  }

  $scope.toggleGroup = function(group){
    if ($scope.selectedGroup && group._id==$scope.selectedGroup._id) {
      $scope.selectedGroup=null;
      _.each($scope.subscriptions, function(subscr){
        subscr.active=false;
      })
    } else {
      $scope.selectedGroup=group;
      $http.get('/ws/groups/'+group._id+'/subscriptions').then(function(resp){
        var groupIndex = _.indexBy(resp.data, 'student');
        _.each($scope.subscriptions, function(subscr){
          subscr.active=_.has(groupIndex, subscr.student._id);
        })
      })
    }
  }

  $scope.close = function(){
    $uibModalInstance.dismiss('cancel');
  }

  $scope.sendEmail = function(email){
    var body={
        to: {
          email: email
        },
        template: 'invite',
        opts:{
          '$NAME': conf.teacher.name + ' ' + conf.teacher.surname,
          '$CHANNEL': conf.channel._id
        }
    }
    $http.post('/ws/email/sendTo', body).then(function(resp){
      $scope.tab=1;
    })
  }

  $scope.close = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.init();
}
"use strict";

paScoreCtrl.$inject = ["$scope", "$uibModalInstance", "unit", "folder"];
angular.module('paApp').controller('paScoreCtrl', paScoreCtrl);

function paScoreCtrl($scope, $uibModalInstance, unit, folder) {
  $scope.unit = unit;
  $scope.folder = folder;

  $scope.ok = function () {
    $uibModalInstance.close();
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
}
"use strict";

paStudentCtrl.$inject = ["$scope", "$rootScope", "$state", "$http", "paCache", "paStudent", "config"];
angular.module('paApp').controller('paStudentCtrl', paStudentCtrl);

function paStudentCtrl($scope, $rootScope, $state, $http, paCache, paStudent, config) {
  var conf = paCache.getConf();
  var pageScope = paCache.getPageScope();

  var init = function init() {
    $scope.conf = conf;
    $scope.pageScope = pageScope;

    if ($state.params.id) {
      $scope.tab='editStudent';
      paStudent.editStudent();
    } else {
      $scope.tab='addStudent';
      paStudent.addStudent();
    }

    paStudent.loadFolders();
    //paStudent.getGroups();
  };

  $scope.ok = function(){
    paStudent.saveOrUpdate();
  }

  $scope.importStudent = function(){
    paStudent.findStudent(pageScope.student.id).then(function(student){
      if (student){
        $scope.selectedStudent=student;
        $scope.tab="confirmImport";
        $scope.studentNotFound = undefined;
      } else {
        $scope.studentNotFound = true;
      }
    });
  }

  $scope.updateSubscription = function(){
    var subscr = {
      teacher: $rootScope.user.teacher,
      student: $scope.selectedStudent._id
    }

    paStudent.updateSubscription(subscr).then(function(subscr){
      $scope.back();
    });
  }

  $scope.back = function(){
    var conf = paCache.getConf();
    var to = (conf.organization)?'org-students':'students';
    $state.go(to);
  }
  init();
}
"use strict";

paStudentsCtrl.$inject = ["$scope", "$rootScope", "$http", "$uibModal", "$state", "paCache", "paStudent", "paSubscription", "config"];
angular.module('paApp').controller('paStudentsCtrl', paStudentsCtrl);

function paStudentsCtrl($scope, $rootScope, $http, $uibModal, $state, paCache, paStudent, paSubscription, config) {
  var pageScope = paCache.initPageScope();
  var conf = paCache.getConf();

  var init = function init() {
    $scope.pageScope = pageScope;
    $scope.conf = conf;
    if (conf.teacher.organization){
      paStudent.getOrganizationStudents(conf.teacher.organization._id);
      paStudent.getOrganizationGroups(conf.teacher.organization._id);
    } else {
      paStudent.getSubscriptions();
      paStudent.getGroups();
    }
  };

  $scope.removeSubscription = function (subscription) {
    var modalInstance = $uibModal.open({
      animation: true,
      templateUrl: '/pa/pa.confirm.html?05f9d40d98425d0a',
      controller: 'paConfirmCtrl',
      resolve: {
        message: function(){
          return 'Are you sure?'
        }
      }
    });
    modalInstance.result.then(function () {
      paStudent.removeSubscription(subscription);
    });
  };

  $scope.accept = function(subscr){
    paSubscription.acceptSubscriptionRequest(subscr).then(function(subscr){
      paStudent.getSubscriptions();
      paSubscription.loadPendingSubscriptions();
    })
  }

  $scope.subscribeStudent = function(student){
    paStudent.subscribeStudent(conf.teacher._id, student._id).then(function(resp){
      paStudent.getOrganizationStudents(conf.teacher.organization._id);
    })
  };

  $scope.subscribeGroup = function(group){
    paStudent.subscribeGroup(conf.teacher._id, group._id).then(function(resp){
      paStudent.getOrganizationStudents(conf.teacher.organization._id);
      paStudent.getOrganizationGroups(conf.teacher.organization._id);
    })
  };

  init();
}
"use strict";

paStyleController.$inject = ["$scope", "$state", "$stateParams", "$uibModal", "paStyle", "paCache"];
angular.module('paApp').controller('paStyleController', paStyleController);

function paStyleController($scope, $state, $stateParams, $uibModal, paStyle, paCache) {

    $scope.fontFamilies = ['Segoe UI', 'Georgia', 'Palatino Linotype', 'Book Antiqua', 'Times New Roman', 'Arial', 'Helvetica', 'Arial Black', 'Impact', 'Lucida Sans Unicode', 'Tahoma', 'Verdana', 'Courier New', 'Lucida Console', 'Sans-serif', 'Comic Sans MS', 'initial'];
    $scope.fontSizes = ['normal', 'small', 'large'];
    var conf = paCache.getConf();
    $scope.conf = conf;

    $scope.saveStyle=function(css){
        paStyle.saveStyle(css);
    }
    $scope.removeStyle=function(css){
      paStyle.removeStyle(css);
    }
    $scope.popupWallpapers = function(css){
      var modalInstance = $uibModal.open({
        animation: true,
        templateUrl: '/pa/popup.wallpapers.html?544b2aed8649009e',
        controller: 'popupWallpaperCtrl',
        size: 'lg'
      });
      modalInstance.result.then(function(blob) {
        css.style['background']='linear-gradient(rgba(255,255,255,.8), rgba(255,255,255,.8)), url("'+blob.src+'")'
      });
    }
  
}
"use strict";

paUnlockCtrl.$inject = ["$scope", "$rootScope", "$http", "$window", "paCache", "webinarService", "config"];
angular.module('paApp').controller('paUnlockCtrl', paUnlockCtrl);

function paUnlockCtrl($scope, $rootScope, $http, $window, paCache, webinarService, config) {

  var pageScope = paCache.initPageScope();

  $scope.init = function () {
    $scope.pageScope = pageScope;
    $scope.loadCourses();
    if($rootScope.user.role=='O'){
      $scope.unlockOrganization();
    } else {
      $scope.unlockTeacher();
    }
  };

  $scope.next = function(){
    $scope.tab=1;
  }
  
  $scope.loadCourses = function () {
    $http.get(config.apiUrl + '/ws/products').then(function (resp) {
      $scope.products = resp.data;
    });
  };

  $scope.unlockTeacher = function () {
    var conf = paCache.getConf();
    $http.post(config.apiUrl + '/ws/newPayment/' + $rootScope.user.teacher + '/unlock').then(function (resp) {
      $scope.payment = resp.data;
      $scope.payment.email = conf.teacher.email;
      $scope.payment.fullname = conf.teacher.surname + ' ' + conf.teacher.name;

      if (conf.teacher.middle) {
        $scope.payment.fullname += ' ' + conf.teacher.middle;
      }

    });
  };

  $scope.unlockOrganization = function () {
    var conf = paCache.getConf();
    $http.post(config.apiUrl + '/ws/organizations/' + $rootScope.user.organization + '/unlock').then(function (resp) {
      $scope.payment = resp.data;
      $scope.payment.email = conf.teacher.email;
      $scope.payment.fullname = conf.teacher.surname + ' ' + conf.teacher.name;

    });
  };

  $scope.checkout = function () {
    $http.post(config.apiUrl + '/ws/payments/' + $scope.payment._id + '/checkout/axerve', $scope.payment).then(function (resp) {
      $window.location.href = resp.data.formUrl;
    });
  };

  $scope.init();
}
"use strict";

paVideoCtrl.$inject = ["$scope", "$rootScope", "$http", "$sce", "$uibModalInstance", "config"];
angular.module('paApp').controller('paVideoCtrl', paVideoCtrl);

function paVideoCtrl($scope, $rootScope, $http, $sce, $uibModalInstance, config) {
  $scope.init = function () {
    $http.get(config.apiUrl + '/ws/video').then(function (resp) {
      $scope.videos = resp.data;
    });
  };

  $scope.playVideo = function (video) {
    $scope.videoSource = $sce.trustAsResourceUrl(video.src);
  };

  $scope.close = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.init();
}
"use strict";

webinarSubscriptionCtrl.$inject = ["$scope", "$rootScope", "$http", "$uibModalInstance", "paCache", "webinarService", "config", "webinarSubscription"];
angular.module('paApp').controller('webinarSubscriptionCtrl', webinarSubscriptionCtrl);

function webinarSubscriptionCtrl($scope, $rootScope, $http, $uibModalInstance, paCache, webinarService, config, webinarSubscription) {

  var pageScope = paCache.initPageScope();

  var init = function () {
    $scope.pageScope = pageScope;
    $scope.subscr = webinarSubscription;
    webinarService.loadWebinars();
  };

  $scope.setTab = function (tab) {
    $scope.tab = tab;
  };

  $scope.selectWebinar = function(webinar){
      $scope.tab = 1;
      $scope.selWebinar = webinar;
  }

  $scope.updateSubscription = function(webinar){
    $scope.subscr.webinar = webinar;
    webinarService.updateSubscription($scope.subscr).then(function(subscr){
      $uibModalInstance.close();
    });
  }

  $scope.cancel = function(){
    $uibModalInstance.dismiss('cancel');
  }

  init();
}
"use strict";

wordRaceController.$inject = ["$scope", "$http", "$state", "$rootScope", "paSocket", "paService", "paCache", "config"];
angular.module('paApp').controller('wordRaceController', wordRaceController);

function wordRaceController($scope, $http, $state, $rootScope, paSocket, paService, paCache, config) {
  $scope.$on('$destroy', function (event) {
    paSocket.removeAllListeners();
  });

  $scope.init = function () {
    $scope.data = paService.init();
    paService.findText().then(function (coll) {
      var lines = paService.split(coll.chars, '\n');
      var conf = paCache.getConf();

      var myIndex = _.findIndex(conf.room.users, function (user) {
        return user.username == $rootScope.user.username;
      });

      $scope.data.myWords = paService.split(lines[myIndex].chars, ',');

      if ($rootScope.admin) {
        var allWords = [];

        _.each(lines, function (line) {
          var words = paService.split(line.chars, ',');
          allWords = allWords.concat(words);
        });

        paSocket.emit('words', _.shuffle(allWords));
      }
    });
  };

  $scope.init();
}
"use strict";

paWorkplanCtrl.$inject = ["$scope", "$uibModalInstance", "$http", "data", "config"];
angular.module('paApp').controller('paWorkplanCtrl', paWorkplanCtrl);

function paWorkplanCtrl($scope, $uibModalInstance, $http, data, config) {
  $scope.init = function () {
    $scope.data = data;
    $scope.loadContents();
    $scope.sortableOptions={
      update: function(e, ui){
        $http.put(config.apiUrl + '/ws/workplans/' + data._id, data);
      }
    }
  };

  $scope.loadContents = function () {
    if (data._id) {
      $http.get(config.apiUrl + '/ws/workplans/' + data._id + '/contents').then(function (resp) {
        $scope.data.contents = resp.data;
      });
    }
  };

  $scope.remove = function () {
    $http["delete"](config.apiUrl + '/ws/workplans/' + data._id).then(function (resp) {
      $uibModalInstance.close();
    });
  };

  $scope.ok = function () {
    if (data._id) {
      $http.put(config.apiUrl + '/ws/workplans/' + data._id, data).then(function (resp) {
        if (resp.data.error) {
          $scope.error = resp.data.error;
        } else {
          $uibModalInstance.close();
        }
      });
    } else {
      $http.post(config.apiUrl + '/ws/workplans', data).then(function (resp) {
        if (resp.data.error) {
          $scope.error = resp.data.error;
        } else {
          $uibModalInstance.close();
        }
      });
    }
  };

  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };

  $scope.removeContent = function (content) {
    $http["delete"](config.apiUrl + '/ws/contents/' + content._id).then(function (resp) {
      $scope.loadContents();
    });
  };

  $scope.init();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmN0cmwuanMiLCJhbGVydHMuY3RybC5qcyIsImF1dGguY3RybC5qcyIsImF4ZXJ2ZS5jdHJsLmpzIiwiYm9vay5jdHJsLmpzIiwiYm9va21hcmsuY3RybC5qcyIsImNhcHR1cmUuY3RybC5qcyIsImNoYW5nZVBhc3N3b3JkLmN0cmwuanMiLCJjaGFubmVsLmN0cmwuanMiLCJjb2xsZWN0aW9uLmN0cmwuanMiLCJjb2xsZWN0aW9uUmVtb3ZlLmN0cmwuanMiLCJjb21tZW50LmN0cmwuanMiLCJjb21tZW50cy5jdHJsLmpzIiwiY29uZGl0aW9ucy5jdHJsLmpzIiwiZmVlZC5jdHJsLmpzIiwiZmVlZGJhY2suY3RybC5qcyIsImZpbmRXb3JkLmN0cmwuanMiLCJncm91cC5jdHJsLmpzIiwiaGVscC5jdHJsLmpzIiwiaG9tZS5jdHJsLmpzIiwiaG9tZXdvcmsuY3RybC5qcyIsImhvbWV3b3JrQ29tbWVudHMuY3RybC5qcyIsImtleS5jdHJsLmpzIiwibGFiZWwuY3RybC5qcyIsImxlc3Nvbi5jdHJsLmpzIiwibGVzc29ucy5jdHJsLmpzIiwibGlrZXMuY3RybC5qcyIsImxpbmtTdWJzY3JpcHRpb24uY3RybC5qcyIsImxvZ2luLmN0cmwuanMiLCJtYXJrZXRwbGFjZS5jdHJsLmpzIiwibWQuY3RybC5qcyIsIm1pcmdvdm9yaXQuY3RybC5qcyIsIm1peGVkUmVzb3VyY2UuY3RybC5qcyIsIm9wZW50b2suY3RybC5qcyIsIm9yZ2FuaXphdGlvbi5jdHJsLmpzIiwicGEuY2FudmFzLmN0cmwuanMiLCJwYS5jYXJkRWRpdG9yLmN0cmwuanMiLCJwYS5jaGF0LmN0cmwuanMiLCJwYS5jb2xsZWN0aW9uRWRpdG9yLmN0cmwuanMiLCJwYS5jb2xsZWN0aW9ucy5jdHJsLmpzIiwicGEuY29uZmlybS5jdHJsLmpzIiwicGEuY29udHJvbFBhbmVsLmN0cmwuanMiLCJwYS5jb3B5UGFnZS5jdHJsLmpzIiwicGEuY3RybC5qcyIsInBhLmRhc2hib2FyZC5jdHJsLmpzIiwicGEuZG9taW5vLmN0cmwuanMiLCJwYS5lZGl0Q29udGVudC5jdHJsLmpzIiwicGEuZWRpdFBhZ2UuY3RybC5qcyIsInBhLmVyYXNlci5jdHJsLmpzIiwicGEuZmVlZC5jdHJsLmpzIiwicGEuZmVlZHMuY3RybC5qcyIsInBhLmZvbGRlci5jdHJsLmpzIiwicGEuZ2FtZS5jdHJsLmpzIiwicGEuZ2FtZTIuY3RybC5qcyIsInBhLmd1ZXNzLW51bWJlci5jdHJsLmpzIiwicGEuaW50cm8uY3RybC5qcyIsInBhLmpjcm9wLmN0cmwuanMiLCJwYS5sZXZlbHMuY3RybC5qcyIsInBhLm5hdi5jdHJsLmpzIiwicGEucGljdG9ncmFtLmVkaXRvci5jdHJsLmpzIiwicGEucHVibGlzaC5jdHJsLmpzIiwicGEuc2hvcC5jdHJsLmpzIiwicGEuc2lkZWJhci5jdHJsLmpzIiwicGEuc2l6ZS1mYWN0b3IuZWRpdG9yLmN0cmwuanMiLCJwYS5zb25ncy5jdHJsLmpzIiwicGEuc3RpY2tlcnMuY3RybC5qcyIsInBhLnN1YnNjcmlwdGlvbnMuY3RybC5qcyIsInBhLnRleHQuY3RybC5qcyIsInBhLnRleHQuZWRpdG9yLmN0cmwuanMiLCJwYS53ZWJpbmFyLmN0cmwuanMiLCJwYUNvbnRyb2xsZXIuY3RybC5qcyIsInBheW1lbnRzLmN0cmwuanMiLCJwb3B1cC5jdHJsLmpzIiwicG9wdXAuaG9tZXdvcmstY29tbWVudC5jdHJsLmpzIiwicG9wdXAuaG9tZXdvcmsuY3RybC5qcyIsInBvcHVwLm9yZ1N1YnNjcmlwdGlvbi5jdHJsLmpzIiwicG9wdXAucmVzb3VyY2VzLmN0cmwuanMiLCJwb3B1cC50ZWFjaGVyUHJvZmlsZS5jdHJsLmpzIiwicG9wdXAudW5sb2NrRm9sZGVyLmN0cmwuanMiLCJwb3B1cC51c2VyUGFyYW1zLmN0cmwuanMiLCJwb3B1cC53YWxscGFwZXIuY3RybC5qcyIsInBvcHVwQ2FyZC5jdHJsLmpzIiwicG9zdHMuY3RybC5qcyIsInByb2ZpbGUuY3RybC5qcyIsInJhbmRvbVdvcmRzLmN0cmwuanMiLCJyb29tLmN0cmwuanMiLCJzY29yZS5jdHJsLmpzIiwic3R1ZGVudC5jdHJsLmpzIiwic3R1ZGVudHMuY3RybC5qcyIsInN0eWxlLmN0cmwuanMiLCJ1bmxvY2suY3RybC5qcyIsInZpZGVvLmN0cmwuanMiLCJ3ZWJpbmFyU3Vic2NyaXB0aW9uLmN0cmwuanMiLCJ3b3JkUmFjZS5jdHJsLmpzIiwid29ya3BsYW4uY3RybC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDalJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN1BBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNubkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9HQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM1REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJjb250cm9sbGVycy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFkbWluQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCIkdWliTW9kYWxcIiwgXCIkcm9vdFNjb3BlXCIsIFwicGFDYWNoZVwiLCBcInBhQWNsXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdhZG1pbkNvbnRyb2xsZXInLCBhZG1pbkNvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gYWRtaW5Db250cm9sbGVyKCRzY29wZSwgJGh0dHAsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkdWliTW9kYWwsICRyb290U2NvcGUsIHBhQ2FjaGUsIHBhQWNsLCBjb25maWcpIHtcclxuICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLnRhYiA9IDE7XHJcbiAgICAkc2NvcGUubG9hZFJlc291cmNlcygpO1xyXG4gICAgJHNjb3BlLmNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRzY29wZS5vcHRpb25zID0gXy5leHRlbmQoJHN0YXRlUGFyYW1zLm9wdGlvbnMsJHNjb3BlLmNvbmYuY3VycmVudFBhZ2UuY29sbGVjdGlvbnMpO1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICRzY29wZS5pc0ZvbGRlckFkbWluID0gKCRyb290U2NvcGUudXNlci5yb2xlPT0nRScgJiYgY29uZi5jdXJyZW50Rm9sZGVyLmlzQWRtaW4pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5sb2FkUmVzb3VyY2VzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLnBhZ2UgPSB7XHJcbiAgICAgIGNvbGxlY3Rpb25zOiBbXSxcclxuICAgICAgdGV4dHM6IFtdXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBzb3J0RnVuY3QgPSBmdW5jdGlvbiBzb3J0RnVuY3QoYSwgYikge1xyXG4gICAgICB2YXIgciA9IDA7XHJcbiAgICAgIHZhciBhYSA9IGEubmFtZS5zcGxpdCgvWyAtLl0vKTtcclxuICAgICAgdmFyIGJiID0gYi5uYW1lLnNwbGl0KC9bIC0uXS8pO1xyXG5cclxuICAgICAgaWYgKGFhLmxlbmd0aCA+IDAgJiYgYmIubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIHZhciBsID0gYWEubGVuZ3RoID4gYmIubGVuZ3RoID8gYmIubGVuZ3RoIDogYWEubGVuZ3RoO1xyXG4gICAgICAgIHZhciBpID0gMDtcclxuXHJcbiAgICAgICAgd2hpbGUgKGkgPCBsICYmIHIgPT0gMCkge1xyXG4gICAgICAgICAgdmFyIGFhYSA9IGFhW2ldO1xyXG4gICAgICAgICAgdmFyIGJiYiA9IGJiW2ldO1xyXG5cclxuICAgICAgICAgIGlmIChhYWEgPT0gYmJiKSB7XHJcbiAgICAgICAgICAgIGkgPSBpICsgMTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAocGFyc2VJbnQoYWFhKSAmJiBwYXJzZUludChiYmIpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUludChhYWEpID4gcGFyc2VJbnQoYmJiKSA/IDEgOiAtMTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBhYWEgPiBiYmIgPyAxIDogLTE7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gcjtcclxuICAgIH07XHJcblxyXG4gICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRDb2xsZWN0aW9ucy8nICsgY29uZi5jdXJyZW50UGFnZS5faWQgKyAnLycgKyAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICByZXNwLmRhdGEuc29ydChzb3J0RnVuY3QpO1xyXG4gICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG5cclxuICAgICAgXy5lYWNoKHJlc3AuZGF0YSwgZnVuY3Rpb24gKGNvbGwpIHtcclxuICAgICAgICBpZiAoZGF0YS5zZWxDb2xsZWN0aW9ucyl7XHJcbiAgICAgICAgICB2YXIgcyA9IGRhdGEuc2VsQ29sbGVjdGlvbnNbY29sbC50eXBlXTtcclxuICAgICAgICAgIGlmIChzKSB7XHJcbiAgICAgICAgICAgIGNvbGwuc2VsZWN0ZWQgPSBzID09IGNvbGwuX2lkIHx8IHMgPT0gY29sbC5wYXJlbnQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb2xsLmlzUHJpdmF0ZSA9IGNvbGwudGVhY2hlciAmJiAhY29sbC5wYXJlbnQ7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgJHNjb3BlLnBhZ2UuY29sbGVjdGlvbnMgPSByZXNwLmRhdGE7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuY29weUNvbGxlY3Rpb24gPSBmdW5jdGlvbiAoY29sbCkge1xyXG4gICAgdmFyIGMgPSB7XHJcbiAgICAgIG5hbWU6IGNvbGwubmFtZSsnIC0gQ29weScsXHJcbiAgICAgIHBhZ2U6IGNvbGwucGFnZSxcclxuICAgICAgZm9sZGVyOiBjb2xsLmZvbGRlcixcclxuICAgICAgdHlwZTogY29sbC50eXBlLFxyXG4gICAgICB0ZWFjaGVyOiAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbFxyXG4gICAgfTtcclxuICAgIGlmIChjb2xsLnR5cGU9PSdtaXhlZCd8fGNvbGwudHlwZT09J21peGVkMicpe1xyXG4gICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdjb3B5LWNvbGxlY3Rpb24tbWl4ZWQnLCB7XHJcbiAgICAgICAgY29sbGVjdGlvbjogYyxcclxuICAgICAgICBjb3B5RnJvbTogY29sbC5faWQsXHJcbiAgICAgICAgb3B0aW9uczogJHNjb3BlLm9wdGlvbnNcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2UgaWYgKGNvbGwudHlwZT09J2dyaWQnKXtcclxuICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnY29weS1jb2xsZWN0aW9uLWdyaWQnLCB7XHJcbiAgICAgICAgY29sbGVjdGlvbjogYyxcclxuICAgICAgICBjb3B5RnJvbTogY29sbC5faWQsXHJcbiAgICAgICAgb3B0aW9uczogJHNjb3BlLm9wdGlvbnNcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdjb3B5LWNvbGxlY3Rpb24nLCB7XHJcbiAgICAgICAgY29sbGVjdGlvbjogYyxcclxuICAgICAgICBjb3B5RnJvbTogY29sbC5faWQsXHJcbiAgICAgICAgb3B0aW9uczogJHNjb3BlLm9wdGlvbnNcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmVkaXRDb2xsZWN0aW9uID0gZnVuY3Rpb24gKGNvbGwpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9jb2xsZWN0aW9ucy8nICsgY29sbC5faWQpLnRoZW4oZnVuY3Rpb24ocmVzKXtcclxuXHJcbiAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2VkaXQtY29sbGVjdGlvbicsIHtcclxuICAgICAgICBjb2xsZWN0aW9uOiByZXMuZGF0YSxcclxuICAgICAgICBvcHRpb25zOiAkc2NvcGUub3B0aW9ucyxcclxuICAgICAgICB0YWI6IDJcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSlcclxuICB9O1xyXG5cclxuICAkc2NvcGUuZWRpdENvbGxlY3Rpb25OZXcgPSBmdW5jdGlvbiAoY29sbCkge1xyXG4gICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2NvbGxlY3Rpb25zLycgKyBjb2xsLl9pZCkudGhlbihmdW5jdGlvbihyZXMpe1xyXG5cclxuICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnY29sbGVjdGlvbi0nK2NvbGwudHlwZSwge1xyXG4gICAgICAgIGNvbGxlY3Rpb246IHJlcy5kYXRhLFxyXG4gICAgICAgIG9wdGlvbnM6ICRzY29wZS5vcHRpb25zLFxyXG4gICAgICAgIHRhYjogMlxyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KVxyXG4gIH07XHJcblxyXG4gICRzY29wZS5yZW5hbWVDb2xsZWN0aW9uID0gZnVuY3Rpb24gKGNvbGwpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9jb2xsZWN0aW9ucy8nICsgY29sbC5faWQpLnRoZW4oZnVuY3Rpb24ocmVzKXtcclxuXHJcbiAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2VkaXQtY29sbGVjdGlvbicsIHtcclxuICAgICAgICBjb2xsZWN0aW9uOiByZXMuZGF0YSxcclxuICAgICAgICBvcHRpb25zOiAkc2NvcGUub3B0aW9ucyxcclxuICAgICAgICB0YWI6IDBcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSlcclxuICB9O1xyXG5cclxuICAkc2NvcGUubGFiZWxQYW5lbCA9IGZ1bmN0aW9uIChjb2xsKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvY29sbGVjdGlvbnMvJyArIGNvbGwuX2lkKS50aGVuKGZ1bmN0aW9uKHJlcyl7XHJcblxyXG4gICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdlZGl0LWNvbGxlY3Rpb24nLCB7XHJcbiAgICAgICAgY29sbGVjdGlvbjogcmVzLmRhdGEsXHJcbiAgICAgICAgb3B0aW9uczogJHNjb3BlLm9wdGlvbnMsXHJcbiAgICAgICAgdGFiOiAzXHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pXHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNpemVGYWN0b3JQYW5lbCA9IGZ1bmN0aW9uIChjb2xsKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvY29sbGVjdGlvbnMvJyArIGNvbGwuX2lkKS50aGVuKGZ1bmN0aW9uKHJlcyl7XHJcblxyXG4gICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdlZGl0LWNvbGxlY3Rpb24nLCB7XHJcbiAgICAgICAgY29sbGVjdGlvbjogcmVzLmRhdGEsXHJcbiAgICAgICAgb3B0aW9uczogJHNjb3BlLm9wdGlvbnMsXHJcbiAgICAgICAgdGFiOiA0XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pXHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFkZENvbGxlY3Rpb24gPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBjID0ge1xyXG4gICAgICBwYWdlOiBjb25mLmN1cnJlbnRQYWdlLl9pZCxcclxuICAgICAgZm9sZGVyOiBjb25mLmN1cnJlbnRGb2xkZXIuX2lkLFxyXG4gICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICB0ZWFjaGVyOiAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbFxyXG4gICAgfTtcclxuICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2FkZC1jb2xsZWN0aW9uJywge1xyXG4gICAgICBjb2xsZWN0aW9uOiBjLFxyXG4gICAgICBvcHRpb25zOiAkc2NvcGUub3B0aW9uc1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFkZENvbGxlY3Rpb25OZXcgPSBmdW5jdGlvbiAodHlwZSkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBjID0ge1xyXG4gICAgICBwYWdlOiBjb25mLmN1cnJlbnRQYWdlLl9pZCxcclxuICAgICAgZm9sZGVyOiBjb25mLmN1cnJlbnRGb2xkZXIuX2lkLFxyXG4gICAgICB0eXBlOiB0eXBlLFxyXG4gICAgICB0ZWFjaGVyOiAkcm9vdFNjb3BlLmNoYW5uZWwsXHJcbiAgICAgIHJlc291cmNlczogW11cclxuICAgIH07XHJcbiAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdjb2xsZWN0aW9uLScrdHlwZSwge1xyXG4gICAgICBjb2xsZWN0aW9uOiBjLFxyXG4gICAgICBvcHRpb25zOiAkc2NvcGUub3B0aW9uc1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnJlbW92ZSA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XHJcbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5yZW1vdmVDb2xsZWN0aW9uLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAnY29sbGVjdGlvblJlbW92ZUN0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgY29sbGVjdGlvbjogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiBjb2xsZWN0aW9uXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3JlbW92ZUNvbGxlY3Rpb24vJyArIGNvbGxlY3Rpb24uX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgJHNjb3BlLmxvYWRSZXNvdXJjZXMoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUudG9QaWN0b2dyYW1FZGl0b3IgPSBmdW5jdGlvbiAocmVzLCB0eXBlKSB7XHJcbiAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdlZGl0LXBpY3RvZ3JhbScsIHtcclxuICAgICAgY29sbGVjdGlvbjogcmVzLFxyXG4gICAgICB0eXBlOiB0eXBlXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUudG9TaXplRmFjdG9yID0gZnVuY3Rpb24gKHJlcykge1xyXG4gICAgJHN0YXRlLnRyYW5zaXRpb25Ubygnc2l6ZS1mYWN0b3InLCB7XHJcbiAgICAgIGNvbGxlY3Rpb246IHJlc1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldEFjdGl2ZSA9IGZ1bmN0aW9uIChjb2xsKSB7XHJcbiAgICB2YXIgdiA9IHtcclxuICAgICAgdGVhY2hlcjogJHJvb3RTY29wZS51c2VyLmNoYW5uZWwsXHJcbiAgICAgIHBhZ2U6IGNvbGwucGFnZSxcclxuICAgICAgdHlwZTogY29sbC50eXBlLFxyXG4gICAgICBjb2xsOiBjb2xsLnNlbGVjdGVkID8gY29sbC5faWQgOiBudWxsXHJcbiAgICB9O1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9wYWdlQ29uZicsIHYpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLmRhdGEuc2VsQ29sbGVjdGlvbnMgPSByZXNwLmRhdGE7XHJcbiAgICAgICRzY29wZS5sb2FkUmVzb3VyY2VzKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUua2V5cyA9IGZ1bmN0aW9uKGNvbGwpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmtleXMuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUtleUN0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgY29sbGVjdGlvbjogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiBjb2xsXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcbiAgXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYWxlcnRzQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwicGFDYWNoZVwiLCBcInBhU2VydmljZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignYWxlcnRzQ3RybCcsIGFsZXJ0c0N0cmwpO1xyXG5cclxuZnVuY3Rpb24gYWxlcnRzQ3RybCgkc2NvcGUsIHBhQ2FjaGUsIHBhU2VydmljZSkge1xyXG4gICAgJHNjb3BlLmNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHBhU2VydmljZS5sb2FkQWxlcnRzKCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmF1dGhDdHJsLiRpbmplY3QgPSBbXCIkd2luZG93XCIsIFwiJHN0YXRlXCIsIFwiJHN0YXRlUGFyYW1zXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdhdXRoQ3RybCcsIGF1dGhDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIGF1dGhDdHJsKCR3aW5kb3csICRzdGF0ZSwgJHN0YXRlUGFyYW1zKSB7XHJcbiAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwYS50b2tlbicsICRzdGF0ZVBhcmFtcy50b2tlbik7XHJcbiAgICAkc3RhdGUuZ28oJ3BhJyx7dG86J2Rhc2hib2FyZCd9KTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYXhlcnZlQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwiJGh0dHBcIiwgXCIkd2luZG93XCIsIFwiJGxvY2F0aW9uXCIsIFwiYXV0aFNlcnZpY2VcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2F4ZXJ2ZUN0cmwnLCBheGVydmVDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIGF4ZXJ2ZUN0cmwoJHNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgJGh0dHAsICR3aW5kb3csICRsb2NhdGlvbiwgYXV0aFNlcnZpY2UsIGNvbmZpZyl7XHRcclxuICAgIFxyXG4gICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBwYXJhbXMgPSAkbG9jYXRpb24uc2VhcmNoKCk7XHJcbiAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2F4ZXJ2ZS9zdGF0dXMnLCB7cGFyYW1zOiBwYXJhbXN9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5wYXltZW50PXJlc3AuZGF0YTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5pbml0KCk7XHJcbn1cclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUJvb2tDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcIiRodHRwXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFCb29rQ3RybCcsIHBhQm9va0N0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFCb29rQ3RybCgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgcGFDYWNoZSwgY29uZmlnKSB7XHJcbiAgJHNjb3BlLmRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAkc2NvcGUuY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG5cclxuICAkc2NvcGUuYm9va21hcmsgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBjb250ZW50ID0ge1xyXG4gICAgICBpbWc6IGRhdGEuc2VsQ29sbGVjdGlvbnMuaW1nLFxyXG4gICAgICBpbWcyOiBkYXRhLnNlbENvbGxlY3Rpb25zLmltZzIsXHJcbiAgICAgIGF1ZGlvOiBkYXRhLnNlbENvbGxlY3Rpb25zLmF1ZGlvLFxyXG4gICAgICB0ZXh0OiBkYXRhLnNlbENvbGxlY3Rpb25zLnRleHQsXHJcbiAgICAgIHRleHQyOiBkYXRhLnNlbENvbGxlY3Rpb25zLnRleHQyLFxyXG4gICAgICBjYXJkOiBkYXRhLnNlbENvbGxlY3Rpb25zLmNhcmQsXHJcbiAgICAgIG1peGVkOiBkYXRhLnNlbENvbGxlY3Rpb25zLm1peGVkLFxyXG4gICAgICBtaXhlZDI6IGRhdGEuc2VsQ29sbGVjdGlvbnMubWl4ZWQyLFxyXG4gICAgICBncmlkOiBkYXRhLnNlbENvbGxlY3Rpb25zLmdyaWQsXHJcbiAgICAgIHR5cGU6ICdDJyxcclxuICAgICAgcGFnZTogY29uZi5jdXJyZW50UGFnZSxcclxuICAgICAgbmFtZTogJHNjb3BlLm5hbWUsXHJcbiAgICAgIGxlc3NvbjogJHNjb3BlLmxlc3NvblxyXG4gICAgfTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYWRkQ29udGVudCcsIGNvbnRlbnQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUJvb2ttYXJrQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHVpYk1vZGFsSW5zdGFuY2VcIiwgXCIkaHR0cFwiLCBcInBhQ2FjaGVcIiwgXCJuYW1lXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYUJvb2ttYXJrQ3RybCcsIHBhQm9va21hcmtDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHBhQm9va21hcmtDdHJsKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBwYUNhY2hlLCBuYW1lLCBjb25maWcpIHtcclxuICAkc2NvcGUuZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICRzY29wZS5jb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgJHNjb3BlLm5hbWUgPSBuYW1lO1xyXG5cclxuICAkc2NvcGUuYm9va21hcmsgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBjb250ZW50ID0ge1xyXG4gICAgICB3b3JrcGxhbjogJHNjb3BlLnNlbGVjdGVkV29ya3BsYW4uX2lkLFxyXG4gICAgICBpbWc6IGRhdGEuc2VsQ29sbGVjdGlvbnMuaW1nLFxyXG4gICAgICBpbWcyOiBkYXRhLnNlbENvbGxlY3Rpb25zLmltZzIsXHJcbiAgICAgIGF1ZGlvOiBkYXRhLnNlbENvbGxlY3Rpb25zLmF1ZGlvLFxyXG4gICAgICB0ZXh0OiBkYXRhLnNlbENvbGxlY3Rpb25zLnRleHQsXHJcbiAgICAgIHRleHQyOiBkYXRhLnNlbENvbGxlY3Rpb25zLnRleHQyLFxyXG4gICAgICBjYXJkOiBkYXRhLnNlbENvbGxlY3Rpb25zLmNhcmQsXHJcbiAgICAgIG1peGVkOiBkYXRhLnNlbENvbGxlY3Rpb25zLm1peGVkLFxyXG4gICAgICBtaXhlZDI6IGRhdGEuc2VsQ29sbGVjdGlvbnMubWl4ZWQyLFxyXG4gICAgICBncmlkOiBkYXRhLnNlbENvbGxlY3Rpb25zLmdyaWQsXHJcbiAgICAgIHR5cGU6ICdXJyxcclxuICAgICAgcGFnZTogY29uZi5jdXJyZW50UGFnZS5faWQsXHJcbiAgICAgIG5hbWU6ICRzY29wZS5uYW1lLFxyXG4gICAgICBvcmRlcjogMTAwXHJcbiAgICB9O1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9hZGRDb250ZW50JywgY29udGVudCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnY29udGVudDonK3Jlc3AuZGF0YSk7XHJcbiAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFDYXB0dXJlQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHVpYk1vZGFsSW5zdGFuY2VcIiwgXCJwYVNvY2tldFwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoXCJwYUNhcHR1cmVDdHJsXCIsIHBhQ2FwdHVyZUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFDYXB0dXJlQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFTb2NrZXQsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG4gICRzY29wZS5jYXB0dXJlID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwiY2FwdHVyZS1zY3JlZW5cIiwgaWQpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5nZXRTdWJzY3JpcHRpb25zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRTdWJzY3JpcHRpb25zLycgKyAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUuZGF0YS5zdWJzY3JpcHRpb25zID0gXy5maWx0ZXIocmVzcC5kYXRhLCBmdW5jdGlvbiAoc3Vic2NyKSB7XHJcbiAgICAgICAgcmV0dXJuIHN1YnNjci5hY3RpdmU7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLnNlbGVjdGVkID0ge307XHJcbiAgICAkc2NvcGUuZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgJHNjb3BlLmNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRzY29wZS5nZXRTdWJzY3JpcHRpb25zKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFDaGFuZ2VQYXNzd29yZEN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVwiLCBcInRvYXN0ZXJcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhQ2hhbmdlUGFzc3dvcmRDdHJsJywgcGFDaGFuZ2VQYXNzd29yZEN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFDaGFuZ2VQYXNzd29yZEN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkaHR0cCwgJHN0YXRlLCB0b2FzdGVyLCBjb25maWcpIHtcclxuICAkc2NvcGUudXNlciA9ICRyb290U2NvcGUudXNlcjtcclxuXHJcbiAgJHNjb3BlLmNoZWNrUGFzc3dvcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoJHNjb3BlLnVzZXIucGFzc3dvcmQgPT0gJHNjb3BlLnVzZXIucGFzc3dvcmQyKSB7XHJcbiAgICAgIHNhdmVQYXNzd29yZCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgJHNjb3BlLmVycm9yID0gXCJQYXNzd29yZHMgYXJlIG5vdCB0aGUgc2FtZTogcmUtdHlwZSBhZ2FpblwiO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIHZhciBzYXZlUGFzc3dvcmQgPSBmdW5jdGlvbiBzYXZlUGFzc3dvcmQoKSB7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2NoYW5nZVBhc3N3b3JkLycgKyAkc2NvcGUudXNlci5pZCwge1xyXG4gICAgICBwYXNzd29yZDogJHNjb3BlLnVzZXIucGFzc3dvcmRcclxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCAnUGFzc3dvcmQnLCAnUGFzc3dvcmQgY2hhbmdlZCcpO1xyXG4gICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdkYXNoYm9hcmQnKTtcclxuICAgIH0pO1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmNoYW5uZWxDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCIkbG9jYXRpb25cIiwgXCJwYUNoYW5uZWxcIiwgXCJhdXRoU2VydmljZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignY2hhbm5lbEN0cmwnLCBjaGFubmVsQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBjaGFubmVsQ3RybCgkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkbG9jYXRpb24sIHBhQ2hhbm5lbCwgYXV0aFNlcnZpY2UpIHtcclxuXHJcbiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgIHZhciBwYXJhbXMgPSAkbG9jYXRpb24uc2VhcmNoKCk7XHJcbiAgICAgICAgICBpZiAocGFyYW1zLmRhdGEpe1xyXG5cclxuICAgICAgICAgICAgYXV0aFNlcnZpY2UubWlyZ292b3JpdExvZ2luKHBhcmFtcy5kYXRhLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubWlyZ292b3JpdFByb2ZpbGUgPSByZXN1bHQuZGF0YTtcclxuICAgICAgICAgICAgICAgIHBhQ2hhbm5lbC5qb2luQ2hhbm5lbCgkc3RhdGVQYXJhbXMuY2hhbm5lbCkudGhlbihmdW5jdGlvbihjaGFubmVsKXtcclxuICAgICAgICAgICAgICAgICAgJHNjb3BlLmNoYW5uZWw9Y2hhbm5lbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gIFxyXG4gICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSByZXN1bHQuZXJyb3I7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgXHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkc2NvcGUuYW5vbnltb3VzPXRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmVudGVyID0gZnVuY3Rpb24oKXtcclxuICAgICAgJHN0YXRlLmdvKCdwYScse3RvOidkYXNoYm9hcmQnfSk7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLm9wZW4gPSBmdW5jdGlvbigpe1xyXG4gICAgICBwYUNoYW5uZWwub3BlbkNoYW5uZWwoJHNjb3BlLmNoYW5uZWwuX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgJHN0YXRlLmdvKCdwYScse3RvOidkYXNoYm9hcmQnfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuQ29sbGVjdGlvbkN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIiR1aWJNb2RhbFwiLCBcInBhQ2FjaGVcIiwgXCJwYUFjbFwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignQ29sbGVjdGlvbkN0cmwnLCBDb2xsZWN0aW9uQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBDb2xsZWN0aW9uQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgJHVpYk1vZGFsLCBwYUNhY2hlLCBwYUFjbCwgY29uZmlnKSB7XHJcblxyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcblxyXG4gIHZhciBpbml0ID0gZnVuY3Rpb24oKXtcclxuICAgICRzY29wZS5jb25mID0gY29uZjtcclxuICAgICRzY29wZS5pc0ZvbGRlckFkbWluID0gKCRyb290U2NvcGUudXNlci5yb2xlPT0nRScgJiYgY29uZi5jdXJyZW50Rm9sZGVyLmlzQWRtaW4pO1xyXG5cclxuICAgIGlmICgkc3RhdGVQYXJhbXMuY29weUZyb20pe1xyXG4gICAgICAvLyBjb3B5XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9jb2xsZWN0aW9ucy8nICsgJHN0YXRlUGFyYW1zLmNvcHlGcm9tKS50aGVuKGZ1bmN0aW9uKHJlcyl7XHJcbiAgICAgICAgdmFyIGNvbGwgPSAkc3RhdGVQYXJhbXMuY29sbGVjdGlvbjtcclxuICAgICAgICBjb2xsLnJlc291cmNlcyA9IHJlcy5kYXRhLnJlc291cmNlcztcclxuICAgICAgICBjb2xsLmNoYXJzID0gcmVzLmRhdGEuY2hhcnM7XHJcbiAgICAgICAgY29sbC5pc1N5c3RlbSA9ICRzY29wZS5pc0ZvbGRlckFkbWluO1xyXG4gICAgICAgICRzY29wZS5jb2xsZWN0aW9uID0gY29sbDtcclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIGFkZCBvciBlZGl0XHJcbiAgICAgIHZhciBjb2xsID0gJHN0YXRlUGFyYW1zLmNvbGxlY3Rpb247XHJcbiAgICAgIGNvbGwuaXNTeXN0ZW0gPSAkc2NvcGUuaXNGb2xkZXJBZG1pbjtcclxuICAgICAgJHNjb3BlLmNvbGxlY3Rpb24gPSBjb2xsO1xyXG4gICAgfVxyXG4gICAgJHNjb3BlLnRhYiA9ICRzdGF0ZVBhcmFtcy50YWI7XHJcbiAgXHJcbiAgfVxyXG4gXHJcbiAgJHNjb3BlLm5leHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUudGFiID0gWyd0ZXh0JywgJ3RleHQyJ10uaW5jbHVkZXMoJHNjb3BlLmNvbGxlY3Rpb24udHlwZSkgJiYgISRzY29wZS5jb2xsZWN0aW9uLmNoYXJzID8gMSA6IDI7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNhdmVUZXh0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgLy8gcmVtb3ZlIGVtcHR5IGNoYXJzXHJcbiAgICAkc2NvcGUuY29sbGVjdGlvbi5jaGFycyA9IF8uZmlsdGVyKCRzY29wZS5jb2xsZWN0aW9uLmNoYXJzLCBmdW5jdGlvbiAoYykge1xyXG4gICAgICByZXR1cm4gYy52YWwgIT0gJyc7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoJHNjb3BlLmlzRm9sZGVyQWRtaW4pIHtcclxuICAgICAgJHNjb3BlLmNvbGxlY3Rpb24udGVhY2hlciA9IG51bGw7XHJcbiAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvc2F2ZVN5c3RlbUNvbGxlY3Rpb24nLCAkc2NvcGUuY29sbGVjdGlvbikudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICRzY29wZS5iYWNrKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgJHNjb3BlLmNvbGxlY3Rpb24udGVhY2hlciA9ICRyb290U2NvcGUudXNlci5jaGFubmVsO1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVDb2xsZWN0aW9uJywgJHNjb3BlLmNvbGxlY3Rpb24pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAkc2NvcGUuYmFjaygpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUuYWRkVGV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIC8vJHNjb3BlLmNvbGxlY3Rpb24ucGFnZSA9ICRzdGF0ZVBhcmFtcy5wYWdlO1xyXG4gICAgJHNjb3BlLmNvbGxlY3Rpb24uY2hhcnMgPSBbXTtcclxuXHJcbiAgICBmb3IgKHZhciBpID0gMCwgbCA9ICRzY29wZS5jb2xsZWN0aW9uLnRleHQubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgICRzY29wZS5jb2xsZWN0aW9uLmNoYXJzLnB1c2goe1xyXG4gICAgICAgIHZhbDogJHNjb3BlLmNvbGxlY3Rpb24udGV4dC5jaGFyQXQoaSlcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCRzY29wZS5pc0ZvbGRlckFkbWluKSB7XHJcbiAgICAgICRzY29wZS5jb2xsZWN0aW9uLnRlYWNoZXIgPSBudWxsO1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVTeXN0ZW1Db2xsZWN0aW9uJywgJHNjb3BlLmNvbGxlY3Rpb24pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAkc2NvcGUuY29sbGVjdGlvbiA9IHJlc3AuZGF0YTtcclxuICAgICAgICAkc2NvcGUudGFiID0gMjtcclxuICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAkc2NvcGUuY29sbGVjdGlvbi50ZWFjaGVyID0gJHJvb3RTY29wZS51c2VyLmNoYW5uZWw7XHJcbiAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvc2F2ZUNvbGxlY3Rpb24nLCAkc2NvcGUuY29sbGVjdGlvbikudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICRzY29wZS5jb2xsZWN0aW9uID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICRzY29wZS50YWIgPSAyO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUucXVpY2tJbnNlcnQgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAucXVpY2staW5zZXJ0Lmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncG9wdXBSZXNvdXJjZXNDdHJsJyxcclxuICAgICAgc2l6ZTogJ2xnJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIHJlc291cmNlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHR5cGU6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24odGV4dCkge1xyXG4gICAgICBpZiAoISRzY29wZS5jb2xsZWN0aW9uLnJlc291cmNlcyl7XHJcbiAgICAgICAgJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzPVtdO1xyXG4gICAgICB9XHJcbiAgXHJcbiAgICAgIHZhciBsaW5lcyAgPSB0ZXh0LnNwbGl0KCdcXG4nKTtcclxuICAgICAgXy5lYWNoKGxpbmVzLGZ1bmN0aW9uKGxpbmUpe1xyXG4gICAgICAgIHZhciByb3c9e3R5cGU6J21peGVkJyxyZXNvdXJjZXM6W119O1xyXG4gICAgICAgICRzY29wZS5jb2xsZWN0aW9uLnJlc291cmNlcy5wdXNoKHJvdyk7XHJcblxyXG4gICAgICAgIHZhciBjaHVua3MgPSBsaW5lLnNwbGl0KCcjJyk7XHJcbiAgICAgICAgXy5lYWNoKGNodW5rcywgZnVuY3Rpb24oY2h1bmspe1xyXG4gICAgICAgICAgY2h1bmsgPSBjaHVuay50cmltKCk7XHJcbiAgICAgICAgICB2YXIgcmVzb3VyY2UgPSB7XHJcbiAgICAgICAgICAgIGNoYXJzOiBbXSxcclxuICAgICAgICAgICAgdHlwZTogJ3RleHQnXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaHVuay5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICAgICAgcmVzb3VyY2UuY2hhcnMucHVzaCh7XHJcbiAgICAgICAgICAgICAgdmFsOiBjaHVuay5jaGFyQXQoaSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByb3cucmVzb3VyY2VzLnB1c2gocmVzb3VyY2UpO1xyXG4gICAgICAgIH0pICAgICAgXHJcbiAgICAgIFxyXG4gICAgICB9KVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuYWRkTGluZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKCEkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMpe1xyXG4gICAgICAkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXM9W107XHJcbiAgICB9XHJcbiAgICAkc2NvcGUubGluZT17dHlwZTonbWl4ZWQnLHJlc291cmNlczpbXX07XHJcbiAgICAkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMucHVzaCgkc2NvcGUubGluZSk7XHJcbiAgICAkc2NvcGUuYWN0aW9uPTE7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuZWRpdExpbmUgPSBmdW5jdGlvbihsaW5lKSB7XHJcbiAgICAkc2NvcGUubGluZT1saW5lO1xyXG4gICAgJHNjb3BlLmFjdGlvbj0yO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLm9rID0gZnVuY3Rpb24oKXtcclxuICAgICRzY29wZS5hY3Rpb249MDtcclxuICB9XHJcbiAgXHJcbiAgJHNjb3BlLmFkZFVybFJlc291cmNlID0gZnVuY3Rpb24ocmVzb3VyY2Upe1xyXG4gICAgaWYgKCEkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMpe1xyXG4gICAgICAkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXM9W107XHJcbiAgICB9XHJcbiAgICAkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMucHVzaChyZXNvdXJjZSk7XHJcbiAgICAkc2NvcGUucmVzb3VyY2U9e307XHJcbiAgfVxyXG5cclxuXHJcbiAgJHNjb3BlLnJlbW92ZVVybFJlc291cmNlID0gZnVuY3Rpb24oaSl7XHJcbiAgICAkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMuc3BsaWNlKGksMSk7XHJcbiAgfVxyXG4gIFxyXG4gICRzY29wZS5lZGl0UmVzb3VyY2UgPSBmdW5jdGlvbiAocmVzb3VyY2UpIHtcclxuICAgIGlmIChyZXNvdXJjZS50eXBlPT0nY2FyZCcpe1xyXG5cclxuICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnZWRpdC1jYXJkJyx7XHJcbiAgICAgICAgY29sbGVjdGlvbjogJHNjb3BlLmNvbGxlY3Rpb24sXHJcbiAgICAgICAgY2FyZDpyZXNvdXJjZSxcclxuICAgICAgICBvcHRpb25zOiAkc3RhdGVQYXJhbXMub3B0aW9uc1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnJlc291cmNlLWVkaXQuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogJ3BvcHVwUmVzb3VyY2VzQ3RybCcsXHJcbiAgICAgICAgc2l6ZTogJ2xnJyxcclxuICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICByZXNvdXJjZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gXy5jbG9uZShyZXNvdXJjZSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgdHlwZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICBfLmV4dGVuZChyZXNvdXJjZSwgcmVzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnJlbW92ZVJlc291cmNlID0gZnVuY3Rpb24ocmVzb3VyY2VzLCBpKXtcclxuICAgIHJlc291cmNlcy5zcGxpY2UoaSwxKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5zYXZlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIC8vJHNjb3BlLmNvbGxlY3Rpb24ucGFnZSA9ICRzdGF0ZVBhcmFtcy5wYWdlO1xyXG4gICAgaWYgKCRzY29wZS5pc0ZvbGRlckFkbWluKSB7XHJcbiAgICAgICRzY29wZS5jb2xsZWN0aW9uLnRlYWNoZXIgPSBudWxsO1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVTeXN0ZW1Db2xsZWN0aW9uJywgJHNjb3BlLmNvbGxlY3Rpb24pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAkc2NvcGUuYmFjaygpO1xyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRzY29wZS5jb2xsZWN0aW9uLnRlYWNoZXIgPSAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbDtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9zYXZlQ29sbGVjdGlvbicsICRzY29wZS5jb2xsZWN0aW9uKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgJHNjb3BlLmJhY2soKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmJhY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoJHN0YXRlUGFyYW1zLmJhY2s9PVwiZWRpdC1mb2xkZXJcIil7XHJcbiAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oXCJlZGl0LWZvbGRlclwiLCB7XHJcbiAgICAgICAgXCJmb2xkZXJcIjogJHNjb3BlLmNvbmYuY3VycmVudEZvbGRlclxyXG4gICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oXCJhZG1pblwiLCB7XHJcbiAgICAgICAgXCJwYWdlXCI6ICRzY29wZS5jb2xsZWN0aW9uLnBhZ2UsXHJcbiAgICAgICAgXCJvcHRpb25zXCI6ICRzdGF0ZVBhcmFtcy5vcHRpb25zXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS5yZWR1Y2VTaXplID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgIHZhciBmYWN0b3IgPSBpdGVtLnNpemVGYWN0b3IgfHwgMTtcclxuICAgIGl0ZW0uc2l6ZUZhY3RvciA9IGZhY3RvciAtIDAuMjtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5jcmVhc2VTaXplID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgIHZhciBmYWN0b3IgPSBpdGVtLnNpemVGYWN0b3IgfHwgMTtcclxuICAgIGl0ZW0uc2l6ZUZhY3RvciA9IGZhY3RvciArIDAuMjtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuYWRkUmVzb3VyY2VzID0gZnVuY3Rpb24ocmVzb3VyY2VzLCB0eXBlKSB7XHJcbiAgICBpZiAodHlwZT09J2NhcmQnKXtcclxuXHJcbiAgICAgIHZhciByPXtcclxuICAgICAgICB0eXBlOidjYXJkJyxcclxuICAgICAgICBmcm9udDp7fSxcclxuICAgICAgICBiYWNrOnt9XHJcbiAgICAgIH07XHJcbiAgICAgIHJlc291cmNlcy5wdXNoKHIpO1xyXG4gICAgICBcclxuICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnZWRpdC1jYXJkJyx7XHJcbiAgICAgICAgY29sbGVjdGlvbjogJHNjb3BlLmNvbGxlY3Rpb24sXHJcbiAgICAgICAgY2FyZDogcixcclxuICAgICAgICBvcHRpb25zOiAkc3RhdGVQYXJhbXMub3B0aW9uc1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5yZXNvdXJjZXMtYWRkLmh0bWwnLFxyXG4gICAgICAgICAgY29udHJvbGxlcjogJ3BvcHVwUmVzb3VyY2VzQ3RybCcsXHJcbiAgICAgICAgICBzaXplOiAnbGcnLFxyXG4gICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICByZXNvdXJjZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHlwZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICByZXR1cm4gdHlwZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihjKSB7XHJcblxyXG4gICAgICAgIF8uZWFjaChjLnJlc291cmNlcywgZnVuY3Rpb24ocmVzKXtcclxuICAgICAgICAgIHJlc291cmNlcy5wdXNoKHJlcyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBpbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmNvbGxlY3Rpb25SZW1vdmVDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcInBhQ2FjaGVcIiwgXCJwYUFjbFwiLCBcImNvbmZpZ1wiLCBcImNvbGxlY3Rpb25cIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2NvbGxlY3Rpb25SZW1vdmVDdHJsJywgY29sbGVjdGlvblJlbW92ZUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gY29sbGVjdGlvblJlbW92ZUN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkaHR0cCwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICR1aWJNb2RhbEluc3RhbmNlLCBwYUNhY2hlLCBwYUFjbCwgY29uZmlnLCBjb2xsZWN0aW9uKSB7XHJcblxyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgJHNjb3BlLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xyXG5cclxuICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAkc2NvcGUuY29uZiA9IGNvbmY7XHJcbiAgICAkc2NvcGUuaXNGb2xkZXJBZG1pbiA9ICgkcm9vdFNjb3BlLnVzZXIucm9sZT09J0UnICYmIGNvbmYuY3VycmVudEZvbGRlci5pc0FkbWluKTtcclxuXHJcbiAgICB2YXIgZmlsdGVyPXt9O1xyXG4gICAgZmlsdGVyW2NvbGxlY3Rpb24udHlwZV0gPSBjb2xsZWN0aW9uLl9pZDtcclxuICAgICRodHRwLnBvc3QoJy93cy9maW5kQ29udGVudHMnLCBmaWx0ZXIpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICRzY29wZS5jb250ZW50cyA9IF8uZmlsdGVyKHJlc3AuZGF0YSwgZnVuY3Rpb24oY29udGVudCl7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQudHlwZT09J0MnO1xyXG4gICAgICB9KTtcclxuICAgICAgJHNjb3BlLndvcmtwbGFucyA9IF8uZmlsdGVyKHJlc3AuZGF0YSwgZnVuY3Rpb24oY29udGVudCl7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRlbnQudHlwZT09J1cnO1xyXG4gICAgICB9KTtcclxuICAgICAgJHNjb3BlLnByZXZlbnRSZW1vdmFsID0gIV8uaXNFbXB0eSgkc2NvcGUuY29udGVudHMpO1xyXG4gICAgfSlcclxuICB9XHJcbiBcclxuICAkc2NvcGUuY29uZmlybSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gIGluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFDb21tZW50Q3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHVpYk1vZGFsSW5zdGFuY2VcIiwgXCJwYUNhY2hlXCIsIFwiY29tbWVudFwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFDb21tZW50Q3RybCcsIHBhQ29tbWVudEN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFDb21tZW50Q3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFDYWNoZSwgY29tbWVudCwgY29uZmlnKSB7XHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgJHNjb3BlLmNvbmYgPSBjb25mO1xyXG5cclxuICAgIGlmIChjb21tZW50KSB7XHJcbiAgICAgIC8vIGZyb20gZGFzaGJvYXJkXHJcbiAgICAgICRzY29wZS5jb21tZW50ID0gY29tbWVudDtcclxuICAgIH0gZWxzZSBpZiAoY29uZi5yb29tLnN1YnNjcmlwdGlvbnMubGVuZ3RoID09IDEpIHtcclxuICAgICAgLy8gZnJvbSBjb250cm9sIHBhbmVsXHJcbiAgICAgIHZhciBzdHVkZW50ID0gY29uZi5yb29tLnN1YnNjcmlwdGlvbnNbMF0uc3R1ZGVudC5faWQ7XHJcbiAgICAgICRzY29wZS5sb2FkQ29tbWVudChzdHVkZW50KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUubG9hZENvbW1lbnQgPSBmdW5jdGlvbiAoc3R1ZGVudCkge1xyXG4gICAgaWYgKHN0dWRlbnQpIHtcclxuICAgICAgdmFyIGZpbHRlciA9IHtcclxuICAgICAgICBzdHVkZW50OiBzdHVkZW50LFxyXG4gICAgICAgIGNvbnRlbnQ6ICRzY29wZS5jb25mLmN1cnJlbnRDb250ZW50Ll9pZFxyXG4gICAgICB9O1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2NvbW1lbnRzL3NlYXJjaCcsIGZpbHRlcikudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgaWYgKHJlcy5kYXRhICYmIHJlcy5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgJHNjb3BlLmNvbW1lbnQgPSByZXMuZGF0YVswXTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgJHNjb3BlLmNvbW1lbnQgPSB7XHJcbiAgICAgICAgICAgIHRlYWNoZXI6ICRyb290U2NvcGUudXNlci5jaGFubmVsLFxyXG4gICAgICAgICAgICBmb2xkZXI6ICRzY29wZS5jb25mLmN1cnJlbnRDb250ZW50LnBhZ2UuZm9sZGVyLFxyXG4gICAgICAgICAgICBjb250ZW50OiAkc2NvcGUuY29uZi5jdXJyZW50Q29udGVudC5faWQsXHJcbiAgICAgICAgICAgIHN0dWRlbnQ6IHN0dWRlbnRcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2F2ZUNvbW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2NvbW1lbnRzJywgJHNjb3BlLmNvbW1lbnQpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAvL3RvYXN0ZXIucG9wKCdzdWNjZXNzJywgXCJDb21tZW50XCIsIFwiY29tbWVudCBhZGRlZFwiKTtcclxuICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFDb21tZW50c0N0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiR1aWJNb2RhbEluc3RhbmNlXCIsIFwicGFTZXJ2aWNlXCIsIFwicGFDYWNoZVwiLCBcInVzZXJcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhQ29tbWVudHNDdHJsJywgcGFDb21tZW50c0N0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFDb21tZW50c0N0cmwoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFTZXJ2aWNlLCBwYUNhY2hlLCB1c2VyKSB7XHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNlcnZpY2UubG9hZFN0dWRlbnRDb21tZW50cyh1c2VyLnN0dWRlbnQpO1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICRzY29wZS51c2VyID0gdXNlcjtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uIChjb21tZW50KSB7XHJcbiAgICBwYUNhY2hlLnNldEN1cnJlbnRNb2RlKCdDJyk7XHJcbiAgICBwYUNhY2hlLnNldEN1cnJlbnRGb2xkZXIoY29tbWVudC5mb2xkZXIpO1xyXG4gICAgcGFDYWNoZS5zZXRDdXJyZW50Q29udGVudChjb21tZW50LmNvbnRlbnQpO1xyXG4gICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoY29tbWVudC5jb250ZW50KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5pdCgpO1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5jb25kaXRpb25zQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHVpYk1vZGFsSW5zdGFuY2VcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2NvbmRpdGlvbnNDdHJsJywgY29uZGl0aW9uc0N0cmwpO1xyXG5cclxuZnVuY3Rpb24gY29uZGl0aW9uc0N0cmwoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSkge1xyXG4gICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTtcclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5mZWVkQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwicGFDYWNoZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignZmVlZEN0cmwnLCBmZWVkQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBmZWVkQ3RybCgkc2NvcGUsIHBhQ2FjaGUpIHtcclxuICAkc2NvcGUuZmVlZCA9IHBhQ2FjaGUuZ2V0RmVlZCgpO1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUZlZWRiYWNrQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHNjZVwiLCBcIiR1aWJNb2RhbEluc3RhbmNlXCIsIFwiY29uZmlnXCIsIFwiY2hhbm5lbFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFGZWVkYmFja0N0cmwnLCBwYUZlZWRiYWNrQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYUZlZWRiYWNrQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkc2NlLCAkdWliTW9kYWxJbnN0YW5jZSwgY29uZmlnLCBjaGFubmVsKSB7XHJcbiAgJHNjb3BlLmZlZWRiYWNrID0ge1xyXG4gICAgdHlwZTogJ2xlc3NvbicsXHJcbiAgICByYXRlOiAwXHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNoYW5uZWwgPSBjaGFubmVsO1xyXG4gIFxyXG4gICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZW5kRmVlZGJhY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoJHNjb3BlLmZlZWRiYWNrLnJhdGUgfHwgJHNjb3BlLmZlZWRiYWNrLmNvbW1lbnQpIHtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9mZWVkYmFja3MnLCAkc2NvcGUuZmVlZGJhY2spO1xyXG4gICAgfVxyXG5cclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmZpbmRXb3JkQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwicGFTb2NrZXRcIiwgXCJwYVNlcnZpY2VcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdmaW5kV29yZENvbnRyb2xsZXInLCBmaW5kV29yZENvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gZmluZFdvcmRDb250cm9sbGVyKCRzY29wZSwgJGh0dHAsICRzdGF0ZSwgJHJvb3RTY29wZSwgcGFTb2NrZXQsIHBhU2VydmljZSwgcGFDYWNoZSwgY29uZmlnKSB7XHJcbiAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIHBhU29ja2V0LnJlbW92ZUFsbExpc3RlbmVycygpO1xyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5kYXRhID0gcGFTZXJ2aWNlLmluaXQoKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5pdCgpO1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUdyb3VwQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHVpYk1vZGFsXCIsIFwiJHN0YXRlXCIsIFwicGFDYWNoZVwiLCBcInBhU3R1ZGVudFwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFHcm91cEN0cmwnLCBwYUdyb3VwQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYUdyb3VwQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkdWliTW9kYWwsICRzdGF0ZSwgcGFDYWNoZSwgcGFTdHVkZW50LCBjb25maWcpIHtcclxuICAgIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG5cclxuICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAkc2NvcGUucGFnZVNjb3BlID0gcGFnZVNjb3BlO1xyXG4gICAgICAgIGlmICgkc3RhdGUucGFyYW1zLmdyb3VwKXtcclxuICAgICAgICAgICAgLy8gZWRpdFxyXG4gICAgICAgICAgICBwYWdlU2NvcGUuZ3JvdXAgPSAkc3RhdGUucGFyYW1zLmdyb3VwO1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoJy93cy9ncm91cHMvJytwYWdlU2NvcGUuZ3JvdXAuX2lkKycvc3Vic2NyaXB0aW9ucycpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICB2YXIgZ3JvdXBJbmRleCA9IF8uaW5kZXhCeShyZXNwLmRhdGEsICdzdHVkZW50Jyk7XHJcbiAgICAgICAgICAgICAgICBfLmVhY2gocGFnZVNjb3BlLnN1YnNjcmlwdGlvbnMsIGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyLmFjdGl2ZT1fLmhhcyhncm91cEluZGV4LCBzdWJzY3Iuc3R1ZGVudC5faWQpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIGFkZFxyXG4gICAgICAgICAgICBwYWdlU2NvcGUuZ3JvdXAgPSB7XHJcbiAgICAgICAgICAgICAgICB0ZWFjaGVyOiAkcm9vdFNjb3BlLnVzZXIudGVhY2hlcixcclxuICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbjogJHJvb3RTY29wZS51c2VyLm9yZ2FuaXphdGlvbixcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfLmVhY2gocGFnZVNjb3BlLnN1YnNjcmlwdGlvbnMsIGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3IuYWN0aXZlPWZhbHNlO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuc2F2ZUdyb3VwPWZ1bmN0aW9uKGdyb3VwKXtcclxuICAgICAgICBwYVN0dWRlbnQuc2F2ZUdyb3VwKGdyb3VwKTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUucmVtb3ZlR3JvdXAgPSBmdW5jdGlvbihncm91cCl7XHJcbiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29uZmlybS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3BhQ29uZmlybUN0cmwnLFxyXG4gICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgbWVzc2FnZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnQXJlIHlvdSBzdXJlPydcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcGFTdHVkZW50LnJlbW92ZUdyb3VwKGdyb3VwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuYmFjayA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgdmFyIGNvbmY9cGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgICAgdmFyIHRvPShjb25mLm9yZ2FuaXphdGlvbik/J29yZy1ncm91cHMnOidzdHVkZW50cyc7XHJcbiAgICAgICAgJHN0YXRlLmdvKHRvKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaW5pdCgpO1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUhlbHBDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiR1aWJNb2RhbEluc3RhbmNlXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFIZWxwQ3RybCcsIHBhSGVscEN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFIZWxwQ3RybCgkc2NvcGUsICRodHRwLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFDYWNoZSwgY29uZmlnKSB7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG5cclxuICAgIHZhciBpbml0ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvaGVscC8nICsgY29uZi5jdXJyZW50Rm9sZGVyLmNvZGUgKyAnLycgKyBjb25mLmN1cnJlbnRQYWdlLmNvZGUpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3AgJiYgcmVzcC5kYXRhKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaGVscE1kID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5oZWxwTWQgPSAnSGVscCBmb3IgdGhpcyBwYWdlIGlzIG5vdCB5ZXQgYXZhaWxhYmxlLic7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgJHNjb3BlLmtleXM9W107XHJcbiAgICAgICAgaWYgKGNvbmYuY3VycmVudENvbnRlbnQpe1xyXG4gICAgICAgICAgICBsb2FkS2V5cyhjb25mLmN1cnJlbnRDb250ZW50LmltZyk7XHJcbiAgICAgICAgICAgIGxvYWRLZXlzKGNvbmYuY3VycmVudENvbnRlbnQuaW1nMik7XHJcbiAgICAgICAgICAgIGxvYWRLZXlzKGNvbmYuY3VycmVudENvbnRlbnQuYXVkaW8pO1xyXG4gICAgICAgICAgICBsb2FkS2V5cyhjb25mLmN1cnJlbnRDb250ZW50LnRleHQpO1xyXG4gICAgICAgICAgICBsb2FkS2V5cyhjb25mLmN1cnJlbnRDb250ZW50LnRleHQyKTtcclxuICAgICAgICAgICAgbG9hZEtleXMoY29uZi5jdXJyZW50Q29udGVudC5jYXJkKTtcclxuICAgICAgICAgICAgbG9hZEtleXMoY29uZi5jdXJyZW50Q29udGVudC51cmwpO1xyXG4gICAgICAgICAgICBsb2FkS2V5cyhjb25mLmN1cnJlbnRDb250ZW50Lm1peGVkKTtcclxuICAgICAgICAgICAgbG9hZEtleXMoY29uZi5jdXJyZW50Q29udGVudC5taXhlZDIpO1xyXG4gICAgICAgICAgICBsb2FkS2V5cyhjb25mLmN1cnJlbnRDb250ZW50LmdyaWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB2YXIgbG9hZEtleXMgPSBmdW5jdGlvbihjb2xsZWN0aW9uKXtcclxuICAgICAgICBpZiAoY29sbGVjdGlvbil7XHJcbiAgICAgICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9jb2xsZWN0aW9ucy8nICsgY29sbGVjdGlvbiArICcva2V5cycpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUua2V5cyA9ICRzY29wZS5rZXlzLmNvbmNhdChyZXNwLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuY2FuY2VsPWZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXQoKTtcclxufSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbmhvbWVDdHJsLiRpbmplY3QgPSBbXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCIkaHR0cFwiLCBcIiRyb290U2NvcGVcIiwgXCJwYVNlcnZpY2VcIiwgXCJwYUNhY2hlXCIsIFwicGFTb2NrZXRcIiwgXCJwYVN0eWxlXCIsIFwiY29uZmlnXCIsIFwiZmVhdHVyZXNcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2hvbWVDdHJsJywgaG9tZUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gaG9tZUN0cmwoJHN0YXRlLCAkc3RhdGVQYXJhbXMsICRodHRwLCAkcm9vdFNjb3BlLCBwYVNlcnZpY2UsIHBhQ2FjaGUsIHBhU29ja2V0LCBwYVN0eWxlLCBjb25maWcsIGZlYXR1cmVzKSB7XHJcblxyXG4gIHBhQ2FjaGUuaW5pdExvY2FsZSgpO1xyXG4gICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9ob21lJykudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgaWYgKHJlc3AgJiYgcmVzcC5kYXRhKSB7XHJcbiAgICAgICRyb290U2NvcGUuYWRtaW4gPSByZXNwLmRhdGEuYWRtaW47XHJcbiAgICAgICRyb290U2NvcGUudXNlciA9IHJlc3AuZGF0YS51c2VyO1xyXG4gICAgICBwYUNhY2hlLnNldFVzZXJMb2NhbGUoJHJvb3RTY29wZS51c2VyLmxvY2FsZSk7XHJcbiAgICAgICRyb290U2NvcGUuem9vbUVuYWJsZWQgPSByZXNwLmRhdGEuem9vbUVuYWJsZWQ7XHJcbiAgICAgICRyb290U2NvcGUucGFDb25maWcgPSBjb25maWc7XHJcbiAgICAgICRyb290U2NvcGUucGFGZWF0dXJlcyA9IGZlYXR1cmVzIHx8IHt9O1xyXG4gICAgICBwYVNlcnZpY2UubG9hZFN0YXRlcygpO1xyXG4gICAgICBwYVNvY2tldC5pbml0KCk7XHJcbiAgICAgIHBhU3R5bGUubG9hZEdsb2JhbFN0eWxlKCk7XHJcbiAgICAgIGlmIChyZXNwLmRhdGEudXNlci5yb2xlPT0nTycpe1xyXG4gICAgICAgICRzdGF0ZS5nbygkc3RhdGVQYXJhbXMudG8rJy1vJyk7XHJcbiAgICAgIH0gZWxzZSBpZiAocmVzcC5kYXRhLnVzZXIucm9sZT09J0UnKXtcclxuICAgICAgICAkc3RhdGUuZ28oJHN0YXRlUGFyYW1zLnRvKyctZScpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICRzdGF0ZS5nbygkc3RhdGVQYXJhbXMudG8pO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBlcnJvclxyXG4gICAgICAkc3RhdGUuZ28oJ2xvZ2luJyk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG5wYUhvbWV3b3JrQ3RybC4kaW5qZWN0PVtcIiRzY29wZVwiLFwiJHJvb3RTY29wZVwiLFwiJHN0YXRlXCIsXCIkaHR0cFwiLFwiJHVpYk1vZGFsXCIsXCJwYUNhY2hlXCIsXCJwYUhvbWV3b3JrXCIsXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhSG9tZXdvcmtDdHJsJywgcGFIb21ld29ya0N0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFIb21ld29ya0N0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkc3RhdGUsICRodHRwLCAkdWliTW9kYWwsIHBhQ2FjaGUsIHBhSG9tZXdvcmssIGNvbmZpZyl7XHJcblxyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuXHJcbiAgICAkc2NvcGUub3BlbiA9IGZ1bmN0aW9uKGhvbWV3b3JrKXtcclxuICAgICAgICAkaHR0cC5nZXQoJy93cy9tZW51L2ZpbmRQYWdlLycraG9tZXdvcmsuY29udGVudC5wYWdlKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICBob21ld29yay5jb250ZW50LnBhZ2U9cmVzcC5kYXRhO1xyXG4gICAgICAgICAgICBwYUNhY2hlLnNldEN1cnJlbnRIb21ld29yayhob21ld29yayk7XHJcbiAgICAgICAgICAgIHBhQ2FjaGUuc2V0Q3VycmVudENvbnRlbnQoaG9tZXdvcmsuY29udGVudCk7XHJcbiAgICAgICAgICAgIHBhQ2FjaGUuc2V0Q3VycmVudFBhZ2UoaG9tZXdvcmsuY29udGVudC5wYWdlKTtcclxuICAgICAgICAgICAgcGFDYWNoZS5zZXRDdXJyZW50TW9kZSgnSCcpO1xyXG4gICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKGhvbWV3b3JrLmNvbnRlbnQucGFnZS50ZW1wbGF0ZS5uYW1lLCBcclxuICAgICAgICAgICAgICAgIHtjb250ZW50OiBob21ld29yay5jb250ZW50fSwgXHJcbiAgICAgICAgICAgICAgICB7XCJyZWxvYWRcIjogdHJ1ZX0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmRvbmUgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIHBhSG9tZXdvcmsucGF0Y2hIb21ld29yaygkcm9vdFNjb3BlLnVzZXIuc3R1ZGVudCwgY29uZi5jdXJyZW50Q29udGVudC5faWQsIHtkb25lOiB0cnVlfSkudGhlbihmdW5jdGlvbihob21ld29yayl7XHJcbiAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2Rhc2hib2FyZCcse3RhYjogNn0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBwYUhvbWV3b3JrLnBhdGNoSG9tZXdvcmsoY29uZi5hc1N0dWRlbnQuX2lkLCBjb25mLmN1cnJlbnRDb250ZW50Ll9pZCwge2Nsb3NlZDogdHJ1ZX0pLnRoZW4oZnVuY3Rpb24oaG9tZXdvcmspe1xyXG4gICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdzZWxlY3Qtc3R1ZGVudCcse3RhYjogNiwgaWQ6IGNvbmYuYXNTdHVkZW50Ll9pZH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLnJlb3BlbiA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgcGFIb21ld29yay5wYXRjaEhvbWV3b3JrKGNvbmYuYXNTdHVkZW50Ll9pZCwgY29uZi5jdXJyZW50Q29udGVudC5faWQsIHtkb25lOiBmYWxzZX0pLnRoZW4oZnVuY3Rpb24oaG9tZXdvcmspe1xyXG4gICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdzZWxlY3Qtc3R1ZGVudCcse3RhYjogNiwgaWQ6IGNvbmYuYXNTdHVkZW50Ll9pZH0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmFkZEhvbWV3b3JrID0gZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5ob21ld29yay5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3BvcHVwSG9tZXdvcmtDdHJsJyxcclxuICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgaG9tZXdvcms6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhY2hlcjogJHJvb3RTY29wZS51c2VyLmNoYW5uZWwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnQ6IGNvbmYuYXNTdHVkZW50Ll9pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZG9uZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlZDogZmFsc2VcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHVkZW50czogW2NvbmYuYXNTdHVkZW50XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogMFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cdCAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKGNvbGwpIHtcclxuXHQgICAgXHRwYUhvbWV3b3JrLmxvYWRIb21ld29ya3MoY29uZi5hc1N0dWRlbnQuX2lkKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuZWRpdEhvbWV3b3JrID0gZnVuY3Rpb24oaG9tZXdvcmspe1xyXG4gICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmhvbWV3b3JrLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncG9wdXBIb21ld29ya0N0cmwnLFxyXG4gICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICBob21ld29yazogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5jbG9uZShob21ld29yaylcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBvcHRpb25zOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0dWRlbnRzOiBbY29uZi5hc1N0dWRlbnRdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlOiAxXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblx0ICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oY29sbCkge1xyXG5cdCAgICBcdHBhSG9tZXdvcmsubG9hZEhvbWV3b3Jrcyhjb25mLmFzU3R1ZGVudC5faWQpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5yZW1vdmVIb21ld29yayA9IGZ1bmN0aW9uKGhvbWV3b3JrKXtcclxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5ob21ld29yay5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3BvcHVwSG9tZXdvcmtDdHJsJyxcclxuICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgaG9tZXdvcms6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8uY2xvbmUoaG9tZXdvcmspXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgb3B0aW9uczogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdHVkZW50czogW2NvbmYuYXNTdHVkZW50XSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogMlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cdCAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICBwYUhvbWV3b3JrLmxvYWRIb21ld29ya3MoY29uZi5hc1N0dWRlbnQuX2lkKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG5wYUhvbWV3b3JrQ29tbWVudHNDdHJsLiRpbmplY3Q9W1wiJHNjb3BlXCIsXCIkcm9vdFNjb3BlXCIsXCIkc3RhdGVcIixcIiRodHRwXCIsXCIkdWliTW9kYWxcIixcInBhQ2FjaGVcIixcInBhSG9tZXdvcmtcIixcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFIb21ld29ya0NvbW1lbnRzQ3RybCcsIHBhSG9tZXdvcmtDb21tZW50c0N0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFIb21ld29ya0NvbW1lbnRzQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRzdGF0ZSwgJGh0dHAsICR1aWJNb2RhbCwgcGFDYWNoZSwgcGFIb21ld29yaywgY29uZmlnKXtcclxuXHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgJHNjb3BlLmhvbWV3b3JrID0gY29uZi5jdXJyZW50SG9tZXdvcms7XHJcbiAgICBcclxuICAgICRzY29wZS5hZGRDb21tZW50ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAuaG9tZXdvcmstY29tbWVudC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3BvcHVwSG9tZXdvcmtDb21tZW50Q3RybCcsXHJcbiAgICAgICAgICAgIHNpemU6ICdsZycsXHJcbiAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgIHA6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHQgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihob21ld29yaykge1xyXG5cdCAgICBcdCRzY29wZS5ob21ld29yayA9IGhvbWV3b3JrO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5lZGl0Q29tbWVudCA9IGZ1bmN0aW9uKGkpIHtcclxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5ob21ld29yay1jb21tZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncG9wdXBIb21ld29ya0NvbW1lbnRDdHJsJyxcclxuICAgICAgICAgICAgc2l6ZTogJ2xnJyxcclxuICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgcDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge2FjdGlvbjoxLCBpOml9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblx0ICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oaG9tZXdvcmspIHtcclxuXHQgICAgXHQkc2NvcGUuaG9tZXdvcmsgPSBob21ld29yaztcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUucmVtb3ZlQ29tbWVudCA9IGZ1bmN0aW9uKGkpIHtcclxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5ob21ld29yay1jb21tZW50Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncG9wdXBIb21ld29ya0NvbW1lbnRDdHJsJyxcclxuICAgICAgICAgICAgc2l6ZTogJ2xnJyxcclxuICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgcDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge2FjdGlvbjoyLCBpOml9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblx0ICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24oaG9tZXdvcmspIHtcclxuXHQgICAgXHQkc2NvcGUuaG9tZXdvcmsgPSBob21ld29yaztcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhS2V5Q3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiR1aWJNb2RhbEluc3RhbmNlXCIsIFwiJGh0dHBcIiwgXCJwYUNhY2hlXCIsIFwiY29sbGVjdGlvblwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFLZXlDdHJsJywgcGFLZXlDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHBhS2V5Q3RybCgkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkaHR0cCwgcGFDYWNoZSwgY29sbGVjdGlvbikge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRzY29wZS5pc0ZvbGRlckFkbWluID0gKCRyb290U2NvcGUudXNlci5yb2xlPT0nRScgJiYgY29uZi5jdXJyZW50Rm9sZGVyLmlzQWRtaW4pO1xyXG4gICAgICAgIGxvYWRLZXlzKGNvbGxlY3Rpb24pO1xyXG4gICAgICAgICRzY29wZS5kYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICAgIH07XHJcblxyXG4gICAgJHNjb3BlLmVkaXRLZXkgPSBmdW5jdGlvbihrZXkpe1xyXG4gICAgICAgICRzY29wZS5tb2RlPSdlZGl0JztcclxuICAgICAgICAkc2NvcGUua2V5PWtleTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuYWRkS2V5ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAkc2NvcGUubW9kZT0nYWRkJztcclxuICAgICAgICAkc2NvcGUua2V5PXtcclxuICAgICAgICAgICAgdmFsdWU6bnVsbFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLnNhdmVLZXkgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgaWYgKGtleS5faWQpe1xyXG4gICAgICAgICAgICAkaHR0cC5wdXQoJy93cy9jb2xsZWN0aW9ucy8nICsgY29sbGVjdGlvbi5faWQgKyAnL2tleXMvJyArIGtleS5faWQsIHt2YWx1ZToga2V5LnZhbHVlfSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICAgICAgbG9hZEtleXMoY29sbGVjdGlvbik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGtleSA9IHtcclxuICAgICAgICAgICAgICAgIGNvbGw6IGNvbGxlY3Rpb24uX2lkLFxyXG4gICAgICAgICAgICAgICAgdmFsdWU6IGtleS52YWx1ZVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBpZiAoISRzY29wZS5pc0ZvbGRlckFkbWluKXtcclxuICAgICAgICAgICAgICAgIGtleS50ZWFjaGVyID0gJHJvb3RTY29wZS51c2VyLnRlYWNoZXJcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkaHR0cC5wb3N0KCcvd3MvY29sbGVjdGlvbnMvJyArIGNvbGxlY3Rpb24uX2lkICsgJy9rZXlzJywga2V5KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICAgICBsb2FkS2V5cyhjb2xsZWN0aW9uKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5yZW1vdmVLZXkgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgJGh0dHAuZGVsZXRlKCcvd3MvY29sbGVjdGlvbnMvJyArIGNvbGxlY3Rpb24uX2lkICsgJy9rZXlzLycgKyBrZXkuX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgIGxvYWRLZXlzKGNvbGxlY3Rpb24pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBsb2FkS2V5cyA9IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgJGh0dHAuZ2V0KCcvd3MvY29sbGVjdGlvbnMvJyArIGNvbGxlY3Rpb24uX2lkICsgJy9rZXlzJykudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICAkc2NvcGUua2V5cyA9IHJlc3AuZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLm1vZGUgPSBudWxsO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcbiAgICAkc2NvcGUuaW5pdCgpO1xyXG59IiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxubGFiZWxDdHJsLiRpbmplY3Q9W1wiJHNjb3BlXCIsXCJwYUNhY2hlXCIsXCJsYWJlbHNcIixcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignbGFiZWxDdHJsJywgbGFiZWxDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIGxhYmVsQ3RybCgkc2NvcGUsIHBhQ2FjaGUsIGxhYmVscywgY29uZmlnKXtcclxuICAgIHZhciB1c2VyTG9jYWxlID0gcGFDYWNoZS5nZXRVc2VyTG9jYWxlKCk7XHJcbiAgICB2YXIgbG9jYWxlID0gKHVzZXJMb2NhbGUgJiYgdXNlckxvY2FsZS5jb2RlKSA/IHVzZXJMb2NhbGUuY29kZSA6IGNvbmZpZy5kZWZhdWx0TG9jYWxlO1xyXG4gICAgJHNjb3BlLmxhYmVsID0gKGxhYmVsc1tsb2NhbGVdICYmIGxhYmVsc1tsb2NhbGVdWyRzY29wZS5rZXldKSA/IGxhYmVsc1tsb2NhbGVdWyRzY29wZS5rZXldIDogJHNjb3BlLmRlZmF1bHQ7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhTGVzc29uQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHVpYk1vZGFsSW5zdGFuY2VcIiwgXCJwYUNhY2hlXCIsIFwiZGF0YVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFMZXNzb25DdHJsJywgcGFMZXNzb25DdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHBhTGVzc29uQ3RybCgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBwYUNhY2hlLCBkYXRhKSB7XHJcbiAgJHNjb3BlLmxlc3NvbiA9IGRhdGEubGVzc29uO1xyXG4gICRzY29wZS5jb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcblxyXG4gICRzY29wZS5vayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmxlc3NvbnNDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdsZXNzb25zQ3RybCcsIGxlc3NvbnNDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIGxlc3NvbnNDdHJsKCRzY29wZSwgJHJvb3RTY29wZSwgJGh0dHAsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcblxyXG4gIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgIHZhciB0b2RheSA9IG5ldyBEYXRlKCk7XHJcbiAgICAkc2NvcGUubW9udGhzID0ge1xyXG4gICAgICBsYWJlbHM6IFsnSmFuJywgJ0ZlYicsICdNYXInLCAnQXByJywgJ01heScsICdKdW4nLCAnSnVsJywgJ0F1ZycsICdTZXAnLCAnT2N0JywgJ05vdicsICdEZWMnXSxcclxuICAgICAgb3B0aW9uczogXy5yYW5nZSgwLCAxMiksXHJcbiAgICAgIHNlbGVjdGVkOiB0b2RheS5nZXRNb250aCgpXHJcbiAgICB9O1xyXG4gICAgJHNjb3BlLnllYXJzID0ge1xyXG4gICAgICBvcHRpb25zOiBfLnJhbmdlKDIwMTUsIHRvZGF5LmdldEZ1bGxZZWFyKCkgKyAxKSxcclxuICAgICAgc2VsZWN0ZWQ6IHRvZGF5LmdldEZ1bGxZZWFyKClcclxuICAgIH07XHJcbiAgICAkc2NvcGUubG9hZExlc3NvbnMoKTtcclxuICAgICRzY29wZS5sb2FkTmV4dExlc3NvbnMoKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUubG9hZExlc3NvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvZmluZExlc3NvbnNCeVRlYWNoZXIvJyArICRyb290U2NvcGUudXNlci50ZWFjaGVyICsgJy8nICsgJHNjb3BlLm1vbnRocy5zZWxlY3RlZCArICcvJyArICRzY29wZS55ZWFycy5zZWxlY3RlZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUuYWxsTGVzc29ucyA9IHJlc3AuZGF0YTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5sb2FkTmV4dExlc3NvbnMgPSBmdW5jdGlvbigpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kTmV4dExlc3NvbnNCeVRlYWNoZXIvJyArICRyb290U2NvcGUudXNlci50ZWFjaGVyKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5uZXh0TGVzc29ucyA9IHJlc3AuZGF0YTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaW5pdCgpO1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5saWtlc0NvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiJHJvb3RTY29wZVwiLCBcIiR1aWJNb2RhbFwiLCBcInBhU29ja2V0XCIsIFwicGFDYWNoZVwiLCBcInRvYXN0ZXJcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2xpa2VzQ29udHJvbGxlcicsIGxpa2VzQ29udHJvbGxlcik7XHJcblxyXG5mdW5jdGlvbiBsaWtlc0NvbnRyb2xsZXIoJHNjb3BlLCAkaHR0cCwgJHJvb3RTY29wZSwgJHVpYk1vZGFsLCBwYVNvY2tldCwgcGFDYWNoZSwgdG9hc3RlciwgY29uZmlnKSB7XHJcbiAgJHNjb3BlLmFuaW1hdGVFbGVtZW50SW4gPSBmdW5jdGlvbiAoJGVsKSB7XHJcbiAgICAkZWwucmVtb3ZlQ2xhc3MoJ25vdC12aXNpYmxlJyk7XHJcbiAgICAkZWwuYWRkQ2xhc3MoJ2FuaW1hdGVkIHpvb21JbicpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5hbmltYXRlRWxlbWVudE91dCA9IGZ1bmN0aW9uICgkZWwpIHtcclxuICAgICRlbC5hZGRDbGFzcygnbm90LXZpc2libGUnKTtcclxuICAgICRlbC5yZW1vdmVDbGFzcygnYW5pbWF0ZWQgem9vbUluJyk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNjcm9sbFRvRWxlbWVudCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInNjcm9sbFwiLCBpZCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuZmlsdGVyQnkgPSB7fTtcclxuICAgICRzY29wZS5nZXRQb3N0cygpO1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy92ay9nZXRVc2VyJykudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICBpZiAocmVzcC5kYXRhLmVycm9yKSB7XHJcbiAgICAgICAgJHNjb3BlLmF1dGggPSB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICRzY29wZS52a1VzZXIgPSByZXNwLmRhdGFbMF07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHZhciBkaXN0aW5jdFBhZ2VzID0gZnVuY3Rpb24gZGlzdGluY3RQYWdlcyhwb3N0cykge1xyXG4gICAgdmFyIHBhZ2VzID0gXy5tYXAocG9zdHMsIGZ1bmN0aW9uIChwb3N0KSB7XHJcbiAgICAgIHJldHVybiBwb3N0LnBhZ2U7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gXy51bmlxKHBhZ2VzLCBmdW5jdGlvbiAocGFnZSkge1xyXG4gICAgICByZXR1cm4gcGFnZS5faWQ7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuZ2V0UG9zdHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZnJvbSA9IG5ldyBEYXRlKCk7XHJcbiAgICBmcm9tLnNldE1vbnRoKGZyb20uZ2V0TW9udGgoKSAtIDEpO1xyXG4gICAgdmFyIGNyaXRlcmlhID0ge1xyXG4gICAgICBkYXRlOiB7XHJcbiAgICAgICAgJGd0OiBmcm9tXHJcbiAgICAgIH0sXHJcbiAgICAgIHByaXZhdGU6IHtcclxuICAgICAgICAkbmU6IHRydWVcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvZ2V0UG9zdHMnLCBjcml0ZXJpYSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICB2YXIgcG9zdHMgPSBfLmZpbHRlcihyZXNwLmRhdGEsIGZ1bmN0aW9uIChwb3N0KSB7XHJcbiAgICAgICAgcmV0dXJuIHBvc3Quc3R1ZGVudCAmJiBwb3N0LnN0dWRlbnQubGVuZ3RoICYmIHBvc3QudGVhY2hlciAmJiBwb3N0LnBhZ2U7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgJHNjb3BlLnBvc3RzID0gcG9zdHM7XHJcbiAgICAgICRzY29wZS5wYWdlcyA9IGRpc3RpbmN0UGFnZXMocG9zdHMpO1xyXG5cclxuICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgXy5lYWNoKHBvc3RzLCBmdW5jdGlvbiAocG9zdCkge1xyXG4gICAgICAgIHBvc3QubGlrZSA9IHBvc3QubGlrZXMuaW5kZXhPZigkcm9vdFNjb3BlLnVzZXIuc3R1ZGVudCkgIT0gLTE7XHJcbiAgICAgICAgcG9zdC5pc01pbmUgPSBfLmNvbnRhaW5zKHBvc3Quc3R1ZGVudCwgZnVuY3Rpb24ocyl7XHJcbiAgICAgICAgICByZXR1cm4gcy5faWQ9PSRyb290U2NvcGUudXNlci5zdHVkZW50O1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmZpbHRlckJ5UGFnZSA9IGZ1bmN0aW9uIChwYWdlKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCdmaWx0ZXJCeScsIHtcclxuICAgICAgcGFnZTogcGFnZVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFkZExpa2UgPSBmdW5jdGlvbiAocG9zdCkge1xyXG4gICAgdmFyIGxpa2UgPSB7XHJcbiAgICAgIHBvc3Q6IHBvc3QuX2lkLFxyXG4gICAgICBzdHVkZW50OiAkcm9vdFNjb3BlLnVzZXIuc3R1ZGVudFxyXG4gICAgfTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYWRkTGlrZScsIGxpa2UpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgcG9zdC5saWtlcyA9IHJlc3AuZGF0YS5saWtlcztcclxuICAgICAgcG9zdC5saWtlID0gcG9zdC5saWtlcyAmJiBwb3N0Lmxpa2VzLmluZGV4T2YoJHJvb3RTY29wZS51c2VyLnN0dWRlbnQpICE9IC0xO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNvbmZpcm1SZW1vdmUgPSBmdW5jdGlvbiAocG9zdCkge1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29uZmlybS5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhQ29uZmlybUN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiAnQXJlIHlvdSBzdXJlPydcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9yZW1vdmVQb3N0LycgKyBwb3N0Ll9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICRzY29wZS5pbml0KCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnJlbW92ZUxpa2UgPSBmdW5jdGlvbiAocG9zdCkge1xyXG4gICAgdmFyIGxpa2UgPSB7XHJcbiAgICAgIHBvc3Q6IHBvc3QuX2lkLFxyXG4gICAgICBzdHVkZW50OiAkcm9vdFNjb3BlLnVzZXIuc3R1ZGVudFxyXG4gICAgfTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvcmVtb3ZlTGlrZScsIGxpa2UpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgcG9zdC5saWtlcyA9IHJlc3AuZGF0YS5saWtlcztcclxuICAgICAgcG9zdC5saWtlID0gcG9zdC5saWtlcy5pbmRleE9mKCRyb290U2NvcGUudXNlci5zdHVkZW50KSAhPSAtMTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG5wYUxpbmtTdWJzY3JpcHRpb25DdHJsLiRpbmplY3Q9W1wiJHNjb3BlXCIsXCIkdWliTW9kYWxJbnN0YW5jZVwiLFwic3Vic2NyXCIsXCJwYUNhY2hlXCIsXCJwYVN1YnNjcmlwdGlvblwiLFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYUxpbmtTdWJzY3JpcHRpb25DdHJsJywgcGFMaW5rU3Vic2NyaXB0aW9uQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYUxpbmtTdWJzY3JpcHRpb25DdHJsKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsIHN1YnNjciwgcGFDYWNoZSwgcGFTdWJzY3JpcHRpb24sIGNvbmZpZyl7XHJcblxyXG4gICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhQ2FjaGUuaW5pdFBhZ2VTY29wZSgpO1xyXG4gICAgcGFTdWJzY3JpcHRpb24uZ2V0VGVhY2hlcnNGb3JTdWJzY3JpcHRpb24oc3Vic2NyLl9pZCk7XHJcblxyXG4gICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5zZWxlY3QgPSBmdW5jdGlvbih0ZWFjaGVyKXtcclxuICAgICAgICAkc2NvcGUuc2VsPXRlYWNoZXI7XHJcbiAgICB9XHJcbiAgICBcclxuICAgICRzY29wZS5saW5rPWZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoJHNjb3BlLnNlbCk7XHJcbiAgICB9XHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG5sb2dpbkN0cmwuJGluamVjdCA9IFtcIiRxXCIsIFwiJGh0dHBcIiwgXCIkc2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCJhdXRoU2VydmljZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignbG9naW5DdHJsJywgbG9naW5DdHJsKTtcclxuXHJcbmZ1bmN0aW9uIGxvZ2luQ3RybCgkcSwgJGh0dHAsICRzY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsIGF1dGhTZXJ2aWNlLCBjb25maWcpIHtcclxuICBcclxuICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7XHJcbiAgICBhdXRoU2VydmljZS5nZXRTdHJhdGVnaWVzKCkudGhlbihmdW5jdGlvbihyZXMpe1xyXG4gICAgICAkc2NvcGUuYXV0aCA9IHJlcztcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbiAoc3RyYXRlZ3kpIHtcclxuICAgIGF1dGhTZXJ2aWNlLmxvZ2luKCRzY29wZS51c2VybmFtZSwgJHNjb3BlLnBhc3N3b3JkLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2VzcyA9PT0gdHJ1ZSkge1xyXG4gICAgICAgICRzdGF0ZS5nbygncGEnLHt0bzonZGFzaGJvYXJkJ30pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgICRzY29wZS5lcnJvciA9IHJlc3VsdC5lcnJvcjtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdmFyIHB3ZCA9IGZ1bmN0aW9uIHB3ZCh1c2VyKSB7XHJcbiAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9mb3Jnb3RQYXNzd29yZCcsIHVzZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgcmV0dXJuIGRlZmVycmVkLnJlc29sdmUocmVzcC5kYXRhKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmZvcmdvdFBhc3N3b3JkID0gZnVuY3Rpb24gKGVtYWlsKSB7XHJcbiAgICBwd2Qoe1xyXG4gICAgICBlbWFpbDogZW1haWxcclxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAkc2NvcGUucHRhYiA9IHJlc3VsdDtcclxuICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge30pO1xyXG4gIH07XHJcblxyXG4gIC8qJHNjb3BlLnBvcHVwUHJpdmFjeSA9IGZ1bmN0aW9uKCl7XHJcbiAgXHQkdWliTW9kYWwub3Blbih7XHJcbiAgXHRcdGFuaW1hdGlvbjogdHJ1ZSxcclxuICBcdFx0dGVtcGxhdGVVcmw6ICcvcHJpdmFjeS5odG1sJyksXHJcbiAgXHRcdGNvbnRyb2xsZXI6ICdjb25kaXRpb25zQ3RybCcsXHJcbiAgXHRcdHNpemU6ICdsZycgICAgICAgICAgICBcclxuICBcdH0pO1xyXG4gIH1cclxuICBcclxuICAkc2NvcGUucG9wdXBDb25kaXRpb25zID0gZnVuY3Rpb24oKXtcclxuICBcdCR1aWJNb2RhbC5vcGVuKHtcclxuICBcdFx0YW5pbWF0aW9uOiB0cnVlLFxyXG4gIFx0XHR0ZW1wbGF0ZVVybDogJy9jb25kaXRpb25zLmh0bWwnKSxcclxuICBcdFx0Y29udHJvbGxlcjogJ2NvbmRpdGlvbnNDdHJsJyxcclxuICBcdFx0c2l6ZTogJ2xnJyAgICAgICAgICAgIFxyXG4gIFx0fSk7XHJcbiAgfSovXHJcblxyXG4gIGluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFNYXJrZXRwbGFjZUN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiR3aW5kb3dcIiwgXCJwYUNhY2hlXCIsIFwicGFNZW51XCIsIFwiY29uZmlnXCIsIFwiY291bnRyaWVzXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYU1hcmtldHBsYWNlQ3RybCcsIHBhTWFya2V0cGxhY2VDdHJsKTtcclxuXHJcblxyXG5mdW5jdGlvbiBwYU1hcmtldHBsYWNlQ3RybCgkc2NvcGUsICRzdGF0ZSwgJHJvb3RTY29wZSwgJGh0dHAsICR3aW5kb3csIHBhQ2FjaGUsIHBhTWVudSwgY29uZmlnLCBjb3VudHJpZXMpIHtcclxuXHJcbiAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAkc2NvcGUuY291bnRyaWVzPWNvdW50cmllcztcclxuXHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuY2hlY2tvdXRUYWI9LTE7XHJcbiAgICAkc2NvcGUucGF5bWVudENvbmZpZyA9IGNvbmZpZy5wYXltZW50cztcclxuXHJcbiAgICAkc2NvcGUubG9hZFByb2R1Y3RzKCk7XHJcbiAgICBpZiAoJHN0YXRlLnBhcmFtcy50ZWFjaGVyKXtcclxuICAgICAgLy8gb3JnYW5pemF0aW9uOiBwYXkgb24tYmVoYWxmLW9mIGEgdGVhY2hlclxyXG4gICAgICAkc2NvcGUubG9hZFBlbmRpbmdQYXltZW50cygkc3RhdGUucGFyYW1zLnRlYWNoZXIpO1xyXG4gICAgICAkc2NvcGUubG9hZEZvbGRlclN1YnNjcmlwdGlvbnMoJHN0YXRlLnBhcmFtcy50ZWFjaGVyKTtcclxuICAgICAgJHNjb3BlLm5ld09yZ1BheW1lbnQoJHN0YXRlLnBhcmFtcy50ZWFjaGVyKTtcclxuICAgICAgJHNjb3BlLnN1YnNjcmlwdGlvblBsYW49Y29uZi5vcmdhbml6YXRpb24uc3Vic2NyaXB0aW9uUGxhbjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRzY29wZS5sb2FkUGVuZGluZ1BheW1lbnRzKCRyb290U2NvcGUudXNlci50ZWFjaGVyKTtcclxuICAgICAgJHNjb3BlLmxvYWRGb2xkZXJTdWJzY3JpcHRpb25zKCRyb290U2NvcGUudXNlci50ZWFjaGVyKTtcclxuICAgICAgJHNjb3BlLm5ld1BheW1lbnQoKTtcclxuICAgICAgJHNjb3BlLnN1YnNjcmlwdGlvblBsYW49Y29uZi50ZWFjaGVyLnN1YnNjcmlwdGlvblBsYW47XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFRhYiA9IGZ1bmN0aW9uKHQpe1xyXG4gICAgJHNjb3BlLmNoZWNrb3V0VGFiPXQ7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUubG9hZEZvbGRlclN1YnNjcmlwdGlvbnMgPSBmdW5jdGlvbiAodGVhY2hlcikge1xyXG4gICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL21lbnUvZm9sZGVyU3Vic2NyaXB0aW9ucy8nICsgdGVhY2hlcikudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUuZm9sZGVyU3Vic2NyaXB0aW9ucyA9IHJlc3AuZGF0YTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5sb2FkUGVuZGluZ1BheW1lbnRzID0gZnVuY3Rpb24odGVhY2hlcikge1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9maW5kUGF5bWVudHMnLCB7dGVhY2hlcjp0ZWFjaGVyLCBzdGF0dXM6J3BlbmRpbmcnLCBjdXJyZW5jeTon4oKsJ30pLnRoZW4oZnVuY3Rpb24ocmVzcCkge1xyXG4gICAgICBpZiAocmVzcC5kYXRhLmxlbmd0aD09MCl7XHJcbiAgICAgICAgJHNjb3BlLmNoZWNrb3V0VGFiPTA7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJHNjb3BlLnBlbmRpbmdQYXltZW50cz1yZXNwLmRhdGE7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmxvYWRQcm9kdWN0cyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3Byb2R1Y3RzJykudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUucHJvZHVjdHMgPSBfLmZpbHRlcihyZXNwLmRhdGEsIGZ1bmN0aW9uIChwKSB7XHJcbiAgICAgICAgcmV0dXJuIHAuZm9sZGVyO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXREZWZlcnJpbmcgPSBmdW5jdGlvbigpe1xyXG4gICAgJHNjb3BlLmRlZmVycmluZz10cnVlO1xyXG4gICAgJHNjb3BlLmNoZWNrb3V0VGFiPTI7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuc2V0UGF5bWVudFR5cGUgPSBmdW5jdGlvbih0eXBlKXtcclxuICAgICRzY29wZS5wYXltZW50LnR5cGU9dHlwZTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvc2F2ZVBheW1lbnQvJyArICRzY29wZS5wYXltZW50Ll9pZCwgJHNjb3BlLnBheW1lbnQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLnBheW1lbnQgPSByZXNwLmRhdGE7XHJcbiAgICAgICRzY29wZS5jaGVja291dFRhYj0yO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB2YXIgaW5pdEJpbGxpbmdJbmZvID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBmdWxsbmFtZSA9IGNvbmYudGVhY2hlci5uYW1lICsgXCIgXCIgKyBjb25mLnRlYWNoZXIuc3VybmFtZTtcclxuICAgIGlmIChjb25mLnRlYWNoZXIubWlkZGxlKSB7XHJcbiAgICAgIGZ1bGxuYW1lICs9IFwiIFwiK2NvbmYudGVhY2hlci5taWRkbGU7XHJcbiAgICB9XHJcbiAgICAkc2NvcGUucGF5bWVudC5iaWxsaW5nSW5mbyA9IHtcclxuICAgICAgZW1haWw6IGNvbmYudGVhY2hlci5lbWFpbCxcclxuICAgICAgZmlyc3RuYW1lOiBjb25mLnRlYWNoZXIubmFtZSxcclxuICAgICAgbGFzdG5hbWU6IGNvbmYudGVhY2hlci5zdXJuYW1lLFxyXG4gICAgICBtaWRkbGVuYW1lOiBjb25mLnRlYWNoZXIubWlkZGxlLFxyXG4gICAgICBmdWxsbmFtZTogZnVsbG5hbWUsXHJcbiAgICAgIGNvdW50cnlDb2RlOiBjb25mLnRlYWNoZXIuYWRkcmVzcy5jb3VudHJ5Q29kZSB8fCAnUlUnXHJcbiAgICB9ICAgIFxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLm5ld1BheW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvbmV3UGF5bWVudC8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLnBheW1lbnQgPSByZXNwLmRhdGE7XHJcbiAgICAgICRzY29wZS5wYXltZW50Lml0ZW1zID0ge307XHJcbiAgICAgIGluaXRCaWxsaW5nSW5mbygpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLm5ld09yZ1BheW1lbnQgPSBmdW5jdGlvbiAodGVhY2hlcikge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvb3JnYW5pemF0aW9ucy8nICsgJHJvb3RTY29wZS51c2VyLm9yZ2FuaXphdGlvbiArICcvdGVhY2hlcnMvJyArIHRlYWNoZXIgKyBcIi9wYXltZW50c1wiKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5wYXltZW50ID0gcmVzcC5kYXRhO1xyXG4gICAgICAkc2NvcGUucGF5bWVudC5pdGVtcyA9IHt9O1xyXG4gICAgICAkc2NvcGUucGF5bWVudC5lbWFpbCA9IGNvbmYub3JnYW5pemF0aW9uLmVtYWlsO1xyXG4gICAgICAkc2NvcGUucGF5bWVudC5mdWxsbmFtZSA9IGNvbmYub3JnYW5pemF0aW9uLmRpcmVjdG9yO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnRvZ2dsZSA9IGZ1bmN0aW9uIChwcm9kdWN0KSB7XHJcbiAgICB2YXIgc2VsID0gJHNjb3BlLnBheW1lbnQuaXRlbXNbcHJvZHVjdC5mb2xkZXIuY29kZV07XHJcbiAgICBpZiAoc2VsICYmIHNlbC5faWQ9PXByb2R1Y3QuX2lkKSB7XHJcbiAgICAgICRzY29wZS5wYXltZW50Lml0ZW1zW3Byb2R1Y3QuZm9sZGVyLmNvZGVdID0gbnVsbDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRzY29wZS5wYXltZW50Lml0ZW1zW3Byb2R1Y3QuZm9sZGVyLmNvZGVdID0gcHJvZHVjdDtcclxuICAgIH1cclxuXHJcbiAgICBzYXZlUGF5bWVudCgpO1xyXG4gIH07XHJcblxyXG4gIHZhciBzYXZlUGF5bWVudCA9IGZ1bmN0aW9uIHNhdmVQYXltZW50KCkge1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9zYXZlUGF5bWVudC8nICsgJHNjb3BlLnBheW1lbnQuX2lkLCAkc2NvcGUucGF5bWVudCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUucGF5bWVudCA9IHJlc3AuZGF0YTtcclxuICAgICAgZXhwaXJ5RGF0ZXMoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHZhciBleHBpcnlEYXRlcyA9IGZ1bmN0aW9uIGV4cGlyeURhdGVzKCkge1xyXG4gICAgXy5lYWNoKF8udmFsdWVzKCRzY29wZS5wYXltZW50Lml0ZW1zKSwgZnVuY3Rpb24gKHByb2R1Y3QpIHtcclxuICAgICAgdmFyIHN1YnNjciA9IF8uZmluZCgkc2NvcGUuZm9sZGVyU3Vic2NyaXB0aW9ucywgZnVuY3Rpb24oc3Vic2NyKSB7XHJcbiAgICAgICAgcmV0dXJuIHN1YnNjci5mb2xkZXIuY29kZT09cHJvZHVjdC5mb2xkZXIuY29kZTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoIXN1YnNjciB8fCAhc3Vic2NyLmV4cGlyeURhdGUgfHwgRGF0ZS5wYXJzZShzdWJzY3IuZXhwaXJ5RGF0ZSkgPCBEYXRlLm5vdygpKSB7XHJcbiAgICAgICAgcHJvZHVjdC5wcmV2RXhwaXJ5RGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcHJvZHVjdC5wcmV2RXhwaXJ5RGF0ZSA9IG5ldyBEYXRlKHN1YnNjci5leHBpcnlEYXRlKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIG5ld0V4cGlyeSA9IG5ldyBEYXRlKHByb2R1Y3QucHJldkV4cGlyeURhdGUpO1xyXG4gICAgICBuZXdFeHBpcnkuc2V0RGF0ZShuZXdFeHBpcnkuZ2V0RGF0ZSgpICsgcHJvZHVjdC5kYXlzKTtcclxuICAgICAgcHJvZHVjdC5uZXdFeHBpcnlEYXRlID0gbmV3RXhwaXJ5O1xyXG5cclxuICAgIH0pO1xyXG5cclxuICB9O1xyXG5cclxuICAkc2NvcGUuYXBwbHlQcm9tb0NvZGUgPSBmdW5jdGlvbigpIHtcclxuICAgICRodHRwLnB1dChjb25maWcuYXBpVXJsICsgJy93cy9wYXltZW50cy9hcHBseVByb21vJywgJHNjb3BlLnBheW1lbnQpLnRoZW4oXHJcbiAgICAgIGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICRzY29wZS5wYXltZW50ID0gcmVzcC5kYXRhO1xyXG4gICAgICB9LCBcclxuICAgICAgZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgJHNjb3BlLnByb21vQ29kZUVycm9yPXJlc3AuZGF0YTtcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAkc2NvcGUucmVtb3ZlUHJvbW9Db2RlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAkaHR0cC5wdXQoY29uZmlnLmFwaVVybCArICcvd3MvcGF5bWVudHMvcmVtb3ZlUHJvbW8nLCAkc2NvcGUucGF5bWVudCkudGhlbihcclxuICAgICAgZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgJHNjb3BlLnBheW1lbnQgPSByZXNwLmRhdGE7XHJcbiAgICAgIH0pXHJcbiAgfVxyXG5cclxuICAkc2NvcGUucGF5T3JkZXIgPSBmdW5jdGlvbihwYXltZW50KXtcclxuICAgICRzY29wZS5wYXltZW50ID0gcGF5bWVudDtcclxuICAgICRzY29wZS5jaGVja291dFRhYiA9IDI7XHJcbiAgICBpbml0QmlsbGluZ0luZm8oKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5jYW5jZWxPcmRlciA9IGZ1bmN0aW9uKHBheW1lbnQpe1xyXG4gICAgJGh0dHAuZGVsZXRlKGNvbmZpZy5hcGlVcmwgKyAnL3dzL3Jldm9sdXQvb3JkZXJzP3BheW1lbnRJZD0nK3BheW1lbnQuX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5pbml0KCk7XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmFiYW5kb25QYXltZW50ID0gZnVuY3Rpb24ocGF5bWVudCl7XHJcbiAgICBpZiAocGF5bWVudC50eXBlPT0nY3JlZGl0Q2FyZCcpe1xyXG4gICAgICAkaHR0cC5kZWxldGUoY29uZmlnLmFwaVVybCArICcvd3MvcmV2b2x1dC9vcmRlcnM/YWJhbmRvbj10cnVlJnBheW1lbnRJZD0nK3BheW1lbnQuX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgJHNjb3BlLmluaXQoKTtcclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRodHRwLmRlbGV0ZShjb25maWcuYXBpVXJsICsgJy93cy9wYXltZW50cy8nK3BheW1lbnQuX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgJHNjb3BlLmluaXQoKTtcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gICRzY29wZS5wYXltZW50RGV0YWlscyA9IGZ1bmN0aW9uKHBheW1lbnQpe1xyXG4gICAgJHNjb3BlLnBheW1lbnQ9cGF5bWVudDtcclxuICAgICRzY29wZS5jaGVja291dFRhYj01O1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmNoZWNrb3V0UGVuZGluZyA9IGZ1bmN0aW9uKHBheW1lbnQpIHtcclxuICAgICRodHRwLnB1dChjb25maWcuYXBpVXJsICsgJy93cy9wYXltZW50cy8nK3BheW1lbnQuX2lkKycvY2hlY2tvdXQvcGVuZGluZycpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLnBheW1lbnQgPSByZXNwLmRhdGE7XHJcbiAgICAgICRzY29wZS5jaGVja291dFRhYiA9IDE7XHJcbiAgICAgIGluaXRCaWxsaW5nSW5mbygpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuYXhlcnZlQ2hlY2tvdXQgPSBmdW5jdGlvbihwYXltZW50LCBwYXltZW50VHlwZSl7XHJcbiAgICAkc2NvcGUuY2hlY2tvdXRUYWIgPSAzO1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9wYXltZW50cy8nICsgcGF5bWVudC5faWQgKyAnL2NoZWNrb3V0L2F4ZXJ2ZS8nK3BheW1lbnRUeXBlLCBwYXltZW50KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlc3AuZGF0YS5mb3JtVXJsOyAgICBcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAkc2NvcGUuY29uZmlybUJhbmtUcmFuc2ZlciA9IGZ1bmN0aW9uKHBheW1lbnQpe1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9wYXltZW50cy8nICsgcGF5bWVudC5faWQgKyAnL2NoZWNrb3V0L2JhbmtUcmFuc2ZlcicsIHBheW1lbnQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLmNoZWNrb3V0VGFiID0gNDtcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAkc2NvcGUuY2hlY2tvdXQgPSBmdW5jdGlvbiAocGF5bWVudCkge1xyXG4gICAgLy8kc2NvcGUuY2hlY2tvdXRUYWIgPSAzO1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9wYXltZW50cy8nICsgcGF5bWVudC5faWQgKyAnL2NoZWNrb3V0L3Jldm9sdXQnLCBwYXltZW50KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgIFJldm9sdXRDaGVja291dChyZXNwLmRhdGEucHVibGljX2lkLCBjb25maWcucGF5bWVudHMuZW52KS50aGVuKChpbnN0YW5jZSkgPT4ge1xyXG4gICAgICAgIGluc3RhbmNlLnBheVdpdGhQb3B1cCh7XHJcbiAgICAgICAgICBuYW1lOiAkc2NvcGUucGF5bWVudC5iaWxsaW5nSW5mby5mdWxsbmFtZSxcclxuICAgICAgICAgIGVtYWlsOiAkc2NvcGUucGF5bWVudC5iaWxsaW5nSW5mby5lbWFpbCxcclxuICAgICAgICAgIG9uU3VjY2VzcygpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNoZWNrT3JkZXJTdGF0dXMocmVzcC5kYXRhLmlkKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBvbkVycm9yKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNoZWNrT3JkZXJTdGF0dXMocmVzcC5kYXRhLmlkKTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBvbkNhbmNlbCgpIHtcclxuICAgICAgICAgIH0gICAgICAgICAgXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pOyAgICAgIFxyXG4gICAgfSxmdW5jdGlvbihyZXNwKXtcclxuICAgICAgJHNjb3BlLmNoZWNrb3V0VGFiID0gNTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5jaGVja09yZGVyU3RhdHVzID0gZnVuY3Rpb24ob3JkZXJJZCl7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3Jldm9sdXQvY2FsbGJhY2snLHtvcmRlcl9pZDpvcmRlcklkfSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICB2YXIgcGF5bWVudD1yZXNwLmRhdGE7XHJcbiAgICAgIGlmIChwYXltZW50LnN0YXR1cz09J3ZhbGlkJyl7XHJcbiAgICAgICAgcGFNZW51LmxvYWRNeUZvbGRlcnMoJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpO1xyXG4gICAgICAgICRzdGF0ZS5nbygnbGV2ZWxzJyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJHNjb3BlLmNoZWNrb3V0VGFiID0gNDtcclxuICAgICAgICAkc2NvcGUucGF5bWVudCA9IHBheW1lbnQ7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICAkc2NvcGUuZGVmZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3BheW1lbnRzLycgKyAkc2NvcGUucGF5bWVudC5faWQgKyAnL2RlZmVyJywgJHNjb3BlLnBheW1lbnQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgcGFNZW51LmxvYWRNeUZvbGRlcnMoJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpO1xyXG4gICAgICAkc2NvcGUucm93cz1yZXNwLmRhdGE7XHJcbiAgICAgICRzY29wZS5jaGVja291dFRhYj00O1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxubWRDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignbWRDdHJsJywgbWRDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIG1kQ3RybCgkc2NvcGUsICRodHRwKXtcdFxyXG4gICAgJGh0dHAuZ2V0KCcvd3MvaGVscC9ob21lLycgKyAkc2NvcGUucGFnZSkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICBpZiAocmVzcCAmJiByZXNwLmRhdGEpe1xyXG4gICAgICAgICAgICAkc2NvcGUubWQgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgfSkgICBcclxufVxyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbm1pcmdvdm9yaXRDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCIkaHR0cFwiLCBcIiR3aW5kb3dcIiwgXCIkbG9jYXRpb25cIiwgXCJhdXRoU2VydmljZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignbWlyZ292b3JpdEN0cmwnLCBtaXJnb3Zvcml0Q3RybCk7XHJcblxyXG5mdW5jdGlvbiBtaXJnb3Zvcml0Q3RybCgkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkaHR0cCwgJHdpbmRvdywgJGxvY2F0aW9uLCBhdXRoU2VydmljZSwgY29uZmlnKXtcdFxyXG4gICAgXHJcbiAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgc3dpdGNoICgkc3RhdGUuY3VycmVudC5uYW1lKXtcclxuICAgICAgICAgICAgY2FzZSAnbWlyZ292b3JpdC1saW5rJzpcclxuICAgICAgICAgICAgICAgICRzY29wZS5saW5rKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbWlyZ292b3JpdC1sb2dpbic6XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUubG9naW4oKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuc2V0VGFiID0gZnVuY3Rpb24odGFiKXtcclxuICAgICAgICAkc2NvcGUudGFiID0gdGFiO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5saW5rID0gZnVuY3Rpb24obW9kZSkge1xyXG5cclxuICAgICAgICB2YXIgcGFyYW1zID0gJGxvY2F0aW9uLnNlYXJjaCgpO1xyXG4gICAgICAgICRzY29wZS50YWIgPSBtb2RlIHx8IHBhcmFtcy5tb2RlO1xyXG5cclxuICAgICAgICBpZiAocGFyYW1zLmRhdGEpIHtcclxuICAgICAgICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9taXJnb3Zvcml0L2RlY3J5cHQnLCB7ZGF0YTpwYXJhbXMuZGF0YX0pLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLm1pcmdvdm9yaXRQcm9maWxlID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoISRzY29wZS50YWIgfHwgJHNjb3BlLnRhYiE9J3JlZ2lzdGVyJykge1xyXG4gICAgICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvcHJvZmlsZScpLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwICYmIHJlc3AuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5waWtpbW9uaVByb2ZpbGUgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50YWIgPSAnbGluayc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRhYiA9ICdsb2dpbic7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgJHNjb3BlLmNvbmZpcm1MaW5rID0gZnVuY3Rpb24oKXtcclxuICAgICAgICB2YXIgcGFyYW1zID0gJGxvY2F0aW9uLnNlYXJjaCgpO1xyXG4gICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvbWlyZ292b3JpdC9saW5rJywge2RhdGE6IHBhcmFtcy5kYXRhfSkudGhlbihcclxuICAgICAgICAgICAgZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zLnJlZGlyZWN0VXJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhcmFtcy5yZWRpcmVjdFVybCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi51cmwoJy9wYS9kYXNoYm9hcmQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUucGlraW1vbmlMb2dpbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBhdXRoU2VydmljZS5sb2dpbigkc2NvcGUudXNlcm5hbWUsICRzY29wZS5wYXNzd29yZCwgZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VybmFtZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgJHNjb3BlLnBhc3N3b3JkID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAkc2NvcGUubG9nZ2VkSW4gPSB0cnVlO1xyXG4gICAgICAgICAgICAkc2NvcGUubGluaygnbGluaycpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgJHNjb3BlLmVycm9yID0gcmVzdWx0LmVycm9yO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUucmVnaXN0ZXIgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIHZhciBwYXJhbXMgPSAkbG9jYXRpb24uc2VhcmNoKCk7XHJcbiAgICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9taXJnb3Zvcml0L3JlZ2lzdGVyJywge2RhdGE6IHBhcmFtcy5kYXRhfSkudGhlbihcclxuICAgICAgICAgIGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgIGlmIChyZXNwLmRhdGEgJiYgcmVzcC5kYXRhLl9pZCl7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXMucmVkaXJlY3RVcmwpe1xyXG4gICAgICAgICAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IGRlY29kZVVSSUNvbXBvbmVudChwYXJhbXMucmVkaXJlY3RVcmwpO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmxvZ2luKCk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yPXJlc3AuZGF0YS5lcnJvcjtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBwYXJhbXMgPSAkbG9jYXRpb24uc2VhcmNoKCk7XHJcbiAgICAgICAgYXV0aFNlcnZpY2UubWlyZ292b3JpdExvZ2luKHBhcmFtcy5kYXRhLCBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdwYScse3RvOidkYXNoYm9hcmQnfSk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3IgPSByZXN1bHQuZXJyb3I7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAkc2NvcGUuZm9yZ290UGFzc3dvcmQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZvcmdvdFBhc3N3b3JkJywge2VtYWlsOiAkc2NvcGUuZW1haWx9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNwLmRhdGE9PSdFJykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yPSdFbWFpbCBub3QgZm91bmQnO1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLnNldFRhYignZm9yZ290UHdkJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2V0VGFiKCdtYWlsU2VudCcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTsgICAgICAgIFxyXG4gICAgfVxyXG4gICAgJHNjb3BlLmluaXQoKTtcclxufVxyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbm1peGVkUmVzb3VyY2VDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCJwYUNhY2hlXCIsIFwicGFTb2NrZXRcIiwgXCJwYVNlcnZpY2VcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ21peGVkUmVzb3VyY2VDdHJsJywgbWl4ZWRSZXNvdXJjZUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gbWl4ZWRSZXNvdXJjZUN0cmwoJHNjb3BlLCBwYUNhY2hlLCBwYVNvY2tldCwgcGFTZXJ2aWNlKXtcdFxyXG4gICAgJHNjb3BlLmNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRzY29wZS5kYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcblxyXG4gICAgLyppZiAoJHNjb3BlLnBhUmVzb3VyY2UgJiYgJHNjb3BlLnBhUmVzb3VyY2UudHlwZT09J3RleHQnKXtcclxuICAgICAgJHNjb3BlLnBhUmVzb3VyY2Uud29yZHM9cGFTZXJ2aWNlLnNwbGl0KCRzY29wZS5wYVJlc291cmNlLmNoYXJzLCcgJyk7XHJcbiAgICB9Ki9cclxuXHJcbiAgICAkc2NvcGUucGxheUF1ZGlvID0gZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgIHBhU29ja2V0LmVtaXQoXCJwbGF5LXRyYWNrXCIsIHtcclxuICAgICAgICAgIHBsYXk6IHVybFxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUucGF1c2VBdWRpbyA9IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgICAgcGFTb2NrZXQuZW1pdChcInBsYXktdHJhY2tcIiwge1xyXG4gICAgICAgIHBhdXNlOiB1cmxcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5lbWl0TWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlLCB2YWx1ZSkge1xyXG4gICAgICBwYVNvY2tldC5lbWl0KG1lc3NhZ2UsIHZhbHVlKTtcclxuICAgIH07XHJcbiAgXHJcbiAgICAkc2NvcGUudW5kbyA9IGZ1bmN0aW9uIChzLCB0KSB7XHJcbiAgICAgIHBhU29ja2V0LmVtaXQoXCJ1bmRvLWRyYWdcIiwge1xyXG4gICAgICAgIHNvdXJjZTogcyxcclxuICAgICAgICB0YXJnZXQ6IHRcclxuICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5mbGlwID0gZnVuY3Rpb24gKGkpIHtcclxuICAgICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICAgdmFyIHNlbCA9IGRhdGEuc2VsZWN0ZWRbaV07XHJcbiAgICAgIHBhU29ja2V0LmVtaXQoXCJmbGlwXCIsIFtpLCAhc2VsXSk7XHJcbiAgICB9O1xyXG4gIFxyXG4gICAgJHNjb3BlLnNlbmRUZXh0ID0gZnVuY3Rpb24gKGksIHRleHQpIHtcclxuICAgICAgaWYgKCF0ZXh0KXtcclxuICAgICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIHRleHQgPSBkYXRhLnRlbXBbaV07XHJcbiAgICAgIH1cclxuICAgICAgcGFTb2NrZXQuZW1pdCgncmVwbGFjZS10ZXh0Jywge1xyXG4gICAgICAgIGk6IGksXHJcbiAgICAgICAgdmFsOiB0ZXh0XHJcbiAgICAgIH0pO1xyXG4gICAgfTtcclxuICBcclxufVxyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbm9wZW50b2tDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRyb290U2NvcGVcIiwgXCJwYUNhY2hlXCIsIFwicGFTb2NrZXRcIiwgXCJPVFNlc3Npb25cIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ29wZW50b2tDdHJsJywgb3BlbnRva0N0cmwpO1xyXG5cclxuZnVuY3Rpb24gb3BlbnRva0N0cmwoJHNjb3BlLCAkaHR0cCwgJHJvb3RTY29wZSwgcGFDYWNoZSwgcGFTb2NrZXQsIE9UU2Vzc2lvbiwgY29uZmlnKSB7XHJcbiAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAkc2NvcGUuZnVsbHNjcmVlblN0eWxlID0ge1xyXG4gICAgd2lkdGg6ICc5NnZ3JyxcclxuICAgIGhlaWdodDogJzg2dmgnXHJcbiAgfTtcclxuICAkc2NvcGUuc3RhbmRhcmRTdHlsZSA9IHtcclxuICAgIHdpZHRoOiAnMTV2dycsXHJcbiAgICBoZWlnaHQ6ICc1MHZoJ1xyXG4gIH07XHJcblxyXG4gIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgIGlmIChjb25mLnZpZGVvLmFjdGl2ZSkge1xyXG4gICAgICBpbml0U2Vzc2lvbigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY2xvc2VTZXNzaW9uKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgdmFyIGluaXRTZXNzaW9uID0gZnVuY3Rpb24gaW5pdFNlc3Npb24oKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3Mvb3BlbnRvay8nICsgY29uZi5jaGFubmVsLl9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICBPVFNlc3Npb24uaW5pdChyZXNwLmRhdGEuYXBpS2V5LCBjb25mLmNoYW5uZWwub3BlbnRvaywgcmVzcC5kYXRhLnRva2VuLCBmdW5jdGlvbiAoZXJyLCBzZXNzaW9uKSB7Ly8gSGVyZSB5b3UgY2FuIGRvIHRoaW5ncyB0byB0aGUgT3BlblRvayBzZXNzaW9uXHJcbiAgICAgICAgLy8gVGhlIGVyciBpcyBidWJibGVkIHVwIGZyb20gc2Vzc2lvbi5jb25uZWN0XHJcbiAgICAgIH0pO1xyXG4gICAgICAkc2NvcGUuc3RyZWFtcyA9IE9UU2Vzc2lvbi5zdHJlYW1zO1xyXG4gICAgICAkc2NvcGUudG9rZW4gPSByZXNwLmRhdGEudG9rZW47XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBpbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhT3JnYW5pemF0aW9uQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHVpYk1vZGFsXCIsIFwiJHN0YXRlXCIsIFwicGFDYWNoZVwiLCBcInBhVGVhY2hlclwiLCBcInBhU3Vic2NyaXB0aW9uXCIsIFwicGFQYXltZW50XCIsIFwicGFTdHVkZW50XCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYU9yZ2FuaXphdGlvbkN0cmwnLCBwYU9yZ2FuaXphdGlvbkN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFPcmdhbml6YXRpb25DdHJsKCRzY29wZSwgJHJvb3RTY29wZSwgJGh0dHAsICR1aWJNb2RhbCwgJHN0YXRlLCBwYUNhY2hlLCBwYVRlYWNoZXIsIHBhU3Vic2NyaXB0aW9uLCBwYVBheW1lbnQsIHBhU3R1ZGVudCwgY29uZmlnKSB7XHJcbiAgdmFyIHBhZ2VTY29wZSA9IHBhQ2FjaGUuaW5pdFBhZ2VTY29wZSgpO1xyXG4gIHBhZ2VTY29wZS5maWx0ZXI9e307XHJcbiAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhZ2VTY29wZTtcclxuXHJcbiAgdmFyIGluaXQgPSBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgaWYgKCRzdGF0ZS5jdXJyZW50Lm5hbWU9PSdvcmctdGVhY2hlcnMnKXtcclxuICAgICAgcGFUZWFjaGVyLmdldE9yZ2FuaXphdGlvblRlYWNoZXJzKCRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24pO1xyXG5cclxuICAgIH0gZWxzZSBpZiAoJHN0YXRlLmN1cnJlbnQubmFtZT09J29yZy10ZWFjaGVyJyl7XHJcbiAgICAgICRzY29wZS50ZWFjaGVyPSRzdGF0ZS5wYXJhbXMudGVhY2hlcjtcclxuICAgICAgcGFUZWFjaGVyLmdldEZvbGRlclN1YnNjcmlwdGlvbnMoJHN0YXRlLnBhcmFtcy50ZWFjaGVyKTtcclxuXHJcbiAgICB9IGVsc2UgaWYgKCRzdGF0ZS5jdXJyZW50Lm5hbWU9PSdvcmctc3R1ZGVudHMnKXtcclxuICAgICAgcGFTdHVkZW50LmdldE9yZ2FuaXphdGlvblN0dWRlbnRzKCRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24pO1xyXG4gICAgICBwYVN0dWRlbnQuZ2V0T3JnYW5pemF0aW9uR3JvdXBzKCRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24pO1xyXG5cclxuICAgIH0gZWxzZSBpZiAoJHN0YXRlLmN1cnJlbnQubmFtZT09J29yZy1ncm91cHMnKXtcclxuICAgICAgcGFTdHVkZW50LmdldE9yZ2FuaXphdGlvblN0dWRlbnRTdWJzY3JpcHRpb25zKCRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24pO1xyXG4gICAgICBwYVN0dWRlbnQuZ2V0T3JnYW5pemF0aW9uR3JvdXBzKCRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24pO1xyXG5cclxuICAgIH0gZWxzZSBpZiAoJHN0YXRlLmN1cnJlbnQubmFtZT09J29yZy1zdWJzY3JpcHRpb25zJyl7XHJcbiAgICAgIHBhU3Vic2NyaXB0aW9uLmdldE9yZ2FuaXphdGlvblN1YnNjcmlwdGlvbnMoJHJvb3RTY29wZS51c2VyLm9yZ2FuaXphdGlvbik7XHJcblxyXG4gICAgfSBlbHNlIGlmICgkc3RhdGUuY3VycmVudC5uYW1lPT0nb3JnLXBheW1lbnRzJyl7XHJcbiAgICAgIHBhUGF5bWVudC5nZXRPcmdhbml6YXRpb25QYXltZW50cygkcm9vdFNjb3BlLnVzZXIub3JnYW5pemF0aW9uKTtcclxuXHJcbiAgICB9IGVsc2UgaWYgKCRzdGF0ZS5jdXJyZW50Lm5hbWU9PSdvcmctbmV3LXBheW1lbnQnKXtcclxuICAgICAgJHNjb3BlLnRlYWNoZXI9JHN0YXRlLnBhcmFtcy50ZWFjaGVyO1xyXG4gICAgICAkc2NvcGUuZm9sZGVyPSRzdGF0ZS5wYXJhbXMuZm9sZGVyO1xyXG4gICAgICBwYVBheW1lbnQubmV3T3JnYW5pemF0aW9uUGF5bWVudCgkcm9vdFNjb3BlLnVzZXIub3JnYW5pemF0aW9uLCAkc3RhdGUucGFyYW1zLnRlYWNoZXIsICRzdGF0ZS5wYXJhbXMuZm9sZGVyKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUubGlua1RlYWNoZXIgPSBmdW5jdGlvbih0ZWFjaGVySWQpe1xyXG4gICAgcGFUZWFjaGVyLmxpbmtUZWFjaGVyVG9Pcmdhbml6YXRpb24odGVhY2hlcklkLCAkcm9vdFNjb3BlLnVzZXIub3JnYW5pemF0aW9uKVxyXG4gICAgICAudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAkc2NvcGUudGVhY2hlcklkPW51bGw7XHJcbiAgICAgICAgcGFUZWFjaGVyLmdldE9yZ2FuaXphdGlvblRlYWNoZXJzKCRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24pO1xyXG4gICAgICB9KVxyXG4gIH07XHJcblxyXG4gICRzY29wZS51bmxpbmtUZWFjaGVyID0gZnVuY3Rpb24gKHRlYWNoZXIpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmNvbmZpcm0uaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUNvbmZpcm1DdHJsJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIG1lc3NhZ2U6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICByZXR1cm4gJ0FyZSB5b3Ugc3VyZT8nXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICBwYVRlYWNoZXIudW5saW5rVGVhY2hlckZyb21Pcmdhbml6YXRpb24odGVhY2hlci5faWQsICRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24pXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICBwYVRlYWNoZXIuZ2V0T3JnYW5pemF0aW9uVGVhY2hlcnMoJHJvb3RTY29wZS51c2VyLm9yZ2FuaXphdGlvbik7XHJcbiAgICAgICAgfSlcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS51bmxpbmtTdWJzY3JpcHRpb24gPSBmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29uZmlybS5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhQ29uZmlybUN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiAnQXJlIHlvdSBzdXJlPydcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHBhU3Vic2NyaXB0aW9uLnVubGlua1N1YnNjcmlwdGlvbkZyb21UZWFjaGVyKHN1YnNjcilcclxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgIHBhU3Vic2NyaXB0aW9uLmdldE9yZ2FuaXphdGlvblN1YnNjcmlwdGlvbnMoJHJvb3RTY29wZS51c2VyLm9yZ2FuaXphdGlvbik7XHJcbiAgICAgICAgfSlcclxuICAgIH0pO1xyXG4gIH1cclxuICAkc2NvcGUubGlua1N1YnNjcmlwdGlvblBvcHVwID0gZnVuY3Rpb24oc3Vic2NyKXtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmxpbmtTdWJzY3JpcHRpb24uaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUxpbmtTdWJzY3JpcHRpb25DdHJsJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIHN1YnNjcjogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiBzdWJzY3JcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAodGVhY2hlcikge1xyXG4gICAgICBwYVN1YnNjcmlwdGlvbi5saW5rU3Vic2NyaXB0aW9uVG9UZWFjaGVyKHN1YnNjciwgdGVhY2hlcilcclxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgIHBhU3Vic2NyaXB0aW9uLmdldE9yZ2FuaXphdGlvblN1YnNjcmlwdGlvbnMoJHJvb3RTY29wZS51c2VyLm9yZ2FuaXphdGlvbik7XHJcbiAgICAgICAgfSlcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmZpbHRlckJ5R3JvdXAgPSBmdW5jdGlvbihncm91cCl7XHJcbiAgICBwYWdlU2NvcGUuZmlsdGVyLmdyb3VwPXtfaWQ6Z3JvdXAuX2lkfTtcclxuICB9XHJcblxyXG4gICRzY29wZS5jbGVhckZpbHRlciA9IGZ1bmN0aW9uKCl7XHJcbiAgICBwYWdlU2NvcGUuZmlsdGVyPXt9O1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnVubGlua1N0dWRlbnRQb3B1cCA9IGZ1bmN0aW9uKHN0dWRlbnQpe1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29uZmlybS5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhQ29uZmlybUN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiAnQXJlIHlvdSBzdXJlPydcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHBhU3R1ZGVudC51bmxpbmtTdHVkZW50RnJvbU9yZ2FuaXphdGlvbihzdHVkZW50KVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgcGFTdHVkZW50LmdldE9yZ2FuaXphdGlvblN0dWRlbnRzKCRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuY2FudmFzQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdjYW52YXNDdHJsJywgY2FudmFzQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBjYW52YXNDdHJsKCRzY29wZSkge1xyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmxvYWRJbWFnZSgpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5sb2FkSW1hZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcblxyXG4gICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdmFyIHcgPSBpbWcud2lkdGgsXHJcbiAgICAgICAgICBoID0gaW1nLmhlaWdodDtcclxuICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCRzY29wZS5uYW1lKTtcclxuICAgICAgJHNjb3BlLnNjYWxlID0gdyA+IGggPyBjYW52YXMud2lkdGggLyB3IDogY2FudmFzLmhlaWdodCAvIGg7XHJcbiAgICAgICRzY29wZS5yZXNpemUoY2FudmFzLCBpbWcpO1xyXG4gICAgfTtcclxuXHJcbiAgICBpbWcuc3JjID0gJHNjb3BlLnJlc291cmNlLnNyYztcclxuICB9O1xyXG5cclxuICAkc2NvcGUucmVzaXplID0gZnVuY3Rpb24gKGNhbnZhcywgaW1nKSB7XHJcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuICAgIHZhciB3ID0gaW1nLndpZHRoICogJHNjb3BlLnNjYWxlLFxyXG4gICAgICAgIGggPSBpbWcuaGVpZ2h0ICogJHNjb3BlLnNjYWxlO1xyXG4gICAgdmFyIHggPSBjYW52YXMud2lkdGggPiB3ID8gKGNhbnZhcy53aWR0aCAtIHcpIC8gMiA6IDA7XHJcbiAgICB2YXIgeSA9IGNhbnZhcy5oZWlnaHQgPiBoID8gKGNhbnZhcy5oZWlnaHQgLSBoKSAvIDIgOiAwO1xyXG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiYSgwLDAsMCwwKVwiO1xyXG4gICAgY3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgICBjdHguZHJhd0ltYWdlKGltZywgeCwgeSwgdywgaCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufVxyXG5cclxuOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuY2FyZEVkaXRvckNvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiJHN0YXRlXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwiJHVpYk1vZGFsXCIsIFwiJHJvb3RTY29wZVwiLCBcInBhQ2FjaGVcIiwgXCJwYVN0b3JhZ2VcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2NhcmRFZGl0b3JDb250cm9sbGVyJywgY2FyZEVkaXRvckNvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gY2FyZEVkaXRvckNvbnRyb2xsZXIoJHNjb3BlLCAkaHR0cCwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICR1aWJNb2RhbCwgJHJvb3RTY29wZSwgcGFDYWNoZSwgcGFTdG9yYWdlLCBjb25maWcpIHtcclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAkc2NvcGUuY2FyZCA9ICRzdGF0ZVBhcmFtcy5jYXJkO1xyXG5cclxuICB9O1xyXG5cclxuICAkc2NvcGUuYWRkUmVzb3VyY2UgPSBmdW5jdGlvbihyZXNvdXJjZSwgdHlwZSl7XHJcbiAgICByZXNvdXJjZS50eXBlID0gdHlwZTtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnJlc291cmNlLWFkZC5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BvcHVwUmVzb3VyY2VzQ3RybCcsXHJcbiAgICAgIHNpemU6ICdsZycsXHJcbiAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICB0eXBlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc291cmNlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICByZXR1cm4gXy5jbG9uZShyZXNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgIF8uZXh0ZW5kKHJlc291cmNlLCByZXMpO1xyXG4gICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmNsZWFyUmVzb3VyY2UgPSBmdW5jdGlvbihyZXNvdXJjZSkge1xyXG4gICAgXy5tYXBPYmplY3QocmVzb3VyY2UsIGZ1bmN0aW9uKHZhbCwga2V5KSB7XHJcbiAgICAgIGRlbGV0ZSByZXNvdXJjZVtrZXldO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuZWRpdFJlc291cmNlID0gZnVuY3Rpb24ocmVzb3VyY2UpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnJlc291cmNlLWVkaXQuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwb3B1cFJlc291cmNlc0N0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgdHlwZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICByZXNvdXJjZTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgcmV0dXJuIF8uY2xvbmUocmVzb3VyY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICBfLmV4dGVuZChyZXNvdXJjZSwgcmVzKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5vayA9IGZ1bmN0aW9uKCkge1xyXG4gICAgJHN0YXRlLnRyYW5zaXRpb25UbygnY29sbGVjdGlvbi0nKyRzdGF0ZVBhcmFtcy5jb2xsZWN0aW9uLnR5cGUsIHtcclxuICAgICAgY29sbGVjdGlvbjogJHN0YXRlUGFyYW1zLmNvbGxlY3Rpb24sXHJcbiAgICAgIG9wdGlvbnM6ICRzdGF0ZVBhcmFtcy5vcHRpb25zLFxyXG4gICAgICB0YWI6IDJcclxuICAgIH0pXHJcbiAgfVxyXG4gICRzY29wZS5pbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmNoYXRDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCJwYVNvY2tldFwiLCBcInBhQ2FjaGVcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2NoYXRDb250cm9sbGVyJywgY2hhdENvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gY2hhdENvbnRyb2xsZXIoJHNjb3BlLCBwYVNvY2tldCwgcGFDYWNoZSkge1xyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgY29uZi5jaGF0PSB7XHJcbiAgICBvcGVuOiBmYWxzZSxcclxuICAgIG1lc3NhZ2VzOiBbXVxyXG4gIH1cclxuICAkc2NvcGUuY29uZiA9IGNvbmY7XHJcblxyXG4gICRzY29wZS5zZW5kTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICgkc2NvcGUudGV4dCl7XHJcbiAgICAgIHBhU29ja2V0LmVtaXQoXCJjaGF0Lm1lc3NhZ2VcIiwge3RleHQ6ICRzY29wZS50ZXh0LCBpZDogRGF0ZS5ub3coKSwgYWN0aW9uOiAnYWRkJ30pO1xyXG4gICAgICAkc2NvcGUudGV4dCA9ICcnO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS51cGRhdGVNZXNzYWdlID0gZnVuY3Rpb24obXNnKSB7XHJcbiAgICBtc2cuYWN0aW9uPSd1cGRhdGUnO1xyXG4gICAgbXNnLmVkaXRNb2RlPXVuZGVmaW5lZDtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJjaGF0Lm1lc3NhZ2VcIiwgbXNnKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5yZW1vdmVNZXNzYWdlID0gZnVuY3Rpb24obXNnKSB7XHJcbiAgICBtc2cuYWN0aW9uPSdyZW1vdmUnO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImNoYXQubWVzc2FnZVwiLCBtc2cpO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLm9wZW5DaGF0ID0gZnVuY3Rpb24oYil7XHJcbiAgICBwYVNvY2tldC5lbWl0KCdjaGF0Lm9wZW4nLCB7XHJcbiAgICAgIHZhbHVlOiBiXHJcbiAgICB9KTtcclxuICB9XHJcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5jb2xsZWN0aW9uRWRpdG9yQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCIkdWliTW9kYWxcIiwgXCIkcm9vdFNjb3BlXCIsIFwicGFDYWNoZVwiLCBcInBhU3RvcmFnZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignY29sbGVjdGlvbkVkaXRvckNvbnRyb2xsZXInLCBjb2xsZWN0aW9uRWRpdG9yQ29udHJvbGxlcik7XHJcblxyXG5mdW5jdGlvbiBjb2xsZWN0aW9uRWRpdG9yQ29udHJvbGxlcigkc2NvcGUsICRodHRwLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgJHVpYk1vZGFsLCAkcm9vdFNjb3BlLCBwYUNhY2hlLCBwYVN0b3JhZ2UsIGNvbmZpZykge1xyXG5cclxuICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG5cclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICgkc2NvcGUuY29sbGVjdGlvbikge1xyXG5cclxuICAgICAgaWYgKCEkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMpIHtcclxuICAgICAgICAkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMgPSBbXTtcclxuICAgICAgfVxyXG4gIFxyXG4gICAgICBfLmVhY2goJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzLCBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgcmVzLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgIH0pOyBcclxuICAgICAgXHJcbiAgICAgIC8vJHNjb3BlLnJlbW92ZUR1cGxpY2F0ZXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY29uZi5jdXJyZW50UGFnZS5zdG9yYWdlKSB7XHJcbiAgICAgIHBhU3RvcmFnZS5sb2FkQmxvYnMoY29uZi5jdXJyZW50UGFnZS5zdG9yYWdlICsgJy8nLCAkc2NvcGUuY29udGVudFR5cGUsICRzY29wZS5jb2xsZWN0aW9uKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHBhU3RvcmFnZS5sb2FkQmxvYnMobnVsbCwgJHNjb3BlLmNvbnRlbnRUeXBlLCAkc2NvcGUuY29sbGVjdGlvbik7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmNvbmYgPSBjb25mO1xyXG4gICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhZ2VTY29wZTtcclxuICB9O1xyXG4gIC8qJHNjb3BlLnJlbW92ZUR1cGxpY2F0ZXMgPSBmdW5jdGlvbigpe1xyXG4gIFx0dmFyIHVuaXE9W107XHJcbiAgXHRfLmVhY2goJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzLCBmdW5jdGlvbihyZXMpe1xyXG4gIFx0XHRpZiAoISRzY29wZS5maW5kKHVuaXEscmVzKSl7XHJcbiAgXHRcdFx0dW5pcS5wdXNoKHJlcyk7XHJcbiAgXHRcdH1cclxuICBcdH0pO1xyXG4gIFx0JHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzID0gdW5pcTtcclxuICB9XHJcbiAgICAgJHNjb3BlLmZpbmQgPSBmdW5jdGlvbihyZXNvdXJjZXMsYmxvYil7XHJcbiAgICAgXHRyZXR1cm4gcmVzb3VyY2VzLnNvbWUoZnVuY3Rpb24ocmVzKXtcclxuICBcdFx0cmV0dXJuIHJlcy5uYW1lICYmIGJsb2IubmFtZSAmJiByZXMubmFtZT09YmxvYi5uYW1lO1xyXG4gIFx0fSk7XHJcbiAgICAgfTsqL1xyXG5cclxuICAkc2NvcGUuc2VsUmVzb3VyY2UgPSBmdW5jdGlvbihyZXMpe1xyXG4gICAgcGFnZVNjb3BlLnIgPSByZXM7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUubG9hZEJsb2JzID0gZnVuY3Rpb24ocHJlZml4KXtcclxuICAgIHBhU3RvcmFnZS5sb2FkQmxvYnMocHJlZml4LCAkc2NvcGUuY29udGVudFR5cGUsICRzY29wZS5jb2xsZWN0aW9uKVxyXG4gIH1cclxuXHJcblxyXG4gICRzY29wZS50b2dnbGUgPSBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICBpZiAocmVzLmFjdGl2ZSkge1xyXG4gICAgICAkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMucHVzaChyZXMpO1xyXG4gICAgICAvKiRzY29wZS5ub3RTZWxlY3RlZCA9IF8uZmlsdGVyKCRzY29wZS5ub3RTZWxlY3RlZCwgZnVuY3Rpb24ocil7XHJcbiAgICAgIHJldHVybiByLm5hbWUhPXJlcy5uYW1lO1xyXG4gICAgICB9KTsqL1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLyokc2NvcGUubm90U2VsZWN0ZWQucHVzaChyZXMpOyovXHJcbiAgICAgIHZhciBiID0gXy5maW5kKCRzY29wZS5ibG9icywgZnVuY3Rpb24gKGIpIHtcclxuICAgICAgICByZXR1cm4gYi5uYW1lID09IHJlcy5uYW1lO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmIChiKSB7XHJcbiAgICAgICAgYi5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzID0gXy5maWx0ZXIoJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzLCBmdW5jdGlvbiAocikge1xyXG4gICAgICAgIHJldHVybiByLm5hbWUgIT0gcmVzLm5hbWU7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS5uZXdDYXJkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzLnB1c2goe1xyXG4gICAgICB0eXBlOiAnY2FyZCcsXHJcbiAgICAgIGZyb250OiB7fSxcclxuICAgICAgYmFjazoge31cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5hZGRJbWFnZSA9IGZ1bmN0aW9uIChfYmVhbikge1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAuY2FyZC5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BvcHVwQ2FyZEN0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgYmVhbjogZnVuY3Rpb24gYmVhbigpIHtcclxuICAgICAgICAgIF9iZWFuLnR5cGUgPSAnaW1nJztcclxuICAgICAgICAgIHJldHVybiBfYmVhbjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJsb2JzOiBmdW5jdGlvbiBibG9icygpIHtcclxuICAgICAgICAgIHJldHVybiAkc2NvcGUuYmxvYnM7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKGNvbGwpIHt9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuYWRkVGV4dCA9IGZ1bmN0aW9uIChfYmVhbjIpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmNhcmQuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwb3B1cENhcmRDdHJsJyxcclxuICAgICAgc2l6ZTogJ2xnJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIGJlYW46IGZ1bmN0aW9uIGJlYW4oKSB7XHJcbiAgICAgICAgICBfYmVhbjIudHlwZSA9ICd0ZXh0JztcclxuICAgICAgICAgIHJldHVybiBfYmVhbjI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBibG9iczogZnVuY3Rpb24gYmxvYnMoKSB7XHJcbiAgICAgICAgICByZXR1cm4gJHNjb3BlLmJsb2JzO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChjb2xsKSB7fSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmVkaXRCZWFuID0gZnVuY3Rpb24gKF9iZWFuMykge1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAuY2FyZC5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BvcHVwQ2FyZEN0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgYmVhbjogZnVuY3Rpb24gYmVhbigpIHtcclxuICAgICAgICAgIHJldHVybiBfYmVhbjM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBibG9iczogZnVuY3Rpb24gYmxvYnMoKSB7XHJcbiAgICAgICAgICByZXR1cm4gJHNjb3BlLmJsb2JzO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChjb2xsKSB7fSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnJlbW92ZUNhcmQgPSBmdW5jdGlvbiAoaSkge1xyXG4gICAgJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzLnNwbGljZShpLCAxKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5pdCgpO1xyXG59XHJcblxyXG47IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUNvbGxlY3Rpb25zQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwicGFDYWNoZVwiLCBcInBhTWVudVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFDb2xsZWN0aW9uc0NvbnRyb2xsZXInLCBwYUNvbGxlY3Rpb25zQ29udHJvbGxlcik7XHJcblxyXG5mdW5jdGlvbiBwYUNvbGxlY3Rpb25zQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsICRzdGF0ZSwgJGh0dHAsIHBhQ2FjaGUsIHBhTWVudSwgY29uZmlnKSB7XHJcblxyXG4gICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICRzY29wZS5zZWFyY2g9e307XHJcbiAgICB9XHJcbiAgICAkc2NvcGUuc2VhcmNoQ29sbGVjdGlvbnMgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIHBhTWVudS5zZWFjaENvbGxlY3Rpb25zQnlOYW1lKCRzY29wZS5zZWFyY2gubmFtZSkudGhlbihmdW5jdGlvbihyZXN1bHRzKXtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc3VsdHMgPSByZXN1bHRzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgJHNjb3BlLnNldHRpbmdzID0gZnVuY3Rpb24oY29sbCl7XHJcbiAgICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgICBjb25mLmN1cnJlbnRQYWdlID0gY29sbC5wYWdlO1xyXG4gICAgICAgIGNvbmYuY3VycmVudENvbnRlbnQgPSBudWxsXHJcbiAgICAgICAgY29uZi5jdXJyZW50Rm9sZGVyID0gY29sbC5wYWdlLmZvbGRlcjtcclxuICAgICAgICBjb25mLmN1cnJlbnRNb2RlID0gJ1AnO1xyXG4gICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9wYWdlQ29uZi8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwgKyAnLycgKyBjb25mLmN1cnJlbnRQYWdlLl9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgICBpZiAocmVzcC5kYXRhKXtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLnNlbENvbGxlY3Rpb25zID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBvcHRpb25zPXtcclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBjb2xsLl9pZFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKFwiYWRtaW5cIiwge1xyXG4gICAgICAgICAgICAgICAgXCJvcHRpb25zXCI6IG9wdGlvbnNcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAkc2NvcGUuaW5pdCgpO1xyXG59OyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFDb25maXJtQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHVpYk1vZGFsSW5zdGFuY2VcIiwgXCJtZXNzYWdlXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYUNvbmZpcm1DdHJsJywgcGFDb25maXJtQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYUNvbmZpcm1DdHJsKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsIG1lc3NhZ2UpIHtcclxuXHJcbiAgJHNjb3BlLm1lc3NhZ2UgPSBtZXNzYWdlO1xyXG4gIFxyXG4gICRzY29wZS5vayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5jb250cm9sUGFuZWxDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIiR1aWJNb2RhbFwiLCBcIiRyb290U2NvcGVcIiwgXCJuZ0F1ZGlvXCIsIFwicGFTZXJ2aWNlXCIsIFwicGFDYWNoZVwiLCBcInBhU29ja2V0XCIsIFwicGFBY2xcIiwgXCJwYVN0eWxlXCIsIFwiY29uZmlnXCIsIFwicGFJbnRyb1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignY29udHJvbFBhbmVsQ3RybCcsIGNvbnRyb2xQYW5lbEN0cmwpO1xyXG5cclxuZnVuY3Rpb24gY29udHJvbFBhbmVsQ3RybCgkc2NvcGUsICRodHRwLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgJHVpYk1vZGFsLCAkcm9vdFNjb3BlLCBuZ0F1ZGlvLCBwYVNlcnZpY2UsIHBhQ2FjaGUsIHBhU29ja2V0LCBwYUFjbCwgcGFTdHlsZSwgY29uZmlnLCBwYUludHJvKSB7XHJcblxyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICRzY29wZS5jb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAkc2NvcGUuc2hvd0hlbHAgPSBjb25maWcuaGVscEJhc2VVcmw7XHJcblxyXG4gICAgaWYgKCEkc2NvcGUuc2l6ZSkge1xyXG4gICAgICAkc2NvcGUuc2l6ZSA9IHtcclxuICAgICAgICBtaW46IDEsXHJcbiAgICAgICAgbWF4OiAxMDAsXHJcbiAgICAgICAgc3RlcDogMVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghJHNjb3BlLnNpemUyKSB7XHJcbiAgICAgICRzY29wZS5zaXplMiA9IHtcclxuICAgICAgICBtaW46IDEsXHJcbiAgICAgICAgbWF4OiAxMDAsXHJcbiAgICAgICAgc3RlcDogMVxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghJHNjb3BlLnRleHQpIHtcclxuICAgICAgJHNjb3BlLnRleHQgPSB7XHJcbiAgICAgICAgbWluOiAxLFxyXG4gICAgICAgIG1heDogMTAsXHJcbiAgICAgICAgc3RlcDogMC4yXHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmRhdGEudGltZXJWYWx1ZSA9IDkwO1xyXG4gICAgJHNjb3BlLmRhdGEudGltZXJWYWx1ZXMgPSBbMzAsNDUsNjAsOTAsMTIwXTtcclxuICAgICRzY29wZS5zdG9wd2F0Y2ggPSBuZ0F1ZGlvLmxvYWQoY29uZmlnLnN0b3JhZ2VCYXNlVXJsKycvaW1nL2NvbnRyb2xwYW5lbC9Hb25nJTIwbG93Lm1wMycpO1xyXG4gICAgaWYgKCRzY29wZS5zdG9wd2F0Y2guZXJyb3Ipe1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ2Vycm9yIGxvYWRpbmcgYXVkaW8nKTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuZ2V0UmVjcygpO1xyXG4gICAgJHNjb3BlLmlzRm9sZGVyQWRtaW4gPSAoJHJvb3RTY29wZS51c2VyLnJvbGU9PSdFJyAmJiBjb25mLmN1cnJlbnRGb2xkZXIuaXNBZG1pbik7XHJcbiAgICBnZXRGZWVkcygpO1xyXG4gICAgZ2V0Q29ycmVjdGlvbnMoKTtcclxuICAgIGdldFBvaW50ZXJzKCk7XHJcblxyXG4gICAgaWYgKCRyb290U2NvcGUuYWRtaW4pe1xyXG4gICAgICAvLyBsb2FkIGF1ZGlvIGNvbGxlY3Rpb24gaGVyZS5cclxuICAgICAgdmFyIGZvbGRlcjtcclxuICAgICAgaWYgKGNvbmYuY3VycmVudE1vZGU9PSdXJyl7XHJcbiAgICAgICAgdmFyIGZvbGRlciA9IF8uZmluZChjb25mLm15Rm9sZGVycywgZnVuY3Rpb24oZm9sZGVyKXtcclxuICAgICAgICAgIHJldHVybiBmb2xkZXIuX2lkPT1jb25mLmN1cnJlbnRQYWdlLmZvbGRlcjtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBmb2xkZXIgPSBjb25mLmN1cnJlbnRGb2xkZXI7XHJcbiAgICAgIH1cclxuICAgICAgcGFTZXJ2aWNlLmxvYWRBdWRpb0NvbGxlY3Rpb25zKGZvbGRlcik7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgZnVuY3Rpb24gZ2V0RmVlZHMoKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvZmVlZHMvRicpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAkc2NvcGUuZmVlZHMgPSByZXN1bHQuZGF0YTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0Q29ycmVjdGlvbnMoKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvZmVlZHMvQycpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAkc2NvcGUuY29ycmVjdGlvbnMgPSByZXN1bHQuZGF0YTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnNldEFjdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgcGFTb2NrZXQuZW1pdCgndmFyJywge1xyXG4gICAgICBcInZhclwiOiAnYWN0aW9uJyxcclxuICAgICAgdmFsOiB2YWx1ZVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFRhYiA9IGZ1bmN0aW9uICh2YWwpIHtcclxuICAgICRzY29wZS50YWIgPT0gdmFsID8gJHNjb3BlLnRhYiA9IHVuZGVmaW5lZCA6ICRzY29wZS50YWIgPSB2YWw7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldHRpbmdzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHN0YXRlLnRyYW5zaXRpb25UbyhcImFkbWluXCIsIHtcclxuICAgICAgXCJvcHRpb25zXCI6ICRzY29wZS5vcHRpb25zXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuY2FwdHVyZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmNhcHR1cmUuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUNhcHR1cmVDdHJsJyxcclxuICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBsYXlBdWRpbyA9IGZ1bmN0aW9uIChzZWwpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJwbGF5LXRyYWNrXCIsIHtcclxuICAgICAgcGxheTogc2VsLmlcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wYXVzZUF1ZGlvID0gZnVuY3Rpb24gKHNlbCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInBsYXktdHJhY2tcIiwge1xyXG4gICAgICBwYXVzZTogc2VsLmlcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zdG9wID0gZnVuY3Rpb24gKHNlbCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInBsYXktdHJhY2tcIiwge1xyXG4gICAgICBzdG9wOiBzZWwuaVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFByb2dyZXNzID0gZnVuY3Rpb24gKHNlbCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInBsYXktdHJhY2tcIiwge1xyXG4gICAgICB0cmFjazogc2VsLmksXHJcbiAgICAgIHByb2dyZXNzOiBzZWwuYXVkaW8ucHJvZ3Jlc3NcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zYXZlID0gZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvc2F2ZVNjcmVlbnNob3QnLCBkYXRhLCB7XHJcbiAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHksXHJcbiAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkXHJcbiAgICAgIH1cclxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLnBvcHVwKHJlc3AuZGF0YSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0UmF0aW8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNlcnZpY2Uuc2F2ZVBhcmFtKCdyYXRpbycsIE51bWJlcigkc2NvcGUuZGF0YS5yYXRpbykpO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInJhdGlvXCIsIE51bWJlcigkc2NvcGUuZGF0YS5yYXRpbykpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXRTaXplID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTZXJ2aWNlLnNhdmVQYXJhbSgnc2l6ZScsICRzY29wZS5kYXRhLnNpemUpO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInNpemVcIiwgJHNjb3BlLmRhdGEuc2l6ZSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFNpemUyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTZXJ2aWNlLnNhdmVQYXJhbSgnc2l6ZTInLCAkc2NvcGUuZGF0YS5zaXplMik7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwic2l6ZTJcIiwgJHNjb3BlLmRhdGEuc2l6ZTIpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zYXZlU3lzdGVtUGFyYW1zID0gZnVuY3Rpb24oKSB7XHJcbiAgICBpZiAoJHNjb3BlLmRhdGEuc2l6ZSkge1xyXG4gICAgICBwYVNlcnZpY2Uuc2F2ZVBhcmFtKCdzaXplJywgJHNjb3BlLmRhdGEuc2l6ZSwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoJHNjb3BlLmRhdGEuc2l6ZTIpIHtcclxuICAgICAgcGFTZXJ2aWNlLnNhdmVQYXJhbSgnc2l6ZTInLCAkc2NvcGUuZGF0YS5zaXplMiwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoJHNjb3BlLmRhdGEudGV4dHNpemUpIHtcclxuICAgICAgcGFTZXJ2aWNlLnNhdmVQYXJhbSgndGV4dHNpemUnLCAkc2NvcGUuZGF0YS50ZXh0c2l6ZSwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoJHNjb3BlLmRhdGEudGV4dHNpemUyKSB7XHJcbiAgICAgIHBhU2VydmljZS5zYXZlUGFyYW0oJ3RleHRzaXplMicsICRzY29wZS5kYXRhLnRleHRzaXplMiwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImNsZWFyXCIsIHRydWUpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5oaWRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImhpZGVcIiwgISRzY29wZS5kYXRhLmhpZGUpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5mbGFnID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInRvZ2dsZVwiLCB7XHJcbiAgICAgIHNyYzogY29uZmlnLnN0b3JhZ2VCYXNlVXJsKycvaW1nL2NvbnRyb2xwYW5lbC9mbGFnMy5qcGcnXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuY29ycmVjdGlvbiA9IGZ1bmN0aW9uIChjKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwiZmVlZFwiLCB7XHJcbiAgICAgIHNyYzogYy5zcmMsXHJcbiAgICAgIGF1ZGlvOiBjLmF1ZGlvLFxyXG4gICAgICB0aW1lb3V0OiBjLnRpbWVvdXQsXHJcbiAgICAgIFwiY2xhc3NcIjogJ25vdGlmeScsXHJcbiAgICAgIGFsaWduOiAnYWxpZ24taXRlbXMtc3RhcnQnXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuZmVlZCA9IGZ1bmN0aW9uIChmKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwiZmVlZFwiLCB7XHJcbiAgICAgIHNyYzogZi5zcmMsXHJcbiAgICAgIGF1ZGlvOiBmLmF1ZGlvLFxyXG4gICAgICB0aW1lb3V0OiBmLnRpbWVvdXQsXHJcbiAgICAgIFwiY2xhc3NcIjogJ2ZlZWQnLFxyXG4gICAgICBhbGlnbjogJ2FsaWduLWl0ZW1zLWNlbnRlcidcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5yZWNvcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoISRzY29wZS5kYXRhLnJlYykge1xyXG4gICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgICB2YXIgcmVjID0ge1xyXG4gICAgICAgIG5hbWU6ICRzY29wZS5kYXRhLnJlY05hbWUsXHJcbiAgICAgICAgcGFnZTogY29uZi5jdXJyZW50UGFnZS5faWQsXHJcbiAgICAgICAgdGVhY2hlcjogJHJvb3RTY29wZS51c2VyLnRlYWNoZXJcclxuICAgICAgfTtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9yZWMvc2F2ZScsIHJlYykudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICRzY29wZS5kYXRhLnJlYyA9IHJlc3AuZGF0YTtcclxuICAgICAgICAkc2NvcGUudGFiID0gdW5kZWZpbmVkO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUuc3RvcFJlYyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5kYXRhLnJlYyA9IGZhbHNlO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5nZXRSZWNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9yZWMvJyArIGNvbmYuY3VycmVudFBhZ2UuX2lkICsgJy8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwgKyAnL2ZpbmQnKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgIGRhdGEucmVjcyA9IHJlc3AuZGF0YTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wbGF5RXZlbnRzID0gZnVuY3Rpb24gKHJlYykge1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9ldmVudC8nICsgcmVjLl9pZCArICcvZmluZCcpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgXy5lYWNoKHJlc3AuZGF0YSwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgICAgIHBhU29ja2V0LmVtaXQobXNnLm5hbWUsIG1zZy5kYXRhKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucmVtb3ZlUmVjID0gZnVuY3Rpb24gKHJlYykge1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvZXZlbnQvJyArIHJlYy5faWQgKyAnL3JlbW92ZScpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLmdldFJlY3MoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXRUZXh0U2l6ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU2VydmljZS5zYXZlUGFyYW0oJ3RleHRzaXplJywgJHNjb3BlLmRhdGEudGV4dHNpemUpO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInRleHRzaXplXCIsICRzY29wZS5kYXRhLnRleHRzaXplKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0VGV4dFNpemUyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTZXJ2aWNlLnNhdmVQYXJhbSgndGV4dHNpemUyJywgJHNjb3BlLmRhdGEudGV4dHNpemUyKTtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJ0ZXh0c2l6ZTJcIiwgJHNjb3BlLmRhdGEudGV4dHNpemUyKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2VsZWN0TWFyayA9IGZ1bmN0aW9uIChtYXJrKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwidmFyXCIsIHtcclxuICAgICAgXCJ2YXJcIjogJ21hcmsnLFxyXG4gICAgICB2YWw6IG1hcmtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wb3B1cENvbW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAuY29tbWVudC5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhQ29tbWVudEN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgY29tbWVudDogZnVuY3Rpb24gY29tbWVudCgpIHtcclxuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucG9wdXBCb29rbWFyayA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5ib29rbWFyay5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhQm9va21hcmtDdHJsJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIG5hbWU6IGZ1bmN0aW9uIG5hbWUoKSB7XHJcbiAgICAgICAgICByZXR1cm4gY29uZi5jdXJyZW50TW9kZSA9PSAnUCcgPyBjb25mLmN1cnJlbnRQYWdlLm5hbWUgOiBjb25mLmN1cnJlbnRDb250ZW50Lm5hbWUrJyAoJytjb25mLmN1cnJlbnRQYWdlLm5hbWUrJyknO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBvcHVwSG9tZXdvcmsgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAuaG9tZXdvcmsuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwb3B1cEhvbWV3b3JrQ3RybCcsXHJcbiAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICBob21ld29yazogZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHRlYWNoZXI6ICRyb290U2NvcGUudXNlci5jaGFubmVsLFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogY29uZi5jdXJyZW50Q29udGVudC5faWQsXHJcbiAgICAgICAgICAgICAgICBkb25lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGNsb3NlZDogZmFsc2VcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3B0aW9uczogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgc3R1ZGVudHM6IF8ubWFwKGNvbmYucm9vbS5zdWJzY3JpcHRpb25zLCdzdHVkZW50JylcclxuICAgICAgICAgIH1cclxuICAgICAgfVxyXG59XHJcblxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBvcHVwQm9vayA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5ib29rLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncGFCb29rQ3RybCdcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5kaXNwbGF5VGltZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgcGFTb2NrZXQuZW1pdCgndmFyJywge1xyXG4gICAgICAndmFyJzogJ2Rpc3BsYXlUaW1lcicsXHJcbiAgICAgICd2YWwnOiAhZGF0YS5kaXNwbGF5VGltZXJcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5kaXNwbGF5Q291bnRkb3duID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgJ3Zhcic6ICdkaXNwbGF5Q291bnRkb3duJyxcclxuICAgICAgJ3ZhbCc6ICFkYXRhLmRpc3BsYXlDb3VudGRvd25cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5kaXNwbGF5Q291bnRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICBwYVNvY2tldC5lbWl0KCd2YXInLCB7XHJcbiAgICAgICd2YXInOiAnZGlzcGxheUNvdW50ZXInLFxyXG4gICAgICAndmFsJzogIWRhdGEuZGlzcGxheUNvdW50ZXJcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5kaXNwbGF5QmF0dGVyeSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgcGFTb2NrZXQuZW1pdCgndmFyJywge1xyXG4gICAgICAndmFyJzogJ2Rpc3BsYXlCYXR0ZXJ5JyxcclxuICAgICAgJ3ZhbCc6ICFkYXRhLmRpc3BsYXlCYXR0ZXJ5XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuYmF0dGVyeUluYyA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICBpZiAodXNlci5wYXJhbXMuYmF0dGVyeSA8IDYpIHtcclxuICAgICAgcGFTb2NrZXQuZW1pdCgnYmF0dGVyeScsIHtcclxuICAgICAgICB1c2VyOiB1c2VyLmlkLFxyXG4gICAgICAgIHZhbHVlOiB1c2VyLnBhcmFtcy5iYXR0ZXJ5ICsgMVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUuYmF0dGVyeURlYyA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICBpZiAodXNlci5wYXJhbXMuYmF0dGVyeSA+IDApIHtcclxuICAgICAgcGFTb2NrZXQuZW1pdCgnYmF0dGVyeScsIHtcclxuICAgICAgICB1c2VyOiB1c2VyLmlkLFxyXG4gICAgICAgIHZhbHVlOiB1c2VyLnBhcmFtcy5iYXR0ZXJ5IC0gMVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUudG9nZ2xlQ29ycmVjdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuZGlzcGxheUNvcnJlY3Rpb25zID0gISRzY29wZS5kaXNwbGF5Q29ycmVjdGlvbnM7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnRvZ2dsZUZlZWRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmRpc3BsYXlGZWVkcyA9ICEkc2NvcGUuZGlzcGxheUZlZWRzO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zdGFydFRpbWVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdCgndGltZXInLCAndGltZXItc3RhcnQnKTtcclxuICAgICRzY29wZS50aW1lclJ1bm5pbmcgPSAxO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zdG9wVGltZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCd0aW1lcicsICd0aW1lci1zdG9wJyk7XHJcbiAgICAkc2NvcGUudGltZXJSdW5uaW5nID0gMDtcclxuICAgICRzY29wZS5wcm9ncmVzc0Jhcj0wO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wYXVzZVRpbWVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdCgndGltZXInLCAndGltZXItY2xlYXInKTtcclxuICAgICRzY29wZS50aW1lclJ1bm5pbmcgPSAyO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5yZXN1bWVUaW1lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3RpbWVyJywgJ3RpbWVyLXJlc3VtZScpO1xyXG4gICAgJHNjb3BlLnRpbWVyUnVubmluZyA9IDE7XHJcbiAgfTtcclxuXHJcbiAgcGFTb2NrZXQub24oJ3RpbWVyJywgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgJHNjb3BlLiRicm9hZGNhc3QobXNnKTtcclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLiRvbigndGltZXItdGljaycsZnVuY3Rpb24oZSwgdmFsKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgdmFyIHNlYyA9IE1hdGguZmxvb3IodmFsLm1pbGxpcyAvIDEwMDApO1xyXG4gICAgdmFyIHBlcmMgPSBzZWMqMTAwL2RhdGEudGltZXJWYWx1ZTtcclxuICAgICRzY29wZS5wcm9ncmVzc2JhciA9IDEwMC1wZXJjO1xyXG4gICAgaWYgKGRhdGEudGltZXJWYWx1ZT49c2VjKXtcclxuICAgICAgJHNjb3BlLnRpbWVMZWZ0ID0gZGF0YS50aW1lclZhbHVlLXNlYztcclxuICAgICAgaWYgKCRzY29wZS50aW1lTGVmdCA9PSAwKSB7XHJcbiAgICAgICAgJHNjb3BlLnN0b3B3YXRjaC5wbGF5KCk7XHJcbiAgICAgICAgJHNjb3BlLiRicm9hZGNhc3QoJ3RpbWVyLXN0b3AnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUuJG9uKCd0aW1lci1zdG9wcGVkJyxmdW5jdGlvbihlLCB2YWwpIHtcclxuICAgICRzY29wZS5wcm9ncmVzc2JhciA9IDEwMDtcclxuICAgICRzY29wZS50aW1lclJ1bm5pbmcgPSAwO1xyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUuc2V0Q291bnRlciA9IGZ1bmN0aW9uICh0eXBlLGNvbG9yKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCd2YXInLCB7XHJcbiAgICAgIFwidmFyXCI6ICdjb3VudGVycycsXHJcbiAgICAgIHZhbDoge1xyXG4gICAgICAgIHR5cGU6IHR5cGUsXHJcbiAgICAgICAgY29sb3I6IGNvbG9yXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcbiAgJHNjb3BlLnNldFRhcmdldCA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgXCJ2YXJcIjogJ2NvdW50ZXJUYXJnZXQnLFxyXG4gICAgICB2YWw6IHRhcmdldFxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluY3JlbWVudCA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgdmFyIGMgPSBkYXRhLmNvdW50ZXJzW25hbWVdIHx8IDA7XHJcbiAgICBwYVNvY2tldC5lbWl0KCdjb3VudCcsIHtcclxuICAgICAgdXNlcjogbmFtZSxcclxuICAgICAgY291bnRlcjogYyArIDFcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5kZWNyZW1lbnQgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgIHZhciBjID0gZGF0YS5jb3VudGVyc1tuYW1lXSB8fCAwO1xyXG4gICAgcGFTb2NrZXQuZW1pdCgnY291bnQnLCB7XHJcbiAgICAgIHVzZXI6IG5hbWUsXHJcbiAgICAgIGNvdW50ZXI6IGMgLSAxXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucmFuZ2UgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgIHJldHVybiBfLnJhbmdlKGRhdGEuY291bnRlcnNbbmFtZV0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5kaXNwbGF5R2FtZXBhZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgJ3Zhcic6ICdnYW1lcGFkJyxcclxuICAgICAgJ3ZhbCc6ICFkYXRhLmdhbWVwYWRcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnBsYXlQaWNrVXBOdW1iZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCd2YXInLCB7XHJcbiAgICAgICd2YXInOiAnZ2FtZScsXHJcbiAgICAgICd2YWwnOiAncGlja1VwTnVtYmVyJ1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBsYXlQYXBlclN0b25lU2Npc3NvcnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCd2YXInLCB7XHJcbiAgICAgICd2YXInOiAnZ2FtZScsXHJcbiAgICAgICd2YWwnOiAncGFwZXJTdG9uZVNjaXNzb3JzJ1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBsYXlEaWNlRm9yU2VudGVuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCd2YXInLCB7XHJcbiAgICAgICd2YXInOiAnZ2FtZScsXHJcbiAgICAgICd2YWwnOiAnZGljZUZvclNlbnRlbmNlJ1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBsYXlPbmVPclR3byA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgJ3Zhcic6ICdnYW1lJyxcclxuICAgICAgJ3ZhbCc6ICdvbmVPclR3bydcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5waWNrVXBOdW1iZXJTdGFydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBzaHVmZmxlID0gXy5zaHVmZmxlKFtjb25maWcuc3RvcmFnZUJhc2VVcmwrXCIvaW1nL2RpY2UvMS5wbmdcIiwgY29uZmlnLnN0b3JhZ2VCYXNlVXJsK1wiL2ltZy9kaWNlLzIucG5nXCIsIGNvbmZpZy5zdG9yYWdlQmFzZVVybCtcIi9pbWcvZGljZS8zLnBuZ1wiLCBjb25maWcuc3RvcmFnZUJhc2VVcmwrXCIvaW1nL2RpY2UvNC5wbmdcIiwgY29uZmlnLnN0b3JhZ2VCYXNlVXJsK1wiL2ltZy9kaWNlLzUucG5nXCIsIGNvbmZpZy5zdG9yYWdlQmFzZVVybCtcIi9pbWcvZGljZS82LnBuZ1wiXSk7XHJcblxyXG4gICAgcGFTb2NrZXQuZW1pdCgnZXhlYycsIHtcclxuICAgICAgbWV0aG9kOiAncGlja1VwTnVtYmVyJyxcclxuICAgICAgYXJnOiBzaHVmZmxlXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUub25lT3JUd29TdGFydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ2V4ZWMnLCB7XHJcbiAgICAgIG1ldGhvZDogJ29uZU9yVHdvJyxcclxuICAgICAgYXJnOiBfLnJhbmRvbSg0LDgpXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucGFwZXJTdG9uZVNjaXNzb3JzU3RhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgc2h1ZmZsZSA9IF8uc2h1ZmZsZShbY29uZmlnLnN0b3JhZ2VCYXNlVXJsK1wiL2ltZy9wYXBlciUyMHN0b25lLyUyMHBhcGVyJTIwMi5wbmdcIiwgY29uZmlnLnN0b3JhZ2VCYXNlVXJsK1wiL2ltZy9wYXBlciUyMHN0b25lL3NjaXNzb3JzLmpwZ1wiLCBjb25maWcuc3RvcmFnZUJhc2VVcmwrXCIvaW1nL3BhcGVyJTIwc3RvbmUvc3RvbmUuanBlZ1wiXSk7XHJcblxyXG4gICAgcGFTb2NrZXQuZW1pdCgnZXhlYycsIHtcclxuICAgICAgbWV0aG9kOiAncGFwZXJTdG9uZVNjaXNzb3JzJyxcclxuICAgICAgYXJnOiBzaHVmZmxlLmNvbmNhdChzaHVmZmxlKVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmRpY2VGb3JTZW50ZW5jZVN0YXJ0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHNodWZmbGUgPSBfLnNodWZmbGUoW2NvbmZpZy5zdG9yYWdlQmFzZVVybCtcIi9jZG4vY29udHJvbHBhbmVsL2RpY2VGb3JTZW50ZW5jZS8lMkIuZ2lmXCIsIGNvbmZpZy5zdG9yYWdlQmFzZVVybCtcIi9jZG4vY29udHJvbHBhbmVsL2RpY2VGb3JTZW50ZW5jZS8tLmdpZlwiLCBjb25maWcuc3RvcmFnZUJhc2VVcmwrXCIvY2RuL2NvbnRyb2xwYW5lbC9kaWNlRm9yU2VudGVuY2UvcS5naWZcIl0pO1xyXG5cclxuICAgIHBhU29ja2V0LmVtaXQoJ2V4ZWMnLCB7XHJcbiAgICAgIG1ldGhvZDogJ2RpY2VGb3JTZW50ZW5jZScsXHJcbiAgICAgIGFyZzogc2h1ZmZsZS5jb25jYXQoc2h1ZmZsZSlcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5jb3VudGRvd24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgcGFTb2NrZXQuZW1pdCgndmFyJywge1xyXG4gICAgICAndmFyJzogJ2NvdW50ZG93bicsXHJcbiAgICAgICd2YWwnOiAhZGF0YS5jb3VudGRvd25cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5jb3VudGRvd25TdGFydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ2V4ZWMnLCAnY291bnRkb3duJyk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFRpbWVyVmFsdWUgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgJ3Zhcic6ICd0aW1lclZhbHVlJyxcclxuICAgICAgJ3ZhbCc6IE51bWJlcih2YWx1ZSlcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wb3B1cEhlbHAgPSBmdW5jdGlvbigpe1xyXG4gICAgJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmhlbHAuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUhlbHBDdHJsJyxcclxuICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB2YXIgZ2V0UG9pbnRlcnMgPSBmdW5jdGlvbigpe1xyXG4gICAgJHNjb3BlLnBvaW50ZXJzPVtdO1xyXG4gICAgJHNjb3BlLnBvaW50ZXJzLnB1c2goe3NyYzonaHR0cHM6Ly9waWtpbW9uaS5ibG9iLmNvcmUud2luZG93cy5uZXQvaW1nL2NvbnRyb2xwYW5lbC9wb2ludGVycy9hcnJvdy5naWYnfSk7XHJcbiAgICAkc2NvcGUucG9pbnRlcnMucHVzaCh7c3JjOidodHRwczovL3Bpa2ltb25pLmJsb2IuY29yZS53aW5kb3dzLm5ldC9pbWcvY29udHJvbHBhbmVsL3BvaW50ZXJzL0NVUlNPUi1waW5rLmdpZid9KTtcclxuICAgICRzY29wZS5wb2ludGVycy5wdXNoKHtzcmM6J2h0dHBzOi8vcGlraW1vbmkuYmxvYi5jb3JlLndpbmRvd3MubmV0L2ltZy9jb250cm9scGFuZWwvcG9pbnRlcnMvcG9pbnRlcjIuZ2lmJ30pO1xyXG4gICAgJHNjb3BlLnBvaW50ZXJzLnB1c2goe3NyYzonaHR0cHM6Ly9waWtpbW9uaS5ibG9iLmNvcmUud2luZG93cy5uZXQvaW1nL2NvbnRyb2xwYW5lbC9wb2ludGVycy9wb2ludGluZy13aXRoLXBvaW50ZXIuZ2lmJ30pO1xyXG4gICAgJHNjb3BlLnBvaW50ZXJzLnB1c2goe3NyYzonaHR0cHM6Ly9waWtpbW9uaS5ibG9iLmNvcmUud2luZG93cy5uZXQvaW1nL2NvbnRyb2xwYW5lbC9wb2ludGVycy9yaWdodC1hcnJvdy5naWYnfSk7XHJcbiAgfVxyXG4gICRzY29wZS50b2dnbGVQb2ludGVycyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICBpZiAoIWRhdGEuZW5hYmxlSmNyb3Ape1xyXG4gICAgICBwYVNvY2tldC5lbWl0KCd2YXInLCB7XHJcbiAgICAgICAgJ3Zhcic6ICdlbmFibGVKY3JvcCcsXHJcbiAgICAgICAgJ3ZhbCc6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcGFTb2NrZXQuZW1pdCgndmFyJywge1xyXG4gICAgICAndmFyJzogJ2Rpc3BsYXlQb2ludGVycycsXHJcbiAgICAgICd2YWwnOiAhZGF0YS5kaXNwbGF5UG9pbnRlcnNcclxuICAgIH0pO1xyXG4gIH07XHJcbiAgJHNjb3BlLnRvZ2dsZUNyb3AgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgIGlmIChkYXRhLmRpc3BsYXlQb2ludGVycyl7XHJcbiAgICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgICAndmFyJzogJ2Rpc3BsYXlQb2ludGVycycsXHJcbiAgICAgICAgJ3ZhbCc6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcGFTb2NrZXQuZW1pdCgndmFyJywge1xyXG4gICAgICAndmFyJzogJ2VuYWJsZUpjcm9wJyxcclxuICAgICAgJ3ZhbCc6ICFkYXRhLmVuYWJsZUpjcm9wXHJcbiAgICB9KTtcclxuICB9XHJcbiAgJHNjb3BlLnVuZG8gPSBmdW5jdGlvbiAocywgdCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInVuZG8tZHJhZ1wiLCB7XHJcbiAgICAgIHNvdXJjZTogcyxcclxuICAgICAgdGFyZ2V0OiB0XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucG9wdXBBdWRpb0NvbGxlY3Rpb24gPSBmdW5jdGlvbihjb2xsKXtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnNvbmdzLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncGFTb25nc0N0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgY29sbDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiBjb2xsO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uKHNlbCl7XHJcbiAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgIGRhdGEuc2VsPXNlbDtcclxuICAgIH0pXHJcbiAgIFxyXG4gIH1cclxuICAkc2NvcGUuaW5pdCgpO1xyXG4gIGFuZ3VsYXIuZWxlbWVudChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7XHJcbiAgICBwYUludHJvLnBhZ2VUb3VyKCdjb250cm9sUGFuZWwnKVxyXG4gIH0pXHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhQ29weVBhZ2VDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJGh0dHBcIiwgXCJwYUNhY2hlXCIsIFwicGFTZXJ2aWNlXCIsIFwicGFNZW51XCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYUNvcHlQYWdlQ3RybCcsIHBhQ29weVBhZ2VDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHBhQ29weVBhZ2VDdHJsKCRzY29wZSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkaHR0cCwgcGFDYWNoZSwgcGFTZXJ2aWNlLCBwYU1lbnUsIGNvbmZpZykge1xyXG5cclxuICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAkc2NvcGUuY29uZiA9IGNvbmY7XHJcblxyXG4gICAgJHNjb3BlLmluaXQ9ZnVuY3Rpb24oKXtcclxuICAgICAgICBwYU1lbnUubG9hZEZvbGRlcnMoKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgJHNjb3BlLmxvYWRQYWdlcyA9IGZ1bmN0aW9uKGZvbGRlcil7XHJcbiAgICAgICAgcGFTZXJ2aWNlLmxvYWRQYWdlcyhmb2xkZXIpO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5jb3B5UGFnZSA9IGZ1bmN0aW9uKHBhZ2Upe1xyXG4gICAgICAgIHZhciBuZXdQYWdlID0ge1xyXG4gICAgICAgICAgICBuYW1lOnBhZ2UubmFtZSArICcgLSBDb3B5JyxcclxuICAgICAgICAgICAgdHlwZTpwYWdlLnR5cGUsXHJcbiAgICAgICAgICAgIGZvbGRlcjpjb25mLmN1cnJlbnRGb2xkZXIuX2lkLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZTpwYWdlLnRlbXBsYXRlLFxyXG4gICAgICAgICAgICBwYXJhbXM6cGFnZS5wYXJhbXMsXHJcbiAgICAgICAgICAgIGNvbGxlY3Rpb25zOnBhZ2UuY29sbGVjdGlvbnNcclxuICAgICAgICB9O1xyXG4gICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2VkaXQtcGFnZScsIHtwYWdlOiBuZXdQYWdlfSk7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJGh0dHBcIiwgXCIkdWliTW9kYWxcIiwgXCJwYVNvY2tldFwiLCBcInBhQWNsXCIsIFwicGFTZXJ2aWNlXCIsIFwicGFDYWNoZVwiLCBcIiRkb2N1bWVudFwiLCBcInRvYXN0ZXJcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhQ3RybCcsIHBhQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYUN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkc3RhdGUsICRodHRwLCAkdWliTW9kYWwsIHBhU29ja2V0LCBwYUFjbCwgcGFTZXJ2aWNlLCBwYUNhY2hlLCAkZG9jdW1lbnQsIHRvYXN0ZXIsIGNvbmZpZykge1xyXG4gICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBwYVNvY2tldC5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLnJlbG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJyZWxvYWRcIik7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldEhvbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwicGFnZSBtZXNzYWdlXCIsIHtcclxuICAgICAgY29kZTogJ2Rhc2hib2FyZCdcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXRXYWxsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInBhZ2UgbWVzc2FnZVwiLCB7XHJcbiAgICAgIGNvZGU6ICd3YWxsJ1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFBhZ2UgPSBmdW5jdGlvbiAocGFnZSkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBmID0gY29uZi5jdXJyZW50Rm9sZGVyO1xyXG4gICAgaWYgKCFmKXtcclxuICAgICAgZiA9IF8uZmluZChjb25mLm15Rm9sZGVycywgZnVuY3Rpb24oZil7XHJcbiAgICAgICAgcmV0dXJuIGYuX2lkPT1wYWdlLmZvbGRlcjtcclxuICAgICAgfSlcclxuICAgIH1cclxuICAgIGlmIChmLmlzRXhwaXJlZCkge1xyXG4gICAgICB0b2FzdGVyLnBvcCgnZXJyb3InLCBcIkFjY2VzcyBkZW5pZWRcIiwgXCJTdWJzY3JpcHRpb24gZm9yIFwiICsgZi5uYW1lICsgXCIgaGFzIGV4cGlyZWQuIEdvIG9uIHBheW1lbnQgdG8gcmVucmV3IHRoZSBzdWJzY3JpcHRpb24uXCIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdmFyIHQ9cGFnZS50ZW1wbGF0ZTtcclxuICAgICAgaWYoIXQubmFtZSl7XHJcbiAgICAgICAgdCA9IF8uZmluZChjb25mLnRlbXBsYXRlcyxmdW5jdGlvbih0ZW1wbGF0ZSl7XHJcbiAgICAgICAgICByZXR1cm4gdGVtcGxhdGUuX2lkPT10O1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgICAgcGFTb2NrZXQuZW1pdChcInBhZ2UgbWVzc2FnZVwiLCB7Y29kZTogdC5uYW1lLCBwYWdlOiBwYWdlfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldENvbnRlbnQgPSBmdW5jdGlvbiAoY29udGVudCkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBmID0gY29uZi5jdXJyZW50Rm9sZGVyO1xyXG4gICAgaWYgKCFmKXtcclxuICAgICAgZiA9IF8uZmluZChjb25mLm15Rm9sZGVycywgZnVuY3Rpb24oZil7XHJcbiAgICAgICAgcmV0dXJuIGYuX2lkPT1jb250ZW50LnBhZ2UuZm9sZGVyO1xyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gICAgaWYgKGYuaXNFeHBpcmVkICYmICFjb250ZW50LmZyZWUpIHtcclxuICAgICAgdG9hc3Rlci5wb3AoJ2Vycm9yJywgXCJBY2Nlc3MgZGVuaWVkXCIsIFwiU3Vic2NyaXB0aW9uIGZvciBcIiArIGYubmFtZSArIFwiIGhhcyBleHBpcmVkLiBHbyBvbiBwYXltZW50IHRvIHJlbnJldyB0aGUgc3Vic2NyaXB0aW9uLlwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vcGFTZXJ2aWNlLmxvZ0NvbnRlbnQoY29udGVudCk7XHJcbiAgICAgIHZhciB0PWNvbnRlbnQucGFnZS50ZW1wbGF0ZTtcclxuICAgICAgaWYoIXQubmFtZSl7XHJcbiAgICAgICAgdCA9IF8uZmluZChjb25mLnRlbXBsYXRlcyxmdW5jdGlvbih0ZW1wbGF0ZSl7XHJcbiAgICAgICAgICByZXR1cm4gdGVtcGxhdGUuX2lkPT10O1xyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgICAgcGFTb2NrZXQuZW1pdChcImNvbnRlbnQgbWVzc2FnZVwiLCB7Y29kZTogdC5uYW1lLCBjb250ZW50OiBjb250ZW50fSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFRhYiA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCd0YWInLCBpKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuYWRtaW5TZWxlY3RJbWFnZSA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICBpZiAoJHNjb3BlLmFkbWluKSB7XHJcbiAgICAgIHBhU29ja2V0LmVtaXQoXCJpbWcgbWVzc2FnZVwiLCB7X2lkOiBpfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNlbGVjdEltYWdlID0gZnVuY3Rpb24gKGkpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJpbWcgbWVzc2FnZVwiLCB7X2lkOiBpfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLm5leHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImltZyBtZXNzYWdlXCIsIHtfaWQ6IGRhdGEuc2VsZWN0ZWRJbWFnZSArIDF9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2VsZWN0TmV4dEltYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgIHZhciBuZXh0ID0gKGRhdGEuc2VsZWN0ZWRJbWFnZSArIDEpICUgZGF0YS5pbWFnZXMubGVuZ3RoO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImltZyBtZXNzYWdlXCIsIHtfaWQ6IG5leHR9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2VsZWN0UHJldkltYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgIHZhciBuZXh0ID0gKGRhdGEuc2VsZWN0ZWRJbWFnZSAtIDEpICUgZGF0YS5pbWFnZXMubGVuZ3RoO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImltZyBtZXNzYWdlXCIsIHtfaWQ6IG5leHR9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2hvd0ltYWdlID0gZnVuY3Rpb24gKGksIHZhbCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInNob3cgbWVzc2FnZVwiLCBbaSwgdmFsXSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmhpZGVJbWFnZSA9IGZ1bmN0aW9uIChpLCB2YWwpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJoaWRlIG1lc3NhZ2VcIiwgW2ksIHZhbF0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS50b2dnbGVJbWFnZSA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgdmFyIHNlbCA9IGRhdGEuc2VsZWN0ZWRbaV07XHJcbiAgICBwYVNvY2tldC5lbWl0KFwiaW1nMiBtZXNzYWdlXCIsIFtpLCAhc2VsXSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFkbWluVG9nZ2xlSW1hZ2UgPSBmdW5jdGlvbiAoaSkge1xyXG4gICAgaWYgKCRzY29wZS5hZG1pbikge1xyXG4gICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICB2YXIgc2VsID0gZGF0YS5zZWxlY3RlZFtpXTtcclxuICAgICAgcGFTb2NrZXQuZW1pdChcImltZzIgbWVzc2FnZVwiLCBbaSwgIXNlbF0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS50YWdJbWFnZSA9IGZ1bmN0aW9uIChpLCB0YWcpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJpbWcyIG1lc3NhZ2VcIiwgW2ksIHRhZ10pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5lbWl0VXNlclBhcmFtID0gZnVuY3Rpb24gKHVzZXIsIG5hbWUsIHZhbHVlKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwidXNlclBhcmFtXCIsIHtcclxuICAgICAgdXNlcjogdXNlci5pZCxcclxuICAgICAgbmFtZTogbmFtZSxcclxuICAgICAgdmFsdWU6IHZhbHVlXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuZW1pdE1lc3NhZ2UgPSBmdW5jdGlvbiAobWVzc2FnZSwgdmFsdWUpIHtcclxuICAgIHBhU29ja2V0LmVtaXQobWVzc2FnZSwgdmFsdWUpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5vdmVyID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgXCJ2YXJcIjogbmFtZSxcclxuICAgICAgdmFsOiB0cnVlXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUub3V0ID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgXCJ2YXJcIjogbmFtZSxcclxuICAgICAgdmFsOiBmYWxzZVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmZpbmRBdWRpb0J5VGl0bGUgPSBmdW5jdGlvbiAodGl0bGUpIHtcclxuICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICByZXR1cm4gXy5maW5kKGRhdGEuYXVkaW9Db2xsZWN0aW9uLCBmdW5jdGlvbiAoYXVkaW8pIHtcclxuICAgICAgcmV0dXJuIGF1ZGlvLnRpdGxlID09IHRpdGxlO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBsYXlCeVRpdGxlID0gZnVuY3Rpb24gKHRpdGxlKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwiYXVkaW8gbWVzc2FnZVwiLCB7XHJcbiAgICAgIGFjdGlvbjogJ3BsYXknLFxyXG4gICAgICB0aXRsZTogdGl0bGVcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wYXVzZUJ5VGl0bGUgPSBmdW5jdGlvbiAodGl0bGUpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJhdWRpbyBtZXNzYWdlXCIsIHtcclxuICAgICAgYWN0aW9uOiAncGF1c2UnLFxyXG4gICAgICB0aXRsZTogdGl0bGVcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zdG9wQnlUaXRsZSA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwiYXVkaW8gbWVzc2FnZVwiLCB7XHJcbiAgICAgIGFjdGlvbjogJ3N0b3AnLFxyXG4gICAgICB0aXRsZTogdGl0bGVcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5kb0FjdGlvbiA9IGZ1bmN0aW9uIChhY3Rpb24sIGkpIHtcclxuICAgIGlmIChhY3Rpb24gPT0gJ3NlbGVjdCcpIHtcclxuICAgICAgcGFTb2NrZXQuZW1pdCgnaW1nIG1lc3NhZ2UnLCB7X2lkOiBpfSk7XHJcbiAgICB9IGVsc2UgaWYgKGFjdGlvbiA9PSAncmVtb3ZlJykge1xyXG4gICAgICBwYVNvY2tldC5lbWl0KCdpbWcyIG1lc3NhZ2UnLCBbaSwgdHJ1ZV0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZW5kVmFyID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCd2YXInLCB7XHJcbiAgICAgIFwidmFyXCI6IG5hbWUsXHJcbiAgICAgIHZhbDogdmFsdWVcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZWxlY3RDb2xvciA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgcGFTb2NrZXQuZW1pdCgnaW1nIHBhcmFtcycsIFtpLCB7XHJcbiAgICAgIGNvbG9yOiBkYXRhLmNvbG9yXHJcbiAgICB9XSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNsaWNrTWUgPSBmdW5jdGlvbiAoZXZlbnQsIGljb24pIHtcclxuICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICB2YXIgbWFyayA9IGRhdGEubWFyayB8fCBpY29uIHx8ICdmYS1jaGVjay1jaXJjbGUnO1xyXG4gICAgdmFyIHRhcmdldCA9IGFuZ3VsYXIuZWxlbWVudChcIiNcIiArIGV2ZW50LmN1cnJlbnRUYXJnZXQuaWQpO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImNsaWNrLW1zZ1wiLCB7XHJcbiAgICAgIGlkOiBldmVudC5jdXJyZW50VGFyZ2V0LmlkLFxyXG4gICAgICB4OiBldmVudC5vZmZzZXRYIC8gdGFyZ2V0LndpZHRoKCksXHJcbiAgICAgIHk6IGV2ZW50Lm9mZnNldFkgLyB0YXJnZXQuaGVpZ2h0KCksXHJcbiAgICAgIGljb246IG1hcmtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zaW5nbGVDbGlja01lID0gZnVuY3Rpb24gKGV2ZW50LCBpY29uKSB7XHJcbiAgICBpZiAoIWljb24pIHtcclxuICAgICAgaWNvbiA9ICdmYS1jaGVjay1jaXJjbGUnO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciB0YXJnZXQgPSBhbmd1bGFyLmVsZW1lbnQoXCIjXCIgKyBldmVudC5jdXJyZW50VGFyZ2V0LmlkKTtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJjbGljay1tc2dcIiwge1xyXG4gICAgICBpZDogZXZlbnQuY3VycmVudFRhcmdldC5pZCxcclxuICAgICAgeDogZXZlbnQub2Zmc2V0WCAvIHRhcmdldC53aWR0aCgpLFxyXG4gICAgICB5OiBldmVudC5vZmZzZXRZIC8gdGFyZ2V0LmhlaWdodCgpLFxyXG4gICAgICBpY29uOiBpY29uLFxyXG4gICAgICBzaW5nbGU6IHRydWVcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5jbGVhckNsaWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImNsZWFyLWNsaWNrLW1zZ1wiLCB7fSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXRCb29rID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJCgnI2JiLWJvb2tibG9jaycpLmJvb2tibG9jayh7XHJcbiAgICAgIHNwZWVkOiA4MDAsXHJcbiAgICAgIHNoYWRvd1NpZGVzOiAwLjgsXHJcbiAgICAgIHNoYWRvd0ZsaXA6IDAuN1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLm5leHRQYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImJvb2sgbWVzc2FnZVwiLCBcIm5leHRcIik7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnByZXZQYWdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImJvb2sgbWVzc2FnZVwiLCBcInByZXZcIik7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBvcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3BvcCBtZXNzYWdlJywgJ3BvcCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS51bmRvID0gZnVuY3Rpb24gKHMsIHQpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJ1bmRvLWRyYWdcIiwge1xyXG4gICAgICBzb3VyY2U6IHMsXHJcbiAgICAgIHRhcmdldDogdFxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLm1vdmUgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgaWYgKCRzY29wZS5tKSB7XHJcbiAgICAgIHZhciByZWxYID0gZS5vZmZzZXRYIC0gMTQwO1xyXG4gICAgICB2YXIgcmVsWSA9IGUub2Zmc2V0WSAtIDgwO1xyXG4gICAgICAkKCdtYXNrIGcnKS5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKCcgKyByZWxYICsgJywnICsgcmVsWSArICcpJyk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnN0YXJ0TW92ZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAkc2NvcGUubSA9IHRydWU7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnN0b3BNb3ZlID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICRzY29wZS5tID0gZmFsc2U7XHJcbiAgICBwYVNvY2tldC5lbWl0KCdiaW5vY3VsYXInLCB7XHJcbiAgICAgIG9mZnNldFg6IGUub2Zmc2V0WCxcclxuICAgICAgb2Zmc2V0WTogZS5vZmZzZXRZXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2VsZWN0T25lID0gZnVuY3Rpb24gKGksIGopIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3VzZXItc2VsZWN0aW9uJywge1xyXG4gICAgICBpOiBpLFxyXG4gICAgICBqOiBqLFxyXG4gICAgICB1c2VyOiAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWVcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5mb250U2l6ZSA9IGZ1bmN0aW9uIChlbGVtKSB7XHJcbiAgICB2YXIgdyA9IGFuZ3VsYXIuZWxlbWVudCgnIycgKyBlbGVtKS53aWR0aCgpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgJ2ZvbnQtc2l6ZSc6IHcgKyAncHgnXHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZW5kVGV4dCA9IGZ1bmN0aW9uIChpLCB0ZXh0KSB7XHJcbiAgICBpZiAoIXRleHQpe1xyXG4gICAgICB2YXIgZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICB0ZXh0ID0gZGF0YS50ZW1wW2ldO1xyXG4gICAgfVxyXG4gICAgcGFTb2NrZXQuZW1pdCgncmVwbGFjZS10ZXh0Jywge1xyXG4gICAgICBpOiBpLFxyXG4gICAgICB2YWw6IHRleHRcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXRGb2xkZXIgPSBmdW5jdGlvbiAoZm9sZGVyKSB7XHJcbiAgICBwYUNhY2hlLnNldEN1cnJlbnRNb2RlKCdQJyk7XHJcbiAgICBwYUNhY2hlLnNldEN1cnJlbnRGb2xkZXIoZm9sZGVyKTtcclxuICAgIC8vcGFTZXJ2aWNlLmxvYWRQYWdlcyhmb2xkZXIpO1xyXG4gICAgcGFTZXJ2aWNlLmxvYWRDb250ZW50cyhmb2xkZXIpO1xyXG5cclxuICAgICRzY29wZS5wb3B1cE1lbnUoKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0V29ya3BsYW4gPSBmdW5jdGlvbiAod29ya3BsYW4pIHtcclxuICAgIHBhQ2FjaGUuc2V0Q3VycmVudE1vZGUoJ1cnKTtcclxuICAgIHBhQ2FjaGUuc2V0Q3VycmVudEZvbGRlcih3b3JrcGxhbik7XHJcbiAgICBwYVNlcnZpY2UubG9hZFdvcmtwbGFuKHdvcmtwbGFuKTtcclxuICAgICRzY29wZS5wb3B1cFdvcmtwbGFuKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFN0aWNrZXJzID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAkaHR0cC5wb3N0KCcvd3MvbWVudS9maW5kUGFnZXMnLHt0eXBlOidTJyxjb2RlOidzdGlja2Vycyd9KS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICB2YXIgcGFnZT1yZXNwLmRhdGFbMF07XHJcbiAgICAgIHZhciBmb2xkZXIgPSBwYWdlLmZvbGRlcjtcclxuXHJcbiAgICAgIHZhciByZXMgPSBfLmZpbmQoY29uZi5zeXN0ZW1SZXNvdXJjZXMsIGZ1bmN0aW9uKHJlcyl7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5jb2RlPT1mb2xkZXIuY29kZTtcclxuICAgICAgfSk7XHJcbiAgICAgIGZvbGRlci5pc0FkbWluID0gcmVzJiZyZXMuaXNBZG1pbjtcclxuICAgICAgXHJcbiAgICAgIHBhQ2FjaGUuc2V0Q3VycmVudE1vZGUoJ1MnKTtcclxuICAgICAgcGFDYWNoZS5zZXRDdXJyZW50Rm9sZGVyKGZvbGRlcik7XHJcbiAgICAgIHBhQ2FjaGUuc2V0Q3VycmVudFBhZ2UocGFnZSk7XHJcbiAgICAgICRzdGF0ZS5nbygnc3RpY2tlcnMnLCB7XHJcbiAgICAgICAgc3R1ZGVudDogbnVsbCxcclxuICAgICAgICBjb250ZW50OiB7XHJcbiAgICAgICAgICB0eXBlOiAnUCdcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSlcclxuICB9O1xyXG5cclxuICAkc2NvcGUucG9wdXBNZW51ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgY29udHJvbGxlcjogJ3NpZGViYXJDdHJsJyxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuc2lkZWJhci5odG1sJyxcclxuICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgfSk7XHJcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChpdGVtKSB7XHJcbiAgICAgIGlmIChpdGVtLnR5cGUgPT0gJ1AnKSB7XHJcbiAgICAgICAgJHNjb3BlLnNldFBhZ2UoaXRlbSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoaXRlbS50eXBlID09ICdDJykge1xyXG4gICAgICAgICRzY29wZS5zZXRDb250ZW50KGl0ZW0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucG9wdXBXb3JrcGxhbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdzaWRlYmFyQ3RybCcsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnNpZGViYXJXLmh0bWwnLFxyXG4gICAgICBzaXplOiAnbGcnXHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgJHNjb3BlLnNldENvbnRlbnQoaXRlbSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2VsZWN0U21pbGUgPSBmdW5jdGlvbiAoaSkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInNtaWxlIG1lc3NhZ2VcIiwgaSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmRpc3RyaWJ1dGVGcm9tRGVjayA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJleGVjXCIsIFwiZGlzdHJpYnV0ZUZyb21EZWNrXCIpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS51cGRhdGVVc2VyVGV4dCA9IGZ1bmN0aW9uICh1c2VyLCBfY2hhciwgY29sb3IpIHtcclxuICAgIF9jaGFyLmNvbG9yID0gY29sb3I7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwidXNlclBhcmFtXCIsIHtcclxuICAgICAgdXNlcjogdXNlci5pZCxcclxuICAgICAgbmFtZTogJ2NoYXJzJyxcclxuICAgICAgdmFsdWU6IHVzZXIucGFyYW1zLmNoYXJzXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucHVibGlzaFZrID0gZnVuY3Rpb24gKHBvc3QpIHtcclxuICAgICRzY29wZS5zcGlubmluZyA9IHRydWU7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvdmsvYWxidW0nKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgIGlmIChyZXNwLmRhdGEuZXJyb3IpIHtcclxuICAgICAgICAkc2NvcGUuYXV0aCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy92ay9wdWJsaXNoJywge1xyXG4gICAgICAgICAgYWxidW06IHJlc3AuZGF0YSxcclxuICAgICAgICAgIHBvc3Q6IHBvc3RcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICBpZiAocmVzcC5kYXRhLmVycm9yKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5hdXRoID0gdHJ1ZTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICRzY29wZS5zcGlubmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsIFwiU3VjY2Vzc1wiLCBcImltYWdlIHB1Ymxpc2hlZFwiKTtcclxuICAgICAgICAgICAgLypcclxuICAgICAgICAgICAgd2FsbCBwZXJtaXNzaW9uIG5vdCBhbGxvd2VkOiBodHRwczovL3ZrLmNvbS9kZXYvcGVybWlzc2lvbnNcclxuICAgICAgICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsKycvd3MvdmsvcG9zdCcse21lZGlhOnJlc3AuZGF0YVswXSxwb3N0OnBvc3R9KS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3AuZGF0YS5lcnJvcil7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmF1dGg9dHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnNwaW5uaW5nPWZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRvYXN0ZXIucG9wKCdzdWNjZXNzJywgXCJQb3N0XCIsIFwicG9zdCBwdWJsaXNoZWRcIik7XHRcdFx0XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICovXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wbGF5QXVkaW8gPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwicGxheS10cmFja1wiLCB7XHJcbiAgICAgIHBsYXk6IHVybFxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnN0YXJ0TGluZSA9IGZ1bmN0aW9uKGkpe1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImpzb25cIiwge2xpbmVJZDppLGNlbGxJZDowfSk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuZ2V0U2VsZWN0aW9uVGV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkpIHtcclxuICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpKSB7XHJcbiAgICAgICAgLy8gdGV4dCBzZWxlY3Rpb25cclxuICAgICAgICB2YXIgcmFuZ2UgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKTtcclxuICAgICAgICB2YXIgcyA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyLnBhcmVudEVsZW1lbnQuaWQ7XHJcbiAgICAgICAgdmFyIGUgPSByYW5nZS5lbmRDb250YWluZXIucGFyZW50RWxlbWVudC5pZDtcclxuICAgICAgICBwYVNvY2tldC5lbWl0KCd0ZXh0Jywge1xyXG4gICAgICAgICAgc3RhcnQ6IHMsXHJcbiAgICAgICAgICBlbmQ6IGVcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXRTaWRlYmFyVGFiID0gZnVuY3Rpb24odGFiKSB7XHJcbiAgICBpZiAodGFiPT0xKXtcclxuICAgICAgcGFDYWNoZS5zZXRTaWRlYmFyVGFiKDEpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGFTb2NrZXQuZW1pdCgnY29uZicsIHtcclxuICAgICAgICBcInZhclwiOiAnc2lkZWJhcicsXHJcbiAgICAgICAgdmFsOiB7XHJcbiAgICAgICAgICB0YWI6dGFiXHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmRhc2hib2FyZENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiR3aW5kb3dcIiwgXCIkbG9jYXRpb25cIiwgXCIkdWliTW9kYWxcIiwgXCIkbG9nXCIsIFwiJHN0YXRlXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwicGFTb2NrZXRcIiwgXCJwYUNhY2hlXCIsIFwicGFTZXJ2aWNlXCIsIFwicGFDaGFubmVsXCIsIFwicGFBY2xcIiwgXCJwYU1lbnVcIiwgXCJwYUhvbWV3b3JrXCIsIFwicGFTdWJzY3JpcHRpb25cIiwgXCJwYVRlYWNoZXJcIiwgXCJ0b2FzdGVyXCIsIFwiY29uZmlnXCIsIFwicGFJbnRyb1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignZGFzaGJvYXJkQ29udHJvbGxlcicsIGRhc2hib2FyZENvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gZGFzaGJvYXJkQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkd2luZG93LCAkbG9jYXRpb24sICR1aWJNb2RhbCwgJGxvZywgJHN0YXRlLCAkc3RhdGVQYXJhbXMsIHBhU29ja2V0LCBwYUNhY2hlLCBwYVNlcnZpY2UsIHBhQ2hhbm5lbCwgcGFBY2wsIHBhTWVudSwgcGFIb21ld29yaywgcGFTdWJzY3JpcHRpb24sIHBhVGVhY2hlciwgdG9hc3RlciwgY29uZmlnLCBwYUludHJvKSB7XHJcblxyXG4gIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmluaXRQYWdlU2NvcGUoKTtcclxuXHJcbiAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIHBhU29ja2V0LnJlbW92ZUFsbExpc3RlbmVycygpO1xyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5jb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAkc2NvcGUuZGF0YSA9IHBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhZ2VTY29wZTtcclxuXHJcbiAgICBpZiAoJHNjb3BlLmNvbmYuY2hhbm5lbCAmJiAkc2NvcGUuY29uZi5jaGFubmVsLm9wZW4pIHtcclxuICAgICAgcGFDYWNoZS5zZXRTaWRlYmFyVGFiKDIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGFDYWNoZS5zZXRTaWRlYmFyVGFiKDEpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICgkc3RhdGUuY3VycmVudC5uYW1lID09ICdzZWxlY3Qtc3R1ZGVudCcpIHtcclxuICAgICAgLy8gdGVhY2hlciBhcyBzdHVkZW50XHJcbiAgICAgIHBhTWVudS5sb2FkRm9sZGVycygpO1xyXG4gICAgICAkc2NvcGUuc2VsZWN0U3R1ZGVudCgkc3RhdGUucGFyYW1zLmlkKTtcclxuICAgICAgcGFIb21ld29yay5sb2FkSG9tZXdvcmtzKCRzdGF0ZS5wYXJhbXMuaWQpO1xyXG5cclxuICAgIH0gZWxzZSBpZiAoJHJvb3RTY29wZS51c2VyLnJvbGU9PSdUJyB8fCAkcm9vdFNjb3BlLnVzZXIucm9sZT09J0UnKSB7XHJcbiAgICAgIC8vIHRlYWNoZXIncyBsb2dpblxyXG4gICAgICAkc2NvcGUuc3R1ZGVudCA9IG51bGw7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kVGVhY2hlci8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAkc2NvcGUuY29uZi50ZWFjaGVyID0gcmVzcC5kYXRhO1xyXG4gICAgICAgICRzY29wZS5jb25mLnRlYWNoZXIuaGFzRnVsbD0oJHNjb3BlLmNvbmYudGVhY2hlci5zdWJzY3JpcHRpb25QbGFuPT0nZnVsbCd8fCgkc2NvcGUuY29uZi50ZWFjaGVyLm9yZ2FuaXphdGlvbiAmJiAkc2NvcGUuY29uZi50ZWFjaGVyLm9yZ2FuaXphdGlvbi5zdWJzY3JpcHRpb25QbGFuPT0nZW50ZXJwcmlzZScpKTtcclxuICAgICAgICBpZighJHNjb3BlLmNvbmYudGVhY2hlci5lbWFpbCl7XHJcbiAgICAgICAgICB0b2FzdGVyLnBvcCgnd2FybmluZycsIFwiRWRpdCB5b3VyIHByb2ZpbGVcIiwgXCJJbnNlcnQgeW91ciBlbWFpbCBhZGRyZXNzXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoJHJvb3RTY29wZS51c2VyLnJvbGU9PSdFJyl7XHJcbiAgICAgICAgcGFBY2wubG9hZFN5c3RlbVJlc291cmNlcygpO1xyXG4gICAgICAgICRzY29wZS5jb25mLnJvb209e1xyXG4gICAgICAgICAgdXNlcnM6W11cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgcGFDaGFubmVsLmZpbmRPckNyZWF0ZUNoYW5uZWwoJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24oY2hhbm5lbCl7XHJcbiAgICAgICAgICAkc2NvcGUuY29uZi5jaGFubmVsID0gY2hhbm5lbDtcclxuICAgICAgICAgIGlmIChjaGFubmVsLnN0YXR1cz09MSl7XHJcbiAgICAgICAgICAgIC8vIGxlc3NvbiBhbHJlYWR5IHN0YXJ0ZWRcclxuICAgICAgICAgICAgJHNjb3BlLmNvbmYuY2hhbm5lbC5vcGVuPXRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAkc2NvcGUuY29uZi5yb29tPXt9O1xyXG4gICAgICAgICAgcGFDaGFubmVsLmxvYWRSb29tKCk7XHJcbiAgICAgICAgICBwYUNoYW5uZWwubG9hZFZhbGlkU3R1ZGVudHMoKTtcclxuICAgICAgICAgIHBhU3Vic2NyaXB0aW9uLmxvYWRQZW5kaW5nU3Vic2NyaXB0aW9ucygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHBhTWVudS5sb2FkTXlGb2xkZXJzKCRyb290U2NvcGUudXNlci50ZWFjaGVyKTtcclxuICAgICAgICBwYVNlcnZpY2UubG9hZFdvcmtwbGFucygpO1xyXG4gICAgICAgIHBhQWNsLmxvYWRQZXJtaXNzaW9ucygpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSBlbHNlIGlmICgkcm9vdFNjb3BlLnVzZXIucm9sZT09J1MnKSB7XHJcbiAgICAgIC8vIHN0dWRlbnQncyBsb2dpblxyXG4gICAgICBwYU1lbnUubG9hZEZvbGRlcnMoKTtcclxuICAgICAgJHNjb3BlLnNlbGVjdFN0dWRlbnQoJHJvb3RTY29wZS51c2VyLnN0dWRlbnQpO1xyXG4gICAgICBcclxuICAgICAgaWYoJHJvb3RTY29wZS51c2VyLmNoYW5uZWwpeyBcclxuICAgICAgICAvLyB1c2VyIHN1YnNjcmliZWQgY2xhc3Nyb29tXHJcbiAgICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRPcGVuT3JOZXdDaGFubmVsL3RlYWNoZXJzLycgKyAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgaWYgKHJlc3AuZGF0YSl7XHJcbiAgICAgICAgICAgIC8vIGxlc3NvbiBhbHJlYWR5IHN0YXJ0ZWRcclxuICAgICAgICAgICAgJHNjb3BlLmNvbmYuY2hhbm5lbCA9IHJlc3AuZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLmNvbmYuY2hhbm5lbC5vcGVuID0gKHJlc3AuZGF0YS5zdGF0dXM9PTEpO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLmNvbmYucm9vbT17fTtcclxuICAgICAgICAgICAgcGFDaGFubmVsLmxvYWRSb29tKCk7XHJcbiAgICBcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBwYUhvbWV3b3JrLmxvYWRIb21ld29ya3MoJHJvb3RTY29wZS51c2VyLnN0dWRlbnQpO1xyXG5cclxuICAgIH0gZWxzZSBpZiAoJHJvb3RTY29wZS51c2VyLnJvbGU9PSdPJykge1xyXG4gICAgICAkaHR0cC5nZXQoJy93cy9vcmdhbml6YXRpb25zLycrJHJvb3RTY29wZS51c2VyLm9yZ2FuaXphdGlvbikudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAkc2NvcGUuY29uZi5vcmdhbml6YXRpb24gPSByZXNwLmRhdGE7XHJcbiAgICAgIH0pXHJcbiAgICAgIHBhQWNsLmxvYWRQZXJtaXNzaW9ucygpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuc2hvd01vZGFsID0gZmFsc2U7XHJcbiAgICAkc2NvcGUubGVzc29ucyA9IFtdO1xyXG4gICAgJGxvZy5pbmZvKCdicm93c2VyOiAnICsgJHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUudW5sb2NrRm9sZGVyID0gZnVuY3Rpb24oZm9sZGVyKXtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnVubG9ja0ZvbGRlci5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BvcHVwVW5sb2NrRm9sZGVyQ3RybCcsXHJcbiAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICBmb2xkZXI6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgcmV0dXJuIGZvbGRlcjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihzdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgIF8uZWFjaChzdWJzY3JpcHRpb25zLCBmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAgICRodHRwLnBvc3QoJy93cy9mb2xkZXJTdWJzY3JpcHRpb25zJyxzdWJzY3IpXHJcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgcGFNZW51LmxvYWRNeUZvbGRlcnMoJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpO1xyXG4gICAgICAgICAgfSlcclxuICAgICAgfSlcclxuICAgIH0pO1xyXG4gIH1cclxuICAkc2NvcGUucG9wdXBWaWRlbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnZpZGVvLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncGFWaWRlb0N0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnXHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge30pO1xyXG4gIH07XHJcbiAgJHNjb3BlLnJlc2V0SW50cm8gPSBmdW5jdGlvbigpIHtcclxuICAgIHBhSW50cm8ucmVzZXRJbnRybygpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XHJcbiAgICAgIHBhSW50cm8ucGFnZVRvdXIoJ2Rhc2hib2FyZC0nKyRyb290U2NvcGUudXNlci5yb2xlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICAkc2NvcGUuZWRpdFNjb3JlID0gZnVuY3Rpb24gKF91bml0LCBfZm9sZGVyKSB7XHJcbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5zY29yZS5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhU2NvcmVDdHJsJyxcclxuICAgICAgdW5pdDogX3VuaXQsXHJcbiAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICB1bml0OiBmdW5jdGlvbiB1bml0KCkge1xyXG4gICAgICAgICAgcmV0dXJuIF91bml0O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZm9sZGVyOiBmdW5jdGlvbiBmb2xkZXIoKSB7XHJcbiAgICAgICAgICByZXR1cm4gX2ZvbGRlcjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICRzY29wZS5zYXZlU2NvcmUoX3VuaXQpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmVkaXRMZXNzb24gPSBmdW5jdGlvbiAobGVzc29uKSB7XHJcbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5sZXNzb24uaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUxlc3NvbkN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGxlc3NvbjogbGVzc29uXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgJHNjb3BlLnNhdmVMZXNzb24obGVzc29uKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5lZGl0Um9vbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5yb29tLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncGFSb29tQ3RybCcsXHJcbiAgICAgIHNpemU6ICdsZycsXHJcbiAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICBzdWJzY3JpcHRpb25zOiBmdW5jdGlvbiBzdWJzY3JpcHRpb25zKCkge1xyXG4gICAgICAgICAgcmV0dXJuICRzY29wZS5zdWJzY3JpcHRpb25zO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmludml0ZUxpbmsgPSBmdW5jdGlvbigpIHtcclxuICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC5pbnZpdGVMaW5rLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncGFSb29tQ3RybCcsXHJcbiAgICAgIHNpemU6ICdsZydcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnN0YXJ0TGVzc29uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHBhQ2hhbm5lbC5vcGVuQ2hhbm5lbChjb25mLmNoYW5uZWwuX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgIC8vdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCBcIlN0YXJ0XCIsIFwibGVzc29uIHN0YXJ0ZWRcIik7XHJcbiAgICAgIHBhU29ja2V0LmVtaXQoJ2xlc3NvblN0YXJ0ZWQnLCByZXNwLmRhdGEpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmZpbmlzaExlc3NvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICBwYVNvY2tldC5lbWl0KCdsZXNzb25FbmRlZCcsIGNvbmYuY2hhbm5lbCk7XHJcbiAgICBjbG9zZUNoYW5uZWwoKTtcclxuICAgIGRpc2Nvbm5lY3RTdHVkZW50cygpO1xyXG4gICAgY2xlYXJDaGF0KCk7XHJcbiAgfTtcclxuXHJcbiAgdmFyIGNsb3NlQ2hhbm5lbCA9IGZ1bmN0aW9uIGNsb3NlQ2hhbm5lbCgpIHtcclxuICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2Nsb3NlQ2hhbm5lbC8nICsgY29uZi5jaGFubmVsLl9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUuY29uZi5jaGFubmVsID0gcmVzcC5kYXRhO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdmFyIGRpc2Nvbm5lY3RTdHVkZW50cyA9IGZ1bmN0aW9uIGRpc2Nvbm5lY3RTdHVkZW50cygpIHtcclxuXHJcbiAgICBfLmVhY2goJHNjb3BlLmNvbmYucm9vbS5zdWJzY3JpcHRpb25zLCBmdW5jdGlvbihzdWJzY3JpcHRpb24pe1xyXG4gICAgICAgIHBhQ2hhbm5lbC5zYXZlTGVzc29uKHN1YnNjcmlwdGlvbik7XHJcbiAgICAgICAgcGFDaGFubmVsLnVuc3Vic2NyaWJlQ2hhbm5lbCh7c3R1ZGVudDpzdWJzY3JpcHRpb24uc3R1ZGVudC5faWR9KTtcclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS5jb25mLnNob3dPbmxpbmVVc2Vycz1mYWxzZTtcclxuICAgICRzY29wZS5jb25mLnJvb209e307XHJcbiAgfTtcclxuXHJcbiAgdmFyIGNsZWFyQ2hhdCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAkc2NvcGUuY29uZi5jaGF0Lm1lc3NhZ2VzPVtdO1xyXG4gICAgcGFTb2NrZXQuZW1pdCgnY2hhdC5vcGVuJywge1xyXG4gICAgICB2YWx1ZTogZmFsc2VcclxuICAgIH0pOyAgICBcclxuICB9XHJcblxyXG4gICRzY29wZS5hZGRMZXNzb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL25ld0xlc3Nvbi8nICsgJHNjb3BlLnN0dWRlbnQuX2lkICsgJy8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLmdldExlc3NvbnMoJHNjb3BlLnN0dWRlbnQuX2lkKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zYXZlTGVzc29uID0gZnVuY3Rpb24gKGxlc3Nvbikge1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9zYXZlTGVzc29uJywgbGVzc29uKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5nZXRMZXNzb25zKCRzY29wZS5zdHVkZW50Ll9pZCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucmVtb3ZlTGVzc29uID0gZnVuY3Rpb24gKGxlc3Nvbikge1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29uZmlybS5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhQ29uZmlybUN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiAnQXJlIHlvdSBzdXJlPydcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9yZW1vdmVMZXNzb24vJyArIGxlc3Nvbi5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAkc2NvcGUuZ2V0TGVzc29ucygkc2NvcGUuc3R1ZGVudC5faWQpO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZWxlY3RDb3Vyc2UgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgIGlmIChpZCkge1xyXG4gICAgICAkc2NvcGUuY2wgPSB0cnVlO1xyXG4gICAgICAkc2NvcGUuaG10ID0gaWQgPT0gJ2ljYW5yZWFkJztcclxuICAgICAgJHNjb3BlLnJoID0gaWQgPT0gJ2ljYW5yZWFkJztcclxuICAgICAgJHJvb3RTY29wZS5jb3Vyc2UgPSBpZDtcclxuICAgICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRVbml0cy8nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAkc2NvcGUudW5pdHMgPSByZXNwLmRhdGE7XHJcbiAgICAgICAgJHNjb3BlLmNoZWNrVW5pdHMoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNlbGVjdFN0dWRlbnQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgIGlmIChpZCkge1xyXG4gICAgICAkc2NvcGUudGFiID0gJHN0YXRlUGFyYW1zLnRhYnx8MTtcclxuICAgICAgJHNjb3BlLmdldFN0dWRlbnQoaWQpO1xyXG4gICAgICAkc2NvcGUuZ2V0TGVzc29ucyhpZCk7XHJcbiAgICAgICRzY29wZS5nZXRTY29yZXMoaWQpO1xyXG4gICAgICBwYVNlcnZpY2UubG9hZFN0dWRlbnRDb21tZW50cyhpZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAkc2NvcGUuc3R1ZGVudCA9IG51bGw7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmdldFN0dWRlbnQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kU3R1ZGVudC8nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLnN0dWRlbnQgPSByZXNwLmRhdGE7XHJcbiAgICAgICRzY29wZS5jb25mLmFzU3R1ZGVudCA9IHJlc3AuZGF0YTtcclxuICAgICAgJHNjb3BlLnN0dWRlbnQuY29pbnNMID0gXy5yYW5nZSgwLCAkc2NvcGUuc3R1ZGVudC5jb2lucyk7XHJcbiAgICAgICRzY29wZS5jb3Vyc2VTdCA9ICRzY29wZS5zdHVkZW50LmNvdXJzZTtcclxuICAgICAgJHNjb3BlLmNvdXJzZVVuID0gJHNjb3BlLnN0dWRlbnQuY291cnNlO1xyXG4gICAgICAkc2NvcGUuZ2V0U3RpY2tlcnMoaWQsICRzY29wZS5zdHVkZW50LmNvdXJzZSk7XHJcbiAgICAgICRzY29wZS5zZWxlY3RDb3Vyc2UoJHNjb3BlLnN0dWRlbnQuY291cnNlKTtcclxuICAgICAgJHNjb3BlLmxvYWRTdWJzY3JpcHRpb24oaWQpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmxvYWRTdWJzY3JpcHRpb24gPSBmdW5jdGlvbihpZCl7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2ZpbmRTdWJzY3JpcHRpb24nLCB7c3R1ZGVudDogaWR9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5jb25mLnN1YnNjcmlwdGlvbiA9IHJlc3AuZGF0YTtcclxuICAgICAgcGFUZWFjaGVyLmdldFRlYWNoZXJNaXJnb3Zvcml0UHJvZmlsZShyZXNwLmRhdGEudGVhY2hlci5faWQpLnRoZW4oZnVuY3Rpb24ocHJvZmlsZSl7XHJcbiAgICAgICAgJHNjb3BlLmNvbmYuc3Vic2NyaXB0aW9uLnRlYWNoZXIubWlyZ292b3JpdFByb2ZpbGUgPSBwcm9maWxlO1xyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wb3B1cENvbW1lbnQgPSBmdW5jdGlvbiAoX2NvbW1lbnQpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmNvbW1lbnQuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUNvbW1lbnRDdHJsJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIGNvbW1lbnQ6IGZ1bmN0aW9uIGNvbW1lbnQoKSB7XHJcbiAgICAgICAgICByZXR1cm4gX2NvbW1lbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICBwYVNlcnZpY2UubG9hZFN0dWRlbnRDb21tZW50cygkc2NvcGUuc3R1ZGVudC5faWQpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmRlbGV0ZUNvbW1lbnQgPSBmdW5jdGlvbiAoY29tbWVudCkge1xyXG4gICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29uZmlybS5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhQ29uZmlybUN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiAnQXJlIHlvdSBzdXJlPydcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICRodHRwW1wiZGVsZXRlXCJdKGNvbmZpZy5hcGlVcmwgKyAnL3dzL2NvbW1lbnRzLycgKyBjb21tZW50Ll9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgIHBhU2VydmljZS5sb2FkU3R1ZGVudENvbW1lbnRzKCRzY29wZS5zdHVkZW50Ll9pZCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFkZFdvcmtwbGFuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIHdvcmtwbGFuID0ge1xyXG4gICAgICB0ZWFjaGVyOiAkcm9vdFNjb3BlLnVzZXIuY2hhbm5lbFxyXG4gICAgfTtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLndvcmtwbGFuLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncGFXb3JrcGxhbkN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHtcclxuICAgICAgICAgIHJldHVybiB3b3JrcGxhbjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHBhU2VydmljZS5sb2FkV29ya3BsYW5zKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuZWRpdFdvcmtwbGFuID0gZnVuY3Rpb24gKHdvcmtwbGFuKSB7XHJcbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wb3B1cC53b3JrcGxhbi5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3BhV29ya3BsYW5DdHJsJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7XHJcbiAgICAgICAgICByZXR1cm4gd29ya3BsYW47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICBwYVNlcnZpY2UubG9hZFdvcmtwbGFucygpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmdldExlc3NvbnMgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kTGVzc29uc0J5U3R1ZGVudC8nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgdmFyIGZvbGRlck1hcCA9IHt9O1xyXG5cclxuICAgICAgXy5lYWNoKCRzY29wZS5jb25mLmFsbEZvbGRlcnMsIGZ1bmN0aW9uIChmb2xkZXIpIHtcclxuICAgICAgICBmb2xkZXJNYXBbZm9sZGVyLmNvZGVdID0gZm9sZGVyO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIF8uZWFjaChyZXNwLmRhdGEsIGZ1bmN0aW9uIChsZXNzb24pIHtcclxuICAgICAgICBsZXNzb24uZm9sZGVyID0gZm9sZGVyTWFwW2xlc3Nvbi5jb3Vyc2VdO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgICRzY29wZS5sZXNzb25zID0gcmVzcC5kYXRhO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmdldFN0aWNrZXJzID0gZnVuY3Rpb24gKGlkLCBjb3Vyc2UpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kU3RpY2tlcnMvJyArIGlkICsgJy8nICsgY291cnNlKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5zdGlja2VycyA9IHJlc3AuZGF0YTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5nZXRTY29yZXMgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kU2NvcmVzLycgKyBpZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUuc2NvcmVzID0gcmVzcC5kYXRhO1xyXG4gICAgICAkc2NvcGUuY2hlY2tVbml0cygpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNoZWNrVW5pdHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAoJHNjb3BlLnVuaXRzICYmICRzY29wZS5zY29yZXMpIHtcclxuICAgICAgdmFyIG1hcCA9IHt9O1xyXG5cclxuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAkc2NvcGUuc2NvcmVzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgdmFyIHNjb3JlID0gJHNjb3BlLnNjb3Jlc1tqXTtcclxuXHJcbiAgICAgICAgaWYgKHNjb3JlLmNvdXJzZSA9PSAkc2NvcGUuY291cnNlKSB7XHJcbiAgICAgICAgICBtYXBbc2NvcmUudW5pdF0gPSBzY29yZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJHNjb3BlLnVuaXRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgdmFyIHVuaXQgPSAkc2NvcGUudW5pdHNbaV07XHJcblxyXG4gICAgICAgIGlmIChtYXBbdW5pdC5pZF0pIHtcclxuICAgICAgICAgIHVuaXQuc2NvcmUgPSBtYXBbdW5pdC5pZF07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNhdmVTY29yZSA9IGZ1bmN0aW9uICh1bml0KSB7XHJcbiAgICB1bml0LnNjb3JlLmNvdXJzZSA9ICRyb290U2NvcGUuY291cnNlO1xyXG4gICAgdW5pdC5zY29yZS5zdHVkZW50ID0gJHNjb3BlLnN0dWRlbnQuX2lkO1xyXG4gICAgdW5pdC5zY29yZS51bml0ID0gdW5pdC5pZDtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvc2F2ZVNjb3JlJywgdW5pdC5zY29yZSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUuZ2V0U2NvcmVzKCRzY29wZS5zdHVkZW50Ll9pZCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuYWRkU3RpY2tlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3N0dWRlbnQtaWQnLCAkc2NvcGUuc3R1ZGVudCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnJlbW92ZVN0aWNrZXIgPSBmdW5jdGlvbiAoc3RpY2tlcikge1xyXG4gICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3JlbW92ZVN0aWNrZXIvJyArIHN0aWNrZXIuX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5nZXRTdGlja2Vycygkc2NvcGUuc3R1ZGVudC5faWQsICRzY29wZS5zdHVkZW50LmNvdXJzZSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0VGFiID0gZnVuY3Rpb24gKGkpIHtcclxuICAgICRzY29wZS50YWIgPSBpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS50b2dnbGVWYXIgPSBmdW5jdGlvbiAodikge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInRvZ2dsZSBtZXNzYWdlXCIsIHYpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS50b2dnbGVQYWlkID0gZnVuY3Rpb24gKGxlc3Nvbikge1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9sZXNzb25zLycgKyBsZXNzb24uX2lkICsgJy90b2dnbGVQYWlkJykudGhlbihmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICRzY29wZS5nZXRMZXNzb25zKCRzY29wZS5zdHVkZW50Ll9pZCk7XHJcbiAgICAgICRzY29wZS5nZXRTdHVkZW50KCRzY29wZS5zdHVkZW50Ll9pZCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuYWRkQ29pbnMgPSBmdW5jdGlvbiAoY29pbnMpIHtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvYWRkQ29pbnMnLCB7XHJcbiAgICAgIHN0dWRlbnQ6ICRzY29wZS5zdHVkZW50Ll9pZCxcclxuICAgICAgY29pbnM6IE51bWJlcihjb2lucylcclxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICAkc2NvcGUuZ2V0U3R1ZGVudCgkc2NvcGUuc3R1ZGVudC5faWQpO1xyXG4gICAgICAkKFwiI2NvaW5zXCIpLnZhbCh1bmRlZmluZWQpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnRvZ2dsZVRpcHMgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRodHRwLnBvc3QoJy93cy9zYXZlVGVhY2hlci8nK2NvbmYudGVhY2hlci5faWQsIGNvbmYudGVhY2hlcik7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuZ290byA9IGZ1bmN0aW9uKHN0YXRlKXtcclxuICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oc3RhdGUse29yZ2FuaXphdGlvbjokcm9vdFNjb3BlLnVzZXIub3JnYW5pemF0aW9ufSx7XCJyZWxvYWRcIjp0cnVlfSk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuZWRpdEZvbGRlciA9IGZ1bmN0aW9uKGZvbGRlcil7XHJcbiAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdlZGl0LWZvbGRlcicse2ZvbGRlcjpmb2xkZXJ9LHtcInJlbG9hZFwiOnRydWV9KTtcclxuICB9XHJcblxyXG4gICRzY29wZS5zdWJzY3JpYmVDaGFubmVsID0gZnVuY3Rpb24oY2hhbm5lbCl7XHJcbiAgICBwYUNoYW5uZWwuc3Vic2NyaWJlQ2hhbm5lbCh7Y2hhbm5lbDpjaGFubmVsLHN0dWRlbnQ6JHJvb3QudXNlci5zdHVkZW50fSkudGhlbihmdW5jdGlvbihzdHVkZW50KXtcclxuXHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnBvcHVwVGVhY2hlclByb2ZpbGUgPSBmdW5jdGlvbih0ZWFjaGVyKXtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnRlYWNoZXJQcm9maWxlLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncG9wdXBUZWFjaGVyUHJvZmlsZUN0cmwnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgdGVhY2hlcjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gdGVhY2hlcjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICRzY29wZS5pbml0KCk7XHJcbiAgICB9KTsgIFxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxuICBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xyXG4gICAgcGFJbnRyby5wYWdlVG91cignZGFzaGJvYXJkLScrJHJvb3RTY29wZS51c2VyLnJvbGUpO1xyXG4gIH0pXHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmRvbWlub0NvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVwiLCBcInBhU29ja2V0XCIsIFwicGFDYWNoZVwiLCBcInBhU2VydmljZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignZG9taW5vQ29udHJvbGxlcicsIGRvbWlub0NvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gZG9taW5vQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkc3RhdGUsIHBhU29ja2V0LCBwYUNhY2hlLCBwYVNlcnZpY2UsIGNvbmZpZykge1xyXG4gICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBwYVNvY2tldC5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuZGF0YSA9IHBhU2VydmljZS5pbml0KCk7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgJHNjb3BlLmRhdGEucGxheWVycyA9IF8ubWFwKGNvbmYucm9vbS51c2VycywgZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgICAgcmV0dXJuIHVzZXIudXNlcm5hbWU7XHJcbiAgICB9KTtcclxuICAgICRzY29wZS5wbGF5ZXIgPSAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWU7XHJcblxyXG4gICAgaWYgKCRzY29wZS5hZG1pbikge1xyXG4gICAgICBpZiAoY29uZi5jdXJyZW50TW9kZSA9PSAnUCcpIHtcclxuICAgICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvcGFnZUNvbmYvJyArICRyb290U2NvcGUudXNlci5jaGFubmVsICsgJy8nICsgY29uZi5jdXJyZW50UGFnZS5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgIGlmIChyZXNwLmRhdGEuaW1nKXtcclxuICAgICAgICAgICAgbG9hZFJlc291cmNlcyhyZXNwLmRhdGEuaW1nKTtcclxuICAgICAgICAgIH0gZWxzZSBpZiAocmVzcC5kYXRhLmNhcmQpe1xyXG4gICAgICAgICAgICBsb2FkUmVzb3VyY2VzKHJlc3AuZGF0YS5jYXJkKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIGlmIChjb25mLmN1cnJlbnRDb250ZW50LmltZyl7XHJcbiAgICAgICAgbG9hZFJlc291cmNlcyhjb25mLmN1cnJlbnRDb250ZW50LmltZyk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY29uZi5jdXJyZW50Q29udGVudC5jYXJkKXtcclxuICAgICAgICBsb2FkUmVzb3VyY2VzKGNvbmYuY3VycmVudENvbnRlbnQuY2FyZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwYVNvY2tldC5vbignY29sbGVjdGlvbicsIGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XHJcbiAgICB2YXIgaSA9ICRzY29wZS5kYXRhLnBsYXllcnMuaW5kZXhPZigkc2NvcGUucGxheWVyKTtcclxuICAgICRzY29wZS5teUNhcmRzID0gY29sbGVjdGlvbi5yZXNvdXJjZXMuc2xpY2UoaSAqIDQsIGkgKiA0ICsgNCk7XHJcbiAgICAkc2NvcGUucmVzb3VyY2VzID0gY29sbGVjdGlvbi5yZXNvdXJjZXMuc2xpY2UoJHNjb3BlLmRhdGEucGxheWVycy5sZW5ndGggKiA0ICsgMSwgY29sbGVjdGlvbi5yZXNvdXJjZXMubGVuZ3RoKTtcclxuICAgICRzY29wZS5jYXJkcyA9IFtdO1xyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUuZ2V0Q2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ2ltZyBtZXNzYWdlJywge19pZDogJHNjb3BlLnBsYXllcn0pO1xyXG4gIH07XHJcblxyXG4gIHBhU29ja2V0Lm9uKCdpbWcgbWVzc2FnZScsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgIHZhciBjYXJkID0gJHNjb3BlLnJlc291cmNlcy5zaGlmdCgpO1xyXG5cclxuICAgIGlmIChtc2cuX2lkID09ICRzY29wZS5wbGF5ZXIpIHtcclxuICAgICAgJHNjb3BlLm15Q2FyZHMucHVzaChjYXJkKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLnBsYXlDYXJkID0gZnVuY3Rpb24gKGNhcmQpIHtcclxuICAgIGNhcmQucGxheWVyID0gJHNjb3BlLnBsYXllcjtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3NyYyBtZXNzYWdlJywgY2FyZCk7XHJcbiAgfTtcclxuXHJcbiAgcGFTb2NrZXQub24oJ3NyYyBtZXNzYWdlJywgZnVuY3Rpb24gKGNhcmQpIHtcclxuICAgIGNhcmQucHVzaCA/ICRzY29wZS5jYXJkcy5wdXNoKGNhcmQpIDogJHNjb3BlLmNhcmRzLnVuc2hpZnQoY2FyZCk7XHJcblxyXG4gICAgaWYgKGNhcmQucGxheWVyID09ICRzY29wZS5wbGF5ZXIpIHtcclxuICAgICAgdmFyIGxlZnRDYXJkcyA9ICRzY29wZS5teUNhcmRzLmZpbHRlcihmdW5jdGlvbiAoYykge1xyXG4gICAgICAgIHJldHVybiBjLmlkICE9IGNhcmQuaWQ7XHJcbiAgICAgIH0pO1xyXG4gICAgICAkc2NvcGUubXlDYXJkcyA9IGxlZnRDYXJkcztcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLnVuZG8gPSBmdW5jdGlvbiAoY2FyZCkge1xyXG4gICAgaWYgKCRzY29wZS5hZG1pbiAmJiBjYXJkLnBsYXllcikge1xyXG4gICAgICBwYVNvY2tldC5lbWl0KCd1bmRvJywgY2FyZCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcGFTb2NrZXQub24oJ3VuZG8nLCBmdW5jdGlvbiAoY2FyZCkge1xyXG4gICAgdmFyIGxhc3QgPSBfLmZpbmQoJHNjb3BlLmNhcmRzLCBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgIHJldHVybiByZXMuaWQgPT0gY2FyZC5pZDtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChsYXN0LnBsYXllciA9PSAkc2NvcGUucGxheWVyKSB7XHJcbiAgICAgICRzY29wZS5teUNhcmRzLnB1c2gobGFzdCk7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGxlZnRDYXJkcyA9ICRzY29wZS5jYXJkcy5maWx0ZXIoZnVuY3Rpb24gKGMpIHtcclxuICAgICAgcmV0dXJuIGMuaWQgIT0gY2FyZC5pZDtcclxuICAgIH0pO1xyXG4gICAgJHNjb3BlLmNhcmRzID0gbGVmdENhcmRzO1xyXG4gIH0pO1xyXG5cclxuICB2YXIgbG9hZFJlc291cmNlcyA9IGZ1bmN0aW9uIGxvYWRSZXNvdXJjZXMoY29kZSkge1xyXG4gICAgcGFTZXJ2aWNlLmZpbmRDb2xsZWN0aW9uQnlDb2RlKGNvZGUpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcclxuICAgICAgY29sbGVjdGlvbi5yZXNvdXJjZXMgPSBfLnNodWZmbGUoY29sbGVjdGlvbi5yZXNvdXJjZXMpO1xyXG4gICAgICBwYVNvY2tldC5lbWl0KCdjb2xsZWN0aW9uJywgY29sbGVjdGlvbik7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5pdCgpO1xyXG59XHJcblxyXG47IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUVkaXRDb250ZW50Q3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwicGFDYWNoZVwiLCBcInBhU2VydmljZVwiLCBcInBhTWVudVwiLCBcImNvbmZpZ1wiLCBcIiR1aWJNb2RhbFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFFZGl0Q29udGVudEN0cmwnLCBwYUVkaXRDb250ZW50Q3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYUVkaXRDb250ZW50Q3RybCgkc2NvcGUsICRyb290U2NvcGUsICRzdGF0ZSwgJGh0dHAsIHBhQ2FjaGUsIHBhU2VydmljZSwgcGFNZW51LCBjb25maWcsICR1aWJNb2RhbCkge1xyXG5cclxuICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAkc2NvcGUuY29uZiA9IGNvbmY7XHJcbiAgICAkc2NvcGUuY29udGVudCA9ICRzdGF0ZS5wYXJhbXMuY29udGVudDtcclxuXHJcbiAgICAkc2NvcGUudGVtcGxhdGU9JHNjb3BlLmNvbnRlbnQucGFnZS50ZW1wbGF0ZTtcclxuXHJcbiAgICAkaHR0cC5nZXQoJy93cy9maW5kU3lzdGVtQ29sbGVjdGlvbnMvJyskc2NvcGUuY29udGVudC5wYWdlLl9pZCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAkc2NvcGUuY29sbGVjdGlvbnMgPSBfLmdyb3VwQnkocmVzcC5kYXRhLCAndHlwZScpO1xyXG4gICAgfSlcclxuXHJcbiAgICAkc2NvcGUuc2F2ZUNvbnRlbnQ9ZnVuY3Rpb24oKXtcclxuICAgICAgICAkaHR0cC5wb3N0KCcvd3Mvc2F2ZUNvbnRlbnQvJyskc2NvcGUuY29udGVudC5faWQsICRzY29wZS5jb250ZW50KS50aGVuKFxyXG4gICAgICAgICAgICBmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnZWRpdC1mb2xkZXInLHtmb2xkZXI6Y29uZi5jdXJyZW50Rm9sZGVyLCBmb3JjZVJlbG9hZDp0cnVlfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAkc2NvcGUucmVtb3ZlQ29udGVudD1mdW5jdGlvbigpe1xyXG5cclxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jb25maXJtLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncGFDb25maXJtQ3RybCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICBtZXNzYWdlOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICdBcmUgeW91IHN1cmU/J1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGh0dHAucHV0KCcvd3MvY29udGVudHMvJyskc2NvcGUuY29udGVudC5faWQse2RlbGV0ZWQ6dHJ1ZX0pLnRoZW4oXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2VkaXQtZm9sZGVyJyx7Zm9sZGVyOmNvbmYuY3VycmVudEZvbGRlciwgZm9yY2VSZWxvYWQ6dHJ1ZX0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgXHJcbiAgICB9XHJcblxyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUVkaXRQYWdlQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRodHRwXCIsIFwicGFDYWNoZVwiLCBcInBhU2VydmljZVwiLCBcInBhTWVudVwiLCBcImNvbmZpZ1wiLCBcIiR1aWJNb2RhbFwiLCBcInRvYXN0ZXJcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhRWRpdFBhZ2VDdHJsJywgcGFFZGl0UGFnZUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFFZGl0UGFnZUN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkc3RhdGUsICRodHRwLCBwYUNhY2hlLCBwYVNlcnZpY2UsIHBhTWVudSwgY29uZmlnLCAkdWliTW9kYWwsIHRvYXN0ZXIpIHtcclxuXHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgJHNjb3BlLmNvbmYgPSBjb25mO1xyXG4gICAgJHNjb3BlLnRlbXBsYXRlcz1fLnZhbHVlcyhjb25mLnRlbXBsYXRlcyk7XHJcblxyXG4gICAgJHNjb3BlLnBhZ2UgPSAkc3RhdGUucGFyYW1zLnBhZ2U7XHJcbiAgICBpZiAoISRzY29wZS5wYWdlKXtcclxuICAgICAgICAvLyBhZGRcclxuICAgICAgICAkc2NvcGUucGFnZT17XHJcbiAgICAgICAgICAgIGZvbGRlcjogY29uZi5jdXJyZW50Rm9sZGVyLl9pZCxcclxuICAgICAgICAgICAgdGVtcGxhdGU6IHt9LFxyXG4gICAgICAgICAgICBwYXJhbXM6IHt9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgJHNjb3BlLnBhZ2UudHlwZT0nUCc7XHJcblxyXG4gICAgJHNjb3BlLnNhdmVQYWdlPWZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJGh0dHAucG9zdCgnL3dzL21lbnUvc2F2ZVBhZ2UnLCRzY29wZS5wYWdlKS50aGVuKFxyXG4gICAgICAgICAgICBmdW5jdGlvbihyZXN1bHQpe1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbygnZWRpdC1mb2xkZXInLHtmb2xkZXI6Y29uZi5jdXJyZW50Rm9sZGVyLCBmb3JjZVJlbG9hZDp0cnVlfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAkc2NvcGUucmVtb3ZlUGFnZT1mdW5jdGlvbigpe1xyXG5cclxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jb25maXJtLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncGFDb25maXJtQ3RybCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICBtZXNzYWdlOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICdBcmUgeW91IHN1cmU/J1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvd3MvbWVudS9yZW1vdmVQYWdlLycrJHNjb3BlLnBhZ2UuX2lkKS50aGVuKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24ocmVzdWx0KXtcclxuICAgICAgICAgICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdlZGl0LWZvbGRlcicse2ZvbGRlcjpjb25mLmN1cnJlbnRGb2xkZXIsIGZvcmNlUmVsb2FkOnRydWV9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgfVxyXG5cclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuZXJhc2VyQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCJwYVNvY2tldFwiLCBcInBhU2VydmljZVwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2VyYXNlckNvbnRyb2xsZXInLCBlcmFzZXJDb250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIGVyYXNlckNvbnRyb2xsZXIoJHNjb3BlLCAkaHR0cCwgJHN0YXRlLCBwYVNvY2tldCwgcGFTZXJ2aWNlLCBwYUNhY2hlLCBjb25maWcpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYVNlcnZpY2UuaW5pdCgpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zaG93SW1hZ2UgPSBmdW5jdGlvbiAoaSwgdmFsKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwic2hvdyBtZXNzYWdlXCIsIFtpLCB2YWxdKTtcclxuICB9O1xyXG5cclxuICBwYVNvY2tldC5vbihcInNob3cgbWVzc2FnZVwiLCBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICB2YXIgaSA9IG1zZ1swXTtcclxuICAgIHZhciB2YWwgPSBtc2dbMV07XHJcbiAgICAkc2NvcGUuZGF0YS5pbWFnZXNbaV0uc2hvdyA9IHZhbDtcclxuXHJcbiAgICBpZiAodmFsKSB7XHJcbiAgICAgICRzY29wZS5pbml0Q2FudmFzKGksICcjZGRkJyk7XHJcbiAgICAgICRzY29wZS5zZXRCZyhpKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLmluaXRDYW52YXMgPSBmdW5jdGlvbiAoaSwgZmlsbENvbG9yKSB7XHJcbiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2MnICsgaSk7XHJcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7IC8vIGRlZmluZSBhIGN1c3RvbSBmaWxsQ2lyY2xlIG1ldGhvZFxyXG5cclxuICAgIGN0eC5maWxsQ2lyY2xlID0gZnVuY3Rpb24gKHgsIHksIHJhZGl1cywgZmlsbENvbG9yKSB7XHJcbiAgICAgIHRoaXMuZmlsbFN0eWxlID0gZmlsbENvbG9yO1xyXG4gICAgICB0aGlzLmJlZ2luUGF0aCgpO1xyXG4gICAgICB0aGlzLm1vdmVUbyh4LCB5KTtcclxuICAgICAgdGhpcy5hcmMoeCwgeSwgcmFkaXVzLCAwLCBNYXRoLlBJICogMiwgZmFsc2UpO1xyXG4gICAgICB0aGlzLmZpbGwoKTtcclxuICAgIH07XHJcblxyXG4gICAgY3R4LmNsZWFyVG8gPSBmdW5jdGlvbiAoZmlsbENvbG9yKSB7XHJcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBmaWxsQ29sb3I7XHJcbiAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBjdHguY2xlYXJUbyhmaWxsQ29sb3IgfHwgXCIjZGRkXCIpOyAvLyBiaW5kIG1vdXNlIGV2ZW50c1xyXG5cclxuICAgIGNhbnZhcy5vbm1vdXNlbW92ZSA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIGlmICghY2FudmFzLmlzRHJhd2luZykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIHggPSBlLm9mZnNldFg7XHJcbiAgICAgIHZhciB5ID0gZS5vZmZzZXRZO1xyXG4gICAgICB2YXIgcmFkaXVzID0gMjA7IC8vIG9yIHdoYXRldmVyXHJcblxyXG4gICAgICB2YXIgZmlsbENvbG9yID0gJyNmZjAwMDAnO1xyXG4gICAgICBjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2Rlc3RpbmF0aW9uLW91dCc7XHJcbiAgICAgIGN0eC5maWxsQ2lyY2xlKHgsIHksIHJhZGl1cywgZmlsbENvbG9yKTtcclxuICAgIH07XHJcblxyXG4gICAgY2FudmFzLm9ubW91c2Vkb3duID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgY2FudmFzLmlzRHJhd2luZyA9IHRydWU7XHJcbiAgICB9O1xyXG5cclxuICAgIGNhbnZhcy5vbm1vdXNldXAgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICBjYW52YXMuaXNEcmF3aW5nID0gZmFsc2U7XHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXRCZyA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICB2YXIgZGl2ID0gYW5ndWxhci5lbGVtZW50KCcjZCcgKyBpKTtcclxuICAgIHZhciBpbWFnZSA9ICRzY29wZS5kYXRhLmltYWdlc1tpXTtcclxuICAgIGRpdi5jc3Moe1xyXG4gICAgICAnYmFja2dyb3VuZCc6ICd1cmwoJyArIGltYWdlLnNyYyArICcpJyxcclxuICAgICAgJ2JhY2tncm91bmQtcmVwZWF0JzogJ25vLXJlcGVhdCcsXHJcbiAgICAgICdiYWNrZ3JvdW5kLXNpemUnOiAnMTAwJSdcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhRmVlZENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiR1aWJNb2RhbFwiLCBcIiRzdGF0ZVwiLCBcInBhRmVlZFwiLCBcInBhU2VydmljZVwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhRmVlZENvbnRyb2xsZXInLCBwYUZlZWRDb250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIHBhRmVlZENvbnRyb2xsZXIoJHNjb3BlLCAkdWliTW9kYWwsICRzdGF0ZSwgcGFGZWVkLCBwYVNlcnZpY2UsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG5cclxuICAgICRzY29wZS5mZWVkID0gXy5jbG9uZSgkc3RhdGUucGFyYW1zLmZlZWQpO1xyXG5cclxuICAgICRzY29wZS5zYXZlRmVlZD1mdW5jdGlvbihmZWVkKXtcclxuICAgICAgICBpZiAoZmVlZC5faWQpe1xyXG4gICAgICAgICAgICBwYUZlZWQudXBkYXRlRmVlZChmZWVkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdmZWVkcycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBwYUZlZWQuYWRkRmVlZChmZWVkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdmZWVkcycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLnJlbW92ZUZlZWQgPSBmdW5jdGlvbihmZWVkKXtcclxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jb25maXJtLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncGFDb25maXJtQ3RybCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICBtZXNzYWdlOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICdBcmUgeW91IHN1cmU/J1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBwYUZlZWQucmVtb3ZlRmVlZChmZWVkKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdmZWVkcycpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9XHJcbn07IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUZlZWRzQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCJwYUZlZWRcIiwgXCJwYVNlcnZpY2VcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYUZlZWRzQ29udHJvbGxlcicsIHBhRmVlZHNDb250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIHBhRmVlZHNDb250cm9sbGVyKCRzY29wZSwgJGh0dHAsICRzdGF0ZSwgcGFGZWVkLCBwYVNlcnZpY2UsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG5cclxuICAgIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmdldFBhZ2VTY29wZSgpO1xyXG4gICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhZ2VTY29wZTtcclxuICAgICRzY29wZS50eXBlID0gJ0YnO1xyXG5cclxuICAgIHZhciBpbml0PWZ1bmN0aW9uKCl7XHJcbiAgICAgICAgcGFGZWVkLmxvYWRGZWVkcygpO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5zZXRUeXBlID0gZnVuY3Rpb24odHlwZSl7XHJcbiAgICAgICAgJHNjb3BlLnR5cGU9dHlwZTtcclxuICAgIH1cclxuXHJcbiAgICBpbml0KCk7XHJcblxyXG59OyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFGb2xkZXJDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJGh0dHBcIiwgXCIkdWliTW9kYWxcIiwgXCJwYUNhY2hlXCIsIFwicGFNZW51XCIsIFwicGFTZXJ2aWNlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYUZvbGRlckN0cmwnLCBwYUZvbGRlckN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFGb2xkZXJDdHJsKCRzY29wZSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkaHR0cCwgJHVpYk1vZGFsLCBwYUNhY2hlLCBwYU1lbnUsIHBhU2VydmljZSwgY29uZmlnKSB7XHJcblxyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgY29uZi5jdXJyZW50Rm9sZGVyID0gJHN0YXRlLnBhcmFtcy5mb2xkZXI7XHJcbiAgcGFDYWNoZS5zZXRDdXJyZW50TW9kZSgnUCcpO1xyXG4gICRzY29wZS5jb25mID0gY29uZjtcclxuXHJcbiAgdmFyIHJlcyA9IF8uZmluZChjb25mLnN5c3RlbVJlc291cmNlcywgZnVuY3Rpb24ocmVzKXtcclxuICAgIHJldHVybiByZXMuY29kZT09Y29uZi5jdXJyZW50Rm9sZGVyLmNvZGU7XHJcbiAgfSk7XHJcbiAgY29uZi5jdXJyZW50Rm9sZGVyLmlzQWRtaW49cmVzLmlzQWRtaW47XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICRzY29wZS5zZWFyY2g9e307XHJcbiAgICBwYUNhY2hlLnNldEN1cnJlbnRGb2xkZXIoY29uZi5jdXJyZW50Rm9sZGVyKTtcclxuICAgIHBhTWVudS5sb2FkQ29udGVudHMoY29uZi5jdXJyZW50Rm9sZGVyLCAkc3RhdGUucGFyYW1zLmZvcmNlUmVsb2FkKTtcclxuICAgIC8vcGFNZW51LmxvYWRQYWdlcyhjb25mLmN1cnJlbnRGb2xkZXIsICRzdGF0ZS5wYXJhbXMuZm9yY2VSZWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnNldE1vZGUgPSBmdW5jdGlvbiAobW9kZSkge1xyXG4gICAgcGFDYWNoZS5zZXRDdXJyZW50TW9kZShtb2RlKTtcclxuICAgIGlmIChtb2RlPT0nQScgJiYgIWNvbmYuY3VycmVudEZvbGRlci5hdWRpb0NvbGxlY3Rpb25zKSB7XHJcbiAgICAgIHBhU2VydmljZS5sb2FkQXVkaW9Db2xsZWN0aW9ucyhjb25mLmN1cnJlbnRGb2xkZXIpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG5cclxuICAkc2NvcGUuc3RhcnRzV2l0aCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgaWYgKHZhbHVlICYmIHZhbHVlLm5hbWUgJiYgJHNjb3BlLnNlYXJjaCAmJiAkc2NvcGUuc2VhcmNoLm5hbWUpIHtcclxuICAgICAgcmV0dXJuIHZhbHVlLm5hbWUudG9VcHBlckNhc2UoKS5zdGFydHNXaXRoKCRzY29wZS5zZWFyY2gubmFtZS50b1VwcGVyQ2FzZSgpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS5zb3J0UGFnZXMgPSBmdW5jdGlvbiAocGFnZXMpIHtcclxuICAgICRodHRwLnBvc3QoJy93cy9tZW51L3NvcnRQYWdlcycsIHBhZ2VzKS50aGVuKFxyXG4gICAgICBmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgY29uZi5jdXJyZW50TW9kZSA9ICdQJztcclxuICAgICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFkZEF1ZGlvQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKGNvbGxOYW1lKXtcclxuICAgIFxyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBhdWRpbyA9IF8uZmluZChjb25mLmN1cnJlbnRGb2xkZXIucGFnZXMsIChwYWdlKT0+e3JldHVybiBwYWdlLnR5cGU9PSdBJ30pO1xyXG4gICAgaWYgKGF1ZGlvKSB7XHJcbiAgICAgIHZhciBjb2xsID0ge1xyXG4gICAgICAgIHBhZ2U6IGF1ZGlvLl9pZCxcclxuICAgICAgICBmb2xkZXI6IGNvbmYuY3VycmVudEZvbGRlci5faWQsXHJcbiAgICAgICAgdHlwZTogJ2F1ZGlvJyxcclxuICAgICAgICBuYW1lOiBjb2xsTmFtZVxyXG4gICAgICB9O1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVTeXN0ZW1Db2xsZWN0aW9uJywgY29sbCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgIHBhU2VydmljZS5sb2FkQXVkaW9Db2xsZWN0aW9ucyhjb25mLmN1cnJlbnRGb2xkZXIpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICBcclxuICB9XHJcblxyXG4gICRzY29wZS5lZGl0QXVkaW9Db2xsZWN0aW9uID0gZnVuY3Rpb24oY29sbCl7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgdmFyIGF1ZGlvID0gXy5maW5kKGNvbmYuY3VycmVudEZvbGRlci5wYWdlcywgKHBhZ2UpPT57cmV0dXJuIHBhZ2UudHlwZT09J0EnfSk7XHJcbiAgICBpZiAoYXVkaW8pIHtcclxuICAgICAgY29uZi5jdXJyZW50UGFnZSA9IGF1ZGlvO1xyXG4gICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvY29sbGVjdGlvbnMvJyArIGNvbGwuX2lkKS50aGVuKGZ1bmN0aW9uKHJlcyl7XHJcblxyXG4gICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2VkaXQtY29sbGVjdGlvbicsIHtcclxuICAgICAgICAgIGNvbGxlY3Rpb246IHJlcy5kYXRhLFxyXG4gICAgICAgICAgdGFiOiAyLFxyXG4gICAgICAgICAgYmFjazogJ2VkaXQtZm9sZGVyJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gICRzY29wZS5yZW1vdmVBdWRpb0NvbGxlY3Rpb24gPSBmdW5jdGlvbihjb2xsKXtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmNvbmZpcm0uaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUNvbmZpcm1DdHJsJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIG1lc3NhZ2U6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICByZXR1cm4gJ0FyZSB5b3Ugc3VyZT8nXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvcmVtb3ZlQ29sbGVjdGlvbi8nICsgY29sbC5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICBwYVNlcnZpY2UubG9hZEF1ZGlvQ29sbGVjdGlvbnMoY29uZi5jdXJyZW50Rm9sZGVyKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuZ2FtZUNvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcInBhU29ja2V0XCIsIFwicGFDYWNoZVwiLCBcInBhU2VydmljZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignZ2FtZUNvbnRyb2xsZXInLCBnYW1lQ29udHJvbGxlcik7XHJcblxyXG5mdW5jdGlvbiBnYW1lQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCBwYVNvY2tldCwgcGFDYWNoZSwgcGFTZXJ2aWNlLCBjb25maWcpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgdmFyIGRhdGEgPSBwYUNhY2hlLmluaXQoKTtcclxuXHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuZGF0YSA9IGRhdGE7XHJcbiAgICAkc2NvcGUuZGF0YS5wbGF5ZXJzID0gXy5tYXAoY29uZi5yb29tLnVzZXJzLCBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgICByZXR1cm4gdXNlci51c2VybmFtZTtcclxuICAgIH0pO1xyXG4gICAgJHNjb3BlLnBsYXllciA9ICRyb290U2NvcGUudXNlci51c2VybmFtZTtcclxuXHJcbiAgICBpZiAoJHNjb3BlLmFkbWluKSB7XHJcbiAgICAgIGlmIChjb25mLmN1cnJlbnRNb2RlID09ICdQJykge1xyXG4gICAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9wYWdlQ29uZi8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwgKyAnLycgKyBjb25mLmN1cnJlbnRQYWdlLl9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgaWYgKHJlc3AuZGF0YSAmJiByZXNwLmRhdGEubWl4ZWQpe1xyXG4gICAgICAgICAgICBsb2FkUmVzb3VyY2VzKHJlc3AuZGF0YS5taXhlZCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0gZWxzZSBpZiAoY29uZi5jdXJyZW50Q29udGVudCAmJiBjb25mLmN1cnJlbnRDb250ZW50Lm1peGVkKSB7XHJcbiAgICAgICAgbG9hZFJlc291cmNlcyhjb25mLmN1cnJlbnRDb250ZW50Lm1peGVkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICB9O1xyXG5cclxuICBwYVNvY2tldC5vbignaW1hZ2VzJywgZnVuY3Rpb24gKGltYWdlcykge1xyXG4gICAgJHNjb3BlLmltYWdlcyA9IGltYWdlcy5zbGljZSgkc2NvcGUuZGF0YS5wbGF5ZXJzLmxlbmd0aCAqIDQsIGltYWdlcy5sZW5ndGgpO1xyXG4gICAgdmFyIGkgPSAkc2NvcGUuZGF0YS5wbGF5ZXJzLmluZGV4T2YoJHNjb3BlLnBsYXllcik7XHJcbiAgICAkc2NvcGUubXlDYXJkcyA9IGltYWdlcy5zbGljZShpICogNCwgaSAqIDQgKyA0KTtcclxuICAgICRzY29wZS5jYWNoZSA9IFtdO1xyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUuZ2V0Q2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ2ltZyBtZXNzYWdlJywge19pZDogJHNjb3BlLnBsYXllcn0pO1xyXG4gIH07XHJcblxyXG4gIHBhU29ja2V0Lm9uKCdpbWcgbWVzc2FnZScsIGZ1bmN0aW9uIChtc2cpIHtcclxuICAgIHZhciBjYXJkID0gJHNjb3BlLmltYWdlcy5zaGlmdCgpO1xyXG5cclxuICAgIGlmIChtc2cuX2lkID09ICRzY29wZS5wbGF5ZXIpIHtcclxuICAgICAgJHNjb3BlLm15Q2FyZHMucHVzaChjYXJkKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLnBsYXlDYXJkID0gZnVuY3Rpb24gKGNhcmQpIHtcclxuICAgIGNhcmQucGxheWVyID0gJHNjb3BlLnBsYXllcjtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3NyYyBtZXNzYWdlJywgY2FyZCk7XHJcbiAgfTtcclxuXHJcbiAgcGFTb2NrZXQub24oJ3NyYyBtZXNzYWdlJywgZnVuY3Rpb24gKGNhcmQpIHtcclxuICAgICRzY29wZS5pbWFnZSA9IGNhcmQ7XHJcbiAgICAkc2NvcGUuY2FjaGUucHVzaChjYXJkKTtcclxuXHJcbiAgICBpZiAoY2FyZC5wbGF5ZXIgPT0gJHNjb3BlLnBsYXllcikge1xyXG4gICAgICB2YXIgbGVmdENhcmRzID0gJHNjb3BlLm15Q2FyZHMuZmlsdGVyKGZ1bmN0aW9uIChjKSB7XHJcbiAgICAgICAgcmV0dXJuIGMuaWQgIT0gY2FyZC5pZDtcclxuICAgICAgfSk7XHJcbiAgICAgICRzY29wZS5teUNhcmRzID0gbGVmdENhcmRzO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUudW5kbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3VuZG8nLCAndW5kbycpO1xyXG4gIH07XHJcblxyXG4gIHBhU29ja2V0Lm9uKCd1bmRvJywgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgdmFyIGxhc3QgPSAkc2NvcGUuY2FjaGUucG9wKCk7XHJcblxyXG4gICAgaWYgKGxhc3QucGxheWVyID09ICRzY29wZS5wbGF5ZXIpIHtcclxuICAgICAgJHNjb3BlLm15Q2FyZHMucHVzaChsYXN0KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoJHNjb3BlLmNhY2hlLmxlbmd0aCA+IDApIHtcclxuICAgICAgJHNjb3BlLmltYWdlID0gJHNjb3BlLmNhY2hlWyRzY29wZS5jYWNoZS5sZW5ndGggLSAxXTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRzY29wZS5pbWFnZSA9IFwiXCI7XHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIHZhciBsb2FkUmVzb3VyY2VzID0gZnVuY3Rpb24gKGNvZGUpIHtcclxuICAgIGRhdGEuc2VsQ29sbGVjdGlvbnMubWl4ZWQgPSBjb2RlO1xyXG5cclxuICAgIHZhciBtdXRpcGxpZXI9TnVtYmVyKGNvbmYuY3VycmVudFBhZ2UucGFyYW1zLm11bHRpcGxpZXIpfHw3O1xyXG4gICAgcGFTZXJ2aWNlLmZpbmRDb2xsZWN0aW9uQnlDb2RlKGNvZGUpLnRoZW4oZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcclxuICAgICAgdmFyIHJlc291cmNlcyA9IFtdO1xyXG4gICAgICBfLmVhY2goY29sbGVjdGlvbi5yZXNvdXJjZXMsIGZ1bmN0aW9uKHJlcyl7XHJcbiAgICAgICAgZm9yIChpPTA7aTxtdXRpcGxpZXI7aSsrKXtcclxuICAgICAgICAgIHJlc291cmNlcy5wdXNoKF8uY2xvbmUocmVzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJlc291cmNlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICByZXNvdXJjZXNbaV0uaWQgPSBpO1xyXG4gICAgICB9XHJcbiAgICAgIHBhU29ja2V0LmVtaXQoJ2ltYWdlcycsIF8uc2h1ZmZsZShyZXNvdXJjZXMpKTtcclxuICBcclxuICAgIH0pXHJcblxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufVxyXG5cclxuOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuZ2FtZTJDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVwiLCBcInBhU29ja2V0XCIsIFwicGFTZXJ2aWNlXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiLCBcInRvYXN0ZXJcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2dhbWUyQ29udHJvbGxlcicsIGdhbWUyQ29udHJvbGxlcik7XHJcblxyXG5mdW5jdGlvbiBnYW1lMkNvbnRyb2xsZXIoJHNjb3BlLCAkaHR0cCwgJHN0YXRlLCBwYVNvY2tldCwgcGFTZXJ2aWNlLCBwYUNhY2hlLCBjb25maWcsIHRvYXN0ZXIpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYUNhY2hlLmluaXQoKTtcclxuXHJcbiAgICBpZiAoJHNjb3BlLmFkbWluKSB7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9wYWdlQ29uZi8nICsgJHJvb3RTY29wZS51c2VyLmNoYW5uZWwgKyAnLycgKyBjb25mLmN1cnJlbnRQYWdlLl9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgIGlmIChyZXNwLmRhdGEuaW1nKXtcclxuICAgICAgICAgIHBhU2VydmljZS5maW5kQ29sbGVjdGlvbkJ5Q29kZShyZXNwLmRhdGEuaW1nKS50aGVuKGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yYW5kb21pemUoY29sbGVjdGlvbi5yZXNvdXJjZXMpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRvYXN0ZXIucG9wKCd3YXJuaW5nJywnV2FybmluZycsIFwiTm8gY29sbGVjdGlvbiBzZWxlY3RlZC4gUGxlYXNlIHNlbGVjdCBhdCBsZWFzdCBvbmUgY29sbGVjdGlvbi5cIilcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHBhU2VydmljZS5maW5kUGFyYW1zKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnJhbmRvbWl6ZSA9IGZ1bmN0aW9uIChpbWFnZXMpIHtcclxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gaW1hZ2VzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICBpbWFnZXNbaV0uaWQgPSBpO1xyXG4gICAgICBpbWFnZXNbaV0ucmFuZCA9IE1hdGgucmFuZG9tKCkgKiAxMDAwMDA7XHJcbiAgICB9XHJcblxyXG4gICAgaW1hZ2VzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgcmV0dXJuIGEucmFuZCAtIGIucmFuZDtcclxuICAgIH0pO1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImltYWdlc1wiLCBpbWFnZXMpO1xyXG4gIH07XHJcblxyXG4gIHBhU29ja2V0Lm9uKFwiaW1hZ2VzXCIsIGZ1bmN0aW9uIChpbWFnZXMpIHtcclxuICAgICRzY29wZS5kYXRhLmltYWdlcyA9IGltYWdlcztcclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLmFkbWluVG9nZ2xlSW1hZ2UgPSBmdW5jdGlvbiAoaSkge1xyXG4gICAgaWYgKCRzY29wZS5hZG1pbikge1xyXG4gICAgICAkc2NvcGUudG9nZ2xlSW1hZ2UoaSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnRvZ2dsZUltYWdlID0gZnVuY3Rpb24gKGkpIHtcclxuICAgIHZhciBzZWwgPSAkc2NvcGUuZGF0YS5zZWxlY3RlZFtpXTtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJpbWcyIG1lc3NhZ2VcIiwgW2ksICFzZWxdKTtcclxuICB9O1xyXG5cclxuICBwYVNvY2tldC5vbihcImltZzIgbWVzc2FnZVwiLCBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICB2YXIgaSA9IG9ialswXTtcclxuICAgIHZhciBzZWwgPSBvYmpbMV07XHJcbiAgICBwYUNhY2hlLnNldFNlbGVjdGVkKGksIHNlbCk7XHJcbiAgfSk7XHJcblxyXG4gICRzY29wZS5wb3AgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KCdwb3AgbWVzc2FnZScsICdwb3AnKTtcclxuICB9O1xyXG5cclxuICBwYVNvY2tldC5vbigncG9wIG1lc3NhZ2UnLCBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICBpZiAoJHNjb3BlLmRhdGEuaW1hZ2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgJHNjb3BlLmRhdGEuaW1hZ2VzLnBvcCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUucmF0aW8gPSBmdW5jdGlvbiAoaW1nKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAncGFkZGluZy1ib3R0b20nOiBpbWcuaGVpZ2h0IC8gaW1nLndpZHRoICogMTAwICsgJyUnXHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5mb250U2l6ZSA9IGZ1bmN0aW9uIChlbGVtKSB7XHJcbiAgICB2YXIgdyA9IGFuZ3VsYXIuZWxlbWVudCgnIycgKyBlbGVtKS53aWR0aCgpO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgJ2ZvbnQtc2l6ZSc6IHcgKyAncHgnXHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmd1ZXNzTnVtYmVyQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHVpYk1vZGFsXCIsIFwicGFTb2NrZXRcIiwgXCJwYVNlcnZpY2VcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdndWVzc051bWJlckN0cmwnLCBndWVzc051bWJlckN0cmwpO1xyXG5cclxuZnVuY3Rpb24gZ3Vlc3NOdW1iZXJDdHJsKCRzY29wZSwgJHN0YXRlLCAkcm9vdFNjb3BlLCAkaHR0cCwgJHVpYk1vZGFsLCBwYVNvY2tldCwgcGFTZXJ2aWNlLCBwYUNhY2hlLCBjb25maWcpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYVNlcnZpY2UuaW5pdCgpO1xyXG4gICAgJHNjb3BlLm51bWJlcnMgPSBfLnJhbmdlKDEsIDEwMSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnRhZ0ltYWdlID0gZnVuY3Rpb24gKGksIHRhZykge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcImltZzIgbWVzc2FnZVwiLCBbaSwgdGFnXSk7XHJcbiAgfTtcclxuXHJcbiAgcGFTb2NrZXQub24oXCJpbWcyIG1lc3NhZ2VcIiwgZnVuY3Rpb24gKG9iaikge1xyXG4gICAgdmFyIGkgPSBvYmpbMF07XHJcbiAgICB2YXIgc2VsID0gb2JqWzFdO1xyXG4gICAgcGFDYWNoZS5zZXRTZWxlY3RlZChpLCBzZWwpO1xyXG4gIH0pO1xyXG4gICRzY29wZS5pbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhSW50cm9Db250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVwiLCBcInBhSW50cm9cIiwgXCJwYVNlcnZpY2VcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYUludHJvQ29udHJvbGxlcicsIHBhSW50cm9Db250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIHBhSW50cm9Db250cm9sbGVyKCRzY29wZSwgJGh0dHAsICRzdGF0ZSwgcGFJbnRybywgcGFTZXJ2aWNlLCBwYUNhY2hlLCBjb25maWcpIHtcclxuXHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbigpe1xyXG4gICAgJHNjb3BlLnN0ZXA9JHN0YXRlLnBhcmFtcy5zdGVwO1xyXG4gICAgcGFJbnRyby5nZXRTdGVwcygpLnRoZW4oZnVuY3Rpb24oc3RlcHMpe1xyXG4gICAgICAkc2NvcGUuc3RlcHM9c3RlcHM7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gICRzY29wZS5zYXZlU3RlcHMgPSBmdW5jdGlvbigpIHtcclxuICAgIHBhSW50cm8uc2F2ZVN0ZXBzKCRzY29wZS5zdGVwcyk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuc2F2ZVN0ZXAgPSBmdW5jdGlvbigpIHtcclxuICAgIHBhSW50cm8uc2F2ZVN0ZXAoJHNjb3BlLnN0ZXApO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnJlbW92ZVN0ZXAgPSBmdW5jdGlvbigpIHtcclxuICAgIHBhSW50cm8ucmVtb3ZlU3RlcCgkc2NvcGUuc3RlcCk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuaW5pdCgpO1xyXG59OyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuamNyb3BDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVwiLCBcInBhU29ja2V0XCIsIFwicGFTZXJ2aWNlXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignamNyb3BDb250cm9sbGVyJywgamNyb3BDb250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIGpjcm9wQ29udHJvbGxlcigkc2NvcGUsICRodHRwLCAkc3RhdGUsIHBhU29ja2V0LCBwYVNlcnZpY2UsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG4gICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBwYVNvY2tldC5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuZGF0YSA9IHBhU2VydmljZS5pbml0KCk7XHJcblxyXG4gICAgaWYgKCEkc2NvcGUub3BhY2l0eSkge1xyXG4gICAgICAkc2NvcGUub3BhY2l0eSA9IHtcclxuICAgICAgICBtaW46IDAsXHJcbiAgICAgICAgbWF4OiAxMCxcclxuICAgICAgICBzdGVwOiAxXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNyb3BJbWFnZSA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICBpZiAoaSAhPSAkc2NvcGUuZGF0YS5zZWxlY3RlZEltYWdlIHx8ICgkc2NvcGUuZGF0YS5lbmFibGVKY3JvcCAmJiAhJHNjb3BlLmRhdGEuamNyb3BfYXBpKSkge1xyXG4gICAgICBwYVNvY2tldC5lbWl0KFwiamNyb3AgbWVzc2FnZVwiLCBpKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuXHJcbiAgJHNjb3BlLnNldE9wYWNpdHkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBwYVNlcnZpY2Uuc2F2ZVBhcmFtKCdvcGFjaXR5JywgJHNjb3BlLmRhdGEub3BhY2l0eSk7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwib3BhY2l0eVwiLCAkc2NvcGUuZGF0YS5vcGFjaXR5KTtcclxuICB9O1xyXG5cclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmxldmVsc0N0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkaHR0cFwiLCBcIiR1aWJNb2RhbFwiLCBcInBhQ2FjaGVcIiwgXCJwYU1lbnVcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ2xldmVsc0N0cmwnLCBsZXZlbHNDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIGxldmVsc0N0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkc3RhdGUsICRodHRwLCAkdWliTW9kYWwsIHBhQ2FjaGUsIHBhTWVudSkge1xyXG5cclxuICAgICRzY29wZS5jb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICBjb25zb2xlLmxvZygnbGV2ZWxzOiBoYXMgZnVsbDonKyRzY29wZS5jb25mLnRlYWNoZXIuaGFzRnVsbCk7XHJcblxyXG4gICAgJHNjb3BlLnVubG9ja0ZvbGRlciA9IGZ1bmN0aW9uKGZvbGRlcil7XHJcbiAgICAgICRodHRwLnBvc3QoJy93cy9mb2xkZXJzLycrZm9sZGVyLl9pZCsnL3VubG9jaycpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgcGFNZW51LmxvYWRNeUZvbGRlcnMoJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpO1xyXG4gICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgICAgJHNjb3BlLmdvdG8gPSBmdW5jdGlvbihzdGF0ZSl7XHJcbiAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25UbyhzdGF0ZSk7XHJcbiAgICAgIH1cclxuICAgICAgICBcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxubmF2Q3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHVpYk1vZGFsXCIsIFwiJHdpbmRvd1wiLCBcInBhQ2FjaGVcIiwgXCJwYVNvY2tldFwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignbmF2Q3RybCcsIG5hdkN0cmwpO1xyXG5cclxuZnVuY3Rpb24gbmF2Q3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkdWliTW9kYWwsICR3aW5kb3csIHBhQ2FjaGUsIHBhU29ja2V0LCBjb25maWcpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdwYS50b2tlbicpO1xyXG4gICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL2xvZ291dCcpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHdpbmRvdy5sb2NhdGlvbiA9ICcvJztcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS50b2dnbGVTaWRlYmFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBzaG93ID0gY29uZi5zaWRlYmFyICYmIGNvbmYuc2lkZWJhci5zaG93O1xyXG4gICAgcGFTb2NrZXQuZW1pdCgnY29uZicsIHtcclxuICAgICAgXCJ2YXJcIjogJ3NpZGViYXInLFxyXG4gICAgICB2YWw6IHtcclxuICAgICAgICBzaG93OiFzaG93XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS50b2dnbGVMb2NrID0gZnVuY3Rpb24gKHVzZXIpIHtcclxuICAgIHZhciBsb2NrZWQ9dXNlci5wYXJhbXMubG9ja2VkPT0ndHJ1ZSc7XHJcbiAgICBwYVNvY2tldC5lbWl0KCdzYXZlVXNlclBhcmFtJywge1xyXG4gICAgICB1c2VyOiB1c2VyLmlkLFxyXG4gICAgICBuYW1lOiAnbG9ja2VkJyxcclxuICAgICAgdmFsdWU6ICFsb2NrZWRcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5hZGRQb2ludCA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwic2F2ZVVzZXJQYXJhbVwiLCB7XHJcbiAgICAgIHVzZXI6IHVzZXIuaWQsXHJcbiAgICAgIG5hbWU6ICdwb2ludHMnLFxyXG4gICAgICB2YWx1ZTogTnVtYmVyKHVzZXIucGFyYW1zLnBvaW50cykgKyAxXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucmVtUG9pbnQgPSBmdW5jdGlvbiAodXNlcikge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInNhdmVVc2VyUGFyYW1cIiwge1xyXG4gICAgICB1c2VyOiB1c2VyLmlkLFxyXG4gICAgICBuYW1lOiAncG9pbnRzJyxcclxuICAgICAgdmFsdWU6IE51bWJlcih1c2VyLnBhcmFtcy5wb2ludHMpIC0gMVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuXHJcbiAgdGhpcy5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmNvbmYgPSBjb25mO1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYUNhY2hlLmdldERhdGEoKTtcclxuICAgICRzY29wZS5mZWVkID0gcGFDYWNoZS5nZXRGZWVkKCk7XHJcbiAgICAkc2NvcGUuYWxlcnRzID0gcGFDYWNoZS5nZXRBbGVydHMoKTtcclxuICAgICRzY29wZS5ldmVudHMgPSBwYUNhY2hlLmdldEV2ZW50cygpO1xyXG4gICAgJHNjb3BlLmxvY2FsaXphdGlvbiA9IHBhQ2FjaGUuZ2V0TG9jYWxpemF0aW9uKCk7XHJcblxyXG4gICAgJHJvb3RTY29wZS4kd2F0Y2goJ3VzZXInLCBmdW5jdGlvbiAob2xkVmFsLCBuZXdWYWwpIHtcclxuICAgICAgaWYgKCRyb290U2NvcGUudXNlciAmJiAkcm9vdFNjb3BlLnVzZXIuc3R1ZGVudCkge1xyXG4gICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvZ2V0UG9zdHMnLCB7XHJcbiAgICAgICAgICBzdHVkZW50OiAkcm9vdFNjb3BlLnVzZXIuc3R1ZGVudCxcclxuICAgICAgICAgIHdpbm5lcjogdHJ1ZVxyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAgICRzY29wZS5wb3N0cyA9IHJlc3AuZGF0YTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNhdmVMb2NhbGUgPSBmdW5jdGlvbiAobCkge1xyXG4gICAgaWYgKCRyb290U2NvcGUudXNlciAmJiAkcm9vdFNjb3BlLnVzZXIuaWQpIHtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9zYXZlVXNlci8nICsgJHJvb3RTY29wZS51c2VyLmlkLCB7bG9jYWxlOiBsLmNvZGV9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgcGFDYWNoZS5zZXRVc2VyTG9jYWxlKHJlc3AuZGF0YS5sb2NhbGUpO1xyXG4gICAgICAgICR3aW5kb3cubG9jYXRpb24gPSAnL2hvbWUuaHRtbCc7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGFDYWNoZS5zZXRVc2VyTG9jYWxlKGwuY29kZSk7XHJcbiAgICAgICR3aW5kb3cubG9jYXRpb24gPSAnL2hvbWUuaHRtbCc7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBvcHVwQ29tbWVudHMgPSBmdW5jdGlvbiAoX3VzZXIpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLmNvbW1lbnRzLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncGFDb21tZW50c0N0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgdXNlcjogZnVuY3Rpb24gdXNlcigpIHtcclxuICAgICAgICAgIHJldHVybiBfdXNlcjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAkc2NvcGUuc2V0Q29udGVudChpdGVtKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5wb3B1cFByaXZhY3kgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcHJpdmFjeS5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ2NvbmRpdGlvbnNDdHJsJyxcclxuICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnBvcHVwQ29uZGl0aW9ucyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9jb25kaXRpb25zLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAnY29uZGl0aW9uc0N0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUudG9nZ2xlVmlkZW8gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgYWN0aXZlID0gY29uZi52aWRlbyAmJiBjb25mLnZpZGVvLmFjdGl2ZTtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZpZGVvJywge1xyXG4gICAgICBhY3RpdmU6ICFhY3RpdmUsXHJcbiAgICAgIGZ1bGxzY3JlZW46IGZhbHNlXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUudG9nZ2xlRnVsbHNjcmVlbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZpZGVvJywge1xyXG4gICAgICBhY3RpdmU6IHRydWUsXHJcbiAgICAgIGZ1bGxzY3JlZW46ICFjb25mLnZpZGVvLmZ1bGxzY3JlZW5cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIC8qdmFyIGxvYWRPcGVudG9rID0gZnVuY3Rpb24gbG9hZE9wZW50b2soKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3Mvb3BlbnRva0NsaWVudC8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLm9wZW50b2tDbGllbnQgPSByZXNwLmRhdGE7XHJcbiAgICB9KTtcclxuICB9OyovXHJcblxyXG4gICRzY29wZS5lZGl0Um9vbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnJvb20uaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYVJvb21DdHJsJyxcclxuICAgICAgc2l6ZTogJ2xnJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIHN1YnNjcmlwdGlvbnM6IGZ1bmN0aW9uIHN1YnNjcmlwdGlvbnMoKSB7XHJcbiAgICAgICAgICByZXR1cm4gJHNjb3BlLnN1YnNjcmlwdGlvbnM7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUubG9ja0FsbCA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgY29uZi5sb2NrQWxsPSFjb25mLmxvY2tBbGw7XHJcbiAgICBfLmVhY2goY29uZi5yb29tLnVzZXJzLCBmdW5jdGlvbih1c2VyKXtcclxuICAgICAgaWYgKHVzZXIuc3R1ZGVudCl7XHJcbiAgICAgICAgcGFTb2NrZXQuZW1pdCgnc2F2ZVVzZXJQYXJhbScsIHtcclxuICAgICAgICAgIHVzZXI6IHVzZXIuaWQsXHJcbiAgICAgICAgICBuYW1lOiAnbG9ja2VkJyxcclxuICAgICAgICAgIHZhbHVlOiBjb25mLmxvY2tBbGxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcblxyXG4gICRzY29wZS5wb3B1cFVzZXJQYXJhbXMgPSBmdW5jdGlvbiAoX3VzZXIpIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLnVzZXJQYXJhbXMuaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwb3B1cFVzZXJQYXJhbXNDdHJsJyxcclxuICAgICAgc2l6ZTogJ2xnJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIHVzZXI6IGZ1bmN0aW9uIHVzZXIoKSB7XHJcbiAgICAgICAgICByZXR1cm4gX3VzZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgJHNjb3BlLnNldENvbnRlbnQoaXRlbSk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICB0aGlzLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGljdG9ncmFtQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIiRodHRwXCIsIFwicGFTZXJ2aWNlXCIsIFwicGFDYWNoZVwiLCBcInBhQWNsXCIsIFwidG9hc3RlclwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGljdG9ncmFtQ3RybCcsIHBpY3RvZ3JhbUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGljdG9ncmFtQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRzdGF0ZVBhcmFtcywgJGh0dHAsIHBhU2VydmljZSwgcGFDYWNoZSwgcGFBY2wsIHRvYXN0ZXIsIGNvbmZpZykge1xyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLnR5cGUgPSAkc3RhdGVQYXJhbXMudHlwZTtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9jb2xsZWN0aW9ucy8nICsgJHN0YXRlUGFyYW1zLmNvbGxlY3Rpb24uX2lkKS50aGVuKGZ1bmN0aW9uKHJlcyl7XHJcbiAgICAgIHZhciBjb2xsID0gcmVzLmRhdGE7XHJcbiAgICAgIGNvbGwuaXNTeXN0ZW0gPSAhY29sbC50ZWFjaGVyO1xyXG4gICAgICAkc2NvcGUuY29sbGVjdGlvbiA9IGNvbGw7XHJcblxyXG4gICAgICBpZiAoJHNjb3BlLnR5cGUgPT0gJ3RleHQnKSB7XHJcbiAgICAgICAgICB2YXIgd29yZHMgPSBwYVNlcnZpY2Uuc3BsaXQoJHNjb3BlLmNvbGxlY3Rpb24uY2hhcnMsICcjJyk7XHJcblxyXG4gICAgICAgICAgaWYgKCEkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzID0gd29yZHM7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBfLmVhY2goJHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzLCBmdW5jdGlvbiAocmVzLCBpKSB7XHJcbiAgICAgICAgICAgICAgcmVzLmNoYXJzID0gd29yZHNbaV0uY2hhcnM7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgfSlcclxuXHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgJHNjb3BlLmlzRm9sZGVyQWRtaW4gPSAoJHJvb3RTY29wZS51c2VyLnJvbGU9PSdFJyAmJiBjb25mLmN1cnJlbnRGb2xkZXIuaXNBZG1pbik7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFNpemUgPSBmdW5jdGlvbiAoaSwgZSkge1xyXG4gICAgdmFyIGV2ZW50ID0gd2luZG93LmV2ZW50IHx8IGU7XHJcbiAgICB2YXIgaXRlbSA9ICRzY29wZS5jb2xsZWN0aW9uLnJlc291cmNlc1tpXTtcclxuXHJcbiAgICBpZiAoIWl0ZW0ud2lkdGgpIHtcclxuICAgICAgaXRlbS53aWR0aCA9IDEwO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBkZWx0YSA9IE1hdGgubWF4KC0xLCBNYXRoLm1pbigxLCBldmVudC53aGVlbERlbHRhIHx8IC1ldmVudC5kZXRhaWwpKTtcclxuXHJcbiAgICBpZiAoZGVsdGEgPiAwKSB7XHJcbiAgICAgIGl0ZW0ud2lkdGgrKztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGl0ZW0ud2lkdGgtLTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0Rm9udFNpemUgPSBmdW5jdGlvbiAoaSwgZSkge1xyXG4gICAgdmFyIGV2ZW50ID0gd2luZG93LmV2ZW50IHx8IGU7XHJcbiAgICB2YXIgaXRlbSA9ICRzY29wZS5jb2xsZWN0aW9uLnJlc291cmNlc1tpXTtcclxuXHJcbiAgICBpZiAoIWl0ZW0uZm9udFNpemUpIHtcclxuICAgICAgaXRlbS5mb250U2l6ZSA9IDEwO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBkZWx0YSA9IE1hdGgubWF4KC0xLCBNYXRoLm1pbigxLCBldmVudC53aGVlbERlbHRhIHx8IC1ldmVudC5kZXRhaWwpKTtcclxuXHJcbiAgICBpZiAoZGVsdGEgPiAwKSB7XHJcbiAgICAgIGl0ZW0uZm9udFNpemUrKztcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGl0ZW0uZm9udFNpemUtLTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0UG9zaXRpb24gPSBmdW5jdGlvbiAoaSwgZSkge1xyXG4gICAgdmFyIGV2ZW50ID0gd2luZG93LmV2ZW50IHx8IGU7XHJcbiAgICB2YXIgaXRlbSA9ICRzY29wZS5jb2xsZWN0aW9uLnJlc291cmNlc1tpXTtcclxuICAgIGlmIChldmVudC5rZXlDb2RlID09IDM4KSBpdGVtLnRvcCsrO2Vsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT0gMzkpIGl0ZW0ubGVmdCsrO2Vsc2UgaWYgKGV2ZW50LmtleUNvZGUgPT0gNDApIGl0ZW0udG9wLS07ZWxzZSBpZiAoZXZlbnQua2V5Q29kZSA9PSAzNykgaXRlbS5sZWZ0LS07XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNhdmVJdGVtcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICgkc2NvcGUuaXNGb2xkZXJBZG1pbikge1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVTeXN0ZW1Db2xsZWN0aW9uJywgJHNjb3BlLmNvbGxlY3Rpb24pLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsICdQaWN0b2dyYW0nLCAncGljdG9ncmFtIHNhdmVkJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9zYXZlQ29sbGVjdGlvbicsICRzY29wZS5jb2xsZWN0aW9uKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCAnUGljdG9ncmFtJywgJ3BpY3RvZ3JhbSBzYXZlZCcpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2VsZWN0SXRlbSA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICAkc2NvcGUuc2VsZWN0ZWQgPSBpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnB1Ymxpc2hDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRyb290U2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcInBhQ2FjaGVcIiwgXCJkaXZcIiwgXCJ0ZXh0XCIsIFwidGltZVwiLCBcInRvYXN0ZXJcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3B1Ymxpc2hDdHJsJywgcHVibGlzaEN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcHVibGlzaEN0cmwoJHNjb3BlLCAkaHR0cCwgJHJvb3RTY29wZSwgJHN0YXRlLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFDYWNoZSwgZGl2LCB0ZXh0LCB0aW1lLCB0b2FzdGVyLCBjb25maWcpIHtcclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5kYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAkc2NvcGUuZ2V0U3Vic2NyaXB0aW9ucygpO1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRzY29wZS5wb3N0ID0ge1xyXG4gICAgICBwYWdlOiBjb25mLmN1cnJlbnRQYWdlLl9pZCxcclxuICAgICAgZGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgdGVhY2hlcjogY29uZi50ZWFjaGVyXHJcbiAgICB9O1xyXG5cclxuICAgIGlmICh0ZXh0KSB7XHJcbiAgICAgICRzY29wZS50ZXh0VmFsdWUgPSB0ZXh0O1xyXG4gICAgfSBlbHNlIGlmICh0aW1lKSB7XHJcbiAgICAgIHZhciBlID0gYW5ndWxhci5lbGVtZW50KCcjJyArIHRpbWUpO1xyXG4gICAgICAkc2NvcGUudGltZVZhbHVlID0gZS50ZXh0KCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB2YXIgZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRpdik7XHJcblxyXG4gICAgICBpZiAoZSkge1xyXG4gICAgICAgIHZhciBvcHRpb25zID0ge1xyXG4gICAgICAgICAgaWdub3JlRWxlbWVudHM6IGZ1bmN0aW9uIGlnbm9yZUVsZW1lbnRzKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuY2xhc3NOYW1lLmluZGV4T2YoJ2ZhJykgIT0gLTEgfHwgZWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZignYm90dG9tYmFyJykgIT0gLTE7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgdXNlQ09SUzogdHJ1ZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaHRtbDJjYW52YXMoZSwgb3B0aW9ucykudGhlbihmdW5jdGlvbiAoY2FudmFzKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnY2FudmFzIHdpZHRoOiAnICsgY2FudmFzLndpZHRoKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdjYW52YXMgaGVpZ2h0OiAnICsgY2FudmFzLmhlaWdodCk7XHJcbiAgICAgICAgICAkc2NvcGUuYmFzZTY0ID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvanBlZycsIDAuOCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnYmFzZTY0IGxlbmd0aDogJyArICRzY29wZS5iYXNlNjQubGVuZ3RoICsgJyBieXRlcycpO1xyXG4gICAgICAgICAgJHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmdldFN1YnNjcmlwdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgJHNjb3BlLmRhdGEuc3R1ZGVudHMgPSBfLm1hcChjb25mLnJvb20uc3Vic2NyaXB0aW9ucywgZnVuY3Rpb24gKHN1YnNjcikge1xyXG4gICAgICByZXR1cm4gc3Vic2NyLnN0dWRlbnQ7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2F2ZVBvc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUucG9zdC5zdHVkZW50ID0gXy5maWx0ZXIoJHNjb3BlLmRhdGEuc3R1ZGVudHMsICdzZWxlY3RlZCcpO1xyXG4gICAgaWYgKCRzY29wZS5wb3N0LnN0dWRlbnQubGVuZ3RoKSB7XHJcbiAgICAgICRzY29wZS5zcGlubmluZyA9IHRydWU7XHJcbiAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVCbG9iL2hvbWUnLCB7XHJcbiAgICAgICAgZm9sZGVyOiAkc2NvcGUucG9zdC5zdHVkZW50LFxyXG4gICAgICAgIG5hbWU6IG5vdy5nZXRUaW1lKCksXHJcbiAgICAgICAgZGF0YTogJHNjb3BlLmJhc2U2NFxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgaWYgKCRzY29wZS5iYXNlNjQpIHtcclxuICAgICAgICAgICRzY29wZS5wb3N0LmltYWdlID0gcmVzcC5kYXRhO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCRzY29wZS50aW1lVmFsdWUpIHtcclxuICAgICAgICAgICRzY29wZS5wb3N0LnRpbWVWYWx1ZSA9ICRzY29wZS50aW1lVmFsdWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJHNjb3BlLnRleHRWYWx1ZSkge1xyXG4gICAgICAgICAgJHNjb3BlLnBvc3QudGV4dFZhbHVlID0gJHNjb3BlLnRleHRWYWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvc2F2ZVBvc3QnLCAkc2NvcGUucG9zdCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgICAgJHNjb3BlLnNwaW5uaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsIFwiUG9zdFwiLCBcInBvc3QgcHVibGlzaGVkXCIpO1xyXG4gICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdG9hc3Rlci5wb3AoJ2Vycm9yJywgXCJQb3N0XCIsIFwic2VsZWN0IHN0dWRlbnRcIik7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnNob3BDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHN0YXRlXCIsIFwiJGh0dHBcIiwgXCJwYVNvY2tldFwiLCBcInBhU2VydmljZVwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3Nob3BDb250cm9sbGVyJywgc2hvcENvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gc2hvcENvbnRyb2xsZXIoJHNjb3BlLCAkcm9vdFNjb3BlLCAkc3RhdGUsICRodHRwLCBwYVNvY2tldCwgcGFTZXJ2aWNlLCBwYUNhY2hlLCBjb25maWcpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYVNlcnZpY2UuaW5pdCgpO1xyXG4gICAgJHNjb3BlLmRhdGEuc2VsZWN0ZWRTbWlsZXMgPSB7fTtcclxuICAgICRzY29wZS5zbWlsZXMgPSBbXTtcclxuICAgICRzY29wZS5kYXRhLmNvdW50ZXIgPSAwO1xyXG5cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMzA7IGkrKykge1xyXG4gICAgICAkc2NvcGUuc21pbGVzLnB1c2goaSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufVxyXG5cclxuOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuc2lkZWJhckN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcInBhQ2FjaGVcIiwgXCJwYVNlcnZpY2VcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3NpZGViYXJDdHJsJywgc2lkZWJhckN0cmwpO1xyXG5cclxuZnVuY3Rpb24gc2lkZWJhckN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFDYWNoZSwgcGFTZXJ2aWNlKSB7XHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG5cclxuICAgIGlmICgkc2NvcGUuY29uZi5jdXJyZW50Rm9sZGVyLmRlbW9Nb2RlIHx8ICEkcm9vdFNjb3BlLnBhRmVhdHVyZXMucGFnZXMpIHtcclxuICAgICAgJHNjb3BlLmNvbmYuY3VycmVudE1vZGUgPSAnQyc7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLm9wZW4gPSBmdW5jdGlvbiAoZm9sZGVyKSB7XHJcbiAgICAkc2NvcGUuc2VsZWN0ZWQgIT0gZm9sZGVyLm5hbWUgPyAkc2NvcGUuc2VsZWN0ZWQgPSBmb2xkZXIubmFtZSA6ICRzY29wZS5zZWxlY3RlZCA9IG51bGw7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldEZvbGRlciA9IGZ1bmN0aW9uIChmb2xkZXIpIHtcclxuICAgIHBhQ2FjaGUuc2V0Q3VycmVudEZvbGRlcihmb2xkZXIpO1xyXG4gICAgcGFTZXJ2aWNlLmxvYWRDb250ZW50cyhmb2xkZXIpO1xyXG4gICAgLy9wYVNlcnZpY2UubG9hZFBhZ2VzKGZvbGRlcik7XHJcblxyXG4gICAgaWYgKCRzY29wZS5jb25mLmN1cnJlbnRGb2xkZXIuZGVtb01vZGUpIHtcclxuICAgICAgJHNjb3BlLmNvbmYuY3VycmVudE1vZGUgPSAnQyc7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNldFdvcmtwbGFuID0gZnVuY3Rpb24gKHdvcmtwbGFuKSB7XHJcbiAgICBwYUNhY2hlLnNldEN1cnJlbnRGb2xkZXIod29ya3BsYW4pO1xyXG4gICAgcGFTZXJ2aWNlLmxvYWRXb3JrcGxhbih3b3JrcGxhbik7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxuXHJcbiAgJHNjb3BlLnNldE1vZGUgPSBmdW5jdGlvbiAobW9kZSkge1xyXG4gICAgcGFDYWNoZS5zZXRDdXJyZW50TW9kZShtb2RlKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0UGFnZSA9IGZ1bmN0aW9uIChwYWdlKSB7XHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZShwYWdlKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uIChjb250ZW50KSB7XHJcbiAgICBwYUNhY2hlLnNldEN1cnJlbnRDb250ZW50KGNvbnRlbnQpO1xyXG4gICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoY29udGVudCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zdGFydHNXaXRoID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICBpZiAodmFsdWUgJiYgdmFsdWUubmFtZSAmJiAkc2NvcGUuc2VhcmNoICYmICRzY29wZS5zZWFyY2gubmFtZSkge1xyXG4gICAgICByZXR1cm4gdmFsdWUubmFtZS50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoJHNjb3BlLnNlYXJjaC5uYW1lLnRvVXBwZXJDYXNlKCkpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgfTtcclxufVxyXG5cclxuOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuc2l6ZUZhY3RvckN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIiRodHRwXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdzaXplRmFjdG9yQ3RybCcsIHNpemVGYWN0b3JDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHNpemVGYWN0b3JDdHJsKCRzY29wZSwgJHN0YXRlUGFyYW1zLCAkaHR0cCwgY29uZmlnKSB7XHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuY29sbGVjdGlvbiA9ICRzdGF0ZVBhcmFtcy5jb2xsZWN0aW9uO1xyXG5cclxuICAgIF8uZWFjaCgkc2NvcGUuY29sbGVjdGlvbi5yZXNvdXJjZXMsIGZ1bmN0aW9uIChyZXNvdXJjZSkge1xyXG4gICAgICBpZiAoIXJlc291cmNlLnNpemVGYWN0b3IpIHtcclxuICAgICAgICByZXNvdXJjZS5zaXplRmFjdG9yID0gMTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmZhY3Rvck1lID0gZnVuY3Rpb24gKHYsIHNpemVGYWN0b3IpIHtcclxuICAgIHZhciB3ID0gc2l6ZUZhY3RvciA/IHYgKiBzaXplRmFjdG9yIDogdjtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIHdpZHRoOiB3ICsgJ3Z3JyxcclxuICAgICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXHJcbiAgICAgIFwiZmxvYXRcIjogJ2xlZnQnXHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zYXZlSXRlbXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVDb2xsZWN0aW9uJywgJHNjb3BlLmNvbGxlY3Rpb24pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhU29uZ3NDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcInBhU2VydmljZVwiLCBcInBhQ2FjaGVcIiwgXCJuZ0F1ZGlvXCIsIFwiY29sbFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFTb25nc0N0cmwnLCBwYVNvbmdzQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYVNvbmdzQ3RybCgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBwYVNlcnZpY2UsIHBhQ2FjaGUsIG5nQXVkaW8sIGNvbGwpIHtcclxuXHJcbiAgICB2YXIgaW5pdCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZhciBhdWRpb0NvbGxlY3Rpb24gPSBbXTtcclxuICAgICAgXy5lYWNoKGNvbGwucmVzb3VyY2VzLCBmdW5jdGlvbiAocmVzKSB7XHJcbiAgICAgICAgYXVkaW9Db2xsZWN0aW9uLnB1c2goe1xyXG4gICAgICAgICAgdGl0bGU6IHJlcy50aXRsZSxcclxuICAgICAgICAgIGk6IHJlcy5zcmNcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICAgICRzY29wZS5hdWRpb0NvbGxlY3Rpb24gPSBhdWRpb0NvbGxlY3Rpb247XHJcblxyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5zZWxlY3QgPSBmdW5jdGlvbihhdWRpbyl7XHJcbiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoYXVkaW8pO1xyXG4gICAgfVxyXG5cclxuICAgIGluaXQoKTtcclxufTsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnN0aWNrZXJzQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHN0YXRlXCIsIFwiJHN0YXRlUGFyYW1zXCIsIFwicGFTb2NrZXRcIiwgXCJwYVNlcnZpY2VcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdzdGlja2Vyc0NvbnRyb2xsZXInLCBzdGlja2Vyc0NvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gc3RpY2tlcnNDb250cm9sbGVyKCRzY29wZSwgJHJvb3RTY29wZSwgJGh0dHAsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCBwYVNvY2tldCwgcGFTZXJ2aWNlLCBwYUNhY2hlLCBjb25maWcpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKCRzdGF0ZVBhcmFtcy5zdHVkZW50ICYmICRzdGF0ZVBhcmFtcy5zdHVkZW50Ll9pZCkge1xyXG4gICAgICAkc2NvcGUuc3R1ZGVudCA9ICRzdGF0ZVBhcmFtcy5zdHVkZW50O1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5kYXRhID0gcGFTZXJ2aWNlLmluaXQoKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5zZWxlY3RJbWFnZSA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwiaW1nIG1lc3NhZ2VcIiwge19pZDogaX0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZWxlY3RlZCA9IFtdO1xyXG4gIHBhU29ja2V0Lm9uKFwiaW1nIG1lc3NhZ2VcIiwgZnVuY3Rpb24gKG1zZykge1xyXG4gICAgJHNjb3BlLnNlbGVjdGVkW21zZy5faWRdID0gISRzY29wZS5zZWxlY3RlZFttc2cuX2lkXTtcclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBmb3IgKHZhciBpIGluICRzY29wZS5zZWxlY3RlZCkge1xyXG4gICAgICBpZiAoJHNjb3BlLnNlbGVjdGVkW2ldKSB7XHJcbiAgICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9hZGRTdGlja2VyLycgKyAkc2NvcGUuc3R1ZGVudC5faWQgKyAnLycgKyAkc2NvcGUuc3R1ZGVudC5jb3Vyc2UsIHtcclxuICAgICAgICAgIFwic3JjXCI6ICRzY29wZS5kYXRhLmltYWdlc1tpXS5zcmNcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAvLyBmb3JjZSBzdHVkZW50IGRhc2hib2FyZCB0byByZWxvYWRcclxuICAgICAgICAgIHBhU29ja2V0LmVtaXQoXCJwYWdlIG1lc3NhZ2VcIiwge1xyXG4gICAgICAgICAgICBjb2RlOiBcImRhc2hib2FyZFwiXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnN1YnNjcmlwdGlvbnNDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCJwYVNvY2tldFwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcignc3Vic2NyaXB0aW9uc0NvbnRyb2xsZXInLCBzdWJzY3JpcHRpb25zQ29udHJvbGxlcik7XHJcblxyXG5mdW5jdGlvbiBzdWJzY3JpcHRpb25zQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCBwYVNvY2tldCwgY29uZmlnKSB7XHJcbiAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIHBhU29ja2V0LnJlbW92ZUFsbExpc3RlbmVycygpO1xyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5nZXRTdWJzY3JpcHRpb25zKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmdldFN1YnNjcmlwdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvZmluZFN1YnNjcmlwdGlvbnMvJyArICRyb290U2NvcGUudXNlci5jaGFubmVsKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5zdWJzY3JpcHRpb25zID0gcmVzcC5kYXRhO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnNhdmVTdWJzY3JpcHRpb24gPSBmdW5jdGlvbiAoc3Vic2NyaXB0aW9uKSB7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3NhdmVTdWJzY3JpcHRpb24vJyArIHN1YnNjcmlwdGlvbi5faWQsIHN1YnNjcmlwdGlvbik7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufVxyXG5cclxuOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxudGV4dENvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiJHN0YXRlXCIsIFwiJHJvb3RTY29wZVwiLCBcInBhU29ja2V0XCIsIFwicGFTZXJ2aWNlXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigndGV4dENvbnRyb2xsZXInLCB0ZXh0Q29udHJvbGxlcik7XHJcblxyXG5mdW5jdGlvbiB0ZXh0Q29udHJvbGxlcigkc2NvcGUsICRodHRwLCAkc3RhdGUsICRyb290U2NvcGUsIHBhU29ja2V0LCBwYVNlcnZpY2UsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG4gICRzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICBwYVNvY2tldC5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuZGF0YSA9IHBhU2VydmljZS5pbml0KCk7XHJcbiAgICBwYVNlcnZpY2UuZmluZFRleHQoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgIGlmIChkYXRhKSB7XHJcbiAgICAgICAgJHNjb3BlLmNoYXJzID0gXy5maWx0ZXIoZGF0YS5jaGFycywgZnVuY3Rpb24gKGMpIHtcclxuICAgICAgICAgIHJldHVybiBjLnZhbCAhPSAnJztcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAkc2NvcGUuc2VsZWN0ZWQgPSAtMTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaXNTZWxlY3RlZCA9IGZ1bmN0aW9uIChpKSB7XHJcbiAgICByZXR1cm4gaSA+PSAkc2NvcGUuZGF0YS5zdGFydCAmJiBpIDw9ICRzY29wZS5kYXRhLmVuZDtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuZ2V0U2VsZWN0aW9uVGV4dCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKCkpIHtcclxuICAgICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpKSB7XHJcbiAgICAgICAgLy8gdGV4dCBzZWxlY3Rpb25cclxuICAgICAgICB2YXIgcmFuZ2UgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZ2V0UmFuZ2VBdCgwKTtcclxuICAgICAgICB2YXIgcyA9IHJhbmdlLnN0YXJ0Q29udGFpbmVyLnBhcmVudEVsZW1lbnQuaWQ7XHJcbiAgICAgICAgdmFyIGUgPSByYW5nZS5lbmRDb250YWluZXIucGFyZW50RWxlbWVudC5pZDtcclxuICAgICAgICBwYVNvY2tldC5lbWl0KCd0ZXh0Jywge1xyXG4gICAgICAgICAgc3RhcnQ6IHMsXHJcbiAgICAgICAgICBlbmQ6IGVcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBjbGlja1xyXG4gICAgICAgIHZhciBiID0gJy4sICc7XHJcbiAgICAgICAgdmFyIGFuY2hvck5vZGUgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkuYW5jaG9yTm9kZTtcclxuXHJcbiAgICAgICAgaWYgKGIuaW5kZXhPZihhbmNob3JOb2RlLm5vZGVWYWx1ZSkgPT0gLTEpIHtcclxuICAgICAgICAgIHZhciBsID0gJHNjb3BlLmNoYXJzLmxlbmd0aDtcclxuICAgICAgICAgIHZhciBpID0gcGFyc2VJbnQoYW5jaG9yTm9kZS5wYXJlbnRFbGVtZW50LmlkKTtcclxuICAgICAgICAgIHZhciBlID0gaTtcclxuXHJcbiAgICAgICAgICB3aGlsZSAoZSA8IGwgJiYgJHNjb3BlLmNoYXJzW2UgKyAxXSAmJiBiLmluZGV4T2YoJHNjb3BlLmNoYXJzW2UgKyAxXS52YWwpID09IC0xKSB7XHJcbiAgICAgICAgICAgIGUgPSBlICsgMTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICB2YXIgcyA9IGk7XHJcblxyXG4gICAgICAgICAgd2hpbGUgKHMgPiAwICYmICRzY29wZS5jaGFyc1tzIC0gMV0gJiYgYi5pbmRleE9mKCRzY29wZS5jaGFyc1tzIC0gMV0udmFsKSA9PSAtMSkge1xyXG4gICAgICAgICAgICBzID0gcyAtIDE7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgcGFTb2NrZXQuZW1pdCgndGV4dCcsIHtcclxuICAgICAgICAgICAgc3RhcnQ6IHMsXHJcbiAgICAgICAgICAgIGVuZDogZVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmhpZGVUZXh0ID0gZnVuY3Rpb24gKGJvb2wpIHtcclxuICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgJ3Zhcic6ICdoaWRlVGV4dCcsXHJcbiAgICAgICd2YWwnOiBib29sXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5pdCgpO1xyXG59XHJcblxyXG47IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG50ZXh0RWRpdG9yQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCIkc3RhdGVQYXJhbXNcIiwgXCIkdWliTW9kYWxcIiwgXCIkcm9vdFNjb3BlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCd0ZXh0RWRpdG9yQ29udHJvbGxlcicsIHRleHRFZGl0b3JDb250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIHRleHRFZGl0b3JDb250cm9sbGVyKCRzY29wZSwgJGh0dHAsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkdWliTW9kYWwsICRyb290U2NvcGUsIGNvbmZpZykge1xyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLnRleHQ9JHNjb3BlLnBhVGV4dDtcclxuICAgICRzY29wZS5lZGl0YWJsZSA9IGZhbHNlO1xyXG4gICAgJHNjb3BlLmZvbnRGYW1pbGllcyA9IFsnU2Vnb2UgVUknLCAnR2VvcmdpYScsICdQYWxhdGlubyBMaW5vdHlwZScsICdCb29rIEFudGlxdWEnLCAnVGltZXMgTmV3IFJvbWFuJywgJ0FyaWFsJywgJ0hlbHZldGljYScsICdBcmlhbCBCbGFjaycsICdJbXBhY3QnLCAnTHVjaWRhIFNhbnMgVW5pY29kZScsICdUYWhvbWEnLCAnVmVyZGFuYScsICdDb3VyaWVyIE5ldycsICdMdWNpZGEgQ29uc29sZScsICdTYW5zLXNlcmlmJywgJ0NvbWljIFNhbnMgTVMnLCAnaW5pdGlhbCddO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5nZXRTZWxlY3Rpb25UZXh0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24oKS50b1N0cmluZygpKSB7XHJcbiAgICAgIC8vIHRleHQgc2VsZWN0aW9uXHJcbiAgICAgIHZhciByYW5nZSA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKS5nZXRSYW5nZUF0KDApO1xyXG4gICAgICAkc2NvcGUuc3RhcnQgPSBwYXJzZUludChyYW5nZS5zdGFydENvbnRhaW5lci5wYXJlbnRFbGVtZW50LmlkKTtcclxuICAgICAgJHNjb3BlLmVuZCA9IHBhcnNlSW50KHJhbmdlLmVuZENvbnRhaW5lci5wYXJlbnRFbGVtZW50LmlkKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUuY2xlYXJTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuc3RhcnQgPSB1bmRlZmluZWQ7XHJcbiAgICAkc2NvcGUuZW5kID0gdW5kZWZpbmVkO1xyXG4gICAgd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5hcHBseUZvbnRGYW1pbHkgPSBmdW5jdGlvbiAoZmFtaWx5KSB7XHJcbiAgICBmb3IgKHZhciBpID0gJHNjb3BlLnN0YXJ0OyBpIDw9ICRzY29wZS5lbmQ7IGkrKykge1xyXG4gICAgICAkc2NvcGUudGV4dC5jaGFyc1tpXS5mb250RmFtaWx5ID0gZmFtaWx5O1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5jbGVhclNlbGVjdGlvbigpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5hcHBseUNvbG9yID0gZnVuY3Rpb24gKHN0eWxlKSB7XHJcbiAgICBmb3IgKHZhciBpID0gJHNjb3BlLnN0YXJ0OyBpIDw9ICRzY29wZS5lbmQ7IGkrKykge1xyXG4gICAgICAkc2NvcGUudGV4dC5jaGFyc1tpXS5jb2xvciA9IHN0eWxlO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5jbGVhclNlbGVjdGlvbigpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5hcHBseVdlaWdodCA9IGZ1bmN0aW9uIChzdHlsZSkge1xyXG4gICAgZm9yICh2YXIgaSA9ICRzY29wZS5zdGFydDsgaSA8PSAkc2NvcGUuZW5kOyBpKyspIHtcclxuICAgICAgJHNjb3BlLnRleHQuY2hhcnNbaV0ud2VpZ2h0ID0gc3R5bGU7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmNsZWFyU2VsZWN0aW9uKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFwcGx5U2l6ZSA9IGZ1bmN0aW9uIChzdHlsZSkge1xyXG4gICAgZm9yICh2YXIgaSA9ICRzY29wZS5zdGFydDsgaSA8PSAkc2NvcGUuZW5kOyBpKyspIHtcclxuICAgICAgJHNjb3BlLnRleHQuY2hhcnNbaV0uc2l6ZSA9IHN0eWxlO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5jbGVhclNlbGVjdGlvbigpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5jbGVhclN0eWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgZm9yICh2YXIgaSA9ICRzY29wZS5zdGFydDsgaSA8PSAkc2NvcGUuZW5kOyBpKyspIHtcclxuICAgICAgJHNjb3BlLnRleHQuY2hhcnNbaV0uY29sb3IgPSBudWxsO1xyXG4gICAgICAkc2NvcGUudGV4dC5jaGFyc1tpXS53ZWlnaHQgPSBudWxsO1xyXG4gICAgICAkc2NvcGUudGV4dC5jaGFyc1tpXS5zaXplID0gbnVsbDtcclxuICAgICAgJHNjb3BlLnRleHQuY2hhcnNbaV0uZm9udEZhbWlseSA9IG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmNsZWFyU2VsZWN0aW9uKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufVxyXG5cclxuOyIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFXZWJpbmFyQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiR1aWJNb2RhbFwiLCBcIndlYmluYXJTZXJ2aWNlXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFXZWJpbmFyQ3RybCcsIHBhV2ViaW5hckN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFXZWJpbmFyQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbCwgd2ViaW5hclNlcnZpY2UsIHBhQ2FjaGUsIGNvbmZpZykge1xyXG5cclxuICAgIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmluaXRQYWdlU2NvcGUoKTtcclxuXHJcbiAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhZ2VTY29wZTtcclxuICAgICAgICB3ZWJpbmFyU2VydmljZS5sb2FkVXBjb21pbmdXZWJpbmFyKCRyb290U2NvcGUudXNlci50ZWFjaGVyKTtcclxuICAgIH07XHJcblxyXG4gICRzY29wZS5yZW1vdmVXZWJpbmFyU3Vic2NyaXB0aW9uID0gZnVuY3Rpb24oc3Vic2NyKXtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmNvbmZpcm0uaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUNvbmZpcm1DdHJsJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIG1lc3NhZ2U6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICByZXR1cm4gJ9CS0Ysg0YPQstC10YDQtdC90Ys/INCe0YLQutCw0LfQsNCy0YjQuNGB0Ywg0L7RgiDRg9GH0LDRgdGC0LjRjyDQsiDQstC10LHQuNC90LDRgNC1LCDQktGLINCx0YPQtNC10YLQtSDQuNC30YPRh9Cw0YLRjCDQv9C70LDRgtGE0L7RgNC80YMg0KHQkNCc0J7QodCi0J7Qr9Ci0JXQm9Cs0J3QniDQv9C+INCy0LXQsdC40L3QsNGA0LDQvCDQsiDQt9Cw0L/QuNGB0Lg/J1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgd2ViaW5hclNlcnZpY2UucmVtb3ZlU3Vic2NyaXB0aW9uKHN1YnNjcikudGhlbihmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAgIHdlYmluYXJTZXJ2aWNlLmxvYWRVcGNvbWluZ1dlYmluYXIoKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gICRzY29wZS5lZGl0V2ViaW5hclN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6ICcvcGEvcG9wdXAud2ViaW5hclN1YnNjcmlwdGlvbi5odG1sJyxcclxuICAgICAgY29udHJvbGxlcjogJ3dlYmluYXJTdWJzY3JpcHRpb25DdHJsJyxcclxuICAgICAgc2l6ZTogJ2xnJyxcclxuICAgICAgcmVzb2x2ZSA6IHtcclxuICAgICAgICB3ZWJpbmFyU3Vic2NyaXB0aW9uIDogZnVuY3Rpb24oKXtcclxuICAgICAgICAgIHJldHVybiBzdWJzY3I7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwicGFTb2NrZXRcIiwgXCJwYVNlcnZpY2VcIiwgXCJwYUNhY2hlXCIsIFwicGFTdHlsZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFDb250cm9sbGVyJywgcGFDb250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIHBhQ29udHJvbGxlcigkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCBwYVNvY2tldCwgcGFTZXJ2aWNlLCBwYUNhY2hlLCBwYVN0eWxlLCBjb25maWcpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTZXJ2aWNlLmRlc3Ryb3koKTtcclxuICB9KTtcclxuXHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUuZGF0YSA9IHBhU2VydmljZS5pbml0KCk7XHJcbiAgICAkc2NvcGUuY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgaWYgKCRzY29wZS5jb25mLmN1cnJlbnRNb2RlID09ICdIJyl7XHJcbiAgICAgIHZhciBzdHVkZW50PSRyb290U2NvcGUudXNlci5zdHVkZW50fHwkc2NvcGUuY29uZi5hc1N0dWRlbnQuX2lkO1xyXG4gICAgICAkaHR0cC5nZXQoJy93cy9yZWMvY29udGVudHMvJyskc2NvcGUuY29uZi5jdXJyZW50Q29udGVudC5faWQrJy9zdHVkZW50cy8nK3N0dWRlbnQpLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgdmFyIHJlYyA9IHJlc3AuZGF0YTtcclxuICAgICAgICAkaHR0cC5nZXQoJy93cy9ldmVudC8nK3Jlc3AuZGF0YS5faWQrJy9maW5kJykudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgaWYgKHJlc3AuZGF0YSl7XHJcbiAgICAgICAgICAgICAgICBfLmVhY2gocmVzcC5kYXRhLCBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFTb2NrZXQuZW1pdChtc2cubmFtZSwgbXNnLmRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCRyb290U2NvcGUudXNlci5yb2xlPT0nUycpe1xyXG4gICAgICAgICAgICAgICRzY29wZS5kYXRhLnJlYyA9IHJlYztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcblxyXG4gICAgfVxyXG4gICAgJHNjb3BlLnNvcnRhYmxlT3B0aW9ucyA9IHtcclxuICAgICAgJ3VpLWZsb2F0aW5nJzogdHJ1ZSxcclxuICAgICAgc3RvcDogZnVuY3Rpb24gc3RvcChlLCB1aSkge1xyXG4gICAgICAgIHBhU29ja2V0LmVtaXQoJ2ltYWdlcycsICRzY29wZS5kYXRhLmltYWdlcyk7XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICAkc2NvcGUuc29ydGFibGVPcHRpb25zMiA9IHtcclxuICAgICAgJ3VpLWZsb2F0aW5nJzogdHJ1ZSxcclxuICAgICAgc3RvcDogZnVuY3Rpb24gc3RvcChlLCB1aSkge1xyXG4gICAgICAgIHBhU29ja2V0LmVtaXQoJ2ltYWdlczInLCAkc2NvcGUuZGF0YS5pbWFnZXMyKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgICRzY29wZS5zb3J0YWJsZUxpbmVXb3JkcyA9IHtcclxuICAgICAgJ3VpLWZsb2F0aW5nJzogdHJ1ZSxcclxuICAgICAgc3RvcDogZnVuY3Rpb24gc3RvcChlLCB1aSkge1xyXG4gICAgICAgIHZhciBpID0gTnVtYmVyKGUudGFyZ2V0LmlkKTtcclxuICAgICAgICB2YXIgb3JkZXIgPSBfLm1hcCgkc2NvcGUuZGF0YS5saW5lc1tpXS53b3JkcywnaScpO1xyXG4gICAgICAgIHBhU29ja2V0LmVtaXQoJ2xpbmUnLCB7aTppLCBvcmRlcjpvcmRlcn0pO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgcGFTdHlsZS5sb2FkUGFnZVN0eWxlcygpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhUGF5bWVudHNDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkd2luZG93XCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFQYXltZW50c0N0cmwnLCBwYVBheW1lbnRzQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYVBheW1lbnRzQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkd2luZG93LCBwYUNhY2hlLCBjb25maWcpIHtcclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAkc2NvcGUuZmluZFBheW1lbnRzKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmZpbmRQYXltZW50cyA9IGZ1bmN0aW9uIGZpbmRQYXltZW50cygpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kUGF5bWVudFJvd3MvJyArICRyb290U2NvcGUudXNlci50ZWFjaGVyKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgJHNjb3BlLnJvd3MgPSByZXMuZGF0YTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBvcHVwQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHVpYk1vZGFsXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwb3B1cEN0cmwnLCBwb3B1cEN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcG9wdXBDdHJsKCRzY29wZSwgJHVpYk1vZGFsKSB7XHJcbiAgJHNjb3BlLnBvcHVwID0gZnVuY3Rpb24gKHJlcykge1xyXG4gICAgd2luZG93LnNjcm9sbFRvKDAsMCk7XHJcbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICR1aWJNb2RhbC5vcGVuKHtcclxuICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5wdWJsaXNoLmh0bWwnLFxyXG4gICAgICBjb250cm9sbGVyOiAncHVibGlzaEN0cmwnLFxyXG4gICAgICBzaXplOiAnbGcnLFxyXG4gICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgZGl2OiBmdW5jdGlvbiBkaXYoKSB7XHJcbiAgICAgICAgICByZXR1cm4gJHNjb3BlLnBhRGl2O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGV4dDogZnVuY3Rpb24gdGV4dCgpIHtcclxuICAgICAgICAgIHJldHVybiAkc2NvcGUucGFUZXh0O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGltZTogZnVuY3Rpb24gdGltZSgpIHtcclxuICAgICAgICAgIHJldHVybiAkc2NvcGUucGFUaW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxufSIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnBvcHVwSG9tZXdvcmtDb21tZW50Q3RybC4kaW5qZWN0PVtcIiRzY29wZVwiLFwiJHJvb3RTY29wZVwiLFwiJHVpYk1vZGFsSW5zdGFuY2VcIixcInBhSG9tZXdvcmtcIixcInBhQ2FjaGVcIixcInBcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BvcHVwSG9tZXdvcmtDb21tZW50Q3RybCcsIHBvcHVwSG9tZXdvcmtDb21tZW50Q3RybCk7XHJcblxyXG5mdW5jdGlvbiBwb3B1cEhvbWV3b3JrQ29tbWVudEN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFIb21ld29yaywgcGFDYWNoZSwgcCl7XHJcblxyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIGlmIChwKSB7XHJcbiAgICAgICAgLy8gZWRpdCBvciByZW1vdmVcclxuICAgICAgICAkc2NvcGUuY29tbWVudCA9IGNvbmYuY3VycmVudEhvbWV3b3JrLmNvbW1lbnRzW3AuaV07XHJcbiAgICAgICAgJHNjb3BlLmFjdGlvbiA9IHAuYWN0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5zYXZlQ29tbWVudCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgcGFIb21ld29yay5zYXZlQ29tbWVudChjb25mLmN1cnJlbnRIb21ld29yaywgJHNjb3BlLmNvbW1lbnQpLnRoZW4oZnVuY3Rpb24ocmVzKXtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UocmVzKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS51cGRhdGVDb21tZW50ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBwYUhvbWV3b3JrLnVwZGF0ZUNvbW1lbnQoY29uZi5jdXJyZW50SG9tZXdvcmssIHAuaSwgJHNjb3BlLmNvbW1lbnQpLnRoZW4oZnVuY3Rpb24ocmVzKXtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UocmVzKTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5yZW1vdmVDb21tZW50ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBwYUhvbWV3b3JrLnJlbW92ZUNvbW1lbnQoY29uZi5jdXJyZW50SG9tZXdvcmssIHAuaSkudGhlbihmdW5jdGlvbihyZXMpe1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZShyZXMpO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICAgIH1cclxuXHJcbn0iLCIndXNlIHN0cmljdCc7XHJcblxyXG5wb3B1cEhvbWV3b3JrQ3RybC4kaW5qZWN0PVtcIiRzY29wZVwiLFwiJHJvb3RTY29wZVwiLFwiJHVpYk1vZGFsSW5zdGFuY2VcIixcInBhSG9tZXdvcmtcIixcInBhQ2FjaGVcIixcImhvbWV3b3JrXCIsXCJvcHRpb25zXCIsIFwidG9hc3RlclwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncG9wdXBIb21ld29ya0N0cmwnLCBwb3B1cEhvbWV3b3JrQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwb3B1cEhvbWV3b3JrQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBwYUhvbWV3b3JrLCBwYUNhY2hlLCBob21ld29yaywgb3B0aW9ucywgdG9hc3Rlcil7XHJcblxyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRzY29wZS5jb25mID0gY29uZjtcclxuICAgICRzY29wZS5ob21ld29yayA9IGhvbWV3b3JrO1xyXG4gICAgJHNjb3BlLm9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcblxyXG4gICAgJHNjb3BlLmxvYWRIb21ld29ya3MgPSBmdW5jdGlvbihzdHVkZW50KXtcclxuICAgICAgICBwYUhvbWV3b3JrLmxvYWRIb21ld29ya3Moc3R1ZGVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmFkZFRvSG9tZXdvcmsgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBwYUhvbWV3b3JrLmFkZEhvbWV3b3JrKCRzY29wZS5ob21ld29yaykudGhlbihmdW5jdGlvbihyZXMpe1xyXG4gICAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsICdIb21ld29yaycsICdUYXNrIGFkZGVkIHN1Y2Nlc2Z1bGx5IHRvIGhvbWV3b3JrcycpO1xyXG4gICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5lZGl0SG9tZXdvcmsgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBwYUhvbWV3b3JrLmVkaXRIb21ld29yaygkc2NvcGUuaG9tZXdvcmspLnRoZW4oZnVuY3Rpb24ocmVzKXtcclxuICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCAnSG9tZXdvcmsnLCAnVGFzayBzYXZlZCBzdWNjZXNmdWxseSB0byBob21ld29ya3MnKTtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUucmVtb3ZlSG9tZXdvcmsgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBwYUhvbWV3b3JrLnJlbW92ZUhvbWV3b3JrKCRzY29wZS5ob21ld29yaykudGhlbihmdW5jdGlvbihyZXMpe1xyXG4gICAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsICdIb21ld29yaycsICdUYXNrIHJlbW92ZWQgc3VjY2VzZnVsbHkgZnJvbSBob21ld29ya3MnKTtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gICAgfVxyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wb3B1cE9yZ1N1YnNjcmlwdGlvbkN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiR1aWJNb2RhbEluc3RhbmNlXCIsIFwiJHJvb3RTY29wZVwiLCBcInN1YnNyXCIsIFwicGFUZWFjaGVyXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwb3B1cE9yZ1N1YnNjcmlwdGlvbkN0cmwnLCBwb3B1cE9yZ1N1YnNjcmlwdGlvbkN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcG9wdXBPcmdTdWJzY3JpcHRpb25DdHJsKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsIHN1YnNjciwgcGFUZWFjaGVyKSB7XHJcbiAgICAkc2NvcGUuZm9sZGVyID0gc3Vic3IuZm9sZGVyO1xyXG5cclxuICAgIHBhVGVhY2hlci5nZXRPcmdhbml6YXRpb25UZWFjaGVyc0J5Rm9sZGVyKCRyb290U2NvcGUudXNlci5vcmdhbml6YXRpb24sIHN1YnNjci5mb2xkZXIuaWQpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICRzY29wZS50ZWFjaGVycyA9IHJlc3AuZGF0YTtcclxuICAgICAgICB9KVxyXG5cclxuICAgICRzY29wZS5zZWxlY3QgPSBmdW5jdGlvbih0ZWFjaGVyKXtcclxuICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh7dGVhY2hlcjp0ZWFjaGVyfSk7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuZGlzbWlzcygpO1xyXG4gICAgfVxyXG5cclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucG9wdXBSZXNvdXJjZXNDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHVpYk1vZGFsSW5zdGFuY2VcIiwgXCJwYUNhY2hlXCIsIFwidHlwZVwiLCBcInJlc291cmNlXCIsIFwiJGh0dHBcIiwgXCIkcVwiLCBcImdvb2dsZUFwaUNvbmZpZ1wiLCBcIiRzY2VcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BvcHVwUmVzb3VyY2VzQ3RybCcsIHBvcHVwUmVzb3VyY2VzQ3RybCk7XHJcbmFuZ3VsYXIubW9kdWxlKFwicGFBcHBcIikuZmlsdGVyKCd0cnVzdFRoaXNVcmwnLCBbXCIkc2NlXCIsIGZ1bmN0aW9uICgkc2NlKSB7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uICh2YWwpIHtcclxuICAgIHJldHVybiAkc2NlLnRydXN0QXNSZXNvdXJjZVVybCh2YWwpO1xyXG4gIH07XHJcbn1dKTtcclxuXHJcbmZ1bmN0aW9uIHBvcHVwUmVzb3VyY2VzQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBwYUNhY2hlLCB0eXBlLCByZXNvdXJjZSwgJGh0dHAsICRxLCBnb29nbGVBcGlDb25maWcsICRzY2UpIHtcclxuXHJcbiAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICB2YXIgcGFnZVNjb3BlID0gcGFDYWNoZS5pbml0UGFnZVNjb3BlKCk7XHJcblxyXG4gIHZhciBpbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmNvbmYgPSBjb25mO1xyXG4gICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhZ2VTY29wZTtcclxuXHJcbiAgICAkc2NvcGUuaXNGb2xkZXJBZG1pbiA9ICgkcm9vdFNjb3BlLnVzZXIucm9sZSA9PSAnRScgJiYgY29uZi5jdXJyZW50Rm9sZGVyLmlzQWRtaW4pO1xyXG5cclxuICAgICRzY29wZS5yZXNvdXJjZSA9IHJlc291cmNlO1xyXG4gICAgJHNjb3BlLnR5cGUgPSB0eXBlO1xyXG4gICAgcGFnZVNjb3BlLnIgPSB7fTtcclxuICAgIHBhZ2VTY29wZS5jID0ge1xyXG4gICAgICByZXNvdXJjZXM6IFtdXHJcbiAgICB9O1xyXG4gICAgJHNjb3BlLmdvb2dsZUltYWdlcyA9IFtdXHJcbiAgICAkc2NvcGUubG9hZGluZ0dvb2dsZUltYWdlcyA9IGZhbHNlO1xyXG4gICAgJHNjb3BlLnlvdXR1YmVWaWRlb3MgPSBbXVxyXG4gICAgJHNjb3BlLmxvYWRpbmdZb3V0dWJlVmlkZW9zID0gZmFsc2U7XHJcblxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLm5leHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkc2NvcGUucmVzb3VyY2UuY2hhcnMgPSBbXTtcclxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gcGFnZVNjb3BlLnIudGV4dC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgJHNjb3BlLnJlc291cmNlLmNoYXJzLnB1c2goe1xyXG4gICAgICAgIHZhbDogcGFnZVNjb3BlLnIudGV4dC5jaGFyQXQoaSlcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFkZFRleHQgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgdmFyIGNodW5rcyA9IHBhZ2VTY29wZS5yLnRleHQuc3BsaXQoJyMnKTtcclxuICAgIF8uZWFjaChjaHVua3MsIGZ1bmN0aW9uIChjaHVuaykge1xyXG4gICAgICBjaHVuayA9IGNodW5rLnRyaW0oKTtcclxuICAgICAgdmFyIHJlc291cmNlID0ge1xyXG4gICAgICAgIGNoYXJzOiBbXSxcclxuICAgICAgICB0eXBlOiAndGV4dCdcclxuICAgICAgfTtcclxuICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjaHVuay5sZW5ndGg7IGkgPCBsOyBpKyspIHtcclxuICAgICAgICByZXNvdXJjZS5jaGFycy5wdXNoKHtcclxuICAgICAgICAgIHZhbDogY2h1bmsuY2hhckF0KGkpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgcGFnZVNjb3BlLmMucmVzb3VyY2VzLnB1c2gocmVzb3VyY2UpO1xyXG4gICAgfSlcclxuXHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZShwYWdlU2NvcGUuYyk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFkZEF1ZGlvID0gZnVuY3Rpb24gKCkge1xyXG4gICAgXy5lYWNoKHBhZ2VTY29wZS5jLnJlc291cmNlcywgZnVuY3Rpb24gKHJlcykge1xyXG4gICAgICByZXMudHlwZSA9ICdhdWRpbyc7XHJcbiAgICB9KTtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHBhZ2VTY29wZS5jKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5hZGRWaWRlbyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhZ2VTY29wZS5yLnR5cGUgPSAndmlkZW8nO1xyXG4gICAgcGFnZVNjb3BlLmMucmVzb3VyY2VzLnB1c2gocGFnZVNjb3BlLnIpO1xyXG4gICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UocGFnZVNjb3BlLmMpO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmFkZFVybCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhZ2VTY29wZS5yLnR5cGUgPSAndXJsJztcclxuICAgIHBhZ2VTY29wZS5jLnJlc291cmNlcy5wdXNoKHBhZ2VTY29wZS5yKTtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHBhZ2VTY29wZS5jKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgXy5leHRlbmQoJHNjb3BlLnJlc291cmNlLCBwYWdlU2NvcGUucik7XHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUucmVzb3VyY2UpO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmFkZEltYWdlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIF8uZWFjaChwYWdlU2NvcGUuYy5yZXNvdXJjZXMsIGZ1bmN0aW9uIChyZXMpIHtcclxuICAgICAgcmVzLnR5cGUgPSAnaW1nJztcclxuICAgIH0pO1xyXG5cclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHBhZ2VTY29wZS5jKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuc3VibWl0UXVpY2tJbnNlcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZShwYWdlU2NvcGUudGV4dCk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuc2VhcmNoR29vZ2xlSW1hZ2VzID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgIGlmICghbmFtZSkge1xyXG4gICAgICBhbGVydChcInBsZWFzZSBhZGQgbmFtZVwiKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgJHNjb3BlLmdvb2dsZUltYWdlcyA9IFtdO1xyXG4gICAgICAkc2NvcGUubG9hZGluZ0dvb2dsZUltYWdlcyA9IHRydWVcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBnb29nbGVBcGlDb25maWcubWF4SW1hZ2VzUmVzdWx0cyAvIDEwOyBpKyspIHtcclxuICAgICAgICAkc2NvcGUuc2VhcmNoRW5naW5lKChpICogMTApLCBuYW1lKVxyXG5cclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICAkc2NvcGUuc2VhcmNoRW5naW5lID0gZnVuY3Rpb24gKHBhZ2VOdW0sIHF1ZXJ5KSB7XHJcbiAgICAkaHR0cC5nZXQoZ29vZ2xlQXBpQ29uZmlnLmltYWdlU2VhcmNoVXJsICsgJz9rZXk9JyArIGdvb2dsZUFwaUNvbmZpZy5wcm9qZWN0S2V5ICsgJyZjeD0nICsgZ29vZ2xlQXBpQ29uZmlnLmN4ICsgJyZxPScgKyBxdWVyeSArICcmc2VhcmNoVHlwZT0nICsgZ29vZ2xlQXBpQ29uZmlnLnNlYXJjaFR5cGUgKyAnJnN0YXJ0PScgKyBwYWdlTnVtKVxyXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5zZWFyY2hJbmZvcm1hdGlvbi50b3RhbFJlc3VsdHMgPiAwKSB7XHJcbiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseSgkc2NvcGUuZ29vZ2xlSW1hZ2VzLCByZXNwb25zZS5kYXRhLml0ZW1zKTtcclxuICAgICAgICAgICRzY29wZS5sb2FkaW5nR29vZ2xlSW1hZ2VzID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgfVxyXG5cclxuICAkc2NvcGUuc2V0SW1hZ2VVcmwgPSBmdW5jdGlvbiAoaW1nVXJsKSB7XHJcbiAgICBwYWdlU2NvcGUuci5zcmMgPSBpbWdVcmw7XHJcbiAgICAkc2NvcGUuZ29vZ2xlSW1hZ2VzID0gW107XHJcbiAgfVxyXG5cclxuICAkc2NvcGUudXBkYXRlSW1hZ2VVcmwgPSBmdW5jdGlvbiAoaW1nVXJsKSB7XHJcbiAgICAkc2NvcGUucmVzb3VyY2Uuc3JjID0gaW1nVXJsO1xyXG4gICAgJHNjb3BlLmdvb2dsZUltYWdlcyA9IFtdO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmNoZWNrQW5kU2VhcmNoR29vZ2xlSW1hZ2VzID0gZnVuY3Rpb24gKGtleUV2ZW50LCBuYW1lKSB7XHJcbiAgICBpZiAoa2V5RXZlbnQud2hpY2ggPT09IDEzKSB7XHJcbiAgICAgICRzY29wZS5zZWFyY2hHb29nbGVJbWFnZXMobmFtZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLy95b3V0dWJlIGFwaXNcclxuICAkc2NvcGUuc2VhcmNoWW91dHViZVZpZGVvcyA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICBpZiAoIW5hbWUpIHtcclxuICAgICAgYWxlcnQoXCJwbGVhc2UgYWRkIG5hbWVcIilcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRzY29wZS55b3V0dWJlVmlkZW9zID0gW107XHJcbiAgICAgICRzY29wZS5sb2FkaW5nWW91dHViZVZpZGVvcyA9IHRydWU7XHJcbiAgICAgICRzY29wZS5zZWFyY2hZb3V0dWJlRW5naW5lKG5hbWUpXHJcbiAgICB9XHJcbiAgfVxyXG4gICRzY29wZS5zZWFyY2hZb3V0dWJlRW5naW5lID0gZnVuY3Rpb24gKHF1ZXJ5KSB7XHJcbiAgICAkaHR0cC5nZXQoZ29vZ2xlQXBpQ29uZmlnLnlvdXR1YmVTZWFyY2hVcmwgKyAnP2tleT0nICsgZ29vZ2xlQXBpQ29uZmlnLnByb2plY3RLZXkgKyAnJnE9JyArIHF1ZXJ5ICsgJyZ0eXBlPXZpZGVvJnBhcnQ9c25pcHBldCZtYXhSZXN1bHRzPScgKyBnb29nbGVBcGlDb25maWcubWF4WW91dHViZVZpZGVvUmVzdWx0cylcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEucGFnZUluZm8udG90YWxSZXN1bHRzID4gMCkge1xyXG4gICAgICAgICAgJHNjb3BlLnlvdXR1YmVWaWRlb3MgPSByZXNwb25zZS5kYXRhLml0ZW1zO1xyXG4gICAgICAgICAgJHNjb3BlLnlvdXR1YmVWaWRlb3MuZm9yRWFjaChpdGVtID0+IGl0ZW0udXJsID0gXCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9cIiArIGl0ZW0uaWQudmlkZW9JZClcclxuICAgICAgICAgICRzY29wZS5sb2FkaW5nWW91dHViZVZpZGVvcyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnNldFZpZGVvVXJsID0gZnVuY3Rpb24gKHZpZGVvT2JqKSB7XHJcbiAgICBwYWdlU2NvcGUuci5zcmMgPSB2aWRlb09iai5pZC52aWRlb0lkO1xyXG4gICAgJHNjb3BlLnlvdXR1YmVWaWRlb3MgPSBbXTtcclxuICB9XHJcblxyXG4gICRzY29wZS51cGRhdGVWaWRlb1VybCA9IGZ1bmN0aW9uICh2aWRlb09iaikge1xyXG4gICAgJHNjb3BlLnJlc291cmNlLnNyYyA9IHZpZGVvT2JqLmlkLnZpZGVvSWQ7XHJcbiAgICAkc2NvcGUueW91dHViZVZpZGVvcyA9IFtdO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmNoZWNrQW5kU2VhcmNoWW91dHViZVZpZGVvcyA9IGZ1bmN0aW9uIChrZXlFdmVudCwgbmFtZSkge1xyXG4gICAgaWYgKGtleUV2ZW50LndoaWNoID09PSAxMykge1xyXG4gICAgICAkc2NvcGUuc2VhcmNoWW91dHViZVZpZGVvcyhuYW1lKTtcclxuICAgIH1cclxuICB9XHJcblxyXG5cclxuICBpbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBvcHVwVGVhY2hlclByb2ZpbGVDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcInBhQ2FjaGVcIiwgXCJwYVN1YnNjcmlwdGlvblwiLCBcInBhVGVhY2hlclwiLCBcInRlYWNoZXJcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BvcHVwVGVhY2hlclByb2ZpbGVDdHJsJywgcG9wdXBUZWFjaGVyUHJvZmlsZUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcG9wdXBUZWFjaGVyUHJvZmlsZUN0cmwoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgJHJvb3RTY29wZSwgJGh0dHAsIHBhQ2FjaGUsIHBhU3Vic2NyaXB0aW9uLCBwYVRlYWNoZXIsIHRlYWNoZXIpIHtcclxuICAgICRzY29wZS50ZWFjaGVyID0gdGVhY2hlcjtcclxuXHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgJHNjb3BlLmNvbmYgPSBjb25mO1xyXG5cclxuICAgICRzY29wZS5pbml0ID0gZnVuY3Rpb24oKXtcclxuICAgICAgICBwYVRlYWNoZXIuZ2V0VGVhY2hlck1pcmdvdm9yaXRQcm9maWxlKHRlYWNoZXIuX2lkKS50aGVuKGZ1bmN0aW9uKHByb2ZpbGUpe1xyXG4gICAgICAgICAgICAkc2NvcGUudGVhY2hlci5taXJnb3Zvcml0UHJvZmlsZSA9IHByb2ZpbGU7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcGFUZWFjaGVyLmdldEZvbGRlclN1YnNjcmlwdGlvbnModGVhY2hlcik7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmNvbm5lY3QgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgIHBhU3Vic2NyaXB0aW9uLnNlbmRTdWJzY3JpcHRpb25SZXF1ZXN0KHRlYWNoZXIuX2lkKS50aGVuKGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKHtyZWxvYWQ6dHJ1ZX0pO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLnJldm9rZSA9IGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgcGFTdWJzY3JpcHRpb24ucmV2b2tlU3Vic2NyaXB0aW9uUmVxdWVzdChzdWJzY3IpLnRoZW4oZnVuY3Rpb24oc3Vic2NyKXtcclxuICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2Uoe3JlbG9hZDp0cnVlfSk7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoKTtcclxuICAgIH1cclxuXHJcbiAgICAkc2NvcGUuaW5pdCgpO1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wb3B1cFVubG9ja0ZvbGRlckN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiR1aWJNb2RhbEluc3RhbmNlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiZm9sZGVyXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwb3B1cFVubG9ja0ZvbGRlckN0cmwnLCBwb3B1cFVubG9ja0ZvbGRlckN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcG9wdXBVbmxvY2tGb2xkZXJDdHJsKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRyb290U2NvcGUsICRodHRwLCBmb2xkZXIpIHtcclxuICAgICRzY29wZS5mb2xkZXIgPSBmb2xkZXI7XHJcblxyXG4gICAgJHNjb3BlLmNoZWNrQ2VydGlmaWNhdGUgPSBmdW5jdGlvbihudW1iZXIpe1xyXG4gICAgICAgICRodHRwLmdldCgnL3dzL2NlcnRpZmljYXRlcy8nK251bWJlcikudGhlbihcclxuICAgICAgICAgICAgZnVuY3Rpb24ocmVzcCl7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3AuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcj17bWVzc2FnZTonQ2VydGlmaWNhdGUgbm90IGZvdW5kJ307XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5jZXJ0aWZpY2F0ZT1yZXNwLmRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRhYj0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgfVxyXG4gICAgJHNjb3BlLnVubG9jayA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgaWYgKGZvbGRlci5yZXF1aXJlc0NlcnRpZmljYXRlKXtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3dzL2NlcnRpZmljYXRlcy8nKyRzY29wZS5jZXJ0aWZpY2F0ZS5faWQrJy9yZWdpc3RlcicsIHt0ZWFjaGVyOiRyb290U2NvcGUudXNlci50ZWFjaGVyfSkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICBcclxuXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIHN1YnNjciA9IHtmb2xkZXI6Zm9sZGVyLl9pZCx0ZWFjaGVyOiRyb290U2NvcGUudXNlci50ZWFjaGVyLGFjdGl2ZTp0cnVlfTtcclxuICAgICAgICAgICAgJGh0dHAucG9zdCgnL3dzL2ZvbGRlclN1YnNjcmlwdGlvbnMnLCBzdWJzY3IpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgJHNjb3BlLm5leHQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICRzY29wZS50YWIrPTE7XHJcbiAgICB9XHJcbiAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7XHJcbiAgICB9XHJcblxyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wb3B1cFVzZXJQYXJhbXNDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcInBhU29ja2V0XCIsIFwidXNlclwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncG9wdXBVc2VyUGFyYW1zQ3RybCcsIHBvcHVwVXNlclBhcmFtc0N0cmwpO1xyXG5cclxuZnVuY3Rpb24gcG9wdXBVc2VyUGFyYW1zQ3RybCgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBwYVNvY2tldCwgdXNlcikge1xyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInNhdmVVc2VyUGFyYW1cIiwge1xyXG4gICAgICB1c2VyOiB1c2VyLmlkLFxyXG4gICAgICBuYW1lOiAncG9pbnRzJyxcclxuICAgICAgdmFsdWU6IE51bWJlcih1c2VyLnBhcmFtcy5wb2ludHMpXHJcbiAgICB9KTtcclxuICAgIHBhU29ja2V0LmVtaXQoXCJzYXZlVXNlclBhcmFtXCIsIHtcclxuICAgICAgdXNlcjogdXNlci5pZCxcclxuICAgICAgbmFtZTogJ3RlYW0nLFxyXG4gICAgICB2YWx1ZTogdXNlci5wYXJhbXMudGVhbVxyXG4gICAgfSk7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwic2F2ZVVzZXJQYXJhbVwiLCB7XHJcbiAgICAgIHVzZXI6IHVzZXIuaWQsXHJcbiAgICAgIG5hbWU6ICdtYXJrJyxcclxuICAgICAgdmFsdWU6IHVzZXIucGFyYW1zLm1hcmtcclxuICAgIH0pO1xyXG4gICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuXHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucG9wdXBXYWxscGFwZXJDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncG9wdXBXYWxscGFwZXJDdHJsJywgcG9wdXBXYWxscGFwZXJDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHBvcHVwV2FsbHBhcGVyQ3RybCgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCAkcm9vdFNjb3BlLCAkaHR0cCwgY29uZmlnKSB7XHJcblxyXG4gICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICRzY29wZS5sb2FkQmxvYnMoJ3dhbGxwYXBlcnMvJyk7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLmxvYWRCbG9icyA9IGZ1bmN0aW9uKHByZWZpeCl7XHJcbiAgICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9icm93c2UnLCB7XHJcbiAgICAgICAgICAgIGZvbGRlcjogJ2NkbicsXHJcbiAgICAgICAgICAgIHByZWZpeDogcHJlZml4XHJcbiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5pbWFnZXMgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAocmVzcC5kYXRhLkJsb2IpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5pbWFnZXMgPSBfLm1hcChbXS5jb25jYXQocmVzcC5kYXRhLkJsb2IpLCBmdW5jdGlvbihibG9iKXtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYmxvYi5OYW1lLnN1YnN0cmluZyhibG9iLk5hbWUubGFzdEluZGV4T2YoJy8nKSArIDEsIGJsb2IuTmFtZS5sYXN0SW5kZXhPZignLicpKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3JjOiBjb25maWcuc3RvcmFnZUJhc2VVcmwrXCIvY2RuL1wiICsgYmxvYi5OYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICRzY29wZS5kaXJlY3RvcmllcyA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChyZXNwLmRhdGEuQmxvYlByZWZpeCkge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmRpcmVjdG9yaWVzID0gXy5tYXAoW10uY29uY2F0KHJlc3AuZGF0YS5CbG9iUHJlZml4KSwgZnVuY3Rpb24gKGQpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IGQuTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBkLk5hbWUuc3Vic3RyaW5nKHByZWZpeCA/IHByZWZpeC5sZW5ndGggOiAwLCBkLk5hbWUubGVuZ3RoIC0gMSlcclxuICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgfSk7ICAgICAgICBcclxuICAgIH1cclxuICAgICRzY29wZS5zZWxlY3QgPSBmdW5jdGlvbihpKXtcclxuICAgICAgICAkc2NvcGUuc2VsPWk7XHJcbiAgICAgICAgJHNjb3BlLnNlbGVjdGVkPXRydWU7XHJcbiAgICB9XHJcbiAgICAkc2NvcGUub2sgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5pbWFnZXNbJHNjb3BlLnNlbF0pO1xyXG4gICAgfVxyXG4gICAgJHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCk7XHJcbiAgICB9XHJcbiAgICAkc2NvcGUuaW5pdCgpO1xyXG5cclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucG9wdXBDYXJkQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHVpYk1vZGFsSW5zdGFuY2VcIiwgXCJwYUNhY2hlXCIsIFwicGFTdG9yYWdlXCIsIFwiYmVhblwiLCBcImJsb2JzXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwb3B1cENhcmRDdHJsJywgcG9wdXBDYXJkQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwb3B1cENhcmRDdHJsKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsIHBhQ2FjaGUsIHBhU3RvcmFnZSwgYmVhbiwgYmxvYnMpIHtcclxuICAkc2NvcGUuYmVhbiA9IGJlYW47XHJcbiAgJHNjb3BlLmJsb2JzID0gYmxvYnM7XHJcbiAgJHNjb3BlLmNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuXHJcbiAgdmFyIGdldENoYXJzID0gZnVuY3Rpb24gZ2V0Q2hhcnModGV4dCkge1xyXG4gICAgdmFyIGNoYXJzID0gW107XHJcblxyXG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0ZXh0Lmxlbmd0aDsgaSA8IGw7IGkrKykge1xyXG4gICAgICBjaGFycy5wdXNoKHtcclxuICAgICAgICB2YWw6IHRleHQuY2hhckF0KGkpXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjaGFycztcclxuICB9O1xyXG5cclxuICAkc2NvcGUubG9hZEJsb2JzID0gZnVuY3Rpb24ocHJlZml4KXtcclxuICAgIHBhU3RvcmFnZS5sb2FkQmxvYnMocHJlZml4LCBcImltYWdlL2dpZixpbWFnZS9qcGVnLGltYWdlL3BuZ1wiKVxyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnNlbGVjdCA9IGZ1bmN0aW9uKHIpIHtcclxuICAgIF8uZXh0ZW5kKGJlYW4scik7XHJcbiAgfVxyXG4gICRzY29wZS5zYXZlQmVhbiA9IGZ1bmN0aW9uIChiZWFuKSB7XHJcbiAgICBpZiAoYmVhbi50eXBlID09ICd0ZXh0JyAmJiAhYmVhbi5jaGFycykge1xyXG4gICAgICBiZWFuLmNoYXJzID0gZ2V0Q2hhcnMoYmVhbi50bXApO1xyXG4gICAgICBkZWxldGUgYmVhbi50bXA7XHJcbiAgICB9XHJcblxyXG4gICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoYmVhbik7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcbn1cclxuXHJcbjsiLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBvc3RzQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHVpYk1vZGFsXCIsIFwicGFTb2NrZXRcIiwgXCJwYUNhY2hlXCIsIFwidG9hc3RlclwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncG9zdHNDb250cm9sbGVyJywgcG9zdHNDb250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIHBvc3RzQ29udHJvbGxlcigkc2NvcGUsICRodHRwLCAkcm9vdFNjb3BlLCAkdWliTW9kYWwsIHBhU29ja2V0LCBwYUNhY2hlLCB0b2FzdGVyLCBjb25maWcpIHtcclxuICAkc2NvcGUuYW5pbWF0ZUVsZW1lbnRJbiA9IGZ1bmN0aW9uICgkZWwpIHtcclxuICAgICRlbC5yZW1vdmVDbGFzcygnbm90LXZpc2libGUnKTtcclxuICAgICRlbC5hZGRDbGFzcygnYW5pbWF0ZWQgem9vbUluJyk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmFuaW1hdGVFbGVtZW50T3V0ID0gZnVuY3Rpb24gKCRlbCkge1xyXG4gICAgJGVsLmFkZENsYXNzKCdub3QtdmlzaWJsZScpO1xyXG4gICAgJGVsLnJlbW92ZUNsYXNzKCdhbmltYXRlZCB6b29tSW4nKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2Nyb2xsVG9FbGVtZW50ID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICBwYVNvY2tldC5lbWl0KFwic2Nyb2xsXCIsIGlkKTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5nZXRQb3N0cygpO1xyXG4gICAgJGh0dHAuZ2V0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3ZrL2dldFVzZXInKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgIGlmIChyZXNwLmRhdGEuZXJyb3IpIHtcclxuICAgICAgICAkc2NvcGUuYXV0aCA9IHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJHNjb3BlLnZrVXNlciA9IHJlc3AuZGF0YVswXTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmdldFBvc3RzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgIHZhciBzdHVkZW50ID0gJHJvb3RTY29wZS51c2VyLnN0dWRlbnQgfHwgY29uZi5hc1N0dWRlbnQuX2lkO1xyXG4gICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy9nZXRQb3N0cycsIHtcclxuICAgICAgc3R1ZGVudDogc3R1ZGVudFxyXG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUucG9zdHMgPSByZXNwLmRhdGE7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5pdCgpO1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYVByb2ZpbGVDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCJwYUNhY2hlXCIsIFwicGFUZWFjaGVyXCIsIFwidG9hc3RlclwiLCBcImNvbmZpZ1wiLCBcImNvdW50cmllc1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFQcm9maWxlQ3RybCcsIHBhUHJvZmlsZUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFQcm9maWxlQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkc3RhdGUsIHBhQ2FjaGUsIHBhVGVhY2hlciwgdG9hc3RlciwgY29uZmlnLCBjb3VudHJpZXMpIHtcclxuICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gIHZhciBwYWdlU2NvcGUgPSBwYUNhY2hlLmluaXRQYWdlU2NvcGUoKTtcclxuXHJcbiAgdmFyIGluaXQgPSBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgJHNjb3BlLmNvdW50cmllcz1jb3VudHJpZXM7XHJcbiAgICAkc2NvcGUudGVhY2hlciA9IF8uY2xvbmUoY29uZi50ZWFjaGVyKTtcclxuICAgIGlmICghJHNjb3BlLnRlYWNoZXIuYWRkcmVzcyl7XHJcbiAgICAgICRzY29wZS50ZWFjaGVyLmFkZHJlc3M9e307XHJcbiAgICB9XHJcbiAgICAkc2NvcGUudXNlciA9IF8uY2xvbmUoJHJvb3RTY29wZS51c2VyKTtcclxuICAgIGxvYWRPcGVudG9rKCk7XHJcbiAgICAkc2NvcGUucGFnZVNjb3BlID0gcGFnZVNjb3BlO1xyXG4gICAgcGFUZWFjaGVyLmxvYWRDZXJ0aWZpY2F0ZXMoY29uZi50ZWFjaGVyLl9pZCk7XHJcbiAgICBwYVRlYWNoZXIuZ2V0VmtQcm9maWxlKCRyb290U2NvcGUudXNlci5pZCk7XHJcbiAgICBwYVRlYWNoZXIuZ2V0TWlyZ292b3JpdFByb2ZpbGUoJHJvb3RTY29wZS51c2VyLmlkKTtcclxuICAgIHBhVGVhY2hlci5nZXRab29tUHJvZmlsZSgkcm9vdFNjb3BlLnVzZXIuaWQpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zYXZlUHJvZmlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvc2F2ZVRlYWNoZXIvJyArICRzY29wZS50ZWFjaGVyLl9pZCwgJHNjb3BlLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgY29uZi50ZWFjaGVyID0gcmVzcC5kYXRhO1xyXG4gICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdwcm9maWxlJyk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICB2YXIgbG9hZE9wZW50b2sgPSBmdW5jdGlvbiBsb2FkT3BlbnRvaygpIHtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9vcGVudG9rQ2xpZW50LycgKyAkc2NvcGUudGVhY2hlci5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLm9wZW50b2tDbGllbnQgPSByZXNwLmRhdGE7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuc2F2ZU9wZW50b2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL29wZW50b2tDbGllbnQnLCAkc2NvcGUub3BlbnRva0NsaWVudCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsICdPcGVudG9rJywgJ09wZW50b2sgcHJvZmlsZSBzYXZlZCcpO1xyXG4gICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdwcm9maWxlJyk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICBpbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnJhbmRvbVdvcmRzQ29udHJvbGxlci4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkc3RhdGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwicGFTb2NrZXRcIiwgXCJwYVNlcnZpY2VcIiwgXCJwYUNhY2hlXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdyYW5kb21Xb3Jkc0NvbnRyb2xsZXInLCByYW5kb21Xb3Jkc0NvbnRyb2xsZXIpO1xyXG5cclxuZnVuY3Rpb24gcmFuZG9tV29yZHNDb250cm9sbGVyKCRzY29wZSwgJGh0dHAsICRzdGF0ZSwgJHJvb3RTY29wZSwgcGFTb2NrZXQsIHBhU2VydmljZSwgcGFDYWNoZSwgY29uZmlnKSB7XHJcbiAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIHBhU29ja2V0LnJlbW92ZUFsbExpc3RlbmVycygpO1xyXG4gIH0pO1xyXG5cclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5kYXRhID0gcGFTZXJ2aWNlLmluaXQoKTtcclxuXHJcbiAgICBpZiAoJHJvb3RTY29wZS5hZG1pbikge1xyXG4gICAgICBwYVNlcnZpY2UuZmluZFRleHQoKS50aGVuKGZ1bmN0aW9uIChjb2xsKSB7XHJcbiAgICAgICAgdmFyIHdvcmRzID0gXy5zaHVmZmxlKHBhU2VydmljZS5zcGxpdChjb2xsLmNoYXJzLCAnLCcpKTtcclxuXHJcbiAgICAgICAgcGFTb2NrZXQuZW1pdCgnd29yZHMnLCB3b3Jkcyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXRCb2FyZHMgPSBmdW5jdGlvbiAobikge1xyXG4gICAgcGFTb2NrZXQuZW1pdChcInZhclwiLCB7XHJcbiAgICAgIFwidmFyXCI6ICdib2FyZHMnLFxyXG4gICAgICB2YWw6IG5cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhUm9vbUN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzY2VcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcInBhU29ja2V0XCIsIFwicGFDaGFubmVsXCIsIFwicGFDYWNoZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFSb29tQ3RybCcsIHBhUm9vbUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFSb29tQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkc2NlLCAkdWliTW9kYWxJbnN0YW5jZSwgcGFTb2NrZXQsIHBhQ2hhbm5lbCwgcGFDYWNoZSwgY29uZmlnKSB7XHJcblxyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcblxyXG4gICRzY29wZS5pbml0PWZ1bmN0aW9uKCl7XHJcbiAgICAkc2NvcGUuY29uZj1jb25mO1xyXG4gICAgJHNjb3BlLmxvYWRTdWJzY3JpcHRpb25zKCk7XHJcbiAgICAkc2NvcGUubG9hZEdyb3VwcygpO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmxvYWRTdWJzY3JpcHRpb25zID0gZnVuY3Rpb24oKXtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kVXNlclN1YnNjcmlwdGlvbnMvJyArICRyb290U2NvcGUudXNlci50ZWFjaGVyKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgIHZhciB1c2Vycz1fLmluZGV4QnkocmVzcC5kYXRhLCdzdHVkZW50Jyk7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy9maW5kU3Vic2NyaXB0aW9ucy8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAkc2NvcGUuc3Vic2NyaXB0aW9ucyA9IF8uZmlsdGVyKHJlc3AuZGF0YSxmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAgICAgcmV0dXJuIF8uaGFzKHVzZXJzLHN1YnNjci5zdHVkZW50Ll9pZCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXy5lYWNoKCRzY29wZS5zdWJzY3JpcHRpb25zLCBmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAgICAgc3Vic2NyLmFjdGl2ZT0oc3Vic2NyLnN0dWRlbnQuY2hhbm5lbCE9bnVsbCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gICRzY29wZS5zYXZlU3Vic2NyaXB0aW9ucyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHBhQ2hhbm5lbC5zYXZlU3Vic2NyaXB0aW9ucygkc2NvcGUuc3Vic2NyaXB0aW9ucykudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgcGFTb2NrZXQuZW1pdCgncmVsb2FkQ2hhbm5lbCcsIG51bGwpO1xyXG4gICAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5sb2FkR3JvdXBzID0gZnVuY3Rpb24oKXtcclxuICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy90ZWFjaGVycy8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIgKyAnL2dyb3VwcycpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLmdyb3VwcyA9IHJlc3AuZGF0YTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnRvZ2dsZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXApe1xyXG4gICAgaWYgKCRzY29wZS5zZWxlY3RlZEdyb3VwICYmIGdyb3VwLl9pZD09JHNjb3BlLnNlbGVjdGVkR3JvdXAuX2lkKSB7XHJcbiAgICAgICRzY29wZS5zZWxlY3RlZEdyb3VwPW51bGw7XHJcbiAgICAgIF8uZWFjaCgkc2NvcGUuc3Vic2NyaXB0aW9ucywgZnVuY3Rpb24oc3Vic2NyKXtcclxuICAgICAgICBzdWJzY3IuYWN0aXZlPWZhbHNlO1xyXG4gICAgICB9KVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgJHNjb3BlLnNlbGVjdGVkR3JvdXA9Z3JvdXA7XHJcbiAgICAgICRodHRwLmdldCgnL3dzL2dyb3Vwcy8nK2dyb3VwLl9pZCsnL3N1YnNjcmlwdGlvbnMnKS50aGVuKGZ1bmN0aW9uKHJlc3Ape1xyXG4gICAgICAgIHZhciBncm91cEluZGV4ID0gXy5pbmRleEJ5KHJlc3AuZGF0YSwgJ3N0dWRlbnQnKTtcclxuICAgICAgICBfLmVhY2goJHNjb3BlLnN1YnNjcmlwdGlvbnMsIGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgICAgICBzdWJzY3IuYWN0aXZlPV8uaGFzKGdyb3VwSW5kZXgsIHN1YnNjci5zdHVkZW50Ll9pZCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5zZW5kRW1haWwgPSBmdW5jdGlvbihlbWFpbCl7XHJcbiAgICB2YXIgYm9keT17XHJcbiAgICAgICAgdG86IHtcclxuICAgICAgICAgIGVtYWlsOiBlbWFpbFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGVtcGxhdGU6ICdpbnZpdGUnLFxyXG4gICAgICAgIG9wdHM6e1xyXG4gICAgICAgICAgJyROQU1FJzogY29uZi50ZWFjaGVyLm5hbWUgKyAnICcgKyBjb25mLnRlYWNoZXIuc3VybmFtZSxcclxuICAgICAgICAgICckQ0hBTk5FTCc6IGNvbmYuY2hhbm5lbC5faWRcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAkaHR0cC5wb3N0KCcvd3MvZW1haWwvc2VuZFRvJywgYm9keSkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgJHNjb3BlLnRhYj0xO1xyXG4gICAgfSlcclxuICB9XHJcblxyXG4gICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhU2NvcmVDdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcInVuaXRcIiwgXCJmb2xkZXJcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhU2NvcmVDdHJsJywgcGFTY29yZUN0cmwpO1xyXG5cclxuZnVuY3Rpb24gcGFTY29yZUN0cmwoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgdW5pdCwgZm9sZGVyKSB7XHJcbiAgJHNjb3BlLnVuaXQgPSB1bml0O1xyXG4gICRzY29wZS5mb2xkZXIgPSBmb2xkZXI7XHJcblxyXG4gICRzY29wZS5vayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhU3R1ZGVudEN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkc3RhdGVcIiwgXCIkaHR0cFwiLCBcInBhQ2FjaGVcIiwgXCJwYVN0dWRlbnRcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhU3R1ZGVudEN0cmwnLCBwYVN0dWRlbnRDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHBhU3R1ZGVudEN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkc3RhdGUsICRodHRwLCBwYUNhY2hlLCBwYVN0dWRlbnQsIGNvbmZpZykge1xyXG4gIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgdmFyIHBhZ2VTY29wZSA9IHBhQ2FjaGUuZ2V0UGFnZVNjb3BlKCk7XHJcblxyXG4gIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcclxuICAgICRzY29wZS5jb25mID0gY29uZjtcclxuICAgICRzY29wZS5wYWdlU2NvcGUgPSBwYWdlU2NvcGU7XHJcblxyXG4gICAgaWYgKCRzdGF0ZS5wYXJhbXMuaWQpIHtcclxuICAgICAgJHNjb3BlLnRhYj0nZWRpdFN0dWRlbnQnO1xyXG4gICAgICBwYVN0dWRlbnQuZWRpdFN0dWRlbnQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRzY29wZS50YWI9J2FkZFN0dWRlbnQnO1xyXG4gICAgICBwYVN0dWRlbnQuYWRkU3R1ZGVudCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHBhU3R1ZGVudC5sb2FkRm9sZGVycygpO1xyXG4gICAgLy9wYVN0dWRlbnQuZ2V0R3JvdXBzKCk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLm9rID0gZnVuY3Rpb24oKXtcclxuICAgIHBhU3R1ZGVudC5zYXZlT3JVcGRhdGUoKTtcclxuICB9XHJcblxyXG4gICRzY29wZS5pbXBvcnRTdHVkZW50ID0gZnVuY3Rpb24oKXtcclxuICAgIHBhU3R1ZGVudC5maW5kU3R1ZGVudChwYWdlU2NvcGUuc3R1ZGVudC5pZCkudGhlbihmdW5jdGlvbihzdHVkZW50KXtcclxuICAgICAgaWYgKHN0dWRlbnQpe1xyXG4gICAgICAgICRzY29wZS5zZWxlY3RlZFN0dWRlbnQ9c3R1ZGVudDtcclxuICAgICAgICAkc2NvcGUudGFiPVwiY29uZmlybUltcG9ydFwiO1xyXG4gICAgICAgICRzY29wZS5zdHVkZW50Tm90Rm91bmQgPSB1bmRlZmluZWQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJHNjb3BlLnN0dWRlbnROb3RGb3VuZCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLnVwZGF0ZVN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgc3Vic2NyID0ge1xyXG4gICAgICB0ZWFjaGVyOiAkcm9vdFNjb3BlLnVzZXIudGVhY2hlcixcclxuICAgICAgc3R1ZGVudDogJHNjb3BlLnNlbGVjdGVkU3R1ZGVudC5faWRcclxuICAgIH1cclxuXHJcbiAgICBwYVN0dWRlbnQudXBkYXRlU3Vic2NyaXB0aW9uKHN1YnNjcikudGhlbihmdW5jdGlvbihzdWJzY3Ipe1xyXG4gICAgICAkc2NvcGUuYmFjaygpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUuYmFjayA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG4gICAgdmFyIHRvID0gKGNvbmYub3JnYW5pemF0aW9uKT8nb3JnLXN0dWRlbnRzJzonc3R1ZGVudHMnO1xyXG4gICAgJHN0YXRlLmdvKHRvKTtcclxuICB9XHJcbiAgaW5pdCgpO1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYVN0dWRlbnRzQ3RybC4kaW5qZWN0ID0gW1wiJHNjb3BlXCIsIFwiJHJvb3RTY29wZVwiLCBcIiRodHRwXCIsIFwiJHVpYk1vZGFsXCIsIFwiJHN0YXRlXCIsIFwicGFDYWNoZVwiLCBcInBhU3R1ZGVudFwiLCBcInBhU3Vic2NyaXB0aW9uXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYVN0dWRlbnRzQ3RybCcsIHBhU3R1ZGVudHNDdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHBhU3R1ZGVudHNDdHJsKCRzY29wZSwgJHJvb3RTY29wZSwgJGh0dHAsICR1aWJNb2RhbCwgJHN0YXRlLCBwYUNhY2hlLCBwYVN0dWRlbnQsIHBhU3Vic2NyaXB0aW9uLCBjb25maWcpIHtcclxuICB2YXIgcGFnZVNjb3BlID0gcGFDYWNoZS5pbml0UGFnZVNjb3BlKCk7XHJcbiAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuXHJcbiAgdmFyIGluaXQgPSBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhZ2VTY29wZTtcclxuICAgICRzY29wZS5jb25mID0gY29uZjtcclxuICAgIGlmIChjb25mLnRlYWNoZXIub3JnYW5pemF0aW9uKXtcclxuICAgICAgcGFTdHVkZW50LmdldE9yZ2FuaXphdGlvblN0dWRlbnRzKGNvbmYudGVhY2hlci5vcmdhbml6YXRpb24uX2lkKTtcclxuICAgICAgcGFTdHVkZW50LmdldE9yZ2FuaXphdGlvbkdyb3Vwcyhjb25mLnRlYWNoZXIub3JnYW5pemF0aW9uLl9pZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBwYVN0dWRlbnQuZ2V0U3Vic2NyaXB0aW9ucygpO1xyXG4gICAgICBwYVN0dWRlbnQuZ2V0R3JvdXBzKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnJlbW92ZVN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uIChzdWJzY3JpcHRpb24pIHtcclxuICAgIHZhciBtb2RhbEluc3RhbmNlID0gJHVpYk1vZGFsLm9wZW4oe1xyXG4gICAgICBhbmltYXRpb246IHRydWUsXHJcbiAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmNvbmZpcm0uaHRtbCcsXHJcbiAgICAgIGNvbnRyb2xsZXI6ICdwYUNvbmZpcm1DdHJsJyxcclxuICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgIG1lc3NhZ2U6IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICByZXR1cm4gJ0FyZSB5b3Ugc3VyZT8nXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICBwYVN0dWRlbnQucmVtb3ZlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbik7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuYWNjZXB0ID0gZnVuY3Rpb24oc3Vic2NyKXtcclxuICAgIHBhU3Vic2NyaXB0aW9uLmFjY2VwdFN1YnNjcmlwdGlvblJlcXVlc3Qoc3Vic2NyKS50aGVuKGZ1bmN0aW9uKHN1YnNjcil7XHJcbiAgICAgIHBhU3R1ZGVudC5nZXRTdWJzY3JpcHRpb25zKCk7XHJcbiAgICAgIHBhU3Vic2NyaXB0aW9uLmxvYWRQZW5kaW5nU3Vic2NyaXB0aW9ucygpO1xyXG4gICAgfSlcclxuICB9XHJcblxyXG4gICRzY29wZS5zdWJzY3JpYmVTdHVkZW50ID0gZnVuY3Rpb24oc3R1ZGVudCl7XHJcbiAgICBwYVN0dWRlbnQuc3Vic2NyaWJlU3R1ZGVudChjb25mLnRlYWNoZXIuX2lkLCBzdHVkZW50Ll9pZCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgcGFTdHVkZW50LmdldE9yZ2FuaXphdGlvblN0dWRlbnRzKGNvbmYudGVhY2hlci5vcmdhbml6YXRpb24uX2lkKTtcclxuICAgIH0pXHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnN1YnNjcmliZUdyb3VwID0gZnVuY3Rpb24oZ3JvdXApe1xyXG4gICAgcGFTdHVkZW50LnN1YnNjcmliZUdyb3VwKGNvbmYudGVhY2hlci5faWQsIGdyb3VwLl9pZCkudGhlbihmdW5jdGlvbihyZXNwKXtcclxuICAgICAgcGFTdHVkZW50LmdldE9yZ2FuaXphdGlvblN0dWRlbnRzKGNvbmYudGVhY2hlci5vcmdhbml6YXRpb24uX2lkKTtcclxuICAgICAgcGFTdHVkZW50LmdldE9yZ2FuaXphdGlvbkdyb3Vwcyhjb25mLnRlYWNoZXIub3JnYW5pemF0aW9uLl9pZCk7XHJcbiAgICB9KVxyXG4gIH07XHJcblxyXG4gIGluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFTdHlsZUNvbnRyb2xsZXIuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRzdGF0ZVwiLCBcIiRzdGF0ZVBhcmFtc1wiLCBcIiR1aWJNb2RhbFwiLCBcInBhU3R5bGVcIiwgXCJwYUNhY2hlXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYVN0eWxlQ29udHJvbGxlcicsIHBhU3R5bGVDb250cm9sbGVyKTtcclxuXHJcbmZ1bmN0aW9uIHBhU3R5bGVDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICR1aWJNb2RhbCwgcGFTdHlsZSwgcGFDYWNoZSkge1xyXG5cclxuICAgICRzY29wZS5mb250RmFtaWxpZXMgPSBbJ1NlZ29lIFVJJywgJ0dlb3JnaWEnLCAnUGFsYXRpbm8gTGlub3R5cGUnLCAnQm9vayBBbnRpcXVhJywgJ1RpbWVzIE5ldyBSb21hbicsICdBcmlhbCcsICdIZWx2ZXRpY2EnLCAnQXJpYWwgQmxhY2snLCAnSW1wYWN0JywgJ0x1Y2lkYSBTYW5zIFVuaWNvZGUnLCAnVGFob21hJywgJ1ZlcmRhbmEnLCAnQ291cmllciBOZXcnLCAnTHVjaWRhIENvbnNvbGUnLCAnU2Fucy1zZXJpZicsICdDb21pYyBTYW5zIE1TJywgJ2luaXRpYWwnXTtcclxuICAgICRzY29wZS5mb250U2l6ZXMgPSBbJ25vcm1hbCcsICdzbWFsbCcsICdsYXJnZSddO1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRzY29wZS5jb25mID0gY29uZjtcclxuXHJcbiAgICAkc2NvcGUuc2F2ZVN0eWxlPWZ1bmN0aW9uKGNzcyl7XHJcbiAgICAgICAgcGFTdHlsZS5zYXZlU3R5bGUoY3NzKTtcclxuICAgIH1cclxuICAgICRzY29wZS5yZW1vdmVTdHlsZT1mdW5jdGlvbihjc3Mpe1xyXG4gICAgICBwYVN0eWxlLnJlbW92ZVN0eWxlKGNzcyk7XHJcbiAgICB9XHJcbiAgICAkc2NvcGUucG9wdXBXYWxscGFwZXJzID0gZnVuY3Rpb24oY3NzKXtcclxuICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkdWliTW9kYWwub3Blbih7XHJcbiAgICAgICAgYW5pbWF0aW9uOiB0cnVlLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BvcHVwLndhbGxwYXBlcnMuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogJ3BvcHVwV2FsbHBhcGVyQ3RybCcsXHJcbiAgICAgICAgc2l6ZTogJ2xnJ1xyXG4gICAgICB9KTtcclxuICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbihibG9iKSB7XHJcbiAgICAgICAgY3NzLnN0eWxlWydiYWNrZ3JvdW5kJ109J2xpbmVhci1ncmFkaWVudChyZ2JhKDI1NSwyNTUsMjU1LC44KSwgcmdiYSgyNTUsMjU1LDI1NSwuOCkpLCB1cmwoXCInK2Jsb2Iuc3JjKydcIiknXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIFxyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYVVubG9ja0N0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiR3aW5kb3dcIiwgXCJwYUNhY2hlXCIsIFwid2ViaW5hclNlcnZpY2VcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3BhVW5sb2NrQ3RybCcsIHBhVW5sb2NrQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYVVubG9ja0N0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkaHR0cCwgJHdpbmRvdywgcGFDYWNoZSwgd2ViaW5hclNlcnZpY2UsIGNvbmZpZykge1xyXG5cclxuICB2YXIgcGFnZVNjb3BlID0gcGFDYWNoZS5pbml0UGFnZVNjb3BlKCk7XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLnBhZ2VTY29wZSA9IHBhZ2VTY29wZTtcclxuICAgICRzY29wZS5sb2FkQ291cnNlcygpO1xyXG4gICAgaWYoJHJvb3RTY29wZS51c2VyLnJvbGU9PSdPJyl7XHJcbiAgICAgICRzY29wZS51bmxvY2tPcmdhbml6YXRpb24oKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICRzY29wZS51bmxvY2tUZWFjaGVyKCk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLm5leHQgPSBmdW5jdGlvbigpe1xyXG4gICAgJHNjb3BlLnRhYj0xO1xyXG4gIH1cclxuICBcclxuICAkc2NvcGUubG9hZENvdXJzZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvcHJvZHVjdHMnKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS5wcm9kdWN0cyA9IHJlc3AuZGF0YTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS51bmxvY2tUZWFjaGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3MvbmV3UGF5bWVudC8nICsgJHJvb3RTY29wZS51c2VyLnRlYWNoZXIgKyAnL3VubG9jaycpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHNjb3BlLnBheW1lbnQgPSByZXNwLmRhdGE7XHJcbiAgICAgICRzY29wZS5wYXltZW50LmVtYWlsID0gY29uZi50ZWFjaGVyLmVtYWlsO1xyXG4gICAgICAkc2NvcGUucGF5bWVudC5mdWxsbmFtZSA9IGNvbmYudGVhY2hlci5zdXJuYW1lICsgJyAnICsgY29uZi50ZWFjaGVyLm5hbWU7XHJcblxyXG4gICAgICBpZiAoY29uZi50ZWFjaGVyLm1pZGRsZSkge1xyXG4gICAgICAgICRzY29wZS5wYXltZW50LmZ1bGxuYW1lICs9ICcgJyArIGNvbmYudGVhY2hlci5taWRkbGU7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUudW5sb2NrT3JnYW5pemF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICRodHRwLnBvc3QoY29uZmlnLmFwaVVybCArICcvd3Mvb3JnYW5pemF0aW9ucy8nICsgJHJvb3RTY29wZS51c2VyLm9yZ2FuaXphdGlvbiArICcvdW5sb2NrJykudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUucGF5bWVudCA9IHJlc3AuZGF0YTtcclxuICAgICAgJHNjb3BlLnBheW1lbnQuZW1haWwgPSBjb25mLnRlYWNoZXIuZW1haWw7XHJcbiAgICAgICRzY29wZS5wYXltZW50LmZ1bGxuYW1lID0gY29uZi50ZWFjaGVyLnN1cm5hbWUgKyAnICcgKyBjb25mLnRlYWNoZXIubmFtZTtcclxuXHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuY2hlY2tvdXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5wb3N0KGNvbmZpZy5hcGlVcmwgKyAnL3dzL3BheW1lbnRzLycgKyAkc2NvcGUucGF5bWVudC5faWQgKyAnL2NoZWNrb3V0L2F4ZXJ2ZScsICRzY29wZS5wYXltZW50KS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICR3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlc3AuZGF0YS5mb3JtVXJsO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFWaWRlb0N0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiRyb290U2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzY2VcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcImNvbmZpZ1wiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuY29udHJvbGxlcigncGFWaWRlb0N0cmwnLCBwYVZpZGVvQ3RybCk7XHJcblxyXG5mdW5jdGlvbiBwYVZpZGVvQ3RybCgkc2NvcGUsICRyb290U2NvcGUsICRodHRwLCAkc2NlLCAkdWliTW9kYWxJbnN0YW5jZSwgY29uZmlnKSB7XHJcbiAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAkaHR0cC5nZXQoY29uZmlnLmFwaVVybCArICcvd3MvdmlkZW8nKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICRzY29wZS52aWRlb3MgPSByZXNwLmRhdGE7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUucGxheVZpZGVvID0gZnVuY3Rpb24gKHZpZGVvKSB7XHJcbiAgICAkc2NvcGUudmlkZW9Tb3VyY2UgPSAkc2NlLnRydXN0QXNSZXNvdXJjZVVybCh2aWRlby5zcmMpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5pbml0KCk7XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbndlYmluYXJTdWJzY3JpcHRpb25DdHJsLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJGh0dHBcIiwgXCIkdWliTW9kYWxJbnN0YW5jZVwiLCBcInBhQ2FjaGVcIiwgXCJ3ZWJpbmFyU2VydmljZVwiLCBcImNvbmZpZ1wiLCBcIndlYmluYXJTdWJzY3JpcHRpb25cIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3dlYmluYXJTdWJzY3JpcHRpb25DdHJsJywgd2ViaW5hclN1YnNjcmlwdGlvbkN0cmwpO1xyXG5cclxuZnVuY3Rpb24gd2ViaW5hclN1YnNjcmlwdGlvbkN0cmwoJHNjb3BlLCAkcm9vdFNjb3BlLCAkaHR0cCwgJHVpYk1vZGFsSW5zdGFuY2UsIHBhQ2FjaGUsIHdlYmluYXJTZXJ2aWNlLCBjb25maWcsIHdlYmluYXJTdWJzY3JpcHRpb24pIHtcclxuXHJcbiAgdmFyIHBhZ2VTY29wZSA9IHBhQ2FjaGUuaW5pdFBhZ2VTY29wZSgpO1xyXG5cclxuICB2YXIgaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5wYWdlU2NvcGUgPSBwYWdlU2NvcGU7XHJcbiAgICAkc2NvcGUuc3Vic2NyID0gd2ViaW5hclN1YnNjcmlwdGlvbjtcclxuICAgIHdlYmluYXJTZXJ2aWNlLmxvYWRXZWJpbmFycygpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZXRUYWIgPSBmdW5jdGlvbiAodGFiKSB7XHJcbiAgICAkc2NvcGUudGFiID0gdGFiO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5zZWxlY3RXZWJpbmFyID0gZnVuY3Rpb24od2ViaW5hcil7XHJcbiAgICAgICRzY29wZS50YWIgPSAxO1xyXG4gICAgICAkc2NvcGUuc2VsV2ViaW5hciA9IHdlYmluYXI7XHJcbiAgfVxyXG5cclxuICAkc2NvcGUudXBkYXRlU3Vic2NyaXB0aW9uID0gZnVuY3Rpb24od2ViaW5hcil7XHJcbiAgICAkc2NvcGUuc3Vic2NyLndlYmluYXIgPSB3ZWJpbmFyO1xyXG4gICAgd2ViaW5hclNlcnZpY2UudXBkYXRlU3Vic2NyaXB0aW9uKCRzY29wZS5zdWJzY3IpLnRoZW4oZnVuY3Rpb24oc3Vic2NyKXtcclxuICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAkdWliTW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICB9XHJcblxyXG4gIGluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxud29yZFJhY2VDb250cm9sbGVyLiRpbmplY3QgPSBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRzdGF0ZVwiLCBcIiRyb290U2NvcGVcIiwgXCJwYVNvY2tldFwiLCBcInBhU2VydmljZVwiLCBcInBhQ2FjaGVcIiwgXCJjb25maWdcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmNvbnRyb2xsZXIoJ3dvcmRSYWNlQ29udHJvbGxlcicsIHdvcmRSYWNlQ29udHJvbGxlcik7XHJcblxyXG5mdW5jdGlvbiB3b3JkUmFjZUNvbnRyb2xsZXIoJHNjb3BlLCAkaHR0cCwgJHN0YXRlLCAkcm9vdFNjb3BlLCBwYVNvY2tldCwgcGFTZXJ2aWNlLCBwYUNhY2hlLCBjb25maWcpIHtcclxuICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgcGFTb2NrZXQucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XHJcbiAgfSk7XHJcblxyXG4gICRzY29wZS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgJHNjb3BlLmRhdGEgPSBwYVNlcnZpY2UuaW5pdCgpO1xyXG4gICAgcGFTZXJ2aWNlLmZpbmRUZXh0KCkudGhlbihmdW5jdGlvbiAoY29sbCkge1xyXG4gICAgICB2YXIgbGluZXMgPSBwYVNlcnZpY2Uuc3BsaXQoY29sbC5jaGFycywgJ1xcbicpO1xyXG4gICAgICB2YXIgY29uZiA9IHBhQ2FjaGUuZ2V0Q29uZigpO1xyXG5cclxuICAgICAgdmFyIG15SW5kZXggPSBfLmZpbmRJbmRleChjb25mLnJvb20udXNlcnMsIGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIHVzZXIudXNlcm5hbWUgPT0gJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgICRzY29wZS5kYXRhLm15V29yZHMgPSBwYVNlcnZpY2Uuc3BsaXQobGluZXNbbXlJbmRleF0uY2hhcnMsICcsJyk7XHJcblxyXG4gICAgICBpZiAoJHJvb3RTY29wZS5hZG1pbikge1xyXG4gICAgICAgIHZhciBhbGxXb3JkcyA9IFtdO1xyXG5cclxuICAgICAgICBfLmVhY2gobGluZXMsIGZ1bmN0aW9uIChsaW5lKSB7XHJcbiAgICAgICAgICB2YXIgd29yZHMgPSBwYVNlcnZpY2Uuc3BsaXQobGluZS5jaGFycywgJywnKTtcclxuICAgICAgICAgIGFsbFdvcmRzID0gYWxsV29yZHMuY29uY2F0KHdvcmRzKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcGFTb2NrZXQuZW1pdCgnd29yZHMnLCBfLnNodWZmbGUoYWxsV29yZHMpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmluaXQoKTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFXb3JrcGxhbkN0cmwuJGluamVjdCA9IFtcIiRzY29wZVwiLCBcIiR1aWJNb2RhbEluc3RhbmNlXCIsIFwiJGh0dHBcIiwgXCJkYXRhXCIsIFwiY29uZmlnXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5jb250cm9sbGVyKCdwYVdvcmtwbGFuQ3RybCcsIHBhV29ya3BsYW5DdHJsKTtcclxuXHJcbmZ1bmN0aW9uIHBhV29ya3BsYW5DdHJsKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsICRodHRwLCBkYXRhLCBjb25maWcpIHtcclxuICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRzY29wZS5kYXRhID0gZGF0YTtcclxuICAgICRzY29wZS5sb2FkQ29udGVudHMoKTtcclxuICAgICRzY29wZS5zb3J0YWJsZU9wdGlvbnM9e1xyXG4gICAgICB1cGRhdGU6IGZ1bmN0aW9uKGUsIHVpKXtcclxuICAgICAgICAkaHR0cC5wdXQoY29uZmlnLmFwaVVybCArICcvd3Mvd29ya3BsYW5zLycgKyBkYXRhLl9pZCwgZGF0YSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG5cclxuICAkc2NvcGUubG9hZENvbnRlbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKGRhdGEuX2lkKSB7XHJcbiAgICAgICRodHRwLmdldChjb25maWcuYXBpVXJsICsgJy93cy93b3JrcGxhbnMvJyArIGRhdGEuX2lkICsgJy9jb250ZW50cycpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgICAkc2NvcGUuZGF0YS5jb250ZW50cyA9IHJlc3AuZGF0YTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICRodHRwW1wiZGVsZXRlXCJdKGNvbmZpZy5hcGlVcmwgKyAnL3dzL3dvcmtwbGFucy8nICsgZGF0YS5faWQpLnRoZW4oZnVuY3Rpb24gKHJlc3ApIHtcclxuICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5vayA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmIChkYXRhLl9pZCkge1xyXG4gICAgICAkaHR0cC5wdXQoY29uZmlnLmFwaVVybCArICcvd3Mvd29ya3BsYW5zLycgKyBkYXRhLl9pZCwgZGF0YSkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAgIGlmIChyZXNwLmRhdGEuZXJyb3IpIHtcclxuICAgICAgICAgICRzY29wZS5lcnJvciA9IHJlc3AuZGF0YS5lcnJvcjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgJGh0dHAucG9zdChjb25maWcuYXBpVXJsICsgJy93cy93b3JrcGxhbnMnLCBkYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwKSB7XHJcbiAgICAgICAgaWYgKHJlc3AuZGF0YS5lcnJvcikge1xyXG4gICAgICAgICAgJHNjb3BlLmVycm9yID0gcmVzcC5kYXRhLmVycm9yO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICR1aWJNb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xyXG4gIH07XHJcblxyXG4gICRzY29wZS5yZW1vdmVDb250ZW50ID0gZnVuY3Rpb24gKGNvbnRlbnQpIHtcclxuICAgICRodHRwW1wiZGVsZXRlXCJdKGNvbmZpZy5hcGlVcmwgKyAnL3dzL2NvbnRlbnRzLycgKyBjb250ZW50Ll9pZCkudGhlbihmdW5jdGlvbiAocmVzcCkge1xyXG4gICAgICAkc2NvcGUubG9hZENvbnRlbnRzKCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAkc2NvcGUuaW5pdCgpO1xyXG59Il19