"use strict";

adrag.$inject = ["$document"];
angular.module('paApp').directive('adrag', adrag);

function adrag($document) {
  return {
    link: function link(scope, el, attrs) {
      angular.element(el).attr("draggable", "true");
      el.bind('dragstart', function (e) {
        var oe = e.originalEvent;
        oe.dataTransfer.effectAllowed = 'move';
        var data = {
          id: attrs.adrag,
          offsetX: oe.offsetX,
          offsetY: oe.offsetY
        };
        oe.dataTransfer.setData("text", JSON.stringify(data));
        console.log(e.originalEvent.clientY);
      });
    }
  };
}
"use strict";

adrop.$inject = ["$document"];
angular.module('paApp').directive('adrop', adrop);

function adrop($document) {
  return {
    link: function link(scope, el, attrs) {
      el.on('dragover', function (e) {
        if (e.preventDefault) {
          e.preventDefault();
        }
      });
      el.on('drop', function (e) {
        if (e.preventDefault) {
          e.preventDefault();
        }

        if (e.stopPropogation) {
          e.stopPropogation();
        }

        var text = e.originalEvent.dataTransfer.getData("text");
        var data = JSON.parse(text);
        var rect = document.getElementById(attrs.id).getBoundingClientRect();
        var w = rect.right - rect.left;
        var h = rect.bottom - rect.top; //tX,tY are coords of top/left corner of draggable item, relative to drop area

        var tX = e.originalEvent.clientX - rect.left - data.offsetX;
        var tY = e.originalEvent.clientY - rect.top - data.offsetY;
        var item = scope.collection.resources[data.id];
        item.top = Math.round(tY / parseInt(h) * 100);
        item.left = Math.round(tX / parseInt(w) * 100);
        scope.$apply();
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.alerts', alerts);

function alerts() {
  return {
    restrict: 'E',
    controller: 'alertsCtrl',
    templateUrl: '/directives/pa.alerts.html'
  };
}
"use strict";

append.$inject = ["$document", "$window", "paSocket", "paCache"];
angular.module('paApp').directive('append', append);

function append($document, $window, paSocket, paCache) {
  return {
    link: function link(scope, el, attrs) {
      var oldBorder = el[0].style.border;
      var newBorder = '1px solid green';
      angular.element(el).droppable({
        accept: function accept(draggable) {
          var conf = paCache.getConf();
          var isLocked = conf.user && conf.user.params && conf.user.params.locked=='true';
          return !isLocked && (!attrs.ngAccept || attrs.ngAccept == draggable.attr('id'));
        },
        over: function over(event, ui) {
          el[0].style.border = newBorder;
        },
        out: function out(event, ui) {
          el[0].style.border = oldBorder;
        },
        drop: function drop(event, ui) {
          var msg = {
            source: ui.draggable.attr('id'),
            target: attrs.id,
            position: attrs.appendPosition
          };
          paSocket.emit("append", msg);
          el[0].style.border = oldBorder;
        }
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('awheel', awheel);

function awheel() {
  return {
    link: function link(scope, el, attrs) {
      el.bind('mousewheel', function (e) {
        scope.$apply(function () {
          scope.$eval(attrs.awheel);
        }); // for IE

        event.returnValue = false; // for Chrome and Firefox

        if (event.preventDefault) {
          event.preventDefault();
        }
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.browse', browse);

function browse() {
  return {
    restrict: 'E',
    controller: 'browseController',
    templateUrl: '/pa/pa.browse.html'
  };
}
"use strict";

angular.module('paApp').directive('pa.canvas', canvas);

function canvas() {
  return {
    restrict: 'E',
    controller: 'canvasCtrl',
    templateUrl: '/pa/pa.canvas.html?b44612280c542847',
    scope: {
      resource: '=',
      name: '@'
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.cardResource', cardResource);

function cardResource() {
  return {
    restrict: 'E',
    transclude: true,
    replace: true,
    controller: 'mixedResourceCtrl',
    templateUrl: '/pa/pa.card-resource.html?9564bfbb9d4da448',
    scope: {
      paResource:'='
    }
  };
}
"use strict";

paChannel.$inject = ["paCache"];
angular.module('paApp').directive('paChannel', paChannel);

function paChannel(paCache) {
  return {
    restrict: 'A',
    scope: {
      channel: '='
    },
    link: function link(scope, element, attrs) {
      paCache.setChannel(scope.channel);
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.collection.audio', collectionAudio);

function collectionAudio() {
  return {
    restrict: 'E',
    scope: {
      collection: '=',
      contentType: '@'
    },
    controller: 'collectionEditorController',
    templateUrl: '/pa/pa.collection.audio.html?69e892096559c417'
  };
}
"use strict";

angular.module('paApp').directive('pa.collection.card', collectionCard);

function collectionCard() {
  return {
    restrict: 'E',
    scope: {
      collection: '=',
      contentType: '@'
    },
    controller: 'collectionEditorController',
    templateUrl: '/pa/pa.collection.card.html?cf64a0b722613c16'
  };
}
"use strict";

angular.module('paApp').directive('pa.collection.editor', collectionEditor);

function collectionEditor() {
  return {
    restrict: 'E',
    scope: {
      collection: '=',
      contentType: '@'
    },
    controller: 'collectionEditorController',
    templateUrl: '/pa/pa.collection.editor.html?c20a383b8585c345'
  };
}
"use strict";

angular.module('paApp').directive('contenteditable', contenteditable);

function contenteditable() {
  return {
    require: 'ngModel',
    restrict: 'A',
    link: function link(scope, elm, attr, ngModel) {
      function updateViewValue() {
        var i = parseInt(attr.id);

        if (i > -1) {
          var c = scope.text.chars[i];
          var c1 = {
            val: this.innerText.charAt(0)
          };
          var c2 = {
            val: this.innerText.charAt(1)
          };
          scope.text.chars.splice(i, 1, c1, c2);
        }

        scope.$apply();
      }
      
      elm.on('keyup', updateViewValue);
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.controlPanel', controlPanle);

function controlPanle() {
  return {
    restrict: 'E',
    controller: 'controlPanelCtrl',
    templateUrl: '/pa/pa.controlPanel.html?a470c4fc34d671b3',
    scope: {
      options: '='
    }
  };
}
"use strict";

angular.module('paApp').directive('paDetectSize', paDetectSize);

function paDetectSize() {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      elem.on('load', function (event) {
        scope.paImage.width = this.width;
        scope.paImage.height = this.height;
        scope.paImage.ratio = this.height / this.width;
        scope.$apply();
      });
    },
    scope: {
      paImage: '='
    }
  };
}
"use strict";

drag.$inject = ["$rootScope", "paCache"];
angular.module('paApp').directive('drag', drag);

function drag($rootScope, paCache) {
  return {
    link: function link(scope, el, attrs) {
      angular.element(el).draggable({
        revert: "invalid"
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.draggableResource', draggableResource);

function draggableResource() {
  return {
    restrict: 'E',
    transclude: true,
    replace: true,
    controller: 'mixedResourceCtrl',
    templateUrl: '/pa/pa.draggable-resource.html?4f9296a41fba2da5',
    scope: {
      paResource:'=',
      paIndex:'@',
      paStyle:'='
    }
  };
}
"use strict";

drop.$inject = ["$document", "$window", "paSocket", "paCache"];
angular.module('paApp').directive('drop', drop);

function drop($document, $window, paSocket, paCache) {
  return {
    link: function link(scope, el, attrs) {
      angular.element(el).droppable({
        tolerance: 'pointer',
        accept: function accept(draggable) {
          var conf = paCache.getConf();
          var isLocked = conf.user && conf.user.params && conf.user.params.locked=='true';
          return !isLocked && (!attrs.ngAccept || attrs.ngAccept == draggable.attr('id'));
        },
        drop: function drop(event, ui) {
          var rect = document.getElementById(attrs.id).getBoundingClientRect();
          var scrollLeft = $window.scrollX;
          var scrollTop = $window.scrollY;
          var x0 = attrs.left ? attrs.left : ui.offset.left - rect.left - scrollLeft;
          var y0 = attrs.top ? attrs.top : ui.offset.top - rect.top - scrollTop;
          var msg = {
            source: ui.draggable.attr('id'),
            target: attrs.id,
            x: x0 / (rect.right - rect.left) * 100,
            y: y0 / (rect.bottom - rect.top) * 100,
            _id: ui.draggable.attr('id')
          };
          paSocket.emit("drag", msg);
        }
      });
    }
  };
}
"use strict";

paEmit.$inject = ["paSocket"];
angular.module('paApp').directive('paEmit', paEmit);

function paEmit(paSocket) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      elem.on('click', function (event) {
        var v = attrs.paEmit.split("=");
        paSocket.emit('var', {
          "var": v[0],
          val: v[1]
        });
      });
    }
  };
}
"use strict";

paEmitBool.$inject = ["paSocket","paCache"];
angular.module('paApp').directive('paEmitBool', paEmitBool);

function paEmitBool(paSocket,paCache) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      elem.on('change', function (event) {
        var data=paCache.getData();
        paSocket.emit('var', {
          "var": attrs.paEmitBool,
          val: data[attrs.paEmitBool]
        });
      });
    }
  };
}
"use strict";

paEmitNum.$inject = ["paSocket"];
angular.module('paApp').directive('paEmitNum', paEmitNum);

function paEmitNum(paSocket) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      elem.on('click', function (event) {
        var v = attrs.paEmitNum.split("=");
        paSocket.emit('var', {
          "var": v[0],
          val: Number(v[1])
        });
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.feed', feed);

function feed() {
  return {
    restrict: 'E',
    controller: 'feedCtrl',
    templateUrl: '/directives/pa.feed.html'
  };
}
"use strict";

fit.$inject = ["$document", "$window", "paSocket", "paCache"];
angular.module('paApp').directive('fit', fit);

function fit($document, $window, paSocket, paCache) {
  return {
    link: function link(scope, el, attrs) {
      var oldBorder = el[0].style.border;
      var newBorder = '1px solid green';
      angular.element(el).droppable({
        accept: function accept(draggable) {
          var conf = paCache.getConf();
          var isLocked = conf.user && conf.user.params && conf.user.params.locked=='true';
          return !isLocked && (!attrs.ngAccept || attrs.ngAccept == draggable.attr('id'));
        },
        over: function over(event, ui) {
          el[0].style.border = newBorder;
        },
        out: function out(event, ui) {
          el[0].style.border = oldBorder;
        },
        drop: function drop(event, ui) {
          var msg = {
            source: ui.draggable.attr('id'),
            target: attrs.id,
            position: attrs.fitPosition
          };
          paSocket.emit("fit", msg);
          el[0].style.border = oldBorder;
        }
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.flipCard', flipImg);

function flipImg() {
  return {
    restrict: 'E',
    templateUrl: '/pa/pa.flipCard.html?e7c5e12428781097'
  };
}
"use strict";

angular.module('paApp').directive('pa.flipCard.card', flipCard);

function flipCard() {
  return {
    restrict: 'E',
    templateUrl: '/pa/pa.flipCard.card.html?44d9631b0d863cc6'
  };
}
"use strict";

angular.module('paApp').directive('pa.flipCardSquare', flipImgSquare);

function flipImgSquare() {
  return {
    restrict: 'E',
    templateUrl: '/pa/pa.flipCardSquare.html?b49683822313cdef'
  };
}
"use strict";

angular.module('paApp').directive('pa.footer', footer);

function footer() {
  return {
    restrict: 'E',
    templateUrl: '/pa/pa.footer.html?aadee5a2a6052da0',
    controller: 'navCtrl'
  };
}
"use strict";

angular.module('paApp').directive('pa.homeworkComments', homeworkComments);

function homeworkComments() {
  return {
    restrict: 'E',
    controller: 'paHomeworkCommentsCtrl',
    templateUrl: '/pa/pa.homework.comments.html?29c3e4bd1ff2a2d9'
  };
}
"use strict";

angular.module('paApp').directive('pa.homeworks', homeworks);

function homeworks() {
  return {
    restrict: 'E',
    controller: 'paHomeworkCtrl',
    templateUrl: '/pa/pa.homeworks.html?1e9a4050a535e942'
  };
}
"use strict";

angular.module('paApp').directive('pa.homeworks.toolbar', homeworksToolbar);

function homeworksToolbar() {
  return {
    restrict: 'E',
    controller: 'paHomeworkCtrl',
    templateUrl: '/pa/pa.homeworks.toolbar.html?3ee5c4bf11c9130d'
  };
}
"use strict";

angular.module('paApp').directive('pa.inlineResource', inlineResource);

function inlineResource() {
  return {
    restrict: 'E',
    controller: 'mixedResourceCtrl',
    templateUrl: '/pa/pa.inline-resource.html?8b0c2937aa82a7bd',
    scope: {
      paResource:'=',
      paSize:'='
    }
  };
}
"use strict";

angular.module('paApp').directive('jsonText', jsonText);

function jsonText() {
    return {
        restrict: 'A',
        require: 'ngModel',
        link: function(scope, element, attr, ngModel) {            
          function into(input) {
            return JSON.parse(input);
          }
          function out(data) {
            return JSON.stringify(data, undefined, 2);
          }
          ngModel.$parsers.push(into);
          ngModel.$formatters.push(out);
        }
    };
}
"use strict";

angular.module('paApp').directive('pa.label', label);

function label() {
  return {
    restrict: 'E',
    scope: {
        key: '@',
        default: '@',
        locale: '@'
    },
    template: '{{::label}}',
    controller: 'labelCtrl'
  };
}
"use strict";

angular.module('paApp').directive('pa.likes', likes);

function likes() {
  return {
    restrict: 'E',
    controller: 'likesController',
    templateUrl: '/pa/pa.likes.html?7d1629d1e330ae99'
  };
}
"use strict";

angular.module('paApp').directive('paLoad', paLoad);

function paLoad() {
  return {
    restrict: 'A',
    link: function link(scope, element, attrs) {
      element.bind('load', function () {
        var img = angular.element(this);
        var rate = img.width() / img.height();

        if (rate > scope.w / 2 * scope.h) {
          img.width(scope.w / 2);
          img.height('auto');
        } else {
          img.width('auto');
          img.height(scope.h);
        }
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('ngLoadImg', ngLoadImg);

function ngLoadImg() {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      var img = new Image();

      img.onload = function (event) {
        elem.css('width', this.width + 'px');
        elem.css('height', this.height + 'px');
        elem.css("background", "url(" + img.src + ") no-repeat");
        scope.image.width = this.width;
        scope.image.height = this.height;
        scope.image.loaded = true;
        scope.$apply();
      };

      img.src = attrs.ngLoadImg;
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.logo', logo);

function logo() {
  return {
    restrict: 'E',
    templateUrl: '/pa/pa.logo.html?d8754f2defb5c552'
  };
}
"use strict";

angular.module('paApp').directive('pa.markers', markers);

function markers() {
  return {
    restrict: 'E',
    controller: 'controlPanelCtrl',
    templateUrl: '/directives/pa.markers.html'
  };
}
"use strict";

angular.module('paApp').directive('pa.nav', nav);

function nav() {
  return {
    restrict: 'E',
    controller: 'navCtrl',
    templateUrl: '/pa/pa.nav.html?6f7e724889808317'
  };
}
"use strict";

ngHeight.$inject = ["$timeout"];
angular.module('paApp').directive('ngHeight', ngHeight);

function ngHeight($timeout) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      attrs.$observe('ngHeight', function (newValue, oldValue) {
        if (newValue != oldValue) {
          elem.css('height', newValue + 'vh');
        }
      });
      $timeout(function () {
        elem.css('height', attrs.ngHeight + 'vh');
      });
    }
  };
}
"use strict";

ngHeightRatio.$inject = ["$timeout"];
angular.module('paApp').directive('ngHeightRatio', ngHeightRatio);

function ngHeightRatio($timeout) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      if (attrs.ngHeightRatio){
        attrs.$observe('ngWidth', function (newValue, oldValue) {
          if (newValue != oldValue) {
            elem.css('height', attrs.ngWidth * attrs.ngHeightRatio + 'vw');
          }
        });
        attrs.$observe('ngHeightRatio', function (newValue, oldValue) {
          if (newValue != oldValue) {
            elem.css('height', attrs.ngWidth * attrs.ngHeightRatio + 'vw');
          }
        });
        $timeout(function () {
          elem.css('height', attrs.ngWidth * attrs.ngHeightRatio + 'vw');
        });
      }
    }
  };
}
"use strict";

ngSquare.$inject = ["$timeout"];
angular.module('paApp').directive('ngSquare', ngSquare);

function ngSquare($timeout) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      attrs.$observe('ngSquare', function (newValue, oldValue) {
        if (newValue != oldValue) {
          elem.css('width', newValue + 'vw');
          elem.css('height', newValue + 'vw');
        }
      });
      $timeout(function () {
        elem.css('width', attrs.ngSquare + 'vw');
        elem.css('height', attrs.ngSquare + 'vw');
      });
    }
  };
}
"use strict";

ngWidth.$inject = ["$timeout"];
angular.module('paApp').directive('ngWidth', ngWidth);

function ngWidth($timeout) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      attrs.$observe('ngWidth', function (newValue, oldValue) {
        if (newValue != oldValue) {
          elem.css('width', newValue + 'vw');
        }
      });
      $timeout(function () {
        elem.css('width', attrs.ngWidth + 'vw');
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.onlineUsers', onlineUsers);

function onlineUsers() {
  return {
    restrict: 'E',
    controller: 'navCtrl',
    templateUrl: '/pa/pa.onlineUsers.html?0167cf2a6da9a85d'
  };
}
"use strict";

angular.module('paApp').directive('pa.chat', paChat);

function paChat() {
  return {
    restrict: 'E',
    controller: 'chatController',
    templateUrl: '/pa/pa.chat.html?13266abc2f31845e'
  };
}
"use strict";

angular.module('paApp').directive('pa.content', paContent);

function paContent() {
  return {
    restrict: 'E',
    controller: 'mdCtrl',
    template: '<div markdown-it="md"></div>',
    scope: {
      page:'@'
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.pageFooter', pageFooter);

function pageFooter() {
  return {
    restrict: 'E',
    templateUrl: '/pa/pa.pageFooter.html?0f56063793e20d31'
  };
}
"use strict";

angular.module('paApp').directive('pa.img', img);

function img() {
  return {
    restrict: 'E',
    replace: true,
    templateUrl: '/pa/pa.img.html?146e0a806ad3e3d8',
    scope: {
      paResource:'=',
      paSize:'=',
      paStyle:'='
    }
  };
}
"use strict";

panel.$inject = ["$document", "paSocket"];
angular.module('paApp').directive('panel', panel);

function panel($document, paSocket) {
  return {
    restrict: 'A',
    link: function link(scope, element) {
      var panel = angular.element(element);
      paSocket.emit("size message", [panel.width(), panel.height()]);
    }
  };
}
"use strict";

paRand.$inject = ["paSocket", "paCache"];
angular.module('paApp').directive('paRand', paRand);

function paRand(paSocket, paCache) {
  return {
    restrict: 'A',
    link: function link(scope, element, attrs) {
      if (scope.admin) {
        var x = Math.random()*100;
        var y = Math.random()*100;
        var css={
          position:'absolute'
        };
  
        if (x>50){
          css['right']=(100-x)+'%';
        } else {
          css['left']=x+'%';
        }
        if (y>50){
          css['bottom']=(100-y)+'%';
        } else {
          css['top']=y+'%';
        }
        paSocket.emit('css', {
          id: attrs.id,
          css: css
        });
      }
    }
  };
}
"use strict";

paParseText.$inject = ["paService"];
angular.module('paApp').directive('paParseText', paParseText);

function paParseText(paService) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      scope.$watch(attrs.paParseText, function (newValue, oldValue) {
        if (!scope.data['chunks'] || newValue != oldValue) {
          var chunks = paService.split(newValue, '#');
          _.each(chunks, function(chunk){
            var words = paService.split(chunk.chars, ' ');
            chunk.words = words;
          })
          scope.data['chunks'] = chunks;
        }
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.text', text);

function text() {
  return {
    restrict: 'E',
    replace: true,
    templateUrl: '/pa/pa.text.html?2d204a62bd2173c5',
    scope: {
      paResource:'=',
      paSize:'=',
      paClass:'@',
      paStyle:'='
    }
  };
}
"use strict";

angular.module('paApp').directive('paTextWidth', paTextWidth);

function paTextWidth() {
  return {
    restrict: 'A',
    link: function link(scope, element, attrs) {
      scope.$watch(attrs.ngModel, function (newValue, oldValue) {
        if (oldValue != newValue) {
          var input = angular.element(element);
          var canvas = document.createElement("canvas");
          var context = canvas.getContext("2d");
          context.font = "normal " + scope.data.textsize + "vw arial";
          var metrics = context.measureText(input.val());
          input.width(metrics.width+4); // add padding and border
        }
      });
    }
  };
}
"use strict";

pop.$inject = ["$document", "paSocket"];
angular.module('paApp').directive('pop', pop);

function pop($document, paSocket) {
  return {
    link: function link(scope, el, attrs) {
      angular.element(el).droppable({
        activate: function activate(event, ui) {
          el[0].style.borderColor = 'green';
        },
        deactivate: function deactivate(event, ui) {
          el[0].style.borderColor = '#ddd';
        },
        drop: function drop(event, ui) {
          var card = _.find(scope.myCards, function (image) {
            return image.id == ui.draggable.attr('id');
          });

          card.push = false;
          scope.playCard(card);
        }
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.post', post);

function post() {
  return {
    restrict: 'E',
    templateUrl: '/pa/pa.post.html?64dbf9c1a3d1a9bd',
    scope: {
      post: '='
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.posts', posts);

function posts() {
  return {
    restrict: 'E',
    controller: 'postsController',
    templateUrl: '/pa/pa.posts.html?e2a2b2ae5e9f42ff',
    scope: {
      post: '='
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.previewResource', previewResource);

function previewResource() {
  return {
    restrict: 'E',
    //controller: 'previewResourceCtrl',
    templateUrl: '/pa/pa.previewResource.html?1932698bf36289e7',
    scope: {
      'resource':'='
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.publish', publish);

function publish() {
  return {
    restrict: 'E',
    controller: 'popupCtrl',
    template: '<i class="fa fa-share-alt" ng-click="popup()"></i>',
    scope: {
      paText: '=',
      paDiv: '@',
      paTime: '@'
    }
  };
}
"use strict";

push.$inject = ["$document", "paSocket"];
angular.module('paApp').directive('push', push);

function push($document, paSocket) {
  return {
    link: function link(scope, el, attrs) {
      angular.element(el).droppable({
        activate: function activate(event, ui) {
          el[0].style.borderColor = 'green';
        },
        deactivate: function deactivate(event, ui) {
          el[0].style.borderColor = '#ddd';
        },
        drop: function drop(event, ui) {
          var card = _.find(scope.myCards, function (image) {
            return image.id == ui.draggable.attr('id');
          });

          card.push = true;
          scope.playCard(card);
        }
      });
    }
  };
}
"use strict";

resizable.$inject = ["$document", "paSocket"];
angular.module('paApp').directive('resizable', resizable);

function resizable($document, paSocket) {
  return {
    link: function link(scope, el, attrs) {
      angular.element(el).resizable({
        stop: function stop(event, ui) {
          scope.resource.sizeFactor = ui.size.width / ui.originalSize.width;
        }
      });
    }
  };
}
"use strict";

resize.$inject = ["$window"];
angular.module('paApp').directive('resize', resize);

function resize($window) {
  return function (scope, element) {
    var w = angular.element($window);

    scope.getWindowDimensions = function () {
      return {
        'h': w.height(),
        'w': w.width()
      };
    };

    scope.$watch(scope.getWindowDimensions, function (newValue, oldValue) {
      scope.windowHeight = newValue.h;
      scope.windowWidth = newValue.w;

      scope.style = function () {
        return {
          'height': newValue.h - 100 + 'px',
          'width': newValue.w - 100 + 'px'
        };
      };
    }, true);
    w.bind('resize', function () {
      scope.$apply();
    });
  };
}
"use strict";

angular.module('paApp').directive('pa.resource', resource);

function resource() {
  return {
    restrict: 'E',
    replace:true,
    controller: 'mixedResourceCtrl',
    templateUrl: '/pa/pa.resource.html?4fad13590c7b2224',
    scope: {
      paResource:'='
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.resourceSize', resourceSize);

function resourceSize() {
  return {
    restrict: 'E',
    replace:true,
    controller: 'mixedResourceCtrl',
    templateUrl: '/pa/pa.resource-size.html?61ce8801bfb98a34',
    scope: {
      paResource:'=',
      paSize:'='
    }
  };
}
"use strict";

paSelect.$inject = ["paSocket", "paCache"];
angular.module('paApp').directive('paSelect', paSelect);

function paSelect(paSocket, paCache) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      elem.on('click', function (event) {
        var i = attrs.paSelect;
        var val = !paCache.getSelected(i);
        paSocket.emit('img2 message', [i, val]);
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.selectableResource', selectableResource);

function selectableResource() {
  return {
    restrict: 'E',
    transclude: true,
    replace: true,
    controller: 'mixedResourceCtrl',
    templateUrl: '/pa/pa.selectable-resource.html?c71c60cd02bb6548',
    scope: {
      paResource:'='
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.selectableWords', selectableWords);

function selectableWords() {
  return {
    restrict: 'E',
    controller: 'mixedResourceCtrl',
    templateUrl: '/pa/pa.selectable-words.html?3f1ad1ceb0f5f923',
    scope: {
      paResource:'=',
      paSize:'='
    }
  };
}
"use strict";

paSelectOne.$inject = ["paSocket"];
angular.module('paApp').directive('paSelectOne', paSelectOne);

function paSelectOne(paSocket) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      elem.on('click', function (event) {
        paSocket.emit('img message', {_id: attrs.paSelectOne});
      });
    }
  };
}
"use strict";

paSplitLines.$inject = ["paService"];
angular.module('paApp').directive('paSplitLines', paSplitLines);

function paSplitLines(paService) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      scope.$watch(attrs.paSplitLines, function (newValue, oldValue) {
        if (!scope.data.lines || newValue != oldValue) {
          scope.data.lines = paService.split(newValue, '\n');
        }
      });
    }
  };
}
"use strict";

paSplitLineWords.$inject = ["paService"];
angular.module('paApp').directive('paSplitLineWords', paSplitLineWords);

function paSplitLineWords(paService) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      scope.$watch(attrs.paSplitLineWords, function (newValue, oldValue) {
        if (!scope.line.words || newValue != oldValue) {
          var splitBy = _.isUndefined(attrs.paSplitBySpace) ? ',' : ' ';
          scope.line.words = paService.split(newValue.chars, splitBy);
        }
      });
    }
  };
}
"use strict";

paSplitUserText.$inject = ["paService"];
angular.module('paApp').directive('paSplitUserText', paSplitUserText);

function paSplitUserText(paService) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      scope.$watch("user.params.text", function (newValue, oldValue) {
        if (newValue != oldValue) {
          scope.user.params.chars = _.map(newValue.split(''), function(c){
            return {val:c};
          });
        }
      });
    }
  };
}
"use strict";

paSplitWordChunks.$inject = ["paService"];
angular.module('paApp').directive('paSplitWordChunks', paSplitWordChunks);

function paSplitWordChunks(paService) {
  var parse = function parse(word) {
    var chunks = [];
    var chunk, currentType;

    _.each(word.chars, function (c) {
      var type;

      if (c.val == '*') {
        type = 'input';
      } else {
        type = 'text';
      }

      if (type == currentType) {
        chunk.text += c.val;
        chunk.chars.push(c);
      } else {
        currentType = type;
        chunk = {
          type: currentType,
          text: c.val,
          chars: [c]
        };
        chunks.push(chunk);
      }
    });

    return chunks;
  };

  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      scope.$watch(attrs.paSplitWordChunks, function (newValue, oldValue) {
        if (!scope.word.chunks || newValue != oldValue) {
          scope.word.chunks = parse(newValue);
        }
      });
    }
  };
}
"use strict";

paSplitWords.$inject = ["paService"];
angular.module('paApp').directive('paSplitWords', paSplitWords);

function paSplitWords(paService) {
  return {
    restrict: 'A',
    link: function link(scope, elem, attrs) {
      scope.$watch(attrs.paSplitWords, function (newValue, oldValue) {
        var attr = attrs.paWordsAttr || 'words';
        if (!scope.data[attr] || newValue != oldValue) {
          var splitBy = _.isUndefined(attrs.paSplitBySpace) ? '#' : ' ';
          scope.data[attr] = paService.split(newValue, splitBy);
        }
      });
    }
  };
}
"use strict";

square.$inject = ["$timeout"];
angular.module('paApp').directive('square', square);

function square($timeout) {
  return {
    restrict: 'A',
    link: function link(scope, element, attrs) {
      $timeout(function () {
        var e = angular.element(element);
        e.height(e.width());
      });
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.storage.browser', storageBrowser);

function storageBrowser() {
  return {
    restrict: 'E',
    scope: {
      resource: '=',
      contentType: '@',
    },
    controller: 'collectionEditorController',
    templateUrl: '/pa/pa.storage-browser.html?65bb2d29b492e15a'
  };
}
"use strict";

angular.module('paApp').directive('pa.style', paStyle);

function paStyle() {
  return {
    restrict: 'E',
    controller: 'paStyleController',
    templateUrl: '/pa/pa.pageStyle.html?0b78ec9795bafb91'
  };
}
"use strict";

angular.module('paApp').directive('pa.text.editor', textEditor);

function textEditor() {
  return {
    restrict: 'E',
    scope: {
      paText: '='
    },
    controller: 'textEditorController',
    templateUrl: '/pa/pa.text.editor.html?32302c525a9ecc8a'
  };
}
"use strict";

angular.module('paApp').directive('pa.userProfile', userProfile);

function userProfile() {
  return {
    restrict: 'E',
    controller: 'navCtrl',
    templateUrl: '/pa/pa.userProfile.html?2f61588933454bcd'
  };
}
"use strict";

youtube.$inject = ["$timeout","paCache"];
angular.module('paApp').directive('pa.youtube', youtube);

function youtube($timeout, paCache) {
  return {
    restrict: 'E',
    template: '<div id="{{videoId}}"></div>',
    scope: {
      videoId: '@'
    },
    link: function link(scope, element, attrs) {
      $timeout(function () {
        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        player = new YT.Player(attrs.videoId, {
          height: '100%',
          width: '100%',
          videoId: attrs.videoId,
          playerVars: {
            'controls':0,
            'autoplay':0,
            'disablekb':1,
            'showinfo':0,
            'autohide':1
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
        var data = paCache.getData();
        data.player[attrs.videoId] = player; // 4. The API will call this function when the video player is ready.

        function onPlayerReady(event) {
          //event.target.playVideo();
          data.playerReady = true;
        } // 5. The API calls this function when the player's state changes.
        //    The function indicates that when playing a video (state=1),
        //    the player should play for six seconds and then stop.


        var done = false;

        function onPlayerStateChange(event) {
          /*if (event.data == YT.PlayerState.PLAYING && !done) {
            setTimeout(stopVideo, 6000);
            done = true;
          }*/
        }

        function stopVideo() {
          player.stopVideo();
        }
      })
    }
  };
}
"use strict";

angular.module('paApp').directive('pa.zoom', zoom);

function zoom() {
  return {
    restrict: 'E',
    controller: 'navCtrl',
    templateUrl: '/pa/pa.zoom.html?bc6f32c6df17158d'
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkcmFnLmRydi5qcyIsImFkcm9wLmRydi5qcyIsImFsZXJ0cy5kcnYuanMiLCJhcHBlbmQuZHJ2LmpzIiwiYXdoZWVsLmRydi5qcyIsImJyb3dzZS5kcnYuanMiLCJjYW52YXMuLmRydi5qcyIsImNhcmRSZXNvdXJjZS5kcnYuanMiLCJjaGFubmVsLmRydi5qcyIsImNvbGxlY3Rpb25BdWRpby5kcnYuanMiLCJjb2xsZWN0aW9uQ2FyZC5kcnYuanMiLCJjb2xsZWN0aW9uRWRpdG9yLmRydi5qcyIsImNvbnRlbnRlZGl0YWJsZS5kcnYuanMiLCJjb250cm9sUGFuZWwuZHJ2LmpzIiwiZGV0ZWN0U2l6ZS5kcnYuanMiLCJkcmFnLmRydi5qcyIsImRyYWdnYWJsZVJlc291cmNlLmRydi5qcyIsImRyb3AuZHJ2LmpzIiwiZW1pdC5kcnYuanMiLCJlbWl0Qm9vbC5kcnYuanMiLCJlbWl0TnVtLmRydi5qcyIsImZlZWQuZHJ2LmpzIiwiZml0LmRydi5qcyIsImZsaUNhcmQuZHJ2LmpzIiwiZmxpcENhcmQuY2FyZC5kcnYuanMiLCJmbGlwQ2FyZFNxdWFyZS5kcnYuanMiLCJmb290ZXIuZHJ2LmpzIiwiaG9tZXdvcmsuY29tbWVudHMuZHJ2LmpzIiwiaG9tZXdvcmtzLmRydi5qcyIsImhvbWV3b3Jrcy50b29sYmFyLmRydi5qcyIsImlubGluZVJlc291cmNlLmRydi5qcyIsImpzb24tdGV4dC5kcnYuanMiLCJsYWJlbC5kcnYuanMiLCJsaWtlcy5kcnYuanMiLCJsb2FkLmRydi5qcyIsImxvYWRJbWcuZHJ2LmpzIiwibG9nby5kcnYuanMiLCJtYXJrZXJzLmRydi5qcyIsIm5hdi5kcnYuanMiLCJuZ0hlaWdodC5kcnYuanMiLCJuZ0hlaWdodFJhdGlvLmRydi5qcyIsIm5nU3F1YXJlLmRydi5qcyIsIm5nV2lkdGguZHJ2LmpzIiwib25pbmVVc2Vycy5kcnYuanMiLCJwYUNoYXQuZHJ2LmpzIiwicGFDb250ZW50LmRydi5qcyIsInBhZ2VGb290ZXIuZHJ2LmpzIiwicGFJbWcuZHJ2LmpzIiwicGFuZWwuZHJ2LmpzIiwicGFSYW5kLmRydi5qcyIsInBhcnNlVGV4dC5kcnYuanMiLCJwYVRleHQuZHJ2LmpzIiwicGFUZXh0V2lkdGguZHJ2LmpzIiwicG9wLmRydi5qcyIsInBvc3QuZHJ2LmpzIiwicG9zdHMuZHJ2LmpzIiwicHJldmlld1Jlc291cmNlLmRydi5qcyIsInB1Ymxpc2guZHJ2LmpzIiwicHVzaC5kcnYuanMiLCJyZXNpemFibGUuZHJ2LmpzIiwicmVzaXplLmRydi5qcyIsInJlc291cmNlLmRydi5qcyIsInJlc291cmNlU2l6ZS5kcnYuanMiLCJzZWxlY3QuZHJ2LmpzIiwic2VsZWN0YWJsZVJlc291cmNlLmRydi5qcyIsInNlbGVjdGFibGVXb3Jkcy5kcnYuanMiLCJzZWxlY3RPbmUuZHJ2LmpzIiwic3BsaXRMaW5lcy5kcnYuanMiLCJzcGxpdExpbmVXb3Jkcy5kcnYuanMiLCJzcGxpdFVzZXJUZXh0LmRydi5qcyIsInNwbGl0V29yZENodW5rcy5kcnYuanMiLCJzcGxpdFdvcmRzLmRydi5qcyIsInNxdWFyZS5kcnYuanMiLCJzdG9yYWdlQnJvd3Nlci5kcnYuanMiLCJzdHlsZS5kcnYuanMiLCJ0ZXh0RWRpdG9yLmRydi5qcyIsInVzZXJQcm9maWxlLmRydi5qcyIsInlvdXR1YmUuZHJ2LmpzIiwiem9vbS5kcnYuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImRpcmVjdGl2ZXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hZHJhZy4kaW5qZWN0ID0gW1wiJGRvY3VtZW50XCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ2FkcmFnJywgYWRyYWcpO1xyXG5cclxuZnVuY3Rpb24gYWRyYWcoJGRvY3VtZW50KSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsLCBhdHRycykge1xyXG4gICAgICBhbmd1bGFyLmVsZW1lbnQoZWwpLmF0dHIoXCJkcmFnZ2FibGVcIiwgXCJ0cnVlXCIpO1xyXG4gICAgICBlbC5iaW5kKCdkcmFnc3RhcnQnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHZhciBvZSA9IGUub3JpZ2luYWxFdmVudDtcclxuICAgICAgICBvZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJztcclxuICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgIGlkOiBhdHRycy5hZHJhZyxcclxuICAgICAgICAgIG9mZnNldFg6IG9lLm9mZnNldFgsXHJcbiAgICAgICAgICBvZmZzZXRZOiBvZS5vZmZzZXRZXHJcbiAgICAgICAgfTtcclxuICAgICAgICBvZS5kYXRhVHJhbnNmZXIuc2V0RGF0YShcInRleHRcIiwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGUub3JpZ2luYWxFdmVudC5jbGllbnRZKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYWRyb3AuJGluamVjdCA9IFtcIiRkb2N1bWVudFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdhZHJvcCcsIGFkcm9wKTtcclxuXHJcbmZ1bmN0aW9uIGFkcm9wKCRkb2N1bWVudCkge1xyXG4gIHJldHVybiB7XHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgZWwub24oJ2RyYWdvdmVyJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkge1xyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIGVsLm9uKCdkcm9wJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkge1xyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGUuc3RvcFByb3BvZ2F0aW9uKSB7XHJcbiAgICAgICAgICBlLnN0b3BQcm9wb2dhdGlvbigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRleHQgPSBlLm9yaWdpbmFsRXZlbnQuZGF0YVRyYW5zZmVyLmdldERhdGEoXCJ0ZXh0XCIpO1xyXG4gICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZSh0ZXh0KTtcclxuICAgICAgICB2YXIgcmVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGF0dHJzLmlkKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICB2YXIgdyA9IHJlY3QucmlnaHQgLSByZWN0LmxlZnQ7XHJcbiAgICAgICAgdmFyIGggPSByZWN0LmJvdHRvbSAtIHJlY3QudG9wOyAvL3RYLHRZIGFyZSBjb29yZHMgb2YgdG9wL2xlZnQgY29ybmVyIG9mIGRyYWdnYWJsZSBpdGVtLCByZWxhdGl2ZSB0byBkcm9wIGFyZWFcclxuXHJcbiAgICAgICAgdmFyIHRYID0gZS5vcmlnaW5hbEV2ZW50LmNsaWVudFggLSByZWN0LmxlZnQgLSBkYXRhLm9mZnNldFg7XHJcbiAgICAgICAgdmFyIHRZID0gZS5vcmlnaW5hbEV2ZW50LmNsaWVudFkgLSByZWN0LnRvcCAtIGRhdGEub2Zmc2V0WTtcclxuICAgICAgICB2YXIgaXRlbSA9IHNjb3BlLmNvbGxlY3Rpb24ucmVzb3VyY2VzW2RhdGEuaWRdO1xyXG4gICAgICAgIGl0ZW0udG9wID0gTWF0aC5yb3VuZCh0WSAvIHBhcnNlSW50KGgpICogMTAwKTtcclxuICAgICAgICBpdGVtLmxlZnQgPSBNYXRoLnJvdW5kKHRYIC8gcGFyc2VJbnQodykgKiAxMDApO1xyXG4gICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLmFsZXJ0cycsIGFsZXJ0cyk7XHJcblxyXG5mdW5jdGlvbiBhbGVydHMoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICBjb250cm9sbGVyOiAnYWxlcnRzQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9kaXJlY3RpdmVzL3BhLmFsZXJ0cy5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFwcGVuZC4kaW5qZWN0ID0gW1wiJGRvY3VtZW50XCIsIFwiJHdpbmRvd1wiLCBcInBhU29ja2V0XCIsIFwicGFDYWNoZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdhcHBlbmQnLCBhcHBlbmQpO1xyXG5cclxuZnVuY3Rpb24gYXBwZW5kKCRkb2N1bWVudCwgJHdpbmRvdywgcGFTb2NrZXQsIHBhQ2FjaGUpIHtcclxuICByZXR1cm4ge1xyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgIHZhciBvbGRCb3JkZXIgPSBlbFswXS5zdHlsZS5ib3JkZXI7XHJcbiAgICAgIHZhciBuZXdCb3JkZXIgPSAnMXB4IHNvbGlkIGdyZWVuJztcclxuICAgICAgYW5ndWxhci5lbGVtZW50KGVsKS5kcm9wcGFibGUoe1xyXG4gICAgICAgIGFjY2VwdDogZnVuY3Rpb24gYWNjZXB0KGRyYWdnYWJsZSkge1xyXG4gICAgICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgICAgIHZhciBpc0xvY2tlZCA9IGNvbmYudXNlciAmJiBjb25mLnVzZXIucGFyYW1zICYmIGNvbmYudXNlci5wYXJhbXMubG9ja2VkPT0ndHJ1ZSc7XHJcbiAgICAgICAgICByZXR1cm4gIWlzTG9ja2VkICYmICghYXR0cnMubmdBY2NlcHQgfHwgYXR0cnMubmdBY2NlcHQgPT0gZHJhZ2dhYmxlLmF0dHIoJ2lkJykpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3ZlcjogZnVuY3Rpb24gb3ZlcihldmVudCwgdWkpIHtcclxuICAgICAgICAgIGVsWzBdLnN0eWxlLmJvcmRlciA9IG5ld0JvcmRlcjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG91dDogZnVuY3Rpb24gb3V0KGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgZWxbMF0uc3R5bGUuYm9yZGVyID0gb2xkQm9yZGVyO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZHJvcDogZnVuY3Rpb24gZHJvcChldmVudCwgdWkpIHtcclxuICAgICAgICAgIHZhciBtc2cgPSB7XHJcbiAgICAgICAgICAgIHNvdXJjZTogdWkuZHJhZ2dhYmxlLmF0dHIoJ2lkJyksXHJcbiAgICAgICAgICAgIHRhcmdldDogYXR0cnMuaWQsXHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiBhdHRycy5hcHBlbmRQb3NpdGlvblxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHBhU29ja2V0LmVtaXQoXCJhcHBlbmRcIiwgbXNnKTtcclxuICAgICAgICAgIGVsWzBdLnN0eWxlLmJvcmRlciA9IG9sZEJvcmRlcjtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgnYXdoZWVsJywgYXdoZWVsKTtcclxuXHJcbmZ1bmN0aW9uIGF3aGVlbCgpIHtcclxuICByZXR1cm4ge1xyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgIGVsLmJpbmQoJ21vdXNld2hlZWwnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICBzY29wZS4kZXZhbChhdHRycy5hd2hlZWwpO1xyXG4gICAgICAgIH0pOyAvLyBmb3IgSUVcclxuXHJcbiAgICAgICAgZXZlbnQucmV0dXJuVmFsdWUgPSBmYWxzZTsgLy8gZm9yIENocm9tZSBhbmQgRmlyZWZveFxyXG5cclxuICAgICAgICBpZiAoZXZlbnQucHJldmVudERlZmF1bHQpIHtcclxuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLmJyb3dzZScsIGJyb3dzZSk7XHJcblxyXG5mdW5jdGlvbiBicm93c2UoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICBjb250cm9sbGVyOiAnYnJvd3NlQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5icm93c2UuaHRtbCdcclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLmNhbnZhcycsIGNhbnZhcyk7XHJcblxyXG5mdW5jdGlvbiBjYW52YXMoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICBjb250cm9sbGVyOiAnY2FudmFzQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jYW52YXMuaHRtbCcsXHJcbiAgICBzY29wZToge1xyXG4gICAgICByZXNvdXJjZTogJz0nLFxyXG4gICAgICBuYW1lOiAnQCdcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLmNhcmRSZXNvdXJjZScsIGNhcmRSZXNvdXJjZSk7XHJcblxyXG5mdW5jdGlvbiBjYXJkUmVzb3VyY2UoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgIGNvbnRyb2xsZXI6ICdtaXhlZFJlc291cmNlQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jYXJkLXJlc291cmNlLmh0bWwnLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgcGFSZXNvdXJjZTonPSdcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUNoYW5uZWwuJGluamVjdCA9IFtcInBhQ2FjaGVcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGFDaGFubmVsJywgcGFDaGFubmVsKTtcclxuXHJcbmZ1bmN0aW9uIHBhQ2hhbm5lbChwYUNhY2hlKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICBzY29wZToge1xyXG4gICAgICBjaGFubmVsOiAnPSdcclxuICAgIH0sXHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICBwYUNhY2hlLnNldENoYW5uZWwoc2NvcGUuY2hhbm5lbCk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5jb2xsZWN0aW9uLmF1ZGlvJywgY29sbGVjdGlvbkF1ZGlvKTtcclxuXHJcbmZ1bmN0aW9uIGNvbGxlY3Rpb25BdWRpbygpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIHNjb3BlOiB7XHJcbiAgICAgIGNvbGxlY3Rpb246ICc9JyxcclxuICAgICAgY29udGVudFR5cGU6ICdAJ1xyXG4gICAgfSxcclxuICAgIGNvbnRyb2xsZXI6ICdjb2xsZWN0aW9uRWRpdG9yQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jb2xsZWN0aW9uLmF1ZGlvLmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5jb2xsZWN0aW9uLmNhcmQnLCBjb2xsZWN0aW9uQ2FyZCk7XHJcblxyXG5mdW5jdGlvbiBjb2xsZWN0aW9uQ2FyZCgpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIHNjb3BlOiB7XHJcbiAgICAgIGNvbGxlY3Rpb246ICc9JyxcclxuICAgICAgY29udGVudFR5cGU6ICdAJ1xyXG4gICAgfSxcclxuICAgIGNvbnRyb2xsZXI6ICdjb2xsZWN0aW9uRWRpdG9yQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jb2xsZWN0aW9uLmNhcmQuaHRtbCdcclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLmNvbGxlY3Rpb24uZWRpdG9yJywgY29sbGVjdGlvbkVkaXRvcik7XHJcblxyXG5mdW5jdGlvbiBjb2xsZWN0aW9uRWRpdG9yKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgY29sbGVjdGlvbjogJz0nLFxyXG4gICAgICBjb250ZW50VHlwZTogJ0AnXHJcbiAgICB9LFxyXG4gICAgY29udHJvbGxlcjogJ2NvbGxlY3Rpb25FZGl0b3JDb250cm9sbGVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmNvbGxlY3Rpb24uZWRpdG9yLmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdjb250ZW50ZWRpdGFibGUnLCBjb250ZW50ZWRpdGFibGUpO1xyXG5cclxuZnVuY3Rpb24gY29udGVudGVkaXRhYmxlKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxtLCBhdHRyLCBuZ01vZGVsKSB7XHJcbiAgICAgIGZ1bmN0aW9uIHVwZGF0ZVZpZXdWYWx1ZSgpIHtcclxuICAgICAgICB2YXIgaSA9IHBhcnNlSW50KGF0dHIuaWQpO1xyXG5cclxuICAgICAgICBpZiAoaSA+IC0xKSB7XHJcbiAgICAgICAgICB2YXIgYyA9IHNjb3BlLnRleHQuY2hhcnNbaV07XHJcbiAgICAgICAgICB2YXIgYzEgPSB7XHJcbiAgICAgICAgICAgIHZhbDogdGhpcy5pbm5lclRleHQuY2hhckF0KDApXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgdmFyIGMyID0ge1xyXG4gICAgICAgICAgICB2YWw6IHRoaXMuaW5uZXJUZXh0LmNoYXJBdCgxKVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHNjb3BlLnRleHQuY2hhcnMuc3BsaWNlKGksIDEsIGMxLCBjMik7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzY29wZS4kYXBwbHkoKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgZWxtLm9uKCdrZXl1cCcsIHVwZGF0ZVZpZXdWYWx1ZSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5jb250cm9sUGFuZWwnLCBjb250cm9sUGFubGUpO1xyXG5cclxuZnVuY3Rpb24gY29udHJvbFBhbmxlKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ2NvbnRyb2xQYW5lbEN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuY29udHJvbFBhbmVsLmh0bWwnLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgb3B0aW9uczogJz0nXHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYURldGVjdFNpemUnLCBwYURldGVjdFNpemUpO1xyXG5cclxuZnVuY3Rpb24gcGFEZXRlY3RTaXplKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMpIHtcclxuICAgICAgZWxlbS5vbignbG9hZCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHNjb3BlLnBhSW1hZ2Uud2lkdGggPSB0aGlzLndpZHRoO1xyXG4gICAgICAgIHNjb3BlLnBhSW1hZ2UuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XHJcbiAgICAgICAgc2NvcGUucGFJbWFnZS5yYXRpbyA9IHRoaXMuaGVpZ2h0IC8gdGhpcy53aWR0aDtcclxuICAgICAgICBzY29wZS4kYXBwbHkoKTtcclxuICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgcGFJbWFnZTogJz0nXHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuZHJhZy4kaW5qZWN0ID0gW1wiJHJvb3RTY29wZVwiLCBcInBhQ2FjaGVcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgnZHJhZycsIGRyYWcpO1xyXG5cclxuZnVuY3Rpb24gZHJhZygkcm9vdFNjb3BlLCBwYUNhY2hlKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsLCBhdHRycykge1xyXG4gICAgICBhbmd1bGFyLmVsZW1lbnQoZWwpLmRyYWdnYWJsZSh7XHJcbiAgICAgICAgcmV2ZXJ0OiBcImludmFsaWRcIlxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLmRyYWdnYWJsZVJlc291cmNlJywgZHJhZ2dhYmxlUmVzb3VyY2UpO1xyXG5cclxuZnVuY3Rpb24gZHJhZ2dhYmxlUmVzb3VyY2UoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgIGNvbnRyb2xsZXI6ICdtaXhlZFJlc291cmNlQ3RybCcsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5kcmFnZ2FibGUtcmVzb3VyY2UuaHRtbCcsXHJcbiAgICBzY29wZToge1xyXG4gICAgICBwYVJlc291cmNlOic9JyxcclxuICAgICAgcGFJbmRleDonQCcsXHJcbiAgICAgIHBhU3R5bGU6Jz0nXHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuZHJvcC4kaW5qZWN0ID0gW1wiJGRvY3VtZW50XCIsIFwiJHdpbmRvd1wiLCBcInBhU29ja2V0XCIsIFwicGFDYWNoZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdkcm9wJywgZHJvcCk7XHJcblxyXG5mdW5jdGlvbiBkcm9wKCRkb2N1bWVudCwgJHdpbmRvdywgcGFTb2NrZXQsIHBhQ2FjaGUpIHtcclxuICByZXR1cm4ge1xyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgIGFuZ3VsYXIuZWxlbWVudChlbCkuZHJvcHBhYmxlKHtcclxuICAgICAgICB0b2xlcmFuY2U6ICdwb2ludGVyJyxcclxuICAgICAgICBhY2NlcHQ6IGZ1bmN0aW9uIGFjY2VwdChkcmFnZ2FibGUpIHtcclxuICAgICAgICAgIHZhciBjb25mID0gcGFDYWNoZS5nZXRDb25mKCk7XHJcbiAgICAgICAgICB2YXIgaXNMb2NrZWQgPSBjb25mLnVzZXIgJiYgY29uZi51c2VyLnBhcmFtcyAmJiBjb25mLnVzZXIucGFyYW1zLmxvY2tlZD09J3RydWUnO1xyXG4gICAgICAgICAgcmV0dXJuICFpc0xvY2tlZCAmJiAoIWF0dHJzLm5nQWNjZXB0IHx8IGF0dHJzLm5nQWNjZXB0ID09IGRyYWdnYWJsZS5hdHRyKCdpZCcpKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRyb3A6IGZ1bmN0aW9uIGRyb3AoZXZlbnQsIHVpKSB7XHJcbiAgICAgICAgICB2YXIgcmVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGF0dHJzLmlkKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgICAgIHZhciBzY3JvbGxMZWZ0ID0gJHdpbmRvdy5zY3JvbGxYO1xyXG4gICAgICAgICAgdmFyIHNjcm9sbFRvcCA9ICR3aW5kb3cuc2Nyb2xsWTtcclxuICAgICAgICAgIHZhciB4MCA9IGF0dHJzLmxlZnQgPyBhdHRycy5sZWZ0IDogdWkub2Zmc2V0LmxlZnQgLSByZWN0LmxlZnQgLSBzY3JvbGxMZWZ0O1xyXG4gICAgICAgICAgdmFyIHkwID0gYXR0cnMudG9wID8gYXR0cnMudG9wIDogdWkub2Zmc2V0LnRvcCAtIHJlY3QudG9wIC0gc2Nyb2xsVG9wO1xyXG4gICAgICAgICAgdmFyIG1zZyA9IHtcclxuICAgICAgICAgICAgc291cmNlOiB1aS5kcmFnZ2FibGUuYXR0cignaWQnKSxcclxuICAgICAgICAgICAgdGFyZ2V0OiBhdHRycy5pZCxcclxuICAgICAgICAgICAgeDogeDAgLyAocmVjdC5yaWdodCAtIHJlY3QubGVmdCkgKiAxMDAsXHJcbiAgICAgICAgICAgIHk6IHkwIC8gKHJlY3QuYm90dG9tIC0gcmVjdC50b3ApICogMTAwLFxyXG4gICAgICAgICAgICBfaWQ6IHVpLmRyYWdnYWJsZS5hdHRyKCdpZCcpXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgcGFTb2NrZXQuZW1pdChcImRyYWdcIiwgbXNnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhRW1pdC4kaW5qZWN0ID0gW1wicGFTb2NrZXRcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGFFbWl0JywgcGFFbWl0KTtcclxuXHJcbmZ1bmN0aW9uIHBhRW1pdChwYVNvY2tldCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMpIHtcclxuICAgICAgZWxlbS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICB2YXIgdiA9IGF0dHJzLnBhRW1pdC5zcGxpdChcIj1cIik7XHJcbiAgICAgICAgcGFTb2NrZXQuZW1pdCgndmFyJywge1xyXG4gICAgICAgICAgXCJ2YXJcIjogdlswXSxcclxuICAgICAgICAgIHZhbDogdlsxXVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYUVtaXRCb29sLiRpbmplY3QgPSBbXCJwYVNvY2tldFwiLFwicGFDYWNoZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYUVtaXRCb29sJywgcGFFbWl0Qm9vbCk7XHJcblxyXG5mdW5jdGlvbiBwYUVtaXRCb29sKHBhU29ja2V0LHBhQ2FjaGUpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW0sIGF0dHJzKSB7XHJcbiAgICAgIGVsZW0ub24oJ2NoYW5nZScsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBkYXRhPXBhQ2FjaGUuZ2V0RGF0YSgpO1xyXG4gICAgICAgIHBhU29ja2V0LmVtaXQoJ3ZhcicsIHtcclxuICAgICAgICAgIFwidmFyXCI6IGF0dHJzLnBhRW1pdEJvb2wsXHJcbiAgICAgICAgICB2YWw6IGRhdGFbYXR0cnMucGFFbWl0Qm9vbF1cclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFFbWl0TnVtLiRpbmplY3QgPSBbXCJwYVNvY2tldFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYUVtaXROdW0nLCBwYUVtaXROdW0pO1xyXG5cclxuZnVuY3Rpb24gcGFFbWl0TnVtKHBhU29ja2V0KSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtLCBhdHRycykge1xyXG4gICAgICBlbGVtLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciB2ID0gYXR0cnMucGFFbWl0TnVtLnNwbGl0KFwiPVwiKTtcclxuICAgICAgICBwYVNvY2tldC5lbWl0KCd2YXInLCB7XHJcbiAgICAgICAgICBcInZhclwiOiB2WzBdLFxyXG4gICAgICAgICAgdmFsOiBOdW1iZXIodlsxXSlcclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5mZWVkJywgZmVlZCk7XHJcblxyXG5mdW5jdGlvbiBmZWVkKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ2ZlZWRDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL2RpcmVjdGl2ZXMvcGEuZmVlZC5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmZpdC4kaW5qZWN0ID0gW1wiJGRvY3VtZW50XCIsIFwiJHdpbmRvd1wiLCBcInBhU29ja2V0XCIsIFwicGFDYWNoZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdmaXQnLCBmaXQpO1xyXG5cclxuZnVuY3Rpb24gZml0KCRkb2N1bWVudCwgJHdpbmRvdywgcGFTb2NrZXQsIHBhQ2FjaGUpIHtcclxuICByZXR1cm4ge1xyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgIHZhciBvbGRCb3JkZXIgPSBlbFswXS5zdHlsZS5ib3JkZXI7XHJcbiAgICAgIHZhciBuZXdCb3JkZXIgPSAnMXB4IHNvbGlkIGdyZWVuJztcclxuICAgICAgYW5ndWxhci5lbGVtZW50KGVsKS5kcm9wcGFibGUoe1xyXG4gICAgICAgIGFjY2VwdDogZnVuY3Rpb24gYWNjZXB0KGRyYWdnYWJsZSkge1xyXG4gICAgICAgICAgdmFyIGNvbmYgPSBwYUNhY2hlLmdldENvbmYoKTtcclxuICAgICAgICAgIHZhciBpc0xvY2tlZCA9IGNvbmYudXNlciAmJiBjb25mLnVzZXIucGFyYW1zICYmIGNvbmYudXNlci5wYXJhbXMubG9ja2VkPT0ndHJ1ZSc7XHJcbiAgICAgICAgICByZXR1cm4gIWlzTG9ja2VkICYmICghYXR0cnMubmdBY2NlcHQgfHwgYXR0cnMubmdBY2NlcHQgPT0gZHJhZ2dhYmxlLmF0dHIoJ2lkJykpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb3ZlcjogZnVuY3Rpb24gb3ZlcihldmVudCwgdWkpIHtcclxuICAgICAgICAgIGVsWzBdLnN0eWxlLmJvcmRlciA9IG5ld0JvcmRlcjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG91dDogZnVuY3Rpb24gb3V0KGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgZWxbMF0uc3R5bGUuYm9yZGVyID0gb2xkQm9yZGVyO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZHJvcDogZnVuY3Rpb24gZHJvcChldmVudCwgdWkpIHtcclxuICAgICAgICAgIHZhciBtc2cgPSB7XHJcbiAgICAgICAgICAgIHNvdXJjZTogdWkuZHJhZ2dhYmxlLmF0dHIoJ2lkJyksXHJcbiAgICAgICAgICAgIHRhcmdldDogYXR0cnMuaWQsXHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiBhdHRycy5maXRQb3NpdGlvblxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIHBhU29ja2V0LmVtaXQoXCJmaXRcIiwgbXNnKTtcclxuICAgICAgICAgIGVsWzBdLnN0eWxlLmJvcmRlciA9IG9sZEJvcmRlcjtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEuZmxpcENhcmQnLCBmbGlwSW1nKTtcclxuXHJcbmZ1bmN0aW9uIGZsaXBJbWcoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5mbGlwQ2FyZC5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEuZmxpcENhcmQuY2FyZCcsIGZsaXBDYXJkKTtcclxuXHJcbmZ1bmN0aW9uIGZsaXBDYXJkKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuZmxpcENhcmQuY2FyZC5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEuZmxpcENhcmRTcXVhcmUnLCBmbGlwSW1nU3F1YXJlKTtcclxuXHJcbmZ1bmN0aW9uIGZsaXBJbWdTcXVhcmUoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5mbGlwQ2FyZFNxdWFyZS5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEuZm9vdGVyJywgZm9vdGVyKTtcclxuXHJcbmZ1bmN0aW9uIGZvb3RlcigpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmZvb3Rlci5odG1sJyxcclxuICAgIGNvbnRyb2xsZXI6ICduYXZDdHJsJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEuaG9tZXdvcmtDb21tZW50cycsIGhvbWV3b3JrQ29tbWVudHMpO1xyXG5cclxuZnVuY3Rpb24gaG9tZXdvcmtDb21tZW50cygpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIGNvbnRyb2xsZXI6ICdwYUhvbWV3b3JrQ29tbWVudHNDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmhvbWV3b3JrLmNvbW1lbnRzLmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5ob21ld29ya3MnLCBob21ld29ya3MpO1xyXG5cclxuZnVuY3Rpb24gaG9tZXdvcmtzKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhSG9tZXdvcmtDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmhvbWV3b3Jrcy5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEuaG9tZXdvcmtzLnRvb2xiYXInLCBob21ld29ya3NUb29sYmFyKTtcclxuXHJcbmZ1bmN0aW9uIGhvbWV3b3Jrc1Rvb2xiYXIoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICBjb250cm9sbGVyOiAncGFIb21ld29ya0N0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuaG9tZXdvcmtzLnRvb2xiYXIuaHRtbCdcclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLmlubGluZVJlc291cmNlJywgaW5saW5lUmVzb3VyY2UpO1xyXG5cclxuZnVuY3Rpb24gaW5saW5lUmVzb3VyY2UoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICBjb250cm9sbGVyOiAnbWl4ZWRSZXNvdXJjZUN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuaW5saW5lLXJlc291cmNlLmh0bWwnLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgcGFSZXNvdXJjZTonPScsXHJcbiAgICAgIHBhU2l6ZTonPSdcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ2pzb25UZXh0JywganNvblRleHQpO1xyXG5cclxuZnVuY3Rpb24ganNvblRleHQoKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRyLCBuZ01vZGVsKSB7ICAgICAgICAgICAgXHJcbiAgICAgICAgICBmdW5jdGlvbiBpbnRvKGlucHV0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGlucHV0KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGZ1bmN0aW9uIG91dChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkYXRhLCB1bmRlZmluZWQsIDIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKGludG8pO1xyXG4gICAgICAgICAgbmdNb2RlbC4kZm9ybWF0dGVycy5wdXNoKG91dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5sYWJlbCcsIGxhYmVsKTtcclxuXHJcbmZ1bmN0aW9uIGxhYmVsKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgICBrZXk6ICdAJyxcclxuICAgICAgICBkZWZhdWx0OiAnQCcsXHJcbiAgICAgICAgbG9jYWxlOiAnQCdcclxuICAgIH0sXHJcbiAgICB0ZW1wbGF0ZTogJ3t7OjpsYWJlbH19JyxcclxuICAgIGNvbnRyb2xsZXI6ICdsYWJlbEN0cmwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5saWtlcycsIGxpa2VzKTtcclxuXHJcbmZ1bmN0aW9uIGxpa2VzKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ2xpa2VzQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5saWtlcy5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGFMb2FkJywgcGFMb2FkKTtcclxuXHJcbmZ1bmN0aW9uIHBhTG9hZCgpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgIGVsZW1lbnQuYmluZCgnbG9hZCcsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW1nID0gYW5ndWxhci5lbGVtZW50KHRoaXMpO1xyXG4gICAgICAgIHZhciByYXRlID0gaW1nLndpZHRoKCkgLyBpbWcuaGVpZ2h0KCk7XHJcblxyXG4gICAgICAgIGlmIChyYXRlID4gc2NvcGUudyAvIDIgKiBzY29wZS5oKSB7XHJcbiAgICAgICAgICBpbWcud2lkdGgoc2NvcGUudyAvIDIpO1xyXG4gICAgICAgICAgaW1nLmhlaWdodCgnYXV0bycpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpbWcud2lkdGgoJ2F1dG8nKTtcclxuICAgICAgICAgIGltZy5oZWlnaHQoc2NvcGUuaCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ25nTG9hZEltZycsIG5nTG9hZEltZyk7XHJcblxyXG5mdW5jdGlvbiBuZ0xvYWRJbWcoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtLCBhdHRycykge1xyXG4gICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XHJcblxyXG4gICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgZWxlbS5jc3MoJ3dpZHRoJywgdGhpcy53aWR0aCArICdweCcpO1xyXG4gICAgICAgIGVsZW0uY3NzKCdoZWlnaHQnLCB0aGlzLmhlaWdodCArICdweCcpO1xyXG4gICAgICAgIGVsZW0uY3NzKFwiYmFja2dyb3VuZFwiLCBcInVybChcIiArIGltZy5zcmMgKyBcIikgbm8tcmVwZWF0XCIpO1xyXG4gICAgICAgIHNjb3BlLmltYWdlLndpZHRoID0gdGhpcy53aWR0aDtcclxuICAgICAgICBzY29wZS5pbWFnZS5oZWlnaHQgPSB0aGlzLmhlaWdodDtcclxuICAgICAgICBzY29wZS5pbWFnZS5sb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgaW1nLnNyYyA9IGF0dHJzLm5nTG9hZEltZztcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLmxvZ28nLCBsb2dvKTtcclxuXHJcbmZ1bmN0aW9uIGxvZ28oKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5sb2dvLmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5tYXJrZXJzJywgbWFya2Vycyk7XHJcblxyXG5mdW5jdGlvbiBtYXJrZXJzKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ2NvbnRyb2xQYW5lbEN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvZGlyZWN0aXZlcy9wYS5tYXJrZXJzLmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5uYXYnLCBuYXYpO1xyXG5cclxuZnVuY3Rpb24gbmF2KCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ25hdkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEubmF2Lmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxubmdIZWlnaHQuJGluamVjdCA9IFtcIiR0aW1lb3V0XCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ25nSGVpZ2h0JywgbmdIZWlnaHQpO1xyXG5cclxuZnVuY3Rpb24gbmdIZWlnaHQoJHRpbWVvdXQpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW0sIGF0dHJzKSB7XHJcbiAgICAgIGF0dHJzLiRvYnNlcnZlKCduZ0hlaWdodCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICBpZiAobmV3VmFsdWUgIT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgIGVsZW0uY3NzKCdoZWlnaHQnLCBuZXdWYWx1ZSArICd2aCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBlbGVtLmNzcygnaGVpZ2h0JywgYXR0cnMubmdIZWlnaHQgKyAndmgnKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxubmdIZWlnaHRSYXRpby4kaW5qZWN0ID0gW1wiJHRpbWVvdXRcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgnbmdIZWlnaHRSYXRpbycsIG5nSGVpZ2h0UmF0aW8pO1xyXG5cclxuZnVuY3Rpb24gbmdIZWlnaHRSYXRpbygkdGltZW91dCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMpIHtcclxuICAgICAgaWYgKGF0dHJzLm5nSGVpZ2h0UmF0aW8pe1xyXG4gICAgICAgIGF0dHJzLiRvYnNlcnZlKCduZ1dpZHRoJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgaWYgKG5ld1ZhbHVlICE9IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIGVsZW0uY3NzKCdoZWlnaHQnLCBhdHRycy5uZ1dpZHRoICogYXR0cnMubmdIZWlnaHRSYXRpbyArICd2dycpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGF0dHJzLiRvYnNlcnZlKCduZ0hlaWdodFJhdGlvJywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgaWYgKG5ld1ZhbHVlICE9IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgIGVsZW0uY3NzKCdoZWlnaHQnLCBhdHRycy5uZ1dpZHRoICogYXR0cnMubmdIZWlnaHRSYXRpbyArICd2dycpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIGVsZW0uY3NzKCdoZWlnaHQnLCBhdHRycy5uZ1dpZHRoICogYXR0cnMubmdIZWlnaHRSYXRpbyArICd2dycpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxubmdTcXVhcmUuJGluamVjdCA9IFtcIiR0aW1lb3V0XCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ25nU3F1YXJlJywgbmdTcXVhcmUpO1xyXG5cclxuZnVuY3Rpb24gbmdTcXVhcmUoJHRpbWVvdXQpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW0sIGF0dHJzKSB7XHJcbiAgICAgIGF0dHJzLiRvYnNlcnZlKCduZ1NxdWFyZScsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICBpZiAobmV3VmFsdWUgIT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgIGVsZW0uY3NzKCd3aWR0aCcsIG5ld1ZhbHVlICsgJ3Z3Jyk7XHJcbiAgICAgICAgICBlbGVtLmNzcygnaGVpZ2h0JywgbmV3VmFsdWUgKyAndncnKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZWxlbS5jc3MoJ3dpZHRoJywgYXR0cnMubmdTcXVhcmUgKyAndncnKTtcclxuICAgICAgICBlbGVtLmNzcygnaGVpZ2h0JywgYXR0cnMubmdTcXVhcmUgKyAndncnKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxubmdXaWR0aC4kaW5qZWN0ID0gW1wiJHRpbWVvdXRcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgnbmdXaWR0aCcsIG5nV2lkdGgpO1xyXG5cclxuZnVuY3Rpb24gbmdXaWR0aCgkdGltZW91dCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMpIHtcclxuICAgICAgYXR0cnMuJG9ic2VydmUoJ25nV2lkdGgnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgaWYgKG5ld1ZhbHVlICE9IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICBlbGVtLmNzcygnd2lkdGgnLCBuZXdWYWx1ZSArICd2dycpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBlbGVtLmNzcygnd2lkdGgnLCBhdHRycy5uZ1dpZHRoICsgJ3Z3Jyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEub25saW5lVXNlcnMnLCBvbmxpbmVVc2Vycyk7XHJcblxyXG5mdW5jdGlvbiBvbmxpbmVVc2VycygpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIGNvbnRyb2xsZXI6ICduYXZDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLm9ubGluZVVzZXJzLmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5jaGF0JywgcGFDaGF0KTtcclxuXHJcbmZ1bmN0aW9uIHBhQ2hhdCgpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIGNvbnRyb2xsZXI6ICdjaGF0Q29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5jaGF0Lmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5jb250ZW50JywgcGFDb250ZW50KTtcclxuXHJcbmZ1bmN0aW9uIHBhQ29udGVudCgpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIGNvbnRyb2xsZXI6ICdtZEN0cmwnLFxyXG4gICAgdGVtcGxhdGU6ICc8ZGl2IG1hcmtkb3duLWl0PVwibWRcIj48L2Rpdj4nLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgcGFnZTonQCdcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLnBhZ2VGb290ZXInLCBwYWdlRm9vdGVyKTtcclxuXHJcbmZ1bmN0aW9uIHBhZ2VGb290ZXIoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5wYWdlRm9vdGVyLmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5pbWcnLCBpbWcpO1xyXG5cclxuZnVuY3Rpb24gaW1nKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLmltZy5odG1sJyxcclxuICAgIHNjb3BlOiB7XHJcbiAgICAgIHBhUmVzb3VyY2U6Jz0nLFxyXG4gICAgICBwYVNpemU6Jz0nLFxyXG4gICAgICBwYVN0eWxlOic9J1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhbmVsLiRpbmplY3QgPSBbXCIkZG9jdW1lbnRcIiwgXCJwYVNvY2tldFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYW5lbCcsIHBhbmVsKTtcclxuXHJcbmZ1bmN0aW9uIHBhbmVsKCRkb2N1bWVudCwgcGFTb2NrZXQpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQpIHtcclxuICAgICAgdmFyIHBhbmVsID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpO1xyXG4gICAgICBwYVNvY2tldC5lbWl0KFwic2l6ZSBtZXNzYWdlXCIsIFtwYW5lbC53aWR0aCgpLCBwYW5lbC5oZWlnaHQoKV0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhUmFuZC4kaW5qZWN0ID0gW1wicGFTb2NrZXRcIiwgXCJwYUNhY2hlXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhUmFuZCcsIHBhUmFuZCk7XHJcblxyXG5mdW5jdGlvbiBwYVJhbmQocGFTb2NrZXQsIHBhQ2FjaGUpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcbiAgICAgIGlmIChzY29wZS5hZG1pbikge1xyXG4gICAgICAgIHZhciB4ID0gTWF0aC5yYW5kb20oKSoxMDA7XHJcbiAgICAgICAgdmFyIHkgPSBNYXRoLnJhbmRvbSgpKjEwMDtcclxuICAgICAgICB2YXIgY3NzPXtcclxuICAgICAgICAgIHBvc2l0aW9uOidhYnNvbHV0ZSdcclxuICAgICAgICB9O1xyXG4gIFxyXG4gICAgICAgIGlmICh4PjUwKXtcclxuICAgICAgICAgIGNzc1sncmlnaHQnXT0oMTAwLXgpKyclJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgY3NzWydsZWZ0J109eCsnJSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh5PjUwKXtcclxuICAgICAgICAgIGNzc1snYm90dG9tJ109KDEwMC15KSsnJSc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGNzc1sndG9wJ109eSsnJSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhU29ja2V0LmVtaXQoJ2NzcycsIHtcclxuICAgICAgICAgIGlkOiBhdHRycy5pZCxcclxuICAgICAgICAgIGNzczogY3NzXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYVBhcnNlVGV4dC4kaW5qZWN0ID0gW1wicGFTZXJ2aWNlXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhUGFyc2VUZXh0JywgcGFQYXJzZVRleHQpO1xyXG5cclxuZnVuY3Rpb24gcGFQYXJzZVRleHQocGFTZXJ2aWNlKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtLCBhdHRycykge1xyXG4gICAgICBzY29wZS4kd2F0Y2goYXR0cnMucGFQYXJzZVRleHQsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICBpZiAoIXNjb3BlLmRhdGFbJ2NodW5rcyddIHx8IG5ld1ZhbHVlICE9IG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICB2YXIgY2h1bmtzID0gcGFTZXJ2aWNlLnNwbGl0KG5ld1ZhbHVlLCAnIycpO1xyXG4gICAgICAgICAgXy5lYWNoKGNodW5rcywgZnVuY3Rpb24oY2h1bmspe1xyXG4gICAgICAgICAgICB2YXIgd29yZHMgPSBwYVNlcnZpY2Uuc3BsaXQoY2h1bmsuY2hhcnMsICcgJyk7XHJcbiAgICAgICAgICAgIGNodW5rLndvcmRzID0gd29yZHM7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgc2NvcGUuZGF0YVsnY2h1bmtzJ10gPSBjaHVua3M7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLnRleHQnLCB0ZXh0KTtcclxuXHJcbmZ1bmN0aW9uIHRleHQoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEudGV4dC5odG1sJyxcclxuICAgIHNjb3BlOiB7XHJcbiAgICAgIHBhUmVzb3VyY2U6Jz0nLFxyXG4gICAgICBwYVNpemU6Jz0nLFxyXG4gICAgICBwYUNsYXNzOidAJyxcclxuICAgICAgcGFTdHlsZTonPSdcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhVGV4dFdpZHRoJywgcGFUZXh0V2lkdGgpO1xyXG5cclxuZnVuY3Rpb24gcGFUZXh0V2lkdGgoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG4gICAgICBzY29wZS4kd2F0Y2goYXR0cnMubmdNb2RlbCwgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgIGlmIChvbGRWYWx1ZSAhPSBuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgdmFyIGlucHV0ID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpO1xyXG4gICAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICAgICAgICB2YXIgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgICAgICAgICBjb250ZXh0LmZvbnQgPSBcIm5vcm1hbCBcIiArIHNjb3BlLmRhdGEudGV4dHNpemUgKyBcInZ3IGFyaWFsXCI7XHJcbiAgICAgICAgICB2YXIgbWV0cmljcyA9IGNvbnRleHQubWVhc3VyZVRleHQoaW5wdXQudmFsKCkpO1xyXG4gICAgICAgICAgaW5wdXQud2lkdGgobWV0cmljcy53aWR0aCs0KTsgLy8gYWRkIHBhZGRpbmcgYW5kIGJvcmRlclxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucG9wLiRpbmplY3QgPSBbXCIkZG9jdW1lbnRcIiwgXCJwYVNvY2tldFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwb3AnLCBwb3ApO1xyXG5cclxuZnVuY3Rpb24gcG9wKCRkb2N1bWVudCwgcGFTb2NrZXQpIHtcclxuICByZXR1cm4ge1xyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgIGFuZ3VsYXIuZWxlbWVudChlbCkuZHJvcHBhYmxlKHtcclxuICAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24gYWN0aXZhdGUoZXZlbnQsIHVpKSB7XHJcbiAgICAgICAgICBlbFswXS5zdHlsZS5ib3JkZXJDb2xvciA9ICdncmVlbic7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBkZWFjdGl2YXRlOiBmdW5jdGlvbiBkZWFjdGl2YXRlKGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgZWxbMF0uc3R5bGUuYm9yZGVyQ29sb3IgPSAnI2RkZCc7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBkcm9wOiBmdW5jdGlvbiBkcm9wKGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgdmFyIGNhcmQgPSBfLmZpbmQoc2NvcGUubXlDYXJkcywgZnVuY3Rpb24gKGltYWdlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbWFnZS5pZCA9PSB1aS5kcmFnZ2FibGUuYXR0cignaWQnKTtcclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGNhcmQucHVzaCA9IGZhbHNlO1xyXG4gICAgICAgICAgc2NvcGUucGxheUNhcmQoY2FyZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLnBvc3QnLCBwb3N0KTtcclxuXHJcbmZ1bmN0aW9uIHBvc3QoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5wb3N0Lmh0bWwnLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgcG9zdDogJz0nXHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5wb3N0cycsIHBvc3RzKTtcclxuXHJcbmZ1bmN0aW9uIHBvc3RzKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ3Bvc3RzQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5wb3N0cy5odG1sJyxcclxuICAgIHNjb3BlOiB7XHJcbiAgICAgIHBvc3Q6ICc9J1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEucHJldmlld1Jlc291cmNlJywgcHJldmlld1Jlc291cmNlKTtcclxuXHJcbmZ1bmN0aW9uIHByZXZpZXdSZXNvdXJjZSgpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIC8vY29udHJvbGxlcjogJ3ByZXZpZXdSZXNvdXJjZUN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEucHJldmlld1Jlc291cmNlLmh0bWwnLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgJ3Jlc291cmNlJzonPSdcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLnB1Ymxpc2gnLCBwdWJsaXNoKTtcclxuXHJcbmZ1bmN0aW9uIHB1Ymxpc2goKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICBjb250cm9sbGVyOiAncG9wdXBDdHJsJyxcclxuICAgIHRlbXBsYXRlOiAnPGkgY2xhc3M9XCJmYSBmYS1zaGFyZS1hbHRcIiBuZy1jbGljaz1cInBvcHVwKClcIj48L2k+JyxcclxuICAgIHNjb3BlOiB7XHJcbiAgICAgIHBhVGV4dDogJz0nLFxyXG4gICAgICBwYURpdjogJ0AnLFxyXG4gICAgICBwYVRpbWU6ICdAJ1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnB1c2guJGluamVjdCA9IFtcIiRkb2N1bWVudFwiLCBcInBhU29ja2V0XCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3B1c2gnLCBwdXNoKTtcclxuXHJcbmZ1bmN0aW9uIHB1c2goJGRvY3VtZW50LCBwYVNvY2tldCkge1xyXG4gIHJldHVybiB7XHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbCwgYXR0cnMpIHtcclxuICAgICAgYW5ndWxhci5lbGVtZW50KGVsKS5kcm9wcGFibGUoe1xyXG4gICAgICAgIGFjdGl2YXRlOiBmdW5jdGlvbiBhY3RpdmF0ZShldmVudCwgdWkpIHtcclxuICAgICAgICAgIGVsWzBdLnN0eWxlLmJvcmRlckNvbG9yID0gJ2dyZWVuJztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRlYWN0aXZhdGU6IGZ1bmN0aW9uIGRlYWN0aXZhdGUoZXZlbnQsIHVpKSB7XHJcbiAgICAgICAgICBlbFswXS5zdHlsZS5ib3JkZXJDb2xvciA9ICcjZGRkJztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRyb3A6IGZ1bmN0aW9uIGRyb3AoZXZlbnQsIHVpKSB7XHJcbiAgICAgICAgICB2YXIgY2FyZCA9IF8uZmluZChzY29wZS5teUNhcmRzLCBmdW5jdGlvbiAoaW1hZ2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGltYWdlLmlkID09IHVpLmRyYWdnYWJsZS5hdHRyKCdpZCcpO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgY2FyZC5wdXNoID0gdHJ1ZTtcclxuICAgICAgICAgIHNjb3BlLnBsYXlDYXJkKGNhcmQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucmVzaXphYmxlLiRpbmplY3QgPSBbXCIkZG9jdW1lbnRcIiwgXCJwYVNvY2tldFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdyZXNpemFibGUnLCByZXNpemFibGUpO1xyXG5cclxuZnVuY3Rpb24gcmVzaXphYmxlKCRkb2N1bWVudCwgcGFTb2NrZXQpIHtcclxuICByZXR1cm4ge1xyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWwsIGF0dHJzKSB7XHJcbiAgICAgIGFuZ3VsYXIuZWxlbWVudChlbCkucmVzaXphYmxlKHtcclxuICAgICAgICBzdG9wOiBmdW5jdGlvbiBzdG9wKGV2ZW50LCB1aSkge1xyXG4gICAgICAgICAgc2NvcGUucmVzb3VyY2Uuc2l6ZUZhY3RvciA9IHVpLnNpemUud2lkdGggLyB1aS5vcmlnaW5hbFNpemUud2lkdGg7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5yZXNpemUuJGluamVjdCA9IFtcIiR3aW5kb3dcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncmVzaXplJywgcmVzaXplKTtcclxuXHJcbmZ1bmN0aW9uIHJlc2l6ZSgkd2luZG93KSB7XHJcbiAgcmV0dXJuIGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCkge1xyXG4gICAgdmFyIHcgPSBhbmd1bGFyLmVsZW1lbnQoJHdpbmRvdyk7XHJcblxyXG4gICAgc2NvcGUuZ2V0V2luZG93RGltZW5zaW9ucyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAnaCc6IHcuaGVpZ2h0KCksXHJcbiAgICAgICAgJ3cnOiB3LndpZHRoKClcclxuICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgc2NvcGUuJHdhdGNoKHNjb3BlLmdldFdpbmRvd0RpbWVuc2lvbnMsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgc2NvcGUud2luZG93SGVpZ2h0ID0gbmV3VmFsdWUuaDtcclxuICAgICAgc2NvcGUud2luZG93V2lkdGggPSBuZXdWYWx1ZS53O1xyXG5cclxuICAgICAgc2NvcGUuc3R5bGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICdoZWlnaHQnOiBuZXdWYWx1ZS5oIC0gMTAwICsgJ3B4JyxcclxuICAgICAgICAgICd3aWR0aCc6IG5ld1ZhbHVlLncgLSAxMDAgKyAncHgnXHJcbiAgICAgICAgfTtcclxuICAgICAgfTtcclxuICAgIH0sIHRydWUpO1xyXG4gICAgdy5iaW5kKCdyZXNpemUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5yZXNvdXJjZScsIHJlc291cmNlKTtcclxuXHJcbmZ1bmN0aW9uIHJlc291cmNlKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgcmVwbGFjZTp0cnVlLFxyXG4gICAgY29udHJvbGxlcjogJ21peGVkUmVzb3VyY2VDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLnJlc291cmNlLmh0bWwnLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgcGFSZXNvdXJjZTonPSdcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLnJlc291cmNlU2l6ZScsIHJlc291cmNlU2l6ZSk7XHJcblxyXG5mdW5jdGlvbiByZXNvdXJjZVNpemUoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICByZXBsYWNlOnRydWUsXHJcbiAgICBjb250cm9sbGVyOiAnbWl4ZWRSZXNvdXJjZUN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEucmVzb3VyY2Utc2l6ZS5odG1sJyxcclxuICAgIHNjb3BlOiB7XHJcbiAgICAgIHBhUmVzb3VyY2U6Jz0nLFxyXG4gICAgICBwYVNpemU6Jz0nXHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFTZWxlY3QuJGluamVjdCA9IFtcInBhU29ja2V0XCIsIFwicGFDYWNoZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYVNlbGVjdCcsIHBhU2VsZWN0KTtcclxuXHJcbmZ1bmN0aW9uIHBhU2VsZWN0KHBhU29ja2V0LCBwYUNhY2hlKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtLCBhdHRycykge1xyXG4gICAgICBlbGVtLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHZhciBpID0gYXR0cnMucGFTZWxlY3Q7XHJcbiAgICAgICAgdmFyIHZhbCA9ICFwYUNhY2hlLmdldFNlbGVjdGVkKGkpO1xyXG4gICAgICAgIHBhU29ja2V0LmVtaXQoJ2ltZzIgbWVzc2FnZScsIFtpLCB2YWxdKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5zZWxlY3RhYmxlUmVzb3VyY2UnLCBzZWxlY3RhYmxlUmVzb3VyY2UpO1xyXG5cclxuZnVuY3Rpb24gc2VsZWN0YWJsZVJlc291cmNlKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgdHJhbnNjbHVkZTogdHJ1ZSxcclxuICAgIHJlcGxhY2U6IHRydWUsXHJcbiAgICBjb250cm9sbGVyOiAnbWl4ZWRSZXNvdXJjZUN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuc2VsZWN0YWJsZS1yZXNvdXJjZS5odG1sJyxcclxuICAgIHNjb3BlOiB7XHJcbiAgICAgIHBhUmVzb3VyY2U6Jz0nXHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS5zZWxlY3RhYmxlV29yZHMnLCBzZWxlY3RhYmxlV29yZHMpO1xyXG5cclxuZnVuY3Rpb24gc2VsZWN0YWJsZVdvcmRzKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ21peGVkUmVzb3VyY2VDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLnNlbGVjdGFibGUtd29yZHMuaHRtbCcsXHJcbiAgICBzY29wZToge1xyXG4gICAgICBwYVJlc291cmNlOic9JyxcclxuICAgICAgcGFTaXplOic9J1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhU2VsZWN0T25lLiRpbmplY3QgPSBbXCJwYVNvY2tldFwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYVNlbGVjdE9uZScsIHBhU2VsZWN0T25lKTtcclxuXHJcbmZ1bmN0aW9uIHBhU2VsZWN0T25lKHBhU29ja2V0KSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtLCBhdHRycykge1xyXG4gICAgICBlbGVtLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgIHBhU29ja2V0LmVtaXQoJ2ltZyBtZXNzYWdlJywge19pZDogYXR0cnMucGFTZWxlY3RPbmV9KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxucGFTcGxpdExpbmVzLiRpbmplY3QgPSBbXCJwYVNlcnZpY2VcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGFTcGxpdExpbmVzJywgcGFTcGxpdExpbmVzKTtcclxuXHJcbmZ1bmN0aW9uIHBhU3BsaXRMaW5lcyhwYVNlcnZpY2UpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgIGxpbms6IGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW0sIGF0dHJzKSB7XHJcbiAgICAgIHNjb3BlLiR3YXRjaChhdHRycy5wYVNwbGl0TGluZXMsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICBpZiAoIXNjb3BlLmRhdGEubGluZXMgfHwgbmV3VmFsdWUgIT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgIHNjb3BlLmRhdGEubGluZXMgPSBwYVNlcnZpY2Uuc3BsaXQobmV3VmFsdWUsICdcXG4nKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhU3BsaXRMaW5lV29yZHMuJGluamVjdCA9IFtcInBhU2VydmljZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYVNwbGl0TGluZVdvcmRzJywgcGFTcGxpdExpbmVXb3Jkcyk7XHJcblxyXG5mdW5jdGlvbiBwYVNwbGl0TGluZVdvcmRzKHBhU2VydmljZSkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMpIHtcclxuICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLnBhU3BsaXRMaW5lV29yZHMsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICBpZiAoIXNjb3BlLmxpbmUud29yZHMgfHwgbmV3VmFsdWUgIT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgIHZhciBzcGxpdEJ5ID0gXy5pc1VuZGVmaW5lZChhdHRycy5wYVNwbGl0QnlTcGFjZSkgPyAnLCcgOiAnICc7XHJcbiAgICAgICAgICBzY29wZS5saW5lLndvcmRzID0gcGFTZXJ2aWNlLnNwbGl0KG5ld1ZhbHVlLmNoYXJzLCBzcGxpdEJ5KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhU3BsaXRVc2VyVGV4dC4kaW5qZWN0ID0gW1wicGFTZXJ2aWNlXCJdO1xyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhU3BsaXRVc2VyVGV4dCcsIHBhU3BsaXRVc2VyVGV4dCk7XHJcblxyXG5mdW5jdGlvbiBwYVNwbGl0VXNlclRleHQocGFTZXJ2aWNlKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnQScsXHJcbiAgICBsaW5rOiBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtLCBhdHRycykge1xyXG4gICAgICBzY29wZS4kd2F0Y2goXCJ1c2VyLnBhcmFtcy50ZXh0XCIsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICBpZiAobmV3VmFsdWUgIT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgIHNjb3BlLnVzZXIucGFyYW1zLmNoYXJzID0gXy5tYXAobmV3VmFsdWUuc3BsaXQoJycpLCBmdW5jdGlvbihjKXtcclxuICAgICAgICAgICAgcmV0dXJuIHt2YWw6Y307XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnBhU3BsaXRXb3JkQ2h1bmtzLiRpbmplY3QgPSBbXCJwYVNlcnZpY2VcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGFTcGxpdFdvcmRDaHVua3MnLCBwYVNwbGl0V29yZENodW5rcyk7XHJcblxyXG5mdW5jdGlvbiBwYVNwbGl0V29yZENodW5rcyhwYVNlcnZpY2UpIHtcclxuICB2YXIgcGFyc2UgPSBmdW5jdGlvbiBwYXJzZSh3b3JkKSB7XHJcbiAgICB2YXIgY2h1bmtzID0gW107XHJcbiAgICB2YXIgY2h1bmssIGN1cnJlbnRUeXBlO1xyXG5cclxuICAgIF8uZWFjaCh3b3JkLmNoYXJzLCBmdW5jdGlvbiAoYykge1xyXG4gICAgICB2YXIgdHlwZTtcclxuXHJcbiAgICAgIGlmIChjLnZhbCA9PSAnKicpIHtcclxuICAgICAgICB0eXBlID0gJ2lucHV0JztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0eXBlID0gJ3RleHQnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodHlwZSA9PSBjdXJyZW50VHlwZSkge1xyXG4gICAgICAgIGNodW5rLnRleHQgKz0gYy52YWw7XHJcbiAgICAgICAgY2h1bmsuY2hhcnMucHVzaChjKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjdXJyZW50VHlwZSA9IHR5cGU7XHJcbiAgICAgICAgY2h1bmsgPSB7XHJcbiAgICAgICAgICB0eXBlOiBjdXJyZW50VHlwZSxcclxuICAgICAgICAgIHRleHQ6IGMudmFsLFxyXG4gICAgICAgICAgY2hhcnM6IFtjXVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgY2h1bmtzLnB1c2goY2h1bmspO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gY2h1bmtzO1xyXG4gIH07XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMpIHtcclxuICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLnBhU3BsaXRXb3JkQ2h1bmtzLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgaWYgKCFzY29wZS53b3JkLmNodW5rcyB8fCBuZXdWYWx1ZSAhPSBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgc2NvcGUud29yZC5jaHVua3MgPSBwYXJzZShuZXdWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5wYVNwbGl0V29yZHMuJGluamVjdCA9IFtcInBhU2VydmljZVwiXTtcclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYVNwbGl0V29yZHMnLCBwYVNwbGl0V29yZHMpO1xyXG5cclxuZnVuY3Rpb24gcGFTcGxpdFdvcmRzKHBhU2VydmljZSkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbSwgYXR0cnMpIHtcclxuICAgICAgc2NvcGUuJHdhdGNoKGF0dHJzLnBhU3BsaXRXb3JkcywgZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgIHZhciBhdHRyID0gYXR0cnMucGFXb3Jkc0F0dHIgfHwgJ3dvcmRzJztcclxuICAgICAgICBpZiAoIXNjb3BlLmRhdGFbYXR0cl0gfHwgbmV3VmFsdWUgIT0gb2xkVmFsdWUpIHtcclxuICAgICAgICAgIHZhciBzcGxpdEJ5ID0gXy5pc1VuZGVmaW5lZChhdHRycy5wYVNwbGl0QnlTcGFjZSkgPyAnIycgOiAnICc7XHJcbiAgICAgICAgICBzY29wZS5kYXRhW2F0dHJdID0gcGFTZXJ2aWNlLnNwbGl0KG5ld1ZhbHVlLCBzcGxpdEJ5KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbnNxdWFyZS4kaW5qZWN0ID0gW1wiJHRpbWVvdXRcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgnc3F1YXJlJywgc3F1YXJlKTtcclxuXHJcbmZ1bmN0aW9uIHNxdWFyZSgkdGltZW91dCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBlID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnQpO1xyXG4gICAgICAgIGUuaGVpZ2h0KGUud2lkdGgoKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEuc3RvcmFnZS5icm93c2VyJywgc3RvcmFnZUJyb3dzZXIpO1xyXG5cclxuZnVuY3Rpb24gc3RvcmFnZUJyb3dzZXIoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICBzY29wZToge1xyXG4gICAgICByZXNvdXJjZTogJz0nLFxyXG4gICAgICBjb250ZW50VHlwZTogJ0AnLFxyXG4gICAgfSxcclxuICAgIGNvbnRyb2xsZXI6ICdjb2xsZWN0aW9uRWRpdG9yQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS5zdG9yYWdlLWJyb3dzZXIuaHRtbCdcclxuICB9O1xyXG59IiwiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG5hbmd1bGFyLm1vZHVsZSgncGFBcHAnKS5kaXJlY3RpdmUoJ3BhLnN0eWxlJywgcGFTdHlsZSk7XHJcblxyXG5mdW5jdGlvbiBwYVN0eWxlKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ3BhU3R5bGVDb250cm9sbGVyJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLnBhZ2VTdHlsZS5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEudGV4dC5lZGl0b3InLCB0ZXh0RWRpdG9yKTtcclxuXHJcbmZ1bmN0aW9uIHRleHRFZGl0b3IoKSB7XHJcbiAgcmV0dXJuIHtcclxuICAgIHJlc3RyaWN0OiAnRScsXHJcbiAgICBzY29wZToge1xyXG4gICAgICBwYVRleHQ6ICc9J1xyXG4gICAgfSxcclxuICAgIGNvbnRyb2xsZXI6ICd0ZXh0RWRpdG9yQ29udHJvbGxlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy9wYS9wYS50ZXh0LmVkaXRvci5odG1sJ1xyXG4gIH07XHJcbn0iLCJcInVzZSBzdHJpY3RcIjtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEudXNlclByb2ZpbGUnLCB1c2VyUHJvZmlsZSk7XHJcblxyXG5mdW5jdGlvbiB1c2VyUHJvZmlsZSgpIHtcclxuICByZXR1cm4ge1xyXG4gICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgIGNvbnRyb2xsZXI6ICduYXZDdHJsJyxcclxuICAgIHRlbXBsYXRlVXJsOiAnL3BhL3BhLnVzZXJQcm9maWxlLmh0bWwnXHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxueW91dHViZS4kaW5qZWN0ID0gW1wiJHRpbWVvdXRcIixcInBhQ2FjaGVcIl07XHJcbmFuZ3VsYXIubW9kdWxlKCdwYUFwcCcpLmRpcmVjdGl2ZSgncGEueW91dHViZScsIHlvdXR1YmUpO1xyXG5cclxuZnVuY3Rpb24geW91dHViZSgkdGltZW91dCwgcGFDYWNoZSkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgdGVtcGxhdGU6ICc8ZGl2IGlkPVwie3t2aWRlb0lkfX1cIj48L2Rpdj4nLFxyXG4gICAgc2NvcGU6IHtcclxuICAgICAgdmlkZW9JZDogJ0AnXHJcbiAgICB9LFxyXG4gICAgbGluazogZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIC8vIDMuIFRoaXMgZnVuY3Rpb24gY3JlYXRlcyBhbiA8aWZyYW1lPiAoYW5kIFlvdVR1YmUgcGxheWVyKVxyXG4gICAgICAgIC8vICAgIGFmdGVyIHRoZSBBUEkgY29kZSBkb3dubG9hZHMuXHJcbiAgICAgICAgdmFyIHBsYXllcjtcclxuICAgICAgICBwbGF5ZXIgPSBuZXcgWVQuUGxheWVyKGF0dHJzLnZpZGVvSWQsIHtcclxuICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxyXG4gICAgICAgICAgd2lkdGg6ICcxMDAlJyxcclxuICAgICAgICAgIHZpZGVvSWQ6IGF0dHJzLnZpZGVvSWQsXHJcbiAgICAgICAgICBwbGF5ZXJWYXJzOiB7XHJcbiAgICAgICAgICAgICdjb250cm9scyc6MCxcclxuICAgICAgICAgICAgJ2F1dG9wbGF5JzowLFxyXG4gICAgICAgICAgICAnZGlzYWJsZWtiJzoxLFxyXG4gICAgICAgICAgICAnc2hvd2luZm8nOjAsXHJcbiAgICAgICAgICAgICdhdXRvaGlkZSc6MVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGV2ZW50czoge1xyXG4gICAgICAgICAgICAnb25SZWFkeSc6IG9uUGxheWVyUmVhZHksXHJcbiAgICAgICAgICAgICdvblN0YXRlQ2hhbmdlJzogb25QbGF5ZXJTdGF0ZUNoYW5nZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciBkYXRhID0gcGFDYWNoZS5nZXREYXRhKCk7XHJcbiAgICAgICAgZGF0YS5wbGF5ZXJbYXR0cnMudmlkZW9JZF0gPSBwbGF5ZXI7IC8vIDQuIFRoZSBBUEkgd2lsbCBjYWxsIHRoaXMgZnVuY3Rpb24gd2hlbiB0aGUgdmlkZW8gcGxheWVyIGlzIHJlYWR5LlxyXG5cclxuICAgICAgICBmdW5jdGlvbiBvblBsYXllclJlYWR5KGV2ZW50KSB7XHJcbiAgICAgICAgICAvL2V2ZW50LnRhcmdldC5wbGF5VmlkZW8oKTtcclxuICAgICAgICAgIGRhdGEucGxheWVyUmVhZHkgPSB0cnVlO1xyXG4gICAgICAgIH0gLy8gNS4gVGhlIEFQSSBjYWxscyB0aGlzIGZ1bmN0aW9uIHdoZW4gdGhlIHBsYXllcidzIHN0YXRlIGNoYW5nZXMuXHJcbiAgICAgICAgLy8gICAgVGhlIGZ1bmN0aW9uIGluZGljYXRlcyB0aGF0IHdoZW4gcGxheWluZyBhIHZpZGVvIChzdGF0ZT0xKSxcclxuICAgICAgICAvLyAgICB0aGUgcGxheWVyIHNob3VsZCBwbGF5IGZvciBzaXggc2Vjb25kcyBhbmQgdGhlbiBzdG9wLlxyXG5cclxuXHJcbiAgICAgICAgdmFyIGRvbmUgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gb25QbGF5ZXJTdGF0ZUNoYW5nZShldmVudCkge1xyXG4gICAgICAgICAgLyppZiAoZXZlbnQuZGF0YSA9PSBZVC5QbGF5ZXJTdGF0ZS5QTEFZSU5HICYmICFkb25lKSB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoc3RvcFZpZGVvLCA2MDAwKTtcclxuICAgICAgICAgICAgZG9uZSA9IHRydWU7XHJcbiAgICAgICAgICB9Ki9cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN0b3BWaWRlbygpIHtcclxuICAgICAgICAgIHBsYXllci5zdG9wVmlkZW8oKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgfTtcclxufSIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuYW5ndWxhci5tb2R1bGUoJ3BhQXBwJykuZGlyZWN0aXZlKCdwYS56b29tJywgem9vbSk7XHJcblxyXG5mdW5jdGlvbiB6b29tKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgY29udHJvbGxlcjogJ25hdkN0cmwnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcvcGEvcGEuem9vbS5odG1sJ1xyXG4gIH07XHJcbn0iXX0=